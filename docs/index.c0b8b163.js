var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},e={},n={},s=t.parcelRequireece6;null==s&&((s=function(t){if(t in e)return e[t].exports;if(t in n){var s=n[t];delete n[t];var i={id:t,exports:{}};return e[t]=i,s.call(i.exports,i,i.exports),i.exports}var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(t,e){n[t]=e},t.parcelRequireece6=s),s.register("02Ztr",(function(t,e){var n=s("gpDEB"),i=s("kzBhd"),r=s("72a6v"),o=s("dIU5s");t.exports=function(t,e){return n(t)||i(t,e)||r(t,e)||o()},t.exports.__esModule=!0,t.exports.default=t.exports})),s.register("gpDEB",(function(t,e){t.exports=function(t){if(Array.isArray(t))return t},t.exports.__esModule=!0,t.exports.default=t.exports})),s.register("kzBhd",(function(t,e){t.exports=function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var s,i,r=[],o=!0,a=!1;try{for(n=n.call(t);!(o=(s=n.next()).done)&&(r.push(s.value),!e||r.length!==e);o=!0);}catch(t){a=!0,i=t}finally{try{o||null==n.return||n.return()}finally{if(a)throw i}}return r}},t.exports.__esModule=!0,t.exports.default=t.exports})),s.register("72a6v",(function(t,e){var n=s("2zZPz");t.exports=function(t,e){if(t){if("string"==typeof t)return n(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);return"Object"===s&&t.constructor&&(s=t.constructor.name),"Map"===s||"Set"===s?Array.from(t):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?n(t,e):void 0}},t.exports.__esModule=!0,t.exports.default=t.exports})),s.register("2zZPz",(function(t,e){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,s=new Array(e);n<e;n++)s[n]=t[n];return s},t.exports.__esModule=!0,t.exports.default=t.exports})),s.register("dIU5s",(function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.__esModule=!0,t.exports.default=t.exports})),s.register("fu0YK",(function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t.exports.__esModule=!0,t.exports.default=t.exports})),s.register("lR7jo",(function(t,e){function n(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}t.exports=function(t,e,s){return e&&n(t.prototype,e),s&&n(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t},t.exports.__esModule=!0,t.exports.default=t.exports}));const i=(t,e)=>Array(Math.abs(e)+1).join(t);function r(t,e,n){return function(...s){return console.warn(`${t} is deprecated. Use ${e}.`),n.apply(this,s)}}function o(t){return null!==t&&"object"==typeof t&&"string"==typeof t.name}function a(t){return null!==t&&"object"==typeof t&&"number"==typeof t.step&&"number"==typeof t.alt}const c=[0,2,4,-1,1,3,5],h=c.map((t=>Math.floor(7*t/12)));function l(t){const{step:e,alt:n,oct:s,dir:i=1}=t,r=c[e]+7*n;if(void 0===s)return[i*r];return[i*r,i*(s-h[e]-4*n)]}const u=[3,0,4,1,5,2,6];function d(t){const[e,n,s]=t,i=u[function(t){const e=(t+1)%7;return e<0?7+e:e}(e)],r=Math.floor((e+1)/7);if(void 0===n)return{step:i,alt:r,dir:s};return{step:i,alt:r,oct:n+4*r+h[i],dir:s}}const p={empty:!0,name:"",pc:"",acc:""},f=new Map,m=t=>t<0?i("b",-t):i("#",t),g=t=>"b"===t[0]?-t.length:t.length;function y(t){const e=f.get(t);if(e)return e;const n="string"==typeof t?function(t){const e=v(t);if(""===e[0]||""!==e[3])return p;const n=e[0],s=e[1],i=e[2],r=(n.charCodeAt(0)+3)%7,o=g(s),a=i.length?+i:void 0,c=l({step:r,alt:o,oct:a}),h=n+s+i,u=n+s,d=(b[r]+o+120)%12,f=void 0===a?(_=b[r]+o,w=12,(_%w+w)%w-1188):b[r]+o+12*(a+1),m=f>=0&&f<=127?f:null,y=void 0===a?null:440*Math.pow(2,(f-69)/12);var _,w;return{empty:!1,acc:s,alt:o,chroma:d,coord:c,freq:y,height:f,letter:n,midi:m,name:h,oct:a,pc:u,step:r}}(t):a(t)?y(function(t){const{step:e,alt:n,oct:s}=t,i=(t=>"CDEFGAB".charAt(t))(e);if(!i)return"";const r=i+m(n);return s||0===s?r+s:r}(t)):o(t)?y(t.name):p;return f.set(t,n),n}const _=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function v(t){const e=_.exec(t);return[e[1].toUpperCase(),e[2].replace(/x/g,"##"),e[3],e[4]]}function w(t){return y(d(t))}const b=[0,2,4,5,7,9,11];const T={empty:!0,name:"",acc:""},x=new RegExp("^([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})|(AA|A|P|M|m|d|dd)([-+]?\\d+)$");const A={};function k(t){return"string"==typeof t?A[t]||(A[t]=function(t){const e=function(t){const e=x.exec(`${t}`);return null===e?["",""]:e[1]?[e[1],e[2]]:[e[4],e[3]]}(t);if(""===e[0])return T;const n=+e[0],s=e[1],i=(Math.abs(n)-1)%7,r="PMMPPMM"[i];if("M"===r&&"P"===s)return T;const o="M"===r?"majorable":"perfectable",a=""+n+s,c=n<0?-1:1,h=8===n||-8===n?n:c*(i+1),u=function(t,e){return"M"===e&&"majorable"===t||"P"===e&&"perfectable"===t?0:"m"===e&&"majorable"===t?-1:/^A+$/.test(e)?e.length:/^d+$/.test(e)?-1*("perfectable"===t?e.length:e.length+1):0}(o,s),d=Math.floor((Math.abs(n)-1)/7),p=c*(C[i]+u+12*d),f=(c*(C[i]+u)%12+12)%12,m=l({step:i,alt:u,oct:d,dir:c});return{empty:!1,name:a,num:n,q:s,step:i,alt:u,dir:c,type:o,simple:h,semitones:p,chroma:f,coord:m,oct:d}}(t)):a(t)?k(function(t){const{step:e,alt:n,oct:s=0,dir:r}=t;if(!r)return"";const o=e+1+7*s;return(r<0?"-":"")+(0===o?e+1:o)+function(t,e){return 0===e?"majorable"===t?"M":"P":-1===e&&"majorable"===t?"m":e>0?i("A",e):i("d","perfectable"===t?e:e+1)}("M"==="PMMPPMM"[e]?"majorable":"perfectable",n)}(t)):o(t)?k(t.name):T}const C=[0,2,4,5,7,9,11];function E(t,e){const[n,s=0]=t;return k(d(e||7*n+12*s<0?[-n,-s,-1]:[n,s,1]))}function S(t,e){const n=y(t),s=k(e);if(n.empty||s.empty)return"";const i=n.coord,r=s.coord;return w(1===i.length?[i[0]+r[0]]:[i[0]+r[0],i[1]+r[1]]).name}function M(t,e){const n=y(t),s=y(e);if(n.empty||s.empty)return"";const i=n.coord,r=s.coord,o=r[0]-i[0];return E([o,2===i.length&&2===r.length?r[1]-i[1]:-Math.floor(7*o/12)],s.height===n.height&&null!==s.midi&&null!==n.midi&&n.step>s.step).name}function I(t,e){const n=e.length,s=(t%n+n)%n;return e.slice(s,n).concat(e.slice(0,s))}function D(t){return t.filter((t=>0===t||t))}const P={empty:!0,name:"",setNum:0,chroma:"000000000000",normalized:"000000000000",intervals:[]},O=t=>Number(t).toString(2),R=t=>parseInt(t,2),N=/^[01]{12}$/;function V(t){return N.test(t)}const L={[P.chroma]:P};function q(t){const e=V(t)?t:"number"==typeof(n=t)&&n>=0&&n<=4095?O(t):Array.isArray(t)?function(t){if(0===t.length)return P.chroma;let e;const n=[0,0,0,0,0,0,0,0,0,0,0,0];for(let s=0;s<t.length;s++)e=y(t[s]),e.empty&&(e=k(t[s])),e.empty||(n[e.chroma]=1);return n.join("")}(t):(t=>t&&V(t.chroma))(t)?t.chroma:P.chroma;var n;return L[e]=L[e]||function(t){const e=R(t),n=function(t){const e=t.split("");return e.map(((t,n)=>I(n,e).join("")))}(t).map(R).filter((t=>t>=2048)).sort()[0],s=O(n),i=function(t){const e=[];for(let n=0;n<12;n++)"1"===t.charAt(n)&&e.push(F[n]);return e}(t);return{empty:!1,name:"",setNum:e,chroma:t,normalized:s,intervals:i}}(e)}r("Pcset.pcset","Pcset.get",q);const F=["1P","2m","2M","3m","3M","4P","5d","5P","6m","6M","7m","7M"];function j(t,e=!0){const n=q(t).chroma.split("");return D(n.map(((t,s)=>{const i=I(s,n);return e&&"0"===i[0]?null:i.join("")})))}function U(t){const e=q(t).setNum;return t=>{const n=q(t).setNum;return e&&e!==n&&(n&e)===n}}function B(t){const e=q(t).setNum;return t=>{const n=q(t).setNum;return e&&e!==n&&(n|e)===n}}const z={...P,name:"",quality:"Unknown",intervals:[],aliases:[]};let W=[],$={};function G(t){return $[t]||z}r("ChordType.chordType","ChordType.get",G);function H(){return W.slice()}r("ChordType.entries","ChordType.all",H);function K(t,e,n){const s=function(t){const e=e=>-1!==t.indexOf(e);return e("5A")?"Augmented":e("3M")?"Major":e("5d")?"Diminished":e("3m")?"Minor":"Unknown"}(t),i={...q(t),name:n||"",quality:s,intervals:t,aliases:e};W.push(i),i.name&&($[i.name]=i),$[i.setNum]=i,$[i.chroma]=i,i.aliases.forEach((t=>function(t,e){$[e]=t}(i,t)))}[["1P 3M 5P","major","M ^ "],["1P 3M 5P 7M","major seventh","maj7 Δ ma7 M7 Maj7 ^7"],["1P 3M 5P 7M 9M","major ninth","maj9 Δ9 ^9"],["1P 3M 5P 7M 9M 13M","major thirteenth","maj13 Maj13 ^13"],["1P 3M 5P 6M","sixth","6 add6 add13 M6"],["1P 3M 5P 6M 9M","sixth/ninth","6/9 69 M69"],["1P 3M 6m 7M","major seventh flat sixth","M7b6 ^7b6"],["1P 3M 5P 7M 11A","major seventh sharp eleventh","maj#4 Δ#4 Δ#11 M7#11 ^7#11 maj7#11"],["1P 3m 5P","minor","m min -"],["1P 3m 5P 7m","minor seventh","m7 min7 mi7 -7"],["1P 3m 5P 7M","minor/major seventh","m/ma7 m/maj7 mM7 mMaj7 m/M7 -Δ7 mΔ -^7"],["1P 3m 5P 6M","minor sixth","m6 -6"],["1P 3m 5P 7m 9M","minor ninth","m9 -9"],["1P 3m 5P 7M 9M","minor/major ninth","mM9 mMaj9 -^9"],["1P 3m 5P 7m 9M 11P","minor eleventh","m11 -11"],["1P 3m 5P 7m 9M 13M","minor thirteenth","m13 -13"],["1P 3m 5d","diminished","dim ° o"],["1P 3m 5d 7d","diminished seventh","dim7 °7 o7"],["1P 3m 5d 7m","half-diminished","m7b5 ø -7b5 h7 h"],["1P 3M 5P 7m","dominant seventh","7 dom"],["1P 3M 5P 7m 9M","dominant ninth","9"],["1P 3M 5P 7m 9M 13M","dominant thirteenth","13"],["1P 3M 5P 7m 11A","lydian dominant seventh","7#11 7#4"],["1P 3M 5P 7m 9m","dominant flat ninth","7b9"],["1P 3M 5P 7m 9A","dominant sharp ninth","7#9"],["1P 3M 7m 9m","altered","alt7"],["1P 4P 5P","suspended fourth","sus4 sus"],["1P 2M 5P","suspended second","sus2"],["1P 4P 5P 7m","suspended fourth seventh","7sus4 7sus"],["1P 5P 7m 9M 11P","eleventh","11"],["1P 4P 5P 7m 9m","suspended fourth flat ninth","b9sus phryg 7b9sus 7b9sus4"],["1P 5P","fifth","5"],["1P 3M 5A","augmented","aug + +5 ^#5"],["1P 3m 5A","minor augmented","m#5 -#5 m+"],["1P 3M 5A 7M","augmented seventh","maj7#5 maj7+5 +maj7 ^7#5"],["1P 3M 5P 7M 9M 11A","major sharp eleventh (lydian)","maj9#11 Δ9#11 ^9#11"],["1P 2M 4P 5P","","sus24 sus4add9"],["1P 3M 5A 7M 9M","","maj9#5 Maj9#5"],["1P 3M 5A 7m","","7#5 +7 7+ 7aug aug7"],["1P 3M 5A 7m 9A","","7#5#9 7#9#5 7alt"],["1P 3M 5A 7m 9M","","9#5 9+"],["1P 3M 5A 7m 9M 11A","","9#5#11"],["1P 3M 5A 7m 9m","","7#5b9 7b9#5"],["1P 3M 5A 7m 9m 11A","","7#5b9#11"],["1P 3M 5A 9A","","+add#9"],["1P 3M 5A 9M","","M#5add9 +add9"],["1P 3M 5P 6M 11A","","M6#11 M6b5 6#11 6b5"],["1P 3M 5P 6M 7M 9M","","M7add13"],["1P 3M 5P 6M 9M 11A","","69#11"],["1P 3m 5P 6M 9M","","m69 -69"],["1P 3M 5P 6m 7m","","7b6"],["1P 3M 5P 7M 9A 11A","","maj7#9#11"],["1P 3M 5P 7M 9M 11A 13M","","M13#11 maj13#11 M13+4 M13#4"],["1P 3M 5P 7M 9m","","M7b9"],["1P 3M 5P 7m 11A 13m","","7#11b13 7b5b13"],["1P 3M 5P 7m 13M","","7add6 67 7add13"],["1P 3M 5P 7m 9A 11A","","7#9#11 7b5#9 7#9b5"],["1P 3M 5P 7m 9A 11A 13M","","13#9#11"],["1P 3M 5P 7m 9A 11A 13m","","7#9#11b13"],["1P 3M 5P 7m 9A 13M","","13#9"],["1P 3M 5P 7m 9A 13m","","7#9b13"],["1P 3M 5P 7m 9M 11A","","9#11 9+4 9#4"],["1P 3M 5P 7m 9M 11A 13M","","13#11 13+4 13#4"],["1P 3M 5P 7m 9M 11A 13m","","9#11b13 9b5b13"],["1P 3M 5P 7m 9m 11A","","7b9#11 7b5b9 7b9b5"],["1P 3M 5P 7m 9m 11A 13M","","13b9#11"],["1P 3M 5P 7m 9m 11A 13m","","7b9b13#11 7b9#11b13 7b5b9b13"],["1P 3M 5P 7m 9m 13M","","13b9"],["1P 3M 5P 7m 9m 13m","","7b9b13"],["1P 3M 5P 7m 9m 9A","","7b9#9"],["1P 3M 5P 9M","","Madd9 2 add9 add2"],["1P 3M 5P 9m","","Maddb9"],["1P 3M 5d","","Mb5"],["1P 3M 5d 6M 7m 9M","","13b5"],["1P 3M 5d 7M","","M7b5"],["1P 3M 5d 7M 9M","","M9b5"],["1P 3M 5d 7m","","7b5"],["1P 3M 5d 7m 9M","","9b5"],["1P 3M 7m","","7no5"],["1P 3M 7m 13m","","7b13"],["1P 3M 7m 9M","","9no5"],["1P 3M 7m 9M 13M","","13no5"],["1P 3M 7m 9M 13m","","9b13"],["1P 3m 4P 5P","","madd4"],["1P 3m 5P 6m 7M","","mMaj7b6"],["1P 3m 5P 6m 7M 9M","","mMaj9b6"],["1P 3m 5P 7m 11P","","m7add11 m7add4"],["1P 3m 5P 9M","","madd9"],["1P 3m 5d 6M 7M","","o7M7"],["1P 3m 5d 7M","","oM7"],["1P 3m 6m 7M","","mb6M7"],["1P 3m 6m 7m","","m7#5"],["1P 3m 6m 7m 9M","","m9#5"],["1P 3m 5A 7m 9M 11P","","m11A"],["1P 3m 6m 9m","","mb6b9"],["1P 2M 3m 5d 7m","","m9b5"],["1P 4P 5A 7M","","M7#5sus4"],["1P 4P 5A 7M 9M","","M9#5sus4"],["1P 4P 5A 7m","","7#5sus4"],["1P 4P 5P 7M","","M7sus4"],["1P 4P 5P 7M 9M","","M9sus4"],["1P 4P 5P 7m 9M","","9sus4 9sus"],["1P 4P 5P 7m 9M 13M","","13sus4 13sus"],["1P 4P 5P 7m 9m 13m","","7sus4b9b13 7b9b13sus4"],["1P 4P 7m 10m","","4 quartal"],["1P 5P 7m 9m 11P","","11b9"]].forEach((([t,e,n])=>K(t.split(" "),n.split(" "),e))),W.sort(((t,e)=>t.setNum-e.setNum));const X={...P,intervals:[],aliases:[]};let Y=[],Q={};function Z(t){return Q[t]||X}r("ScaleDictionary.scaleType","ScaleType.get",Z);function J(){return Y.slice()}r("ScaleDictionary.entries","ScaleType.all",J);function tt(t,e,n=[]){const s={...q(t),name:e,intervals:t,aliases:n};return Y.push(s),Q[s.name]=s,Q[s.setNum]=s,Q[s.chroma]=s,s.aliases.forEach((t=>function(t,e){Q[e]=t}(s,t))),s}[["1P 2M 3M 5P 6M","major pentatonic","pentatonic"],["1P 3M 4P 5P 7M","ionian pentatonic"],["1P 3M 4P 5P 7m","mixolydian pentatonic","indian"],["1P 2M 4P 5P 6M","ritusen"],["1P 2M 4P 5P 7m","egyptian"],["1P 3M 4P 5d 7m","neopolitan major pentatonic"],["1P 3m 4P 5P 6m","vietnamese 1"],["1P 2m 3m 5P 6m","pelog"],["1P 2m 4P 5P 6m","kumoijoshi"],["1P 2M 3m 5P 6m","hirajoshi"],["1P 2m 4P 5d 7m","iwato"],["1P 2m 4P 5P 7m","in-sen"],["1P 3M 4A 5P 7M","lydian pentatonic","chinese"],["1P 3m 4P 6m 7m","malkos raga"],["1P 3m 4P 5d 7m","locrian pentatonic","minor seven flat five pentatonic"],["1P 3m 4P 5P 7m","minor pentatonic","vietnamese 2"],["1P 3m 4P 5P 6M","minor six pentatonic"],["1P 2M 3m 5P 6M","flat three pentatonic","kumoi"],["1P 2M 3M 5P 6m","flat six pentatonic"],["1P 2m 3M 5P 6M","scriabin"],["1P 3M 5d 6m 7m","whole tone pentatonic"],["1P 3M 4A 5A 7M","lydian #5P pentatonic"],["1P 3M 4A 5P 7m","lydian dominant pentatonic"],["1P 3m 4P 5P 7M","minor #7M pentatonic"],["1P 3m 4d 5d 7m","super locrian pentatonic"],["1P 2M 3m 4P 5P 7M","minor hexatonic"],["1P 2A 3M 5P 5A 7M","augmented"],["1P 2M 3m 3M 5P 6M","major blues"],["1P 2M 4P 5P 6M 7m","piongio"],["1P 2m 3M 4A 6M 7m","prometheus neopolitan"],["1P 2M 3M 4A 6M 7m","prometheus"],["1P 2m 3M 5d 6m 7m","mystery #1"],["1P 2m 3M 4P 5A 6M","six tone symmetric"],["1P 2M 3M 4A 5A 7m","whole tone","messiaen's mode #1"],["1P 2m 4P 4A 5P 7M","messiaen's mode #5"],["1P 3m 4P 5d 5P 7m","minor blues","blues"],["1P 2M 3M 4P 5d 6m 7m","locrian major","arabian"],["1P 2m 3M 4A 5P 6m 7M","double harmonic lydian"],["1P 2M 3m 4P 5P 6m 7M","harmonic minor"],["1P 2m 2A 3M 4A 6m 7m","altered","super locrian","diminished whole tone","pomeroy"],["1P 2M 3m 4P 5d 6m 7m","locrian #2","half-diminished","aeolian b5"],["1P 2M 3M 4P 5P 6m 7m","mixolydian b6","melodic minor fifth mode","hindu"],["1P 2M 3M 4A 5P 6M 7m","lydian dominant","lydian b7","overtone"],["1P 2M 3M 4A 5P 6M 7M","lydian"],["1P 2M 3M 4A 5A 6M 7M","lydian augmented"],["1P 2m 3m 4P 5P 6M 7m","dorian b2","phrygian #6","melodic minor second mode"],["1P 2M 3m 4P 5P 6M 7M","melodic minor"],["1P 2m 3m 4P 5d 6m 7m","locrian"],["1P 2m 3m 4d 5d 6m 7d","ultralocrian","superlocrian bb7","superlocrian diminished"],["1P 2m 3m 4P 5d 6M 7m","locrian 6","locrian natural 6","locrian sharp 6"],["1P 2A 3M 4P 5P 5A 7M","augmented heptatonic"],["1P 2M 3m 4A 5P 6M 7m","dorian #4","ukrainian dorian","romanian minor","altered dorian"],["1P 2M 3m 4A 5P 6M 7M","lydian diminished"],["1P 2m 3m 4P 5P 6m 7m","phrygian"],["1P 2M 3M 4A 5A 7m 7M","leading whole tone"],["1P 2M 3M 4A 5P 6m 7m","lydian minor"],["1P 2m 3M 4P 5P 6m 7m","phrygian dominant","spanish","phrygian major"],["1P 2m 3m 4P 5P 6m 7M","balinese"],["1P 2m 3m 4P 5P 6M 7M","neopolitan major"],["1P 2M 3m 4P 5P 6m 7m","aeolian","minor"],["1P 2M 3M 4P 5P 6m 7M","harmonic major"],["1P 2m 3M 4P 5P 6m 7M","double harmonic major","gypsy"],["1P 2M 3m 4P 5P 6M 7m","dorian"],["1P 2M 3m 4A 5P 6m 7M","hungarian minor"],["1P 2A 3M 4A 5P 6M 7m","hungarian major"],["1P 2m 3M 4P 5d 6M 7m","oriental"],["1P 2m 3m 3M 4A 5P 7m","flamenco"],["1P 2m 3m 4A 5P 6m 7M","todi raga"],["1P 2M 3M 4P 5P 6M 7m","mixolydian","dominant"],["1P 2m 3M 4P 5d 6m 7M","persian"],["1P 2M 3M 4P 5P 6M 7M","major","ionian"],["1P 2m 3M 5d 6m 7m 7M","enigmatic"],["1P 2M 3M 4P 5A 6M 7M","major augmented","major #5","ionian augmented","ionian #5"],["1P 2A 3M 4A 5P 6M 7M","lydian #9"],["1P 2m 2M 4P 4A 5P 6m 7M","messiaen's mode #4"],["1P 2m 3M 4P 4A 5P 6m 7M","purvi raga"],["1P 2m 3m 3M 4P 5P 6m 7m","spanish heptatonic"],["1P 2M 3M 4P 5P 6M 7m 7M","bebop"],["1P 2M 3m 3M 4P 5P 6M 7m","bebop minor"],["1P 2M 3M 4P 5P 5A 6M 7M","bebop major"],["1P 2m 3m 4P 5d 5P 6m 7m","bebop locrian"],["1P 2M 3m 4P 5P 6m 7m 7M","minor bebop"],["1P 2M 3m 4P 5d 6m 6M 7M","diminished","whole-half diminished"],["1P 2M 3M 4P 5d 5P 6M 7M","ichikosucho"],["1P 2M 3m 4P 5P 6m 6M 7M","minor six diminished"],["1P 2m 3m 3M 4A 5P 6M 7m","half-whole diminished","dominant diminished","messiaen's mode #2"],["1P 3m 3M 4P 5P 6M 7m 7M","kafi raga"],["1P 2M 3M 4P 4A 5A 6A 7M","messiaen's mode #6"],["1P 2M 3m 3M 4P 5d 5P 6M 7m","composite blues"],["1P 2M 3m 3M 4A 5P 6m 7m 7M","messiaen's mode #3"],["1P 2m 2M 3m 4P 4A 5P 6m 6M 7M","messiaen's mode #7"],["1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M","chromatic"]].forEach((([t,e,...n])=>tt(t.split(" "),e,n)));function et(t){const e=t.map((t=>y(t).pc)).filter((t=>t));if(0===y.length)return[];const n=function(t,e){const n=t[0],s=y(n).chroma,i=(t=>{const e=t.reduce(((t,e)=>{const n=y(e).chroma;return void 0!==n&&(t[n]=t[n]||y(e).name),t}),{});return t=>e[t]})(t),r=j(t,!1),o=[];return r.forEach(((t,r)=>{H().filter((e=>e.chroma===t)).forEach((t=>{const a=t.aliases[0],c=i(r);r!==s?o.push({weight:.5*e,name:`${c}${a}/${n}`}):o.push({weight:1*e,name:`${c}${a}`})}))})),o}(e,1);return n.filter((t=>t.weight)).sort(((t,e)=>e.weight-t.weight)).map((t=>t.name))}const nt={empty:!0,name:"",symbol:"",root:"",rootDegree:0,type:"",tonic:null,setNum:NaN,quality:"Unknown",chroma:"",normalized:"",aliases:[],notes:[],intervals:[]},st=/^(6|64|7|9|11|13)$/;function it(t){const[e,n,s,i]=v(t);return""===e?["",t]:"A"===e&&"ug"===i?["","aug"]:i||"4"!==s&&"5"!==s?st.test(s)?[e+n,s+i]:[e+n+s,i]:[e+n,s]}function rt(t){if(""===t)return nt;if(Array.isArray(t)&&2===t.length)return ot(t[1],t[0]);{const[e,n]=it(t),s=ot(n,e);return s.empty?ot(t):s}}function ot(t,e,n){const s=G(t),i=y(e||""),r=y(n||"");if(s.empty||e&&i.empty||n&&r.empty)return nt;const o=M(i.pc,r.pc),a=s.intervals.indexOf(o)+1;if(!r.empty&&!a)return nt;const c=Array.from(s.intervals);for(let t=1;t<a;t++){const t=c[0][0],e=c[0][1],n=parseInt(t,10)+7;c.push(`${n}${e}`),c.shift()}const h=i.empty?[]:c.map((t=>S(i,t)));t=-1!==s.aliases.indexOf(t)?t:s.aliases[0];const l=`${i.empty?"":i.pc}${t}${r.empty||a<=1?"":"/"+r.pc}`,u=`${e?i.pc+" ":""}${s.name}${a>1&&n?" over "+r.pc:""}`;return{...s,name:u,symbol:l,type:s.name,root:r.name,intervals:c,rootDegree:a,tonic:i.name,notes:h}}var at={getChord:ot,get:rt,detect:et,chordScales:function(t){const e=B(rt(t).chroma);return J().filter((t=>e(t.chroma))).map((t=>t.name))},extended:function(t){const e=rt(t),n=B(e.chroma);return H().filter((t=>n(t.chroma))).map((t=>e.tonic+t.aliases[0]))},reduced:function(t){const e=rt(t),n=U(e.chroma);return H().filter((t=>n(t.chroma))).map((t=>e.tonic+t.aliases[0]))},tokenize:it,transpose:function(t,e){const[n,s]=it(t);return n?S(n,e)+s:t},chord:r("Chord.chord","Chord.get",rt)};const ct=[];[[.125,"dl",["large","duplex longa","maxima","octuple","octuple whole"]],[.25,"l",["long","longa"]],[.5,"d",["double whole","double","breve"]],[1,"w",["whole","semibreve"]],[2,"h",["half","minim"]],[4,"q",["quarter","crotchet"]],[8,"e",["eighth","quaver"]],[16,"s",["sixteenth","semiquaver"]],[32,"t",["thirty-second","demisemiquaver"]],[64,"sf",["sixty-fourth","hemidemisemiquaver"]],[128,"h",["hundred twenty-eighth"]],[256,"th",["two hundred fifty-sixth"]]].forEach((([t,e,n])=>function(t,e,n){ct.push({empty:!1,dots:"",name:"",value:1/t,fraction:t<1?[1/t,1]:[1,t],shorthand:e,names:n})}(t,e,n)));const ht=k;function lt(t){const e=k(t);return e.empty?"":e.simple+e.q}const ut=[1,2,2,3,3,4,5,5,6,6,7,7],dt="P m M m M P d P m M m M".split(" ");const pt=M,ft=_t(((t,e)=>[t[0]+e[0],t[1]+e[1]])),mt=_t(((t,e)=>[t[0]-e[0],t[1]-e[1]]));function gt(t,e){const n=ht(t);if(n.empty)return"";const[s,i,r]=n.coord;return E([s+e,i,r]).name}var yt={names:function(){return"1P 2M 3M 4P 5P 6m 7m".split(" ")},get:ht,name:t=>k(t).name,num:t=>k(t).num,semitones:t=>k(t).semitones,quality:t=>k(t).q,fromSemitones:function(t){const e=t<0?-1:1,n=Math.abs(t),s=n%12,i=Math.floor(n/12);return e*(ut[s]+7*i)+dt[s]},distance:pt,invert:function(t){const e=k(t);return e.empty?"":k({step:(7-e.step)%7,alt:"perfectable"===e.type?-e.alt:-(e.alt+1),oct:e.oct,dir:e.dir}).name},simplify:lt,add:ft,addTo:t=>e=>ft(t,e),substract:mt,transposeFifths:gt};function _t(t){return(e,n)=>{const s=k(e).coord,i=k(n).coord;if(s&&i){return E(t(s,i)).name}}}Math.log(2),Math.log(440);"C C# D D# E F F# G G# A A# B".split(" "),"C Db D Eb E F Gb G Ab A Bb B".split(" ");const vt={empty:!0,name:"",chordType:""},wt={};function bt(t){return"string"==typeof t?wt[t]||(wt[t]=function(t){const[e,n,s,i]=(r=t,Tt.exec(r)||["","","",""]);var r;if(!s)return vt;const o=s.toUpperCase(),a=xt.indexOf(o),c=g(n),h=1;return{empty:!1,name:e,roman:s,interval:k({step:a,alt:c,dir:h}).name,acc:n,chordType:i,alt:c,step:a,major:s===o,oct:0,dir:h}}(t)):"number"==typeof t?bt(xt[t]||""):a(t)?bt(m((e=t).alt)+xt[e.step]):o(t)?bt(t.name):vt;var e}r("RomanNumeral.romanNumeral","RomanNumeral.get",bt);const Tt=/^(#{1,}|b{1,}|x{1,}|)(IV|I{1,3}|VI{0,2}|iv|i{1,3}|vi{0,2})([^IViv]*)$/;const xt="I II III IV V VI VII".split(" ");"I II III IV V VI VII".toLowerCase().split(" ");const At=Object.freeze([]),kt={type:"major",tonic:"",alteration:0,keySignature:""},Ct={tonic:"",grades:At,intervals:At,scale:At,chords:At,chordsHarmonicFunction:At,chordScales:At},Et=(t,e,n="")=>e.map(((e,s)=>`${t[s]}${n}${e}`));function St(t,e,n,s){return i=>{const r=t.map((t=>bt(t).interval||"")),o=r.map((t=>S(i,t)));return{tonic:i,grades:t,intervals:r,scale:o,chords:Et(o,e),chordsHarmonicFunction:n.slice(),chordScales:Et(o,s," ")}}}St("I II III IV V VI VII".split(" "),"maj7 m7 m7 maj7 7 m7 m7b5".split(" "),"T SD T SD D T D".split(" "),"major,dorian,phrygian,lydian,mixolydian,minor,locrian".split(",")),St("I II bIII IV V bVI bVII".split(" "),"m7 m7b5 maj7 m7 m7 maj7 7".split(" "),"T SD T SD D SD SD".split(" "),"minor,locrian,major,dorian,phrygian,lydian,mixolydian".split(",")),St("I II bIII IV V bVI VII".split(" "),"mMaj7 m7b5 +maj7 m7 7 maj7 o7".split(" "),"T SD T SD D SD D".split(" "),"harmonic minor,locrian 6,major augmented,lydian diminished,phrygian dominant,lydian #9,ultralocrian".split(",")),St("I II bIII IV V VI VII".split(" "),"m6 m7 +maj7 7 7 m7b5 m7b5".split(" "),"T SD T SD D  ".split(" "),"melodic minor,dorian b2,lydian augmented,lydian dominant,mixolydian b6,locrian #2,altered".split(","));const Mt=[[0,2773,0,"ionian","","Maj7","major"],[1,2902,2,"dorian","m","m7"],[2,3418,4,"phrygian","m","m7"],[3,2741,-1,"lydian","","Maj7"],[4,2774,1,"mixolydian","","7"],[5,2906,3,"aeolian","m","m7","minor"],[6,3434,5,"locrian","dim","m7b5"]],It={...P,name:"",alt:0,modeNum:NaN,triad:"",seventh:"",aliases:[]},Dt=Mt.map((function(t){const[e,n,s,i,r,o,a]=t,c=a?[a]:[],h=Number(n).toString(2);return{empty:!1,intervals:Z(i).intervals,modeNum:e,chroma:h,normalized:h,name:i,setNum:n,alt:s,triad:r,seventh:o,aliases:c}})),Pt={};function Ot(t){return"string"==typeof t?Pt[t.toLowerCase()]||It:t&&t.name?Ot(t.name):It}Dt.forEach((t=>{Pt[t.name]=t,t.aliases.forEach((e=>{Pt[e]=t}))}));r("Mode.mode","Mode.get",Ot);function Rt(){return Dt.slice()}r("Mode.mode","Mode.all",Rt);function Nt(t){return(e,n)=>{const s=Ot(e);if(s.empty)return[];const i=I(s.modeNum,t),r=s.intervals.map((t=>S(n,t)));return i.map(((t,e)=>r[e]+t))}}Nt(Mt.map((t=>t[4]))),Nt(Mt.map((t=>t[5])));const Vt={empty:!0,name:"",type:"",tonic:null,setNum:NaN,chroma:"",normalized:"",aliases:[],notes:[],intervals:[]};function Lt(t){if("string"!=typeof t)return["",""];const e=t.indexOf(" "),n=y(t.substring(0,e));if(n.empty){const e=y(t);return e.empty?["",t]:[e.name,""]}const s=t.substring(n.name.length+1);return[n.name,s.length?s:""]}function qt(t){const e=Array.isArray(t)?t:Lt(t),n=y(e[0]).name,s=Z(e[1]);if(s.empty)return Vt;const i=s.name,r=n?s.intervals.map((t=>S(n,t))):[],o=n?n+" "+i:i;return{...s,name:o,type:i,tonic:n,notes:r}}r("Scale.scale","Scale.get",qt);new Map;$63673e76b6f58a16$import$39f8f2ba4979f6a9;var Ft={};!function(t,e){"object"==typeof Ft?e(Ft,s("02Ztr"),s("fu0YK"),s("lR7jo")):"function"==typeof define&&define.amd?define(["exports","@babel/runtime/helpers/slicedToArray","@babel/runtime/helpers/classCallCheck","@babel/runtime/helpers/createClass"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).automationEvents={},t._slicedToArray,t._classCallCheck,t._createClass)}(Ft,(function(t,e,n,s){function i(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r=i(e),o=i(n),a=i(s),c=function(t,e,n){return{endTime:e,insertTime:n,type:"exponentialRampToValue",value:t}},h=function(t,e,n){return{endTime:e,insertTime:n,type:"linearRampToValue",value:t}},l=function(t,e){return{startTime:e,type:"setValue",value:t}},u=function(t,e,n){return{duration:n,startTime:e,type:"setValueCurve",values:t}},d=function(t,e,n){var s=n.startTime,i=n.target,r=n.timeConstant;return i+(e-i)*Math.exp((s-t)/r)},p=function(t){return"exponentialRampToValue"===t.type},f=function(t){return"linearRampToValue"===t.type},m=function(t){return p(t)||f(t)},g=function(t){return"setValue"===t.type},y=function(t){return"setValueCurve"===t.type},_=function t(e,n,s,i){var r=e[n];return void 0===r?i:m(r)||g(r)?r.value:y(r)?r.values[r.values.length-1]:d(s,t(e,n-1,r.startTime,i),r)},v=function(t,e,n,s,i){return void 0===n?[s.insertTime,i]:m(n)?[n.endTime,n.value]:g(n)?[n.startTime,n.value]:y(n)?[n.startTime+n.duration,n.values[n.values.length-1]]:[n.startTime,_(t,e-1,n.startTime,i)]},w=function(t){return"cancelAndHold"===t.type},b=function(t){return"cancelScheduledValues"===t.type},T=function(t){return w(t)||b(t)?t.cancelTime:p(t)||f(t)?t.endTime:t.startTime},x=function(t,e,n,s){var i=s.endTime,r=s.value;return n===r?r:0<n&&0<r||n<0&&r<0?n*Math.pow(r/n,(t-e)/(i-e)):0},A=function(t,e,n,s){return n+(t-e)/(s.endTime-e)*(s.value-n)},k=function(t,e){var n=e.duration,s=e.startTime,i=e.values;return function(t,e){var n=Math.floor(e),s=Math.ceil(e);return n===s?t[n]:(1-(e-n))*t[n]+(1-(s-e))*t[s]}(i,(t-s)/n*(i.length-1))},C=function(t){return"setTarget"===t.type},E=function(t){function e(t){o.default(this,e),this._automationEvents=[],this._currenTime=0,this._defaultValue=t}return a.default(e,[{key:t,value:function(){return this._automationEvents[Symbol.iterator]()}},{key:"add",value:function(t){var e=T(t);if(w(t)||b(t)){var n=this._automationEvents.findIndex((function(n){return b(t)&&y(n)?n.startTime+n.duration>=e:T(n)>=e})),s=this._automationEvents[n];if(-1!==n&&(this._automationEvents=this._automationEvents.slice(0,n)),w(t)){var i=this._automationEvents[this._automationEvents.length-1];if(void 0!==s&&m(s)){if(C(i))throw new Error("The internal list is malformed.");var r=y(i)?i.startTime+i.duration:T(i),o=y(i)?i.values[i.values.length-1]:i.value,a=p(s)?x(e,r,o,s):A(e,r,o,s),d=p(s)?c(a,e,this._currenTime):h(a,e,this._currenTime);this._automationEvents.push(d)}void 0!==i&&C(i)&&this._automationEvents.push(l(this.getValue(e),e)),void 0!==i&&y(i)&&i.startTime+i.duration>e&&(this._automationEvents[this._automationEvents.length-1]=u(new Float32Array([6,7]),i.startTime,e-i.startTime))}}else{var g=this._automationEvents.findIndex((function(t){return T(t)>e})),_=-1===g?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[g-1];if(void 0!==_&&y(_)&&T(_)+_.duration>e)return!1;var v=p(t)?c(t.value,t.endTime,this._currenTime):f(t)?h(t.value,e,this._currenTime):t;if(-1===g)this._automationEvents.push(v);else{if(y(t)&&e+t.duration>T(this._automationEvents[g]))return!1;this._automationEvents.splice(g,0,v)}}return!0}},{key:"flush",value:function(t){var e=this._automationEvents.findIndex((function(e){return T(e)>t}));if(e>1){var n=this._automationEvents.slice(e-1),s=n[0];C(s)&&n.unshift(l(_(this._automationEvents,e-2,s.startTime,this._defaultValue),s.startTime)),this._automationEvents=n}}},{key:"getValue",value:function(t){if(0===this._automationEvents.length)return this._defaultValue;var e=this._automationEvents.findIndex((function(e){return T(e)>t})),n=this._automationEvents[e],s=(-1===e?this._automationEvents.length:e)-1,i=this._automationEvents[s];if(void 0!==i&&C(i)&&(void 0===n||!m(n)||n.insertTime>t))return d(t,_(this._automationEvents,s-1,i.startTime,this._defaultValue),i);if(void 0!==i&&g(i)&&(void 0===n||!m(n)))return i.value;if(void 0!==i&&y(i)&&(void 0===n||!m(n)||i.startTime+i.duration>t))return t<i.startTime+i.duration?k(t,i):i.values[i.values.length-1];if(void 0!==i&&m(i)&&(void 0===n||!m(n)))return i.value;if(void 0!==n&&p(n)){var o=v(this._automationEvents,s,i,n,this._defaultValue),a=r.default(o,2),c=a[0],h=a[1];return x(t,c,h,n)}if(void 0!==n&&f(n)){var l=v(this._automationEvents,s,i,n,this._defaultValue),u=r.default(l,2),w=u[0],b=u[1];return A(t,w,b,n)}return this._defaultValue}}]),e}(Symbol.iterator);t.AutomationEventList=E,t.createCancelAndHoldAutomationEvent=function(t){return{cancelTime:t,type:"cancelAndHold"}},t.createCancelScheduledValuesAutomationEvent=function(t){return{cancelTime:t,type:"cancelScheduledValues"}},t.createExponentialRampToValueAutomationEvent=function(t,e){return{endTime:e,type:"exponentialRampToValue",value:t}},t.createLinearRampToValueAutomationEvent=function(t,e){return{endTime:e,type:"linearRampToValue",value:t}},t.createSetTargetAutomationEvent=function(t,e,n){return{startTime:e,target:t,timeConstant:n,type:"setTarget"}},t.createSetValueAutomationEvent=l,t.createSetValueCurveAutomationEvent=u,Object.defineProperty(t,"__esModule",{value:!0})}));const jt=new WeakSet,Ut=new WeakMap,Bt=new WeakMap,zt=new WeakMap,Wt=new WeakMap,$t=new WeakMap,Gt=new WeakMap,Ht=new WeakMap,Kt=new WeakMap,Xt=new WeakMap,Yt={construct:()=>Yt},Qt=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,Zt=(t,e)=>{const n=[];let s=t.replace(/^[\s]+/,""),i=s.match(Qt);for(;null!==i;){const t=i[1].slice(1,-1),r=i[0].replace(/([\s]+)?;?$/,"").replace(t,new URL(t,e).toString());n.push(r),s=s.slice(i[0].length).replace(/^[\s]+/,""),i=s.match(Qt)}return[n.join(";"),s]},Jt=t=>{if(void 0!==t&&!Array.isArray(t))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},te=t=>{if(!(t=>{try{new new Proxy(t,Yt)}catch{return!1}return!0})(t))throw new TypeError("The given value for processorCtor should be a constructor.");if(null===t.prototype||"object"!=typeof t.prototype)throw new TypeError("The given value for processorCtor should have a prototype.")},ee=(t,e)=>{const n=t.get(e);if(void 0===n)throw new Error("A value with the given key could not be found.");return n},ne=(t,e)=>{const n=Array.from(t).filter(e);if(n.length>1)throw Error("More than one element was found.");if(0===n.length)throw Error("No element was found.");const[s]=n;return t.delete(s),s},se=(t,e,n,s)=>{const i=ee(t,e),r=ne(i,(t=>t[0]===n&&t[1]===s));return 0===i.size&&t.delete(e),r},ie=t=>ee(Gt,t),re=t=>{if(jt.has(t))throw new Error("The AudioNode is already stored.");jt.add(t),ie(t).forEach((t=>t(!0)))},oe=t=>"port"in t,ae=t=>{if(!jt.has(t))throw new Error("The AudioNode is not stored.");jt.delete(t),ie(t).forEach((t=>t(!1)))},ce=(t,e)=>{!oe(t)&&e.every((t=>0===t.size))&&ae(t)},he={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},le=(t,e)=>t.context===e,ue=t=>{try{t.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},de=()=>new DOMException("","IndexSizeError"),pe=t=>{var e;t.getChannelData=(e=t.getChannelData,n=>{try{return e.call(t,n)}catch(t){if(12===t.code)throw de();throw t}})},fe={numberOfChannels:1},me=t=>jt.has(t),ge={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},ye=t=>ee(Ut,t),_e=t=>ee(zt,t),ve=(t,e)=>{const{activeInputs:n}=ye(t);n.forEach((n=>n.forEach((([n])=>{e.includes(t)||ve(n,[...e,t])}))));const s=(t=>"playbackRate"in t)(t)?[t.playbackRate]:oe(t)?Array.from(t.parameters.values()):(t=>"frequency"in t&&"gain"in t)(t)?[t.Q,t.detune,t.frequency,t.gain]:(t=>"offset"in t)(t)?[t.offset]:(t=>!("frequency"in t)&&"gain"in t)(t)?[t.gain]:(t=>"detune"in t&&"frequency"in t)(t)?[t.detune,t.frequency]:(t=>"pan"in t)(t)?[t.pan]:[];for(const t of s){const n=_e(t);void 0!==n&&n.activeInputs.forEach((([t])=>ve(t,e)))}me(t)&&ae(t)},we=t=>{ve(t.destination,[])},be=t=>void 0===t||"number"==typeof t||"string"==typeof t&&("balanced"===t||"interactive"===t||"playback"===t),Te=t=>"context"in t,xe=t=>Te(t[0]),Ae=(t,e,n,s)=>{for(const e of t)if(n(e)){if(s)return!1;throw Error("The set contains at least one similar element.")}return t.add(e),!0},ke=(t,e,[n,s],i)=>{Ae(t,[e,n,s],(t=>t[0]===e&&t[1]===n),i)},Ce=(t,[e,n,s],i)=>{const r=t.get(e);void 0===r?t.set(e,new Set([[n,s]])):Ae(r,[n,s],(t=>t[0]===n),i)},Ee=t=>"inputs"in t,Se=(t,e,n,s)=>{if(Ee(e)){const i=e.inputs[s];return t.connect(i,n,0),[i,n,0]}return t.connect(e,n,s),[e,n,s]},Me=(t,e,n)=>{for(const s of t)if(s[0]===e&&s[1]===n)return t.delete(s),s;return null},Ie=(t,e)=>{if(!ie(t).delete(e))throw new Error("Missing the expected event listener.")},De=(t,e,n)=>{const s=ee(t,e),i=ne(s,(t=>t[0]===n));return 0===s.size&&t.delete(e),i},Pe=(t,e,n,s)=>{Ee(e)?t.disconnect(e.inputs[s],n,0):t.disconnect(e,n,s)},Oe=t=>ee(Bt,t),Re=t=>ee(Wt,t),Ne=t=>Ht.has(t),Ve=t=>!jt.has(t),Le=(t,e)=>new Promise((n=>{if(null!==e)n(!0);else{const e=t.createScriptProcessor(256,1,1),s=t.createGain(),i=t.createBuffer(1,2,44100),r=i.getChannelData(0);r[0]=1,r[1]=1;const o=t.createBufferSource();o.buffer=i,o.loop=!0,o.connect(e).connect(t.destination),o.connect(s),o.disconnect(s),e.onaudioprocess=s=>{const i=s.inputBuffer.getChannelData(0);Array.prototype.some.call(i,(t=>1===t))?n(!0):n(!1),o.stop(),e.onaudioprocess=null,o.disconnect(e),e.disconnect(t.destination)},o.start()}})),qe=(t,e)=>{const n=new Map;for(const e of t)for(const t of e){const e=n.get(t);n.set(t,void 0===e?1:e+1)}n.forEach(((t,n)=>e(n,t)))},Fe=t=>"context"in t,je=(t,e,n,s)=>{const{activeInputs:i,passiveInputs:r}=_e(e),{outputs:o}=ye(t),a=ie(t),c=o=>{const a=Oe(t),c=Re(e);if(o){const e=De(r,t,n);ke(i,t,e,!1),s||Ne(t)||a.connect(c,n)}else{const e=((t,e,n)=>ne(t,(t=>t[0]===e&&t[1]===n)))(i,t,n);Ce(r,e,!1),s||Ne(t)||a.disconnect(c,n)}};return!!Ae(o,[e,n],(t=>t[0]===e&&t[1]===n),!0)&&(a.add(c),me(t)?ke(i,t,[n,c],!0):Ce(r,[t,n,c],!0),!0)},Ue=(t,e,n,s,i)=>{const[r,o]=((t,e,n,s)=>{const{activeInputs:i,passiveInputs:r}=ye(e),o=Me(i[s],t,n);if(null===o)return[se(r,t,n,s)[2],!1];return[o[2],!0]})(t,n,s,i);if(null!==r&&(Ie(t,r),!o||e||Ne(t)||Pe(Oe(t),Oe(n),s,i)),me(n)){const{activeInputs:t}=ye(n);ce(n,t)}},Be=(t,e,n,s)=>{const[i,r]=((t,e,n)=>{const{activeInputs:s,passiveInputs:i}=_e(e),r=Me(s,t,n);if(null===r)return[De(i,t,n)[1],!1];return[r[2],!0]})(t,n,s);null!==i&&(Ie(t,i),!r||e||Ne(t)||Oe(t).disconnect(Re(n),s))};class ze{constructor(t){this._map=new Map(t)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(t,e=null){return this._map.forEach(((n,s)=>t.call(e,n,s,this)))}get(t){return this._map.get(t)}has(t){return this._map.has(t)}keys(){return this._map.keys()}values(){return this._map.values()}}const We={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}};function $e(t,e,n,s,i){if("function"==typeof t.copyFromChannel)0===e[n].byteLength&&(e[n]=new Float32Array(128)),t.copyFromChannel(e[n],s,i);else{const r=t.getChannelData(s);if(0===e[n].byteLength)e[n]=r.slice(i,i+128);else{const t=new Float32Array(r.buffer,i*Float32Array.BYTES_PER_ELEMENT,128);e[n].set(t)}}}const Ge=(t,e,n,s,i)=>{"function"==typeof t.copyToChannel?0!==e[n].byteLength&&t.copyToChannel(e[n],s,i):0!==e[n].byteLength&&t.getChannelData(s).set(e[n],i)},He=(t,e)=>{const n=[];for(let s=0;s<t;s+=1){const t=[],i="number"==typeof e?e:e[s];for(let e=0;e<i;e+=1)t.push(new Float32Array(128));n.push(t)}return n},Ke=async(t,e,n,s,i,r,o)=>{const a=null===e?128*Math.ceil(t.context.length/128):e.length,c=s.channelCount*s.numberOfInputs,h=i.reduce(((t,e)=>t+e),0),l=0===h?null:n.createBuffer(h,a,n.sampleRate);if(void 0===r)throw new Error("Missing the processor constructor.");const u=ye(t),d=await((t,e)=>{const n=ee(Xt,t),s=Oe(e);return ee(n,s)})(n,t),p=He(s.numberOfInputs,s.channelCount),f=He(s.numberOfOutputs,i),m=Array.from(t.parameters.keys()).reduce(((t,e)=>({...t,[e]:new Float32Array(128)})),{});for(let h=0;h<a;h+=128){if(s.numberOfInputs>0&&null!==e)for(let t=0;t<s.numberOfInputs;t+=1)for(let n=0;n<s.channelCount;n+=1)$e(e,p[t],n,n,h);void 0!==r.parameterDescriptors&&null!==e&&r.parameterDescriptors.forEach((({name:t},n)=>{$e(e,m,t,c+n,h)}));for(let t=0;t<s.numberOfInputs;t+=1)for(let e=0;e<i[t];e+=1)0===f[t][e].byteLength&&(f[t][e]=new Float32Array(128));try{const t=p.map(((t,e)=>0===u.activeInputs[e].size?[]:t)),e=o(h/n.sampleRate,n.sampleRate,(()=>d.process(t,f,m)));if(null!==l)for(let t=0,e=0;t<s.numberOfOutputs;t+=1){for(let n=0;n<i[t];n+=1)Ge(l,f[t],n,e+n,h);e+=i[t]}if(!e)break}catch(e){t.dispatchEvent(new ErrorEvent("processorerror",{colno:e.colno,filename:e.filename,lineno:e.lineno,message:e.message}));break}}return l},Xe={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},Ye={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},Qe={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},Ze={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},Je={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},tn=t=>{const{port1:e,port2:n}=new MessageChannel;return new Promise((s=>{const i=()=>{n.onmessage=null,e.close(),n.close(),s()};n.onmessage=()=>i();try{e.postMessage(t,[t])}finally{i()}}))},en={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},nn=(t,e,n)=>{const s=e[n];if(void 0===s)throw t();return s},sn={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},rn={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},on=()=>new DOMException("","InvalidStateError"),an=()=>new DOMException("","InvalidAccessError"),cn={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},hn=(t,e,n,s,i,r,o,a,c,h,l)=>{const u=h.length;let d=a;for(let a=0;a<u;a+=1){let u=n[0]*h[a];for(let e=1;e<i;e+=1){const s=d-e&c-1;u+=n[e]*r[s],u-=t[e]*o[s]}for(let t=i;t<s;t+=1)u+=n[t]*r[d-t&c-1];for(let n=i;n<e;n+=1)u-=t[n]*o[d-n&c-1];r[d]=h[a],o[d]=u,d=d+1&c-1,l[a]=u}return d},ln={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},un=t=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const n=t.decodeAudioData(e.buffer,(()=>{}));return void 0!==n&&(n.catch((()=>{})),!0)}catch{}return!1},dn={numberOfChannels:1},pn=(t,e,n)=>{const s=e[n];void 0!==s&&s!==t[n]&&(t[n]=s)},fn=(t,e)=>{pn(t,e,"channelCount"),pn(t,e,"channelCountMode"),pn(t,e,"channelInterpretation")},mn=t=>"function"==typeof t.getFloatTimeDomainData,gn=(t,e,n)=>{const s=e[n];void 0!==s&&s!==t[n].value&&(t[n].value=s)},yn=t=>{var e;t.start=(e=t.start,(n=0,s=0,i)=>{if("number"==typeof i&&i<0||s<0||n<0)throw new RangeError("The parameters can't be negative.");e.call(t,n,s,i)})},_n=t=>{var e;t.stop=(e=t.stop,(n=0)=>{if(n<0)throw new RangeError("The parameter can't be negative.");e.call(t,n)})},vn=(t,e)=>null===t?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(t*e))))),wn=async(t,e)=>{const n=await(t=>new Promise(((e,n)=>{const{port1:s,port2:i}=new MessageChannel;s.onmessage=({data:t})=>{s.close(),i.close(),e(t)},s.onmessageerror=({data:t})=>{s.close(),i.close(),n(t)},i.postMessage(t)})))(e);return new t(n)},bn=(t,e)=>{const n=t.createBiquadFilter();return fn(n,e),gn(n,e,"Q"),gn(n,e,"detune"),gn(n,e,"frequency"),gn(n,e,"gain"),pn(n,e,"type"),n},Tn=(t,e)=>{const n=t.createChannelSplitter(e.numberOfOutputs);return fn(n,e),(t=>{const e=t.numberOfOutputs;Object.defineProperty(t,"channelCount",{get:()=>e,set:t=>{if(t!==e)throw on()}}),Object.defineProperty(t,"channelCountMode",{get:()=>"explicit",set:t=>{if("explicit"!==t)throw on()}}),Object.defineProperty(t,"channelInterpretation",{get:()=>"discrete",set:t=>{if("discrete"!==t)throw on()}})})(n),n},xn=(t,e)=>(t.connect=e.connect.bind(e),t.disconnect=e.disconnect.bind(e),t),An=(t,e)=>{const n=t.createDelay(e.maxDelayTime);return fn(n,e),gn(n,e,"delayTime"),n},kn=(t,e)=>{const n=t.createGain();return fn(n,e),gn(n,e,"gain"),n};function Cn(t,e){const n=e[0]*e[0]+e[1]*e[1];return[(t[0]*e[0]+t[1]*e[1])/n,(t[1]*e[0]-t[0]*e[1])/n]}function En(t,e){let n=[0,0];for(let r=t.length-1;r>=0;r-=1)i=e,n=[(s=n)[0]*i[0]-s[1]*i[1],s[0]*i[1]+s[1]*i[0]],n[0]+=t[r];var s,i;return n}const Sn=(t,e,n,s)=>t.createScriptProcessor(e,n,s),Mn=()=>new DOMException("","NotSupportedError"),In={numberOfChannels:1},Dn={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},Pn={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},On={disableNormalization:!1},Rn={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},Nn=()=>new DOMException("","UnknownError"),Vn={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},Ln=(t,e,n)=>void 0===t.copyFromChannel?t.getChannelData(n)[0]:(t.copyFromChannel(e,n),e[0]),qn=t=>{if(null===t)return!1;const e=t.length;return e%2!=0?0!==t[Math.floor(e/2)]:t[e/2-1]+t[e/2]!==0},Fn=(t,e,n,s)=>{let i=t;for(;!i.hasOwnProperty(e);)i=Object.getPrototypeOf(i);const{get:r,set:o}=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(t,e,{get:n(r),set:s(o)})},jn=(t,e,n)=>{try{t.setValueAtTime(e,n)}catch(s){if(9!==s.code)throw s;jn(t,e,n+1e-7)}},Un=t=>{const e=t.createOscillator();try{e.start(-1)}catch(t){return t instanceof RangeError}return!1},Bn=t=>{const e=t.createBuffer(1,1,44100),n=t.createBufferSource();n.buffer=e,n.start(),n.stop();try{return n.stop(),!0}catch{return!1}},zn=t=>{const e=t.createOscillator();try{e.stop(-1)}catch(t){return t instanceof RangeError}return!1},Wn=(t,e)=>{const n=e.createGain();t.connect(n);const s=(i=t.disconnect,()=>{i.call(t,n),t.removeEventListener("ended",s)});var i;t.addEventListener("ended",s),xn(t,n),t.stop=(e=>{let s=!1;return(i=0)=>{if(s)try{e.call(t,i)}catch{n.gain.setValueAtTime(0,i)}else e.call(t,i),s=!0}})(t.stop)},$n=(t,e)=>n=>{const s={value:t};return Object.defineProperties(n,{currentTarget:s,target:s}),"function"==typeof e?e.call(t,n):e.handleEvent.call(t,n)},Gn=(Hn=Ae,(t,e,[n,s,i],r)=>{Hn(t[s],[e,n,i],(t=>t[0]===e&&t[1]===n),r)});var Hn;const Kn=(t=>(e,n,[s,i,r],o)=>{const a=e.get(s);void 0===a?e.set(s,new Set([[i,n,r]])):t(a,[i,n,r],(t=>t[0]===i&&t[1]===n),o)})(Ae),Xn=(Yn=ne,(t,e,n,s)=>Yn(t[s],(t=>t[0]===e&&t[1]===n)));var Yn;const Qn=new WeakMap,Zn=(Jn=Qn,t=>{var e;return null!==(e=Jn.get(t))&&void 0!==e?e:0});var Jn;const ts=(es=new Map,ns=new WeakMap,(t,e)=>{const n=ns.get(t);if(void 0!==n)return n;const s=es.get(t);if(void 0!==s)return s;try{const n=e();return n instanceof Promise?(es.set(t,n),n.catch((()=>!1)).then((e=>(es.delete(t),ns.set(t,e),e)))):(ns.set(t,n),n)}catch{return ns.set(t,!1),!1}});var es,ns;const ss="undefined"==typeof window?null:window,is=(rs=ts,os=de,(t,e)=>{const n=t.createAnalyser();if(fn(n,e),!(e.maxDecibels>e.minDecibels))throw os();return pn(n,e,"fftSize"),pn(n,e,"maxDecibels"),pn(n,e,"minDecibels"),pn(n,e,"smoothingTimeConstant"),rs(mn,(()=>mn(n)))||(t=>{t.getFloatTimeDomainData=e=>{const n=new Uint8Array(e.length);t.getByteTimeDomainData(n);const s=Math.max(n.length,t.fftSize);for(let t=0;t<s;t+=1)e[t]=.0078125*(n[t]-128);return e}})(n),n});var rs,os;const as=(cs=ye,t=>{const e=cs(t);if(null===e.renderer)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return e.renderer});var cs;const hs=((t,e,n)=>async(s,i,r)=>{const o=t(s);await Promise.all(o.activeInputs.map(((t,o)=>Array.from(t).map((async([t,a])=>{const c=e(t),h=await c.render(t,i),l=s.context.destination;n(t)||s===l&&n(s)||h.connect(r,a,o)})))).reduce(((t,e)=>[...t,...e]),[]))})(ye,as,Ne),ls=(us=is,ds=Oe,ps=hs,()=>{const t=new WeakMap;return{render(e,n){const s=t.get(n);return void 0!==s?Promise.resolve(s):(async(e,n)=>{let s=ds(e);if(!le(s,n)){const t={channelCount:s.channelCount,channelCountMode:s.channelCountMode,channelInterpretation:s.channelInterpretation,fftSize:s.fftSize,maxDecibels:s.maxDecibels,minDecibels:s.minDecibels,smoothingTimeConstant:s.smoothingTimeConstant};s=us(n,t)}return t.set(n,s),await ps(e,n,s),s})(e,n)}}});var us,ds,ps;const fs=(ms=$t,t=>{const e=ms.get(t);if(void 0===e)throw on();return e});var ms;const gs=(t=>null===t?null:t.hasOwnProperty("OfflineAudioContext")?t.OfflineAudioContext:t.hasOwnProperty("webkitOfflineAudioContext")?t.webkitOfflineAudioContext:null)(ss),ys=(_s=gs,t=>null!==_s&&t instanceof _s);var _s;const vs=new WeakMap,ws=(bs=$n,class{constructor(t){this._nativeEventTarget=t,this._listeners=new WeakMap}addEventListener(t,e,n){if(null!==e){let s=this._listeners.get(e);void 0===s&&(s=bs(this,e),"function"==typeof e&&this._listeners.set(e,s)),this._nativeEventTarget.addEventListener(t,s,n)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,e,n){const s=null===e?void 0:this._listeners.get(e);this._nativeEventTarget.removeEventListener(t,void 0===s?null:s,n)}});var bs;const Ts=(t=>null===t?null:t.hasOwnProperty("AudioContext")?t.AudioContext:t.hasOwnProperty("webkitAudioContext")?t.webkitAudioContext:null)(ss),xs=(As=Ts,t=>null!==As&&t instanceof As);var As;const ks=(t=>e=>null!==t&&"function"==typeof t.AudioNode&&e instanceof t.AudioNode)(ss),Cs=(t=>e=>null!==t&&"function"==typeof t.AudioParam&&e instanceof t.AudioParam)(ss),Es=(t=>null===t?null:t.hasOwnProperty("AudioWorkletNode")?t.AudioWorkletNode:null)(ss),Ss=((t,e,n,s,i,r,o,a,c,h,l,u,d,p,f,m)=>class extends h{constructor(e,s,i,r){super(i),this._context=e,this._nativeAudioNode=i;const o=l(e);u(o)&&!0!==n(Le,(()=>Le(o,m)))&&(t=>{const e=new Map;var n,s;t.connect=(n=t.connect.bind(t),(t,s=0,i=0)=>{const r=Fe(t)?n(t,s,i):n(t,s),o=e.get(t);return void 0===o?e.set(t,[{input:i,output:s}]):o.every((t=>t.input!==i||t.output!==s))&&o.push({input:i,output:s}),r}),t.disconnect=(s=t.disconnect,(n,i,r)=>{if(s.apply(t),void 0===n)e.clear();else if("number"==typeof n)for(const[t,s]of e){const i=s.filter((t=>t.output!==n));0===i.length?e.delete(t):e.set(t,i)}else if(e.has(n))if(void 0===i)e.delete(n);else{const t=e.get(n);if(void 0!==t){const s=t.filter((t=>t.output!==i&&(t.input!==r||void 0===r)));0===s.length?e.delete(n):e.set(n,s)}}for(const[n,s]of e)s.forEach((e=>{Fe(n)?t.connect(n,e.output,e.input):t.connect(n,e.output)}))})})(i),Bt.set(this,i),Gt.set(this,new Set),"closed"!==e.state&&s&&re(this),t(this,r,i)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(t){this._nativeAudioNode.channelCount=t}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(t){this._nativeAudioNode.channelCountMode=t}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(t){this._nativeAudioNode.channelInterpretation=t}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(t,n=0,a=0){if(n<0||n>=this._nativeAudioNode.numberOfOutputs)throw i();const h=l(this._context),u=f(h);if(d(t)||p(t))throw r();if(Te(t)){const i=Oe(t);try{const e=Se(this._nativeAudioNode,i,n,a),s=Ve(this);(u||s)&&this._nativeAudioNode.disconnect(...e),"closed"!==this.context.state&&!s&&Ve(t)&&re(t)}catch(t){if(12===t.code)throw r();throw t}if(e(this,t,n,a,u)){const e=c([this],t);qe(e,s(u))}return t}const m=Re(t);if("playbackRate"===m.name&&1024===m.maxValue)throw o();try{this._nativeAudioNode.connect(m,n),(u||Ve(this))&&this._nativeAudioNode.disconnect(m,n)}catch(t){if(12===t.code)throw r();throw t}if(je(this,t,n,u)){const e=c([this],t);qe(e,s(u))}}disconnect(t,e,n){let s;const o=l(this._context),h=f(o);if(void 0===t)s=((t,e)=>{const n=ye(t),s=[];for(const i of n.outputs)xe(i)?Ue(t,e,...i):Be(t,e,...i),s.push(i[0]);return n.outputs.clear(),s})(this,h);else if("number"==typeof t){if(t<0||t>=this.numberOfOutputs)throw i();s=((t,e,n)=>{const s=ye(t),i=[];for(const r of s.outputs)r[1]===n&&(xe(r)?Ue(t,e,...r):Be(t,e,...r),i.push(r[0]),s.outputs.delete(r));return i})(this,h,t)}else{if(void 0!==e&&(e<0||e>=this.numberOfOutputs))throw i();if(Te(t)&&void 0!==n&&(n<0||n>=t.numberOfInputs))throw i();if(s=((t,e,n,s,i)=>{const r=ye(t);return Array.from(r.outputs).filter((t=>!(t[0]!==n||void 0!==s&&t[1]!==s||void 0!==i&&t[2]!==i))).map((n=>(xe(n)?Ue(t,e,...n):Be(t,e,...n),r.outputs.delete(n),n[0])))})(this,h,t,e,n),0===s.length)throw r()}for(const t of s){const e=c([this],t);qe(e,a)}}})((Ms=Ut,(t,e,n)=>{const s=[];for(let t=0;t<n.numberOfInputs;t+=1)s.push(new Set);Ms.set(t,{activeInputs:s,outputs:new Set,passiveInputs:new WeakMap,renderer:e})}),((t,e,n,s,i,r,o,a,c,h,l,u,d)=>{const p=new WeakMap;return(f,m,g,y,_)=>{const{activeInputs:v,passiveInputs:w}=r(m),{outputs:b}=r(f),T=a(f),x=r=>{const a=c(m),h=c(f);if(r){const e=se(w,f,g,y);t(v,f,e,!1),_||u(f)||n(h,a,g,y),d(m)&&re(m)}else{const t=s(v,f,g,y);e(w,y,t,!1),_||u(f)||i(h,a,g,y);const n=o(m);if(0===n)l(m)&&ce(m,v);else{const t=p.get(m);void 0!==t&&clearTimeout(t),p.set(m,setTimeout((()=>{l(m)&&ce(m,v)}),1e3*n))}}};return!!h(b,[m,g,y],(t=>t[0]===m&&t[1]===g&&t[2]===y),!0)&&(T.add(x),l(f)?t(v,f,[g,y,x],!0):e(w,y,[f,g,x],!0),!0)}})(Gn,Kn,Se,Xn,Pe,ye,Zn,ie,Oe,Ae,me,Ne,Ve),ts,((t,e,n,s,i,r)=>o=>(a,c)=>{const h=t.get(a);if(void 0===h){if(!o&&r(a)){const t=s(a),{outputs:r}=n(a);for(const n of r)if(xe(n)){const i=s(n[0]);e(t,i,n[1],n[2])}else{const e=i(n[0]);t.disconnect(e,n[1])}}t.set(a,c)}else t.set(a,h+c)})(Ht,Pe,ye,Oe,Re,me),de,an,Mn,((t,e,n,s,i,r,o,a)=>(c,h)=>{const l=e.get(c);if(void 0===l)throw new Error("Missing the expected cycle count.");const u=r(c.context),d=a(u);if(l===h){if(e.delete(c),!d&&o(c)){const e=s(c),{outputs:r}=n(c);for(const n of r)if(xe(n)){const i=s(n[0]);t(e,i,n[1],n[2])}else{const t=i(n[0]);e.connect(t,n[1])}}}else e.set(c,l-h)})(Se,Ht,ye,Oe,Re,fs,me,ys),((t,e,n)=>function s(i,r){const o=Te(r)?r:n(t,r);if((t=>"delayTime"in t)(o))return[];if(i[0]===o)return[i];if(i.includes(o))return[];const{outputs:a}=e(o);return Array.from(a).map((t=>s([...i,o],t[0]))).reduce(((t,e)=>t.concat(e)),[])})(vs,ye,ee),ws,fs,xs,ks,Cs,ys,Es);var Ms;const Is=((t,e,n,s,i,r)=>class extends t{constructor(t,n){const o=i(t),a={...he,...n},c=s(o,a);super(t,!1,c,r(o)?e():null),this._nativeAnalyserNode=c}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(t){this._nativeAnalyserNode.fftSize=t}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(t){const e=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=t,!(t>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=e,n()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(t){const e=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=t,!(this._nativeAnalyserNode.maxDecibels>t))throw this._nativeAnalyserNode.minDecibels=e,n()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(t){this._nativeAnalyserNode.smoothingTimeConstant=t}getByteFrequencyData(t){this._nativeAnalyserNode.getByteFrequencyData(t)}getByteTimeDomainData(t){this._nativeAnalyserNode.getByteTimeDomainData(t)}getFloatFrequencyData(t){this._nativeAnalyserNode.getFloatFrequencyData(t)}getFloatTimeDomainData(t){this._nativeAnalyserNode.getFloatTimeDomainData(t)}})(Ss,ls,de,is,fs,ys),Ds=new WeakSet,Ps=(t=>null===t?null:t.hasOwnProperty("AudioBuffer")?t.AudioBuffer:null)(ss),Os=(Rs=new Uint32Array(1),t=>(Rs[0]=t,Rs[0]));var Rs;const Ns=((t,e)=>n=>{n.copyFromChannel=(s,i,r=0)=>{const o=t(r),a=t(i);if(a>=n.numberOfChannels)throw e();const c=n.length,h=n.getChannelData(a),l=s.length;for(let t=o<0?-o:0;t+o<c&&t<l;t+=1)s[t]=h[t+o]},n.copyToChannel=(s,i,r=0)=>{const o=t(r),a=t(i);if(a>=n.numberOfChannels)throw e();const c=n.length,h=n.getChannelData(a),l=s.length;for(let t=o<0?-o:0;t+o<c&&t<l;t+=1)h[t+o]=s[t]}})(Os,de),Vs=(Ls=Os,t=>{var e,n;t.copyFromChannel=(e=t.copyFromChannel,(n,s,i=0)=>{const r=Ls(i),o=Ls(s);if(r<t.length)return e.call(t,n,o,r)}),t.copyToChannel=(n=t.copyToChannel,(e,s,i=0)=>{const r=Ls(i),o=Ls(s);if(r<t.length)return n.call(t,e,o,r)})});var Ls;const qs=((t,e,n,s,i,r,o,a)=>{let c=null;return class h{constructor(h){if(null===i)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:l,numberOfChannels:u,sampleRate:d}={...fe,...h};null===c&&(c=new i(1,1,44100));const p=null!==s&&e(r,r)?new s({length:l,numberOfChannels:u,sampleRate:d}):c.createBuffer(u,l,d);if(0===p.numberOfChannels)throw n();return"function"!=typeof p.copyFromChannel?(o(p),pe(p)):e(ue,(()=>ue(p)))||a(p),t.add(p),p}static[Symbol.hasInstance](e){return null!==e&&"object"==typeof e&&Object.getPrototypeOf(e)===h.prototype||t.has(e)}}})(Ds,ts,Mn,Ps,gs,(Fs=Ps,()=>{if(null===Fs)return!1;try{new Fs({length:1,sampleRate:44100})}catch{return!1}return!0}),Ns,Vs);var Fs;const js=(Us=kn,(t,e)=>{const n=Us(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});e.connect(n).connect(t.destination);const s=()=>{e.removeEventListener("ended",s),e.disconnect(n),n.disconnect()};e.addEventListener("ended",s)});var Us;const Bs=(zs=as,Ws=_e,$s=Ne,async(t,e,n)=>{const s=Ws(t);await Promise.all(Array.from(s.activeInputs).map((async([t,s])=>{const i=zs(t),r=await i.render(t,e);$s(t)||r.connect(n,s)})))});var zs,Ws,$s;const Gs=(Hs=Bs,(t,e,n)=>Hs(e,t,n));var Hs;const Ks=((t,e,n,s,i,r,o,a,c,h,l)=>(u,d)=>{const p=u.createBufferSource();return fn(p,d),gn(p,d,"playbackRate"),pn(p,d,"buffer"),pn(p,d,"loop"),pn(p,d,"loopEnd"),pn(p,d,"loopStart"),e(n,(()=>n(u)))||(t=>{t.start=(e=>{let n=!1;return(s=0,i=0,r)=>{if(n)throw on();e.call(t,s,i,r),n=!0}})(t.start)})(p),e(s,(()=>s(u)))||c(p),e(i,(()=>i(u)))||h(p,u),e(r,(()=>r(u)))||yn(p),e(o,(()=>o(u)))||l(p,u),e(a,(()=>a(u)))||_n(p),t(u,p),p})(js,ts,(t=>{const e=t.createBufferSource();e.start();try{e.start()}catch{return!0}return!1}),(t=>{const e=t.createBufferSource(),n=t.createBuffer(1,1,44100);e.buffer=n;try{e.start(0,1)}catch{return!1}return!0}),(t=>{const e=t.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0}),Un,Bn,zn,(t=>{var e;t.start=(e=t.start,(n=0,s=0,i)=>{const r=t.buffer,o=null===r?s:Math.min(r.duration,s);null!==r&&o>r.duration-.5/t.context.sampleRate?e.call(t,n,0,0):e.call(t,n,o,i)})}),(Xs=Fn,(t,e)=>{const n=e.createBuffer(1,1,44100);null===t.buffer&&(t.buffer=n),Xs(t,"buffer",(e=>()=>{const s=e.call(t);return s===n?null:s}),(e=>s=>e.call(t,null===s?n:s)))}),Wn);var Xs;const Ys=((t,e)=>(n,s,i)=>(t(s).replay(i),e(s,n,i)))((t=>e=>{const n=t(e);if(null===n.renderer)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return n.renderer})(_e),Bs),Qs=((t,e,n,s,i)=>()=>{const r=new WeakMap;let o=null,a=null;return{set start(t){o=t},set stop(t){a=t},render(c,h){const l=r.get(h);return void 0!==l?Promise.resolve(l):(async(c,h)=>{let l=n(c);const u=le(l,h);if(!u){const t={buffer:l.buffer,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,loop:l.loop,loopEnd:l.loopEnd,loopStart:l.loopStart,playbackRate:l.playbackRate.value};l=e(h,t),null!==o&&l.start(...o),null!==a&&l.stop(a)}return r.set(h,l),u?await t(h,c.playbackRate,l.playbackRate):await s(h,c.playbackRate,l.playbackRate),await i(c,h,l),l})(c,h)}}})(Gs,Ks,Oe,Ys,hs),Zs=((t,e,n,s,i,r,o,a,c,h,l,u,d)=>(p,f,m,g=null,y=null)=>{const _=new Ft.AutomationEventList(m.defaultValue),v=f?s(_):null,w={get defaultValue(){return m.defaultValue},get maxValue(){return null===g?m.maxValue:g},get minValue(){return null===y?m.minValue:y},get value(){return m.value},set value(t){m.value=t,w.setValueAtTime(t,p.context.currentTime)},cancelAndHoldAtTime(t){if("function"==typeof m.cancelAndHoldAtTime)null===v&&_.flush(p.context.currentTime),_.add(i(t)),m.cancelAndHoldAtTime(t);else{const e=Array.from(_).pop();null===v&&_.flush(p.context.currentTime),_.add(i(t));const n=Array.from(_).pop();m.cancelScheduledValues(t),e!==n&&void 0!==n&&("exponentialRampToValue"===n.type?m.exponentialRampToValueAtTime(n.value,n.endTime):"linearRampToValue"===n.type?m.linearRampToValueAtTime(n.value,n.endTime):"setValue"===n.type?m.setValueAtTime(n.value,n.startTime):"setValueCurve"===n.type&&m.setValueCurveAtTime(n.values,n.startTime,n.duration))}return w},cancelScheduledValues:t=>(null===v&&_.flush(p.context.currentTime),_.add(r(t)),m.cancelScheduledValues(t),w),exponentialRampToValueAtTime(t,e){if(0===t)throw new RangeError;if(!Number.isFinite(e)||e<0)throw new RangeError;return null===v&&_.flush(p.context.currentTime),_.add(o(t,e)),m.exponentialRampToValueAtTime(t,e),w},linearRampToValueAtTime:(t,e)=>(null===v&&_.flush(p.context.currentTime),_.add(a(t,e)),m.linearRampToValueAtTime(t,e),w),setTargetAtTime:(t,e,n)=>(null===v&&_.flush(p.context.currentTime),_.add(c(t,e,n)),m.setTargetAtTime(t,e,n),w),setValueAtTime:(t,e)=>(null===v&&_.flush(p.context.currentTime),_.add(h(t,e)),m.setValueAtTime(t,e),w),setValueCurveAtTime(t,e,n){const s=t instanceof Float32Array?t:new Float32Array(t);if(null!==u&&"webkitAudioContext"===u.name){const t=e+n,i=p.context.sampleRate,r=Math.ceil(e*i),o=Math.floor(t*i),a=o-r,c=new Float32Array(a);for(let t=0;t<a;t+=1){const o=(s.length-1)/n*((r+t)/i-e),a=Math.floor(o),h=Math.ceil(o);c[t]=a===h?s[a]:(1-(o-a))*s[a]+(1-(h-o))*s[h]}null===v&&_.flush(p.context.currentTime),_.add(l(c,e,n)),m.setValueCurveAtTime(c,e,n);const h=o/i;h<t&&d(w,c[c.length-1],h),d(w,s[s.length-1],t)}else null===v&&_.flush(p.context.currentTime),_.add(l(s,e,n)),m.setValueCurveAtTime(s,e,n);return w}};return n.set(w,m),e.set(w,p),t(w,v),w})((Js=zt,(t,e)=>{Js.set(t,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:e})}),vs,Wt,(t=>({replay(e){for(const n of t)if("exponentialRampToValue"===n.type){const{endTime:t,value:s}=n;e.exponentialRampToValueAtTime(s,t)}else if("linearRampToValue"===n.type){const{endTime:t,value:s}=n;e.linearRampToValueAtTime(s,t)}else if("setTarget"===n.type){const{startTime:t,target:s,timeConstant:i}=n;e.setTargetAtTime(s,t,i)}else if("setValue"===n.type){const{startTime:t,value:s}=n;e.setValueAtTime(s,t)}else{if("setValueCurve"!==n.type)throw new Error("Can't apply an unknown automation.");{const{duration:t,startTime:s,values:i}=n;e.setValueCurveAtTime(i,s,t)}}}})),Ft.createCancelAndHoldAutomationEvent,Ft.createCancelScheduledValuesAutomationEvent,Ft.createExponentialRampToValueAutomationEvent,Ft.createLinearRampToValueAutomationEvent,Ft.createSetTargetAutomationEvent,Ft.createSetValueAutomationEvent,Ft.createSetValueCurveAutomationEvent,Ts,jn);var Js;const ti=((t,e,n,s,i,r,o,a)=>class extends t{constructor(t,s){const a=r(t),c={...ge,...s},h=i(a,c),l=o(a),u=l?e():null;super(t,!1,h,u),this._audioBufferSourceNodeRenderer=u,this._isBufferNullified=!1,this._isBufferSet=null!==c.buffer,this._nativeAudioBufferSourceNode=h,this._onended=null,this._playbackRate=n(this,l,h.playbackRate,34028234663852886e22,-34028234663852886e22)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(t){if(this._nativeAudioBufferSourceNode.buffer=t,null!==t){if(this._isBufferSet)throw s();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(t){this._nativeAudioBufferSourceNode.loop=t}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(t){this._nativeAudioBufferSourceNode.loopEnd=t}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(t){this._nativeAudioBufferSourceNode.loopStart=t}get onended(){return this._onended}set onended(t){const e="function"==typeof t?a(this,t):null;this._nativeAudioBufferSourceNode.onended=e;const n=this._nativeAudioBufferSourceNode.onended;this._onended=null!==n&&n===e?t:n}get playbackRate(){return this._playbackRate}start(t=0,e=0,n){if(this._nativeAudioBufferSourceNode.start(t,e,n),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.start=void 0===n?[t,e]:[t,e,n]),"closed"!==this.context.state){re(this);const t=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",t),me(this)&&ae(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",t)}}stop(t=0){this._nativeAudioBufferSourceNode.stop(t),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.stop=t)}})(Ss,Qs,Zs,on,Ks,fs,ys,$n),ei=((t,e,n,s,i,r,o,a)=>class extends t{constructor(t,n){const s=r(t),c=o(s),h=i(s,n,c);super(t,!1,h,c?e(a):null),this._isNodeOfNativeOfflineAudioContext=c,this._nativeAudioDestinationNode=h}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(t){if(this._isNodeOfNativeOfflineAudioContext)throw s();if(t>this._nativeAudioDestinationNode.maxChannelCount)throw n();this._nativeAudioDestinationNode.channelCount=t}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(t){if(this._isNodeOfNativeOfflineAudioContext)throw s();this._nativeAudioDestinationNode.channelCountMode=t}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}})(Ss,(t=>{const e=new WeakMap;return{render(n,s){const i=e.get(s);return void 0!==i?Promise.resolve(i):(async(n,s)=>{const i=s.destination;return e.set(s,i),await t(n,s,i),i})(n,s)}}}),de,on,((t,e)=>(n,s,i)=>{const r=n.destination;if(r.channelCount!==s)try{r.channelCount=s}catch{}i&&"explicit"!==r.channelCountMode&&(r.channelCountMode="explicit"),0===r.maxChannelCount&&Object.defineProperty(r,"maxChannelCount",{value:s});const o=t(n,{channelCount:s,channelCountMode:r.channelCountMode,channelInterpretation:r.channelInterpretation,gain:1});return e(o,"channelCount",(t=>()=>t.call(o)),(t=>e=>{t.call(o,e);try{r.channelCount=e}catch(t){if(e>r.maxChannelCount)throw t}})),e(o,"channelCountMode",(t=>()=>t.call(o)),(t=>e=>{t.call(o,e),r.channelCountMode=e})),e(o,"channelInterpretation",(t=>()=>t.call(o)),(t=>e=>{t.call(o,e),r.channelInterpretation=e})),Object.defineProperty(o,"maxChannelCount",{get:()=>r.maxChannelCount}),o.connect(r),o})(kn,Fn),fs,ys,hs),ni=((t,e,n,s,i)=>()=>{const r=new WeakMap;return{render(o,a){const c=r.get(a);return void 0!==c?Promise.resolve(c):(async(o,a)=>{let c=n(o);const h=le(c,a);if(!h){const t={Q:c.Q.value,channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,detune:c.detune.value,frequency:c.frequency.value,gain:c.gain.value,type:c.type};c=e(a,t)}return r.set(a,c),h?(await t(a,o.Q,c.Q),await t(a,o.detune,c.detune),await t(a,o.frequency,c.frequency),await t(a,o.gain,c.gain)):(await s(a,o.Q,c.Q),await s(a,o.detune,c.detune),await s(a,o.frequency,c.frequency),await s(a,o.gain,c.gain)),await i(o,a,c),c})(o,a)}}})(Gs,bn,Oe,Ys,hs),si=(t=>(e,n)=>t.set(e,n))(Qn),ii=(ri=Ss,oi=Zs,ai=ni,ci=an,hi=bn,li=fs,ui=ys,di=si,class extends ri{constructor(t,e){const n=li(t),s={...Xe,...e},i=hi(n,s),r=ui(n);super(t,!1,i,r?ai():null),this._Q=oi(this,r,i.Q,34028234663852886e22,-34028234663852886e22),this._detune=oi(this,r,i.detune,1200*Math.log2(34028234663852886e22),-1200*Math.log2(34028234663852886e22)),this._frequency=oi(this,r,i.frequency,t.sampleRate/2,0),this._gain=oi(this,r,i.gain,40*Math.log10(34028234663852886e22),-34028234663852886e22),this._nativeBiquadFilterNode=i,di(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(t){this._nativeBiquadFilterNode.type=t}getFrequencyResponse(t,e,n){try{this._nativeBiquadFilterNode.getFrequencyResponse(t,e,n)}catch(t){if(11===t.code)throw ci();throw t}if(t.length!==e.length||e.length!==n.length)throw ci()}});var ri,oi,ai,ci,hi,li,ui,di;const pi=((t,e)=>(n,s,i)=>{const r=new Set;var o,a;return n.connect=(o=n.connect,(i,a=0,c=0)=>{const h=0===r.size;if(e(i))return o.call(n,i,a,c),t(r,[i,a,c],(t=>t[0]===i&&t[1]===a&&t[2]===c),!0),h&&s(),i;o.call(n,i,a),t(r,[i,a],(t=>t[0]===i&&t[1]===a),!0),h&&s()}),n.disconnect=(a=n.disconnect,(t,s,o)=>{const c=r.size>0;if(void 0===t)a.apply(n),r.clear();else if("number"==typeof t){a.call(n,t);for(const e of r)e[1]===t&&r.delete(e)}else{e(t)?a.call(n,t,s,o):a.call(n,t,s);for(const e of r)e[0]!==t||void 0!==s&&e[1]!==s||void 0!==o&&e[2]!==o||r.delete(e)}const h=0===r.size;c&&h&&i()}),n})(Ae,ks),fi=(mi=on,gi=pi,(t,e)=>{e.channelCount=1,e.channelCountMode="explicit",Object.defineProperty(e,"channelCount",{get:()=>1,set:()=>{throw mi()}}),Object.defineProperty(e,"channelCountMode",{get:()=>"explicit",set:()=>{throw mi()}});const n=t.createBufferSource();gi(e,(()=>{const t=e.numberOfInputs;for(let s=0;s<t;s+=1)n.connect(e,0,s)}),(()=>n.disconnect(e)))});var mi,gi;const yi=((t,e)=>(n,s)=>{const i=n.createChannelMerger(s.numberOfInputs);return null!==t&&"webkitAudioContext"===t.name&&e(n,i),fn(i,s),i})(Ts,fi),_i=((t,e,n)=>()=>{const s=new WeakMap;return{render(i,r){const o=s.get(r);return void 0!==o?Promise.resolve(o):(async(i,r)=>{let o=e(i);if(!le(o,r)){const e={channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,numberOfInputs:o.numberOfInputs};o=t(r,e)}return s.set(r,o),await n(i,r,o),o})(i,r)}}})(yi,Oe,hs),vi=((t,e,n,s,i)=>class extends t{constructor(t,r){const o=s(t),a={...Ye,...r};super(t,!1,n(o,a),i(o)?e():null)}})(Ss,_i,yi,fs,ys),wi=((t,e,n)=>()=>{const s=new WeakMap;return{render(i,r){const o=s.get(r);return void 0!==o?Promise.resolve(o):(async(i,r)=>{let o=e(i);if(!le(o,r)){const e={channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,numberOfOutputs:o.numberOfOutputs};o=t(r,e)}return s.set(r,o),await n(i,r,o),o})(i,r)}}})(Tn,Oe,hs),bi=((t,e,n,s,i,r)=>class extends t{constructor(t,o){const a=s(t),c=r({...Qe,...o});super(t,!1,n(a,c),i(a)?e():null)}})(Ss,wi,Tn,fs,ys,(t=>({...t,channelCount:t.numberOfOutputs}))),Ti=((t,e,n,s)=>(i,{offset:r,...o})=>{const a=i.createBuffer(1,2,44100),c=e(i,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),h=n(i,{...o,gain:r}),l=a.getChannelData(0);l[0]=1,l[1]=1,c.buffer=a,c.loop=!0;const u={get bufferSize(){},get channelCount(){return h.channelCount},set channelCount(t){h.channelCount=t},get channelCountMode(){return h.channelCountMode},set channelCountMode(t){h.channelCountMode=t},get channelInterpretation(){return h.channelInterpretation},set channelInterpretation(t){h.channelInterpretation=t},get context(){return h.context},get inputs(){return[]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return h.numberOfOutputs},get offset(){return h.gain},get onended(){return c.onended},set onended(t){c.onended=t},addEventListener:(...t)=>c.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>c.dispatchEvent(t[0]),removeEventListener:(...t)=>c.removeEventListener(t[0],t[1],t[2]),start(t=0){c.start.call(c,t)},stop(t=0){c.stop.call(c,t)}};return t(i,c),s(xn(u,h),(()=>c.connect(h)),(()=>c.disconnect(h)))})(js,Ks,kn,pi),xi=((t,e,n,s,i)=>(r,o)=>{if(void 0===r.createConstantSource)return n(r,o);const a=r.createConstantSource();return fn(a,o),gn(a,o,"offset"),e(s,(()=>s(r)))||yn(a),e(i,(()=>i(r)))||_n(a),t(r,a),a})(js,ts,Ti,Un,zn),Ai=((t,e,n,s,i)=>()=>{const r=new WeakMap;let o=null,a=null;return{set start(t){o=t},set stop(t){a=t},render(c,h){const l=r.get(h);return void 0!==l?Promise.resolve(l):(async(c,h)=>{let l=n(c);const u=le(l,h);if(!u){const t={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,offset:l.offset.value};l=e(h,t),null!==o&&l.start(o),null!==a&&l.stop(a)}return r.set(h,l),u?await t(h,c.offset,l.offset):await s(h,c.offset,l.offset),await i(c,h,l),l})(c,h)}}})(Gs,xi,Oe,Ys,hs),ki=((t,e,n,s,i,r,o)=>class extends t{constructor(t,o){const a=i(t),c={...Ze,...o},h=s(a,c),l=r(a),u=l?n():null;super(t,!1,h,u),this._constantSourceNodeRenderer=u,this._nativeConstantSourceNode=h,this._offset=e(this,l,h.offset,34028234663852886e22,-34028234663852886e22),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(t){const e="function"==typeof t?o(this,t):null;this._nativeConstantSourceNode.onended=e;const n=this._nativeConstantSourceNode.onended;this._onended=null!==n&&n===e?t:n}start(t=0){if(this._nativeConstantSourceNode.start(t),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.start=t),"closed"!==this.context.state){re(this);const t=()=>{this._nativeConstantSourceNode.removeEventListener("ended",t),me(this)&&ae(this)};this._nativeConstantSourceNode.addEventListener("ended",t)}}stop(t=0){this._nativeConstantSourceNode.stop(t),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.stop=t)}})(Ss,Zs,Ai,xi,fs,ys,$n),Ci=((t,e)=>(n,s)=>{const i=n.createConvolver();if(fn(i,s),s.disableNormalization===i.normalize&&(i.normalize=!s.disableNormalization),pn(i,s,"buffer"),s.channelCount>2)throw t();if(e(i,"channelCount",(t=>()=>t.call(i)),(e=>n=>{if(n>2)throw t();return e.call(i,n)})),"max"===s.channelCountMode)throw t();return e(i,"channelCountMode",(t=>()=>t.call(i)),(e=>n=>{if("max"===n)throw t();return e.call(i,n)})),i})(Mn,Fn),Ei=((t,e,n)=>()=>{const s=new WeakMap;return{render(i,r){const o=s.get(r);return void 0!==o?Promise.resolve(o):(async(i,r)=>{let o=e(i);if(!le(o,r)){const e={buffer:o.buffer,channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,disableNormalization:!o.normalize};o=t(r,e)}return s.set(r,o),Ee(o)?await n(i,r,o.inputs[0]):await n(i,r,o),o})(i,r)}}})(Ci,Oe,hs),Si=((t,e,n,s,i,r)=>class extends t{constructor(t,o){const a=s(t),c={...Je,...o},h=n(a,c);super(t,!1,h,i(a)?e():null),this._isBufferNullified=!1,this._nativeConvolverNode=h,null!==c.buffer&&r(this,c.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(t){if(this._nativeConvolverNode.buffer=t,null===t&&null!==this._nativeConvolverNode.buffer){const t=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=t.createBuffer(1,1,44100),this._isBufferNullified=!0,r(this,0)}else this._isBufferNullified=!1,r(this,null===this._nativeConvolverNode.buffer?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(t){this._nativeConvolverNode.normalize=t}})(Ss,Ei,Ci,fs,ys,si),Mi=((t,e,n,s,i)=>r=>{const o=new WeakMap;return{render(a,c){const h=o.get(c);return void 0!==h?Promise.resolve(h):(async(a,c)=>{let h=n(a);const l=le(h,c);if(!l){const t={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,delayTime:h.delayTime.value,maxDelayTime:r};h=e(c,t)}return o.set(c,h),l?await t(c,a.delayTime,h.delayTime):await s(c,a.delayTime,h.delayTime),await i(a,c,h),h})(a,c)}}})(Gs,An,Oe,Ys,hs),Ii=((t,e,n,s,i,r,o)=>class extends t{constructor(t,a){const c=i(t),h={...en,...a},l=s(c,h),u=r(c);super(t,!1,l,u?n(h.maxDelayTime):null),this._delayTime=e(this,u,l.delayTime),o(this,h.maxDelayTime)}get delayTime(){return this._delayTime}})(Ss,Zs,Mi,An,fs,ys,si),Di=(Pi=Mn,(t,e)=>{const n=t.createDynamicsCompressor();if(fn(n,e),e.channelCount>2)throw Pi();if("max"===e.channelCountMode)throw Pi();return gn(n,e,"attack"),gn(n,e,"knee"),gn(n,e,"ratio"),gn(n,e,"release"),gn(n,e,"threshold"),n});var Pi;const Oi=((t,e,n,s,i)=>()=>{const r=new WeakMap;return{render(o,a){const c=r.get(a);return void 0!==c?Promise.resolve(c):(async(o,a)=>{let c=n(o);const h=le(c,a);if(!h){const t={attack:c.attack.value,channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,knee:c.knee.value,ratio:c.ratio.value,release:c.release.value,threshold:c.threshold.value};c=e(a,t)}return r.set(a,c),h?(await t(a,o.attack,c.attack),await t(a,o.knee,c.knee),await t(a,o.ratio,c.ratio),await t(a,o.release,c.release),await t(a,o.threshold,c.threshold)):(await s(a,o.attack,c.attack),await s(a,o.knee,c.knee),await s(a,o.ratio,c.ratio),await s(a,o.release,c.release),await s(a,o.threshold,c.threshold)),await i(o,a,c),c})(o,a)}}})(Gs,Di,Oe,Ys,hs),Ri=((t,e,n,s,i,r,o,a)=>class extends t{constructor(t,i){const c=r(t),h={...sn,...i},l=s(c,h),u=o(c);super(t,!1,l,u?n():null),this._attack=e(this,u,l.attack),this._knee=e(this,u,l.knee),this._nativeDynamicsCompressorNode=l,this._ratio=e(this,u,l.ratio),this._release=e(this,u,l.release),this._threshold=e(this,u,l.threshold),a(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(t){const e=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=t,t>2)throw this._nativeDynamicsCompressorNode.channelCount=e,i()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(t){const e=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=t,"max"===t)throw this._nativeDynamicsCompressorNode.channelCountMode=e,i()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return"number"==typeof this._nativeDynamicsCompressorNode.reduction.value?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}})(Ss,Zs,Oi,Di,Mn,fs,ys,si),Ni=((t,e,n,s,i)=>()=>{const r=new WeakMap;return{render(o,a){const c=r.get(a);return void 0!==c?Promise.resolve(c):(async(o,a)=>{let c=n(o);const h=le(c,a);if(!h){const t={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,gain:c.gain.value};c=e(a,t)}return r.set(a,c),h?await t(a,o.gain,c.gain):await s(a,o.gain,c.gain),await i(o,a,c),c})(o,a)}}})(Gs,kn,Oe,Ys,hs),Vi=((t,e,n,s,i,r)=>class extends t{constructor(t,o){const a=i(t),c={...rn,...o},h=s(a,c),l=r(a);super(t,!1,h,l?n():null),this._gain=e(this,l,h.gain,34028234663852886e22,-34028234663852886e22)}get gain(){return this._gain}})(Ss,Zs,Ni,kn,fs,ys),Li=((t,e,n,s)=>(i,r,{channelCount:o,channelCountMode:a,channelInterpretation:c,feedback:h,feedforward:l})=>{const u=vn(r,i.sampleRate),d=h instanceof Float64Array?h:new Float64Array(h),p=l instanceof Float64Array?l:new Float64Array(l),f=d.length,m=p.length,g=Math.min(f,m);if(0===f||f>20)throw s();if(0===d[0])throw e();if(0===m||m>20)throw s();if(0===p[0])throw e();if(1!==d[0]){for(let t=0;t<m;t+=1)p[t]/=d[0];for(let t=1;t<f;t+=1)d[t]/=d[0]}const y=n(i,u,o,o);y.channelCount=o,y.channelCountMode=a,y.channelInterpretation=c;const _=[],v=[],w=[];for(let t=0;t<o;t+=1){_.push(0);const t=new Float32Array(32),e=new Float32Array(32);t.fill(0),e.fill(0),v.push(t),w.push(e)}y.onaudioprocess=t=>{const e=t.inputBuffer,n=t.outputBuffer,s=e.numberOfChannels;for(let t=0;t<s;t+=1){const s=e.getChannelData(t),i=n.getChannelData(t);_[t]=hn(d,f,p,m,g,v[t],w[t],_[t],32,s,i)}};const b=i.sampleRate/2;return xn({get bufferSize(){return u},get channelCount(){return y.channelCount},set channelCount(t){y.channelCount=t},get channelCountMode(){return y.channelCountMode},set channelCountMode(t){y.channelCountMode=t},get channelInterpretation(){return y.channelInterpretation},set channelInterpretation(t){y.channelInterpretation=t},get context(){return y.context},get inputs(){return[y]},get numberOfInputs(){return y.numberOfInputs},get numberOfOutputs(){return y.numberOfOutputs},addEventListener:(...t)=>y.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>y.dispatchEvent(t[0]),getFrequencyResponse(e,n,s){if(e.length!==n.length||n.length!==s.length)throw t();const i=e.length;for(let t=0;t<i;t+=1){const i=-Math.PI*(e[t]/b),r=[Math.cos(i),Math.sin(i)],o=Cn(En(p,r),En(d,r));n[t]=Math.sqrt(o[0]*o[0]+o[1]*o[1]),s[t]=Math.atan2(o[1],o[0])}},removeEventListener:(...t)=>y.removeEventListener(t[0],t[1],t[2])},y)})(an,on,Sn,Mn),qi=((t,e,n,s)=>i=>t(un,(()=>un(i)))?Promise.resolve(t(s,s)).then((t=>{if(!t){const t=n(i,512,0,1);i.oncomplete=()=>{t.onaudioprocess=null,t.disconnect()},t.onaudioprocess=()=>i.currentTime,t.connect(i.destination)}return i.startRendering()})):new Promise((t=>{const n=e(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});i.oncomplete=e=>{n.disconnect(),t(e.renderedBuffer)},n.connect(i.destination),i.startRendering()})))(ts,kn,Sn,((t,e)=>()=>{if(null===e)return Promise.resolve(!1);const n=new e(1,1,44100),s=t(n,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise((t=>{n.oncomplete=()=>{s.disconnect(),t(0!==n.currentTime)},n.startRendering()}))})(kn,gs)),Fi=((t,e,n,s,i)=>(r,o)=>{const a=new WeakMap;let c=null;const h=async(h,l)=>{let u=null,d=e(h);const p=le(d,l);if(void 0===l.createIIRFilter?u=t(l,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):p||(d=l.createIIRFilter(o,r)),a.set(l,null===u?d:u),null!==u){if(null===c){if(null===n)throw new Error("Missing the native OfflineAudioContext constructor.");const t=new n(h.context.destination.channelCount,h.context.length,l.sampleRate);c=(async()=>{await s(h,t,t.destination);return((t,e,n,s)=>{const i=n instanceof Float64Array?n:new Float64Array(n),r=s instanceof Float64Array?s:new Float64Array(s),o=i.length,a=r.length,c=Math.min(o,a);if(1!==i[0]){for(let t=0;t<o;t+=1)r[t]/=i[0];for(let t=1;t<a;t+=1)i[t]/=i[0]}const h=new Float32Array(32),l=new Float32Array(32),u=e.createBuffer(t.numberOfChannels,t.length,t.sampleRate),d=t.numberOfChannels;for(let e=0;e<d;e+=1){const n=t.getChannelData(e),s=u.getChannelData(e);h.fill(0),l.fill(0),hn(i,o,r,a,c,h,l,0,32,n,s)}return u})(await i(t),l,r,o)})()}const t=await c;return u.buffer=t,u.start(0),u}return await s(h,l,d),d};return{render(t,e){const n=a.get(e);return void 0!==n?Promise.resolve(n):h(t,e)}}})(Ks,Oe,gs,hs,qi);var ji;const Ui=((t,e,n,s,i,r)=>class extends t{constructor(t,o){const a=s(t),c=i(a),h={...cn,...o},l=e(a,c?null:t.baseLatency,h);super(t,!1,l,c?n(h.feedback,h.feedforward):null),(t=>{var e;t.getFrequencyResponse=(e=t.getFrequencyResponse,(n,s,i)=>{if(n.length!==s.length||s.length!==i.length)throw an();return e.call(t,n,s,i)})})(l),this._nativeIIRFilterNode=l,r(this,1)}getFrequencyResponse(t,e,n){return this._nativeIIRFilterNode.getFrequencyResponse(t,e,n)}})(Ss,(ji=Li,(t,e,n)=>{if(void 0===t.createIIRFilter)return ji(t,e,n);const s=t.createIIRFilter(n.feedforward,n.feedback);return fn(s,n),s}),Fi,fs,ys,si),Bi=((t,e,n,s,i,r,o,a)=>(c,h)=>{const l=h.listener,{forwardX:u,forwardY:d,forwardZ:p,positionX:f,positionY:m,positionZ:g,upX:y,upY:_,upZ:v}=void 0===l.forwardX?(()=>{const u=new Float32Array(1),d=e(h,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),p=o(h);let f=!1,m=[0,0,-1,0,1,0],g=[0,0,0];const y=()=>{if(f)return;f=!0;const t=s(h,256,9,0);t.onaudioprocess=({inputBuffer:t})=>{const e=[r(t,u,0),r(t,u,1),r(t,u,2),r(t,u,3),r(t,u,4),r(t,u,5)];e.some(((t,e)=>t!==m[e]))&&(l.setOrientation(...e),m=e);const n=[r(t,u,6),r(t,u,7),r(t,u,8)];n.some(((t,e)=>t!==g[e]))&&(l.setPosition(...n),g=n)},d.connect(t)},_=t=>e=>{e!==m[t]&&(m[t]=e,l.setOrientation(...m))},v=t=>e=>{e!==g[t]&&(g[t]=e,l.setPosition(...g))},w=(e,s,r)=>{const o=n(h,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:s});o.connect(d,0,e),o.start(),Object.defineProperty(o.offset,"defaultValue",{get:()=>s});const l=t({context:c},p,o.offset,34028234663852886e22,-34028234663852886e22);var u,f,m,g,_,v,w;return a(l,"value",(t=>()=>t.call(l)),(t=>e=>{try{t.call(l,e)}catch(t){if(9!==t.code)throw t}y(),p&&r(e)})),l.cancelAndHoldAtTime=(u=l.cancelAndHoldAtTime,p?()=>{throw i()}:(...t)=>{const e=u.apply(l,t);return y(),e}),l.cancelScheduledValues=(f=l.cancelScheduledValues,p?()=>{throw i()}:(...t)=>{const e=f.apply(l,t);return y(),e}),l.exponentialRampToValueAtTime=(m=l.exponentialRampToValueAtTime,p?()=>{throw i()}:(...t)=>{const e=m.apply(l,t);return y(),e}),l.linearRampToValueAtTime=(g=l.linearRampToValueAtTime,p?()=>{throw i()}:(...t)=>{const e=g.apply(l,t);return y(),e}),l.setTargetAtTime=(_=l.setTargetAtTime,p?()=>{throw i()}:(...t)=>{const e=_.apply(l,t);return y(),e}),l.setValueAtTime=(v=l.setValueAtTime,p?()=>{throw i()}:(...t)=>{const e=v.apply(l,t);return y(),e}),l.setValueCurveAtTime=(w=l.setValueCurveAtTime,p?()=>{throw i()}:(...t)=>{const e=w.apply(l,t);return y(),e}),l};return{forwardX:w(0,0,_(0)),forwardY:w(1,0,_(1)),forwardZ:w(2,-1,_(2)),positionX:w(6,0,v(0)),positionY:w(7,0,v(1)),positionZ:w(8,0,v(2)),upX:w(3,0,_(3)),upY:w(4,1,_(4)),upZ:w(5,0,_(5))}})():l;return{get forwardX(){return u},get forwardY(){return d},get forwardZ(){return p},get positionX(){return f},get positionY(){return m},get positionZ(){return g},get upX(){return y},get upY(){return _},get upZ(){return v}}})(Zs,yi,xi,Sn,Mn,Ln,ys,Fn),zi=new WeakMap,Wi=((t,e,n,s,i,r)=>class extends n{constructor(n,r){super(n),this._nativeContext=n,$t.set(this,n),s(n)&&i.set(n,new Set),this._destination=new t(this,r),this._listener=e(this,n),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(t){const e="function"==typeof t?r(this,t):null;this._nativeContext.onstatechange=e;const n=this._nativeContext.onstatechange;this._onstatechange=null!==n&&n===e?t:n}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}})(ei,Bi,ws,ys,zi,$n),$i=((t,e,n,s,i,r)=>(o,a)=>{const c=o.createOscillator();return fn(c,a),gn(c,a,"detune"),gn(c,a,"frequency"),void 0!==a.periodicWave?c.setPeriodicWave(a.periodicWave):pn(c,a,"type"),e(n,(()=>n(o)))||yn(c),e(s,(()=>s(o)))||r(c,o),e(i,(()=>i(o)))||_n(c),t(o,c),c})(js,ts,Un,Bn,zn,Wn),Gi=((t,e,n,s,i)=>()=>{const r=new WeakMap;let o=null,a=null,c=null;return{set periodicWave(t){o=t},set start(t){a=t},set stop(t){c=t},render(h,l){const u=r.get(l);return void 0!==u?Promise.resolve(u):(async(h,l)=>{let u=n(h);const d=le(u,l);if(!d){const t={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,detune:u.detune.value,frequency:u.frequency.value,periodicWave:null===o?void 0:o,type:u.type};u=e(l,t),null!==a&&u.start(a),null!==c&&u.stop(c)}return r.set(l,u),d?(await t(l,h.detune,u.detune),await t(l,h.frequency,u.frequency)):(await s(l,h.detune,u.detune),await s(l,h.frequency,u.frequency)),await i(h,l,u),u})(h,l)}}})(Gs,$i,Oe,Ys,hs),Hi=((t,e,n,s,i,r,o)=>class extends t{constructor(t,o){const a=i(t),c={...Dn,...o},h=n(a,c),l=r(a),u=l?s():null,d=t.sampleRate/2;super(t,!1,h,u),this._detune=e(this,l,h.detune,153600,-153600),this._frequency=e(this,l,h.frequency,d,-d),this._nativeOscillatorNode=h,this._onended=null,this._oscillatorNodeRenderer=u,null!==this._oscillatorNodeRenderer&&void 0!==c.periodicWave&&(this._oscillatorNodeRenderer.periodicWave=c.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(t){const e="function"==typeof t?o(this,t):null;this._nativeOscillatorNode.onended=e;const n=this._nativeOscillatorNode.onended;this._onended=null!==n&&n===e?t:n}get type(){return this._nativeOscillatorNode.type}set type(t){this._nativeOscillatorNode.type=t,null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(t){this._nativeOscillatorNode.setPeriodicWave(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=t)}start(t=0){if(this._nativeOscillatorNode.start(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.start=t),"closed"!==this.context.state){re(this);const t=()=>{this._nativeOscillatorNode.removeEventListener("ended",t),me(this)&&ae(this)};this._nativeOscillatorNode.addEventListener("ended",t)}}stop(t=0){this._nativeOscillatorNode.stop(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.stop=t)}})(Ss,Zs,$i,Gi,fs,ys,$n),Ki=(Xi=Ks,(t,e)=>{const n=Xi(t,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),s=t.createBuffer(1,2,44100);return n.buffer=s,n.loop=!0,n.connect(e),n.start(),()=>{n.stop(),n.disconnect(e)}});var Xi;const Yi=((t,e,n,s,i)=>(r,{curve:o,oversample:a,...c})=>{const h=r.createWaveShaper(),l=r.createWaveShaper();fn(h,c),fn(l,c);const u=n(r,{...c,gain:1}),d=n(r,{...c,gain:-1}),p=n(r,{...c,gain:1}),f=n(r,{...c,gain:-1});let m=null,g=!1,y=null;const _={get bufferSize(){},get channelCount(){return h.channelCount},set channelCount(t){u.channelCount=t,d.channelCount=t,h.channelCount=t,p.channelCount=t,l.channelCount=t,f.channelCount=t},get channelCountMode(){return h.channelCountMode},set channelCountMode(t){u.channelCountMode=t,d.channelCountMode=t,h.channelCountMode=t,p.channelCountMode=t,l.channelCountMode=t,f.channelCountMode=t},get channelInterpretation(){return h.channelInterpretation},set channelInterpretation(t){u.channelInterpretation=t,d.channelInterpretation=t,h.channelInterpretation=t,p.channelInterpretation=t,l.channelInterpretation=t,f.channelInterpretation=t},get context(){return h.context},get curve(){return y},set curve(n){if(null!==n&&n.length<2)throw e();if(null===n)h.curve=n,l.curve=n;else{const t=n.length,e=new Float32Array(t+2-t%2),s=new Float32Array(t+2-t%2);e[0]=n[0],s[0]=-n[t-1];const i=Math.ceil((t+1)/2),r=(t+1)/2-1;for(let o=1;o<i;o+=1){const a=o/i*r,c=Math.floor(a),h=Math.ceil(a);e[o]=c===h?n[c]:(1-(a-c))*n[c]+(1-(h-a))*n[h],s[o]=c===h?-n[t-1-c]:-(1-(a-c))*n[t-1-c]-(1-(h-a))*n[t-1-h]}e[i]=t%2==1?n[i-1]:(n[i-2]+n[i-1])/2,h.curve=e,l.curve=s}y=n,g&&(s(y)&&null===m?m=t(r,u):null!==m&&(m(),m=null))},get inputs(){return[u]},get numberOfInputs(){return h.numberOfInputs},get numberOfOutputs(){return h.numberOfOutputs},get oversample(){return h.oversample},set oversample(t){h.oversample=t,l.oversample=t},addEventListener:(...t)=>u.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>u.dispatchEvent(t[0]),removeEventListener:(...t)=>u.removeEventListener(t[0],t[1],t[2])};null!==o&&(_.curve=o instanceof Float32Array?o:new Float32Array(o)),a!==_.oversample&&(_.oversample=a);return i(xn(_,p),(()=>{u.connect(h).connect(p),u.connect(d).connect(l).connect(f).connect(p),g=!0,s(y)&&(m=t(r,u))}),(()=>{u.disconnect(h),h.disconnect(p),u.disconnect(d),d.disconnect(l),l.disconnect(f),f.disconnect(p),g=!1,null!==m&&(m(),m=null)}))})(Ki,on,kn,qn,pi),Qi=((t,e,n,s,i,r,o)=>(a,c)=>{const h=a.createWaveShaper();if(null!==r&&"webkitAudioContext"===r.name&&void 0===a.createGain().gain.automationRate)return n(a,c);fn(h,c);const l=null===c.curve||c.curve instanceof Float32Array?c.curve:new Float32Array(c.curve);if(null!==l&&l.length<2)throw e();pn(h,{curve:l},"curve"),pn(h,c,"oversample");let u=null,d=!1;o(h,"curve",(t=>()=>t.call(h)),(e=>n=>(e.call(h,n),d&&(s(n)&&null===u?u=t(a,h):s(n)||null===u||(u(),u=null)),n)));return i(h,(()=>{d=!0,s(h.curve)&&(u=t(a,h))}),(()=>{d=!1,null!==u&&(u(),u=null)}))})(Ki,on,Yi,qn,pi,Ts,Fn),Zi=((t,e,n,s,i,r,o,a,c,h)=>(l,{coneInnerAngle:u,coneOuterAngle:d,coneOuterGain:p,distanceModel:f,maxDistance:m,orientationX:g,orientationY:y,orientationZ:_,panningModel:v,positionX:w,positionY:b,positionZ:T,refDistance:x,rolloffFactor:A,...k})=>{const C=l.createPanner();if(k.channelCount>2)throw o();if("max"===k.channelCountMode)throw o();fn(C,k);const E={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},S=n(l,{...E,channelInterpretation:"speakers",numberOfInputs:6}),M=s(l,{...k,gain:1}),I=s(l,{...E,gain:1}),D=s(l,{...E,gain:0}),P=s(l,{...E,gain:0}),O=s(l,{...E,gain:0}),R=s(l,{...E,gain:0}),N=s(l,{...E,gain:0}),V=i(l,256,6,1),L=r(l,{...E,curve:new Float32Array([1,1]),oversample:"none"});let q=[g,y,_],F=[w,b,T];const j=new Float32Array(1);V.onaudioprocess=({inputBuffer:t})=>{const e=[c(t,j,0),c(t,j,1),c(t,j,2)];e.some(((t,e)=>t!==q[e]))&&(C.setOrientation(...e),q=e);const n=[c(t,j,3),c(t,j,4),c(t,j,5)];n.some(((t,e)=>t!==F[e]))&&(C.setPosition(...n),F=n)},Object.defineProperty(D.gain,"defaultValue",{get:()=>0}),Object.defineProperty(P.gain,"defaultValue",{get:()=>0}),Object.defineProperty(O.gain,"defaultValue",{get:()=>0}),Object.defineProperty(R.gain,"defaultValue",{get:()=>0}),Object.defineProperty(N.gain,"defaultValue",{get:()=>0});const U={get bufferSize(){},get channelCount(){return C.channelCount},set channelCount(t){if(t>2)throw o();M.channelCount=t,C.channelCount=t},get channelCountMode(){return C.channelCountMode},set channelCountMode(t){if("max"===t)throw o();M.channelCountMode=t,C.channelCountMode=t},get channelInterpretation(){return C.channelInterpretation},set channelInterpretation(t){M.channelInterpretation=t,C.channelInterpretation=t},get coneInnerAngle(){return C.coneInnerAngle},set coneInnerAngle(t){C.coneInnerAngle=t},get coneOuterAngle(){return C.coneOuterAngle},set coneOuterAngle(t){C.coneOuterAngle=t},get coneOuterGain(){return C.coneOuterGain},set coneOuterGain(t){if(t<0||t>1)throw e();C.coneOuterGain=t},get context(){return C.context},get distanceModel(){return C.distanceModel},set distanceModel(t){C.distanceModel=t},get inputs(){return[M]},get maxDistance(){return C.maxDistance},set maxDistance(t){if(t<0)throw new RangeError;C.maxDistance=t},get numberOfInputs(){return C.numberOfInputs},get numberOfOutputs(){return C.numberOfOutputs},get orientationX(){return I.gain},get orientationY(){return D.gain},get orientationZ(){return P.gain},get panningModel(){return C.panningModel},set panningModel(t){C.panningModel=t},get positionX(){return O.gain},get positionY(){return R.gain},get positionZ(){return N.gain},get refDistance(){return C.refDistance},set refDistance(t){if(t<0)throw new RangeError;C.refDistance=t},get rolloffFactor(){return C.rolloffFactor},set rolloffFactor(t){if(t<0)throw new RangeError;C.rolloffFactor=t},addEventListener:(...t)=>M.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>M.dispatchEvent(t[0]),removeEventListener:(...t)=>M.removeEventListener(t[0],t[1],t[2])};u!==U.coneInnerAngle&&(U.coneInnerAngle=u),d!==U.coneOuterAngle&&(U.coneOuterAngle=d),p!==U.coneOuterGain&&(U.coneOuterGain=p),f!==U.distanceModel&&(U.distanceModel=f),m!==U.maxDistance&&(U.maxDistance=m),g!==U.orientationX.value&&(U.orientationX.value=g),y!==U.orientationY.value&&(U.orientationY.value=y),_!==U.orientationZ.value&&(U.orientationZ.value=_),v!==U.panningModel&&(U.panningModel=v),w!==U.positionX.value&&(U.positionX.value=w),b!==U.positionY.value&&(U.positionY.value=b),T!==U.positionZ.value&&(U.positionZ.value=T),x!==U.refDistance&&(U.refDistance=x),A!==U.rolloffFactor&&(U.rolloffFactor=A),1===q[0]&&0===q[1]&&0===q[2]||C.setOrientation(...q),0===F[0]&&0===F[1]&&0===F[2]||C.setPosition(...F);return h(xn(U,C),(()=>{M.connect(C),t(M,L,0,0),L.connect(I).connect(S,0,0),L.connect(D).connect(S,0,1),L.connect(P).connect(S,0,2),L.connect(O).connect(S,0,3),L.connect(R).connect(S,0,4),L.connect(N).connect(S,0,5),S.connect(V).connect(l.destination)}),(()=>{M.disconnect(C),a(M,L,0,0),L.disconnect(I),I.disconnect(S),L.disconnect(D),D.disconnect(S),L.disconnect(P),P.disconnect(S),L.disconnect(O),O.disconnect(S),L.disconnect(R),R.disconnect(S),L.disconnect(N),N.disconnect(S),S.disconnect(V),V.disconnect(l.destination)}))})(Se,on,yi,kn,Sn,Qi,Mn,Pe,Ln,pi),Ji=(tr=Zi,(t,e)=>{const n=t.createPanner();return void 0===n.orientationX?tr(t,e):(fn(n,e),gn(n,e,"orientationX"),gn(n,e,"orientationY"),gn(n,e,"orientationZ"),gn(n,e,"positionX"),gn(n,e,"positionY"),gn(n,e,"positionZ"),pn(n,e,"coneInnerAngle"),pn(n,e,"coneOuterAngle"),pn(n,e,"coneOuterGain"),pn(n,e,"distanceModel"),pn(n,e,"maxDistance"),pn(n,e,"panningModel"),pn(n,e,"refDistance"),pn(n,e,"rolloffFactor"),n)});var tr;const er=((t,e,n,s,i,r,o,a,c,h)=>()=>{const l=new WeakMap;let u=null;return{render(d,p){const f=l.get(p);return void 0!==f?Promise.resolve(f):(async(d,p)=>{let f=null,m=r(d);const g={channelCount:m.channelCount,channelCountMode:m.channelCountMode,channelInterpretation:m.channelInterpretation},y={...g,coneInnerAngle:m.coneInnerAngle,coneOuterAngle:m.coneOuterAngle,coneOuterGain:m.coneOuterGain,distanceModel:m.distanceModel,maxDistance:m.maxDistance,panningModel:m.panningModel,refDistance:m.refDistance,rolloffFactor:m.rolloffFactor},_=le(m,p);if("bufferSize"in m)f=s(p,{...g,gain:1});else if(!_){const t={...y,orientationX:m.orientationX.value,orientationY:m.orientationY.value,orientationZ:m.orientationZ.value,positionX:m.positionX.value,positionY:m.positionY.value,positionZ:m.positionZ.value};m=i(p,t)}if(l.set(p,null===f?m:f),null!==f){if(null===u){if(null===o)throw new Error("Missing the native OfflineAudioContext constructor.");const t=new o(6,d.context.length,p.sampleRate),s=e(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});s.connect(t.destination),u=(async()=>{const e=await Promise.all([d.orientationX,d.orientationY,d.orientationZ,d.positionX,d.positionY,d.positionZ].map((async(e,s)=>{const i=n(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:0===s?1:0});return await a(t,e,i.offset),i})));for(let t=0;t<6;t+=1)e[t].connect(s,0,t),e[t].start(0);return h(t)})()}const t=await u,r=s(p,{...g,gain:1});await c(d,p,r);const l=[];for(let e=0;e<t.numberOfChannels;e+=1)l.push(t.getChannelData(e));let m=[l[0][0],l[1][0],l[2][0]],_=[l[3][0],l[4][0],l[5][0]],v=s(p,{...g,gain:1}),w=i(p,{...y,orientationX:m[0],orientationY:m[1],orientationZ:m[2],positionX:_[0],positionY:_[1],positionZ:_[2]});r.connect(v).connect(w.inputs[0]),w.connect(f);for(let e=128;e<t.length;e+=128){const t=[l[0][e],l[1][e],l[2][e]],n=[l[3][e],l[4][e],l[5][e]];if(t.some(((t,e)=>t!==m[e]))||n.some(((t,e)=>t!==_[e]))){m=t,_=n;const o=e/p.sampleRate;v.gain.setValueAtTime(0,o),v=s(p,{...g,gain:0}),w=i(p,{...y,orientationX:m[0],orientationY:m[1],orientationZ:m[2],positionX:_[0],positionY:_[1],positionZ:_[2]}),v.gain.setValueAtTime(1,o),r.connect(v).connect(w.inputs[0]),w.connect(f)}}return f}return _?(await t(p,d.orientationX,m.orientationX),await t(p,d.orientationY,m.orientationY),await t(p,d.orientationZ,m.orientationZ),await t(p,d.positionX,m.positionX),await t(p,d.positionY,m.positionY),await t(p,d.positionZ,m.positionZ)):(await a(p,d.orientationX,m.orientationX),await a(p,d.orientationY,m.orientationY),await a(p,d.orientationZ,m.orientationZ),await a(p,d.positionX,m.positionX),await a(p,d.positionY,m.positionY),await a(p,d.positionZ,m.positionZ)),Ee(m)?await c(d,p,m.inputs[0]):await c(d,p,m),m})(d,p)}}})(Gs,yi,xi,kn,Ji,Oe,gs,Ys,hs,qi),nr=((t,e,n,s,i,r,o)=>class extends t{constructor(t,a){const c=i(t),h={...Pn,...a},l=n(c,h),u=r(c);super(t,!1,l,u?s():null),this._nativePannerNode=l,this._orientationX=e(this,u,l.orientationX,34028234663852886e22,-34028234663852886e22),this._orientationY=e(this,u,l.orientationY,34028234663852886e22,-34028234663852886e22),this._orientationZ=e(this,u,l.orientationZ,34028234663852886e22,-34028234663852886e22),this._positionX=e(this,u,l.positionX,34028234663852886e22,-34028234663852886e22),this._positionY=e(this,u,l.positionY,34028234663852886e22,-34028234663852886e22),this._positionZ=e(this,u,l.positionZ,34028234663852886e22,-34028234663852886e22),o(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(t){this._nativePannerNode.coneInnerAngle=t}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(t){this._nativePannerNode.coneOuterAngle=t}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(t){this._nativePannerNode.coneOuterGain=t}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(t){this._nativePannerNode.distanceModel=t}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(t){this._nativePannerNode.maxDistance=t}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(t){this._nativePannerNode.panningModel=t}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(t){this._nativePannerNode.refDistance=t}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(t){this._nativePannerNode.rolloffFactor=t}})(Ss,Zs,Ji,er,fs,ys,si),sr=(t=>(e,{disableNormalization:n,imag:s,real:i})=>{const r=s instanceof Float32Array?s:new Float32Array(s),o=i instanceof Float32Array?i:new Float32Array(i),a=e.createPeriodicWave(o,r,{disableNormalization:n});if(Array.from(s).length<2)throw t();return a})(de),ir=((t,e,n,s)=>class i{constructor(i,r){const o=e(i),a=s({...On,...r}),c=t(o,a);return n.add(c),c}static[Symbol.hasInstance](t){return null!==t&&"object"==typeof t&&Object.getPrototypeOf(t)===i.prototype||n.has(t)}})(sr,fs,new WeakSet,(t=>{const{imag:e,real:n}=t;return void 0===e?void 0===n?{...t,imag:[0,0],real:[0,0]}:{...t,imag:Array.from(n,(()=>0)),real:n}:void 0===n?{...t,imag:e,real:Array.from(e,(()=>0))}:{...t,imag:e,real:n}})),rr=((t,e,n,s,i,r)=>{const o=16385,a=new Float32Array([1,1]),c=Math.PI/2,h={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},l={...h,oversample:"none"},u=(t,r,u,d,p)=>{if(1===r)return((t,e,i,r)=>{const u=new Float32Array(o),d=new Float32Array(o);for(let t=0;t<o;t+=1){const e=t/16384*c;u[t]=Math.cos(e),d[t]=Math.sin(e)}const p=n(t,{...h,gain:0}),f=s(t,{...l,curve:u}),m=s(t,{...l,curve:a}),g=n(t,{...h,gain:0}),y=s(t,{...l,curve:d});return{connectGraph(){e.connect(p),e.connect(void 0===m.inputs?m:m.inputs[0]),e.connect(g),m.connect(i),i.connect(void 0===f.inputs?f:f.inputs[0]),i.connect(void 0===y.inputs?y:y.inputs[0]),f.connect(p.gain),y.connect(g.gain),p.connect(r,0,0),g.connect(r,0,1)},disconnectGraph(){e.disconnect(p),e.disconnect(void 0===m.inputs?m:m.inputs[0]),e.disconnect(g),m.disconnect(i),i.disconnect(void 0===f.inputs?f:f.inputs[0]),i.disconnect(void 0===y.inputs?y:y.inputs[0]),f.disconnect(p.gain),y.disconnect(g.gain),p.disconnect(r,0,0),g.disconnect(r,0,1)}}})(t,u,d,p);if(2===r)return((t,i,r,u)=>{const d=new Float32Array(o),p=new Float32Array(o),f=new Float32Array(o),m=new Float32Array(o),g=Math.floor(8192.5);for(let t=0;t<o;t+=1)if(t>g){const e=(t-g)/(16384-g)*c;d[t]=Math.cos(e),p[t]=Math.sin(e),f[t]=0,m[t]=1}else{const e=t/(16384-g)*c;d[t]=1,p[t]=0,f[t]=Math.cos(e),m[t]=Math.sin(e)}const y=e(t,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),_=n(t,{...h,gain:0}),v=s(t,{...l,curve:d}),w=n(t,{...h,gain:0}),b=s(t,{...l,curve:p}),T=s(t,{...l,curve:a}),x=n(t,{...h,gain:0}),A=s(t,{...l,curve:f}),k=n(t,{...h,gain:0}),C=s(t,{...l,curve:m});return{connectGraph(){i.connect(y),i.connect(void 0===T.inputs?T:T.inputs[0]),y.connect(_,0),y.connect(w,0),y.connect(x,1),y.connect(k,1),T.connect(r),r.connect(void 0===v.inputs?v:v.inputs[0]),r.connect(void 0===b.inputs?b:b.inputs[0]),r.connect(void 0===A.inputs?A:A.inputs[0]),r.connect(void 0===C.inputs?C:C.inputs[0]),v.connect(_.gain),b.connect(w.gain),A.connect(x.gain),C.connect(k.gain),_.connect(u,0,0),x.connect(u,0,0),w.connect(u,0,1),k.connect(u,0,1)},disconnectGraph(){i.disconnect(y),i.disconnect(void 0===T.inputs?T:T.inputs[0]),y.disconnect(_,0),y.disconnect(w,0),y.disconnect(x,1),y.disconnect(k,1),T.disconnect(r),r.disconnect(void 0===v.inputs?v:v.inputs[0]),r.disconnect(void 0===b.inputs?b:b.inputs[0]),r.disconnect(void 0===A.inputs?A:A.inputs[0]),r.disconnect(void 0===C.inputs?C:C.inputs[0]),v.disconnect(_.gain),b.disconnect(w.gain),A.disconnect(x.gain),C.disconnect(k.gain),_.disconnect(u,0,0),x.disconnect(u,0,0),w.disconnect(u,0,1),k.disconnect(u,0,1)}}})(t,u,d,p);throw i()};return(e,{channelCount:s,channelCountMode:o,pan:a,...c})=>{if("max"===o)throw i();const h=t(e,{...c,channelCount:1,channelCountMode:o,numberOfInputs:2}),l=n(e,{...c,channelCount:s,channelCountMode:o,gain:1}),d=n(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:a});let{connectGraph:p,disconnectGraph:f}=u(e,s,l,d,h);Object.defineProperty(d.gain,"defaultValue",{get:()=>0}),Object.defineProperty(d.gain,"maxValue",{get:()=>1}),Object.defineProperty(d.gain,"minValue",{get:()=>-1});const m={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(t){l.channelCount!==t&&(g&&f(),({connectGraph:p,disconnectGraph:f}=u(e,t,l,d,h)),g&&p()),l.channelCount=t},get channelCountMode(){return l.channelCountMode},set channelCountMode(t){if("clamped-max"===t||"max"===t)throw i();l.channelCountMode=t},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(t){l.channelInterpretation=t},get context(){return l.context},get inputs(){return[l]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get pan(){return d.gain},addEventListener:(...t)=>l.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>l.dispatchEvent(t[0]),removeEventListener:(...t)=>l.removeEventListener(t[0],t[1],t[2])};let g=!1;return r(xn(m,h),(()=>{p(),g=!0}),(()=>{f(),g=!1}))}})(yi,Tn,kn,Qi,Mn,pi),or=((t,e)=>(n,s)=>{const i=s.channelCountMode;if("clamped-max"===i)throw e();if(void 0===n.createStereoPanner)return t(n,s);const r=n.createStereoPanner();return fn(r,s),gn(r,s,"pan"),Object.defineProperty(r,"channelCountMode",{get:()=>i,set:t=>{if(t!==i)throw e()}}),r})(rr,Mn),ar=((t,e,n,s,i)=>()=>{const r=new WeakMap;return{render(o,a){const c=r.get(a);return void 0!==c?Promise.resolve(c):(async(o,a)=>{let c=n(o);const h=le(c,a);if(!h){const t={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,pan:c.pan.value};c=e(a,t)}return r.set(a,c),h?await t(a,o.pan,c.pan):await s(a,o.pan,c.pan),Ee(c)?await i(o,a,c.inputs[0]):await i(o,a,c),c})(o,a)}}})(Gs,or,Oe,Ys,hs),cr=((t,e,n,s,i,r)=>class extends t{constructor(t,o){const a=i(t),c={...Rn,...o},h=n(a,c),l=r(a);super(t,!1,h,l?s():null),this._pan=e(this,l,h.pan)}get pan(){return this._pan}})(Ss,Zs,or,ar,fs,ys),hr=((t,e,n)=>()=>{const s=new WeakMap;return{render(i,r){const o=s.get(r);return void 0!==o?Promise.resolve(o):(async(i,r)=>{let o=e(i);if(!le(o,r)){const e={channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,curve:o.curve,oversample:o.oversample};o=t(r,e)}return s.set(r,o),Ee(o)?await n(i,r,o.inputs[0]):await n(i,r,o),o})(i,r)}}})(Qi,Oe,hs),lr=((t,e,n,s,i,r,o)=>class extends t{constructor(t,e){const a=i(t),c={...Vn,...e},h=n(a,c);super(t,!0,h,r(a)?s():null),this._isCurveNullified=!1,this._nativeWaveShaperNode=h,o(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(t){if(null===t)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(t.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=t}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(t){this._nativeWaveShaperNode.oversample=t}})(Ss,on,Qi,hr,fs,ys,si),ur=(t=>null!==t&&t.isSecureContext)(ss),dr=(t=>(e,n,s)=>{Object.defineProperties(t,{currentFrame:{configurable:!0,get:()=>Math.round(e*n)},currentTime:{configurable:!0,get:()=>e}});try{return s()}finally{null!==t&&(delete t.currentFrame,delete t.currentTime)}})(ss),pr=new WeakMap,fr=((t,e)=>n=>{let s=t.get(n);if(void 0!==s)return s;if(null===e)throw new Error("Missing the native OfflineAudioContext constructor.");return s=new e(1,1,44100),t.set(n,s),s})(pr,gs),mr=ur?((t,e,n,s,i,r,o,a,c,h,l,u,d)=>{let p=0;return(f,m,g={credentials:"omit"})=>{const y=l.get(f);if(void 0!==y&&y.has(m))return Promise.resolve();const _=h.get(f);if(void 0!==_){const t=_.get(m);if(void 0!==t)return t}const v=r(f),w=void 0===v.audioWorklet?i(m).then((([t,e])=>{const[s,i]=Zt(t,e);return n(`${s};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${i}\n})})(window,'_AWGS')`)})).then((()=>{const t=d._AWGS.pop();if(void 0===t)throw new SyntaxError;s(v.currentTime,v.sampleRate,(()=>t(class{},void 0,((t,n)=>{if(""===t.trim())throw e();const s=Kt.get(v);if(void 0!==s){if(s.has(t))throw e();te(n),Jt(n.parameterDescriptors),s.set(t,n)}else te(n),Jt(n.parameterDescriptors),Kt.set(v,new Map([[t,n]]))}),v.sampleRate,void 0,void 0)))})):Promise.all([i(m),Promise.resolve(t(u,u))]).then((([[t,e],n])=>{const s=p+1;p=s;const[i,r]=Zt(t,e),h=new Blob([`${i};((AudioWorkletProcessor,registerProcessor)=>{${r}\n})(${n?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${n?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${n?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${s}',class extends AudioWorkletProcessor{process(){return !1}})`],{type:"application/javascript; charset=utf-8"}),l=URL.createObjectURL(h);return v.audioWorklet.addModule(l,g).then((()=>{if(a(v))return v;const t=o(v);return t.audioWorklet.addModule(l,g).then((()=>t))})).then((t=>{if(null===c)throw new SyntaxError;try{new c(t,`__sac${s}`)}catch{throw new SyntaxError}})).finally((()=>URL.revokeObjectURL(l)))}));return void 0===_?h.set(f,new Map([[m,w]])):_.set(m,w),w.then((()=>{const t=l.get(f);void 0===t?l.set(f,new Set([m])):t.add(m)})).finally((()=>{const t=h.get(f);void 0!==t&&t.delete(m)})),w}})(ts,Mn,(t=>e=>new Promise(((n,s)=>{if(null===t)return void s(new SyntaxError);const i=t.document.head;if(null===i)s(new SyntaxError);else{const r=t.document.createElement("script"),o=new Blob([e],{type:"application/javascript"}),a=URL.createObjectURL(o),c=t.onerror,h=()=>{t.onerror=c,URL.revokeObjectURL(a)};t.onerror=(e,n,i,r,o)=>n===a||n===t.location.href&&1===i&&1===r?(h(),s(o),!1):null!==c?c(e,n,i,r,o):void 0,r.onerror=()=>{h(),s(new SyntaxError)},r.onload=()=>{h(),n()},r.src=a,r.type="module",i.appendChild(r)}})))(ss),dr,(gr=()=>new DOMException("","AbortError"),async t=>{try{const e=await fetch(t);if(e.ok)return[await e.text(),e.url]}catch{}throw gr()}),fs,fr,ys,Es,new WeakMap,new WeakMap,((t,e)=>async()=>{if(null===t)return!0;if(null===e)return!1;const n=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),s=new e(1,128,44100),i=URL.createObjectURL(n);let r=!1,o=!1;try{await s.audioWorklet.addModule(i);const e=new t(s,"a",{numberOfOutputs:0}),n=s.createOscillator();e.port.onmessage=()=>r=!0,e.onprocessorerror=()=>o=!0,n.connect(e),n.start(0),await s.startRendering()}catch{}finally{URL.revokeObjectURL(i)}return r&&!o})(Es,gs),ss):void 0;var gr;const yr=((t,e)=>n=>t(n)||e(n))(xs,ys),_r=((t,e,n,s,i,r,o,a,c,h,l)=>(u,d)=>{const p=o(u)?u:r(u);if(i.has(d)){const t=n();return Promise.reject(t)}try{i.add(d)}catch{}return e(c,(()=>c(p)))?p.decodeAudioData(d).then((n=>(tn(d).catch((()=>{})),e(a,(()=>a(n)))||l(n),t.add(n),n))):new Promise(((e,n)=>{const i=async()=>{try{await tn(d)}catch{}},r=t=>{n(t),i()};try{p.decodeAudioData(d,(n=>{"function"!=typeof n.copyFromChannel&&(h(n),pe(n)),t.add(n),i().then((()=>e(n)))}),(t=>{r(null===t?s():t)}))}catch(t){r(t)}}))})(Ds,ts,(()=>new DOMException("","DataCloneError")),(()=>new DOMException("","EncodingError")),new WeakSet,fs,yr,ue,un,Ns,Vs),vr=(wr=mr,br=Is,Tr=qs,xr=ti,Ar=ii,kr=vi,Cr=bi,Er=ki,Sr=Si,Mr=_r,Ir=Ii,Dr=Ri,Pr=Vi,Or=Ui,Rr=Wi,Nr=Hi,Vr=nr,Lr=ir,qr=cr,Fr=lr,class extends Rr{constructor(t,e){super(t,e),this._nativeContext=t,this._audioWorklet=void 0===wr?void 0:{addModule:(t,e)=>wr(this,t,e)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new br(this)}createBiquadFilter(){return new Ar(this)}createBuffer(t,e,n){return new Tr({length:e,numberOfChannels:t,sampleRate:n})}createBufferSource(){return new xr(this)}createChannelMerger(t=6){return new kr(this,{numberOfInputs:t})}createChannelSplitter(t=6){return new Cr(this,{numberOfOutputs:t})}createConstantSource(){return new Er(this)}createConvolver(){return new Sr(this)}createDelay(t=1){return new Ir(this,{maxDelayTime:t})}createDynamicsCompressor(){return new Dr(this)}createGain(){return new Pr(this)}createIIRFilter(t,e){return new Or(this,{feedback:e,feedforward:t})}createOscillator(){return new Nr(this)}createPanner(){return new Vr(this)}createPeriodicWave(t,e,n={disableNormalization:!1}){return new Lr(this,{...n,imag:e,real:t})}createStereoPanner(){return new qr(this)}createWaveShaper(){return new Fr(this)}decodeAudioData(t,e,n){return Mr(this._nativeContext,t).then((t=>("function"==typeof e&&e(t),t)),(t=>{throw"function"==typeof n&&n(t),t}))}});var wr,br,Tr,xr,Ar,kr,Cr,Er,Sr,Mr,Ir,Dr,Pr,Or,Rr,Nr,Vr,Lr,qr,Fr;const jr=((t,e,n,s)=>class extends t{constructor(t,i){const r=n(t),o=e(r,i);if(s(r))throw TypeError();super(t,!0,o,null),this._nativeMediaElementAudioSourceNode=o}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}})(Ss,((t,e)=>t.createMediaElementSource(e.mediaElement)),fs,ys),Ur=((t,e,n,s)=>class extends t{constructor(t,i){const r=n(t);if(s(r))throw new TypeError;const o={...ln,...i},a=e(r,o);super(t,!1,a,null),this._nativeMediaStreamAudioDestinationNode=a}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}})(Ss,((t,e)=>{const n=t.createMediaStreamDestination();return fn(n,e),1===n.numberOfOutputs&&Object.defineProperty(n,"numberOfOutputs",{get:()=>0}),n}),fs,ys),Br=((t,e,n,s)=>class extends t{constructor(t,i){const r=n(t),o=e(r,i);if(s(r))throw new TypeError;super(t,!0,o,null),this._nativeMediaStreamAudioSourceNode=o}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}})(Ss,((t,{mediaStream:e})=>{const n=e.getAudioTracks();n.sort(((t,e)=>t.id<e.id?-1:t.id>e.id?1:0));const s=n.slice(0,1),i=t.createMediaStreamSource(new MediaStream(s));return Object.defineProperty(i,"mediaStream",{value:e}),i}),fs,ys),zr=((t,e)=>(n,{mediaStreamTrack:s})=>{if("function"==typeof n.createMediaStreamTrackSource)return n.createMediaStreamTrackSource(s);const i=new MediaStream([s]),r=n.createMediaStreamSource(i);if("audio"!==s.kind)throw t();if(e(n))throw new TypeError;return r})(on,ys),Wr=((t,e,n)=>class extends t{constructor(t,s){const i=n(t);super(t,!0,e(i,s),null)}})(Ss,zr,fs),$r=((t,e,n,s,i,r,o,a,c)=>class extends t{constructor(t={}){if(null===c)throw new Error("Missing the native AudioContext constructor.");let e;try{e=new c(t)}catch(t){if(12===t.code&&"sampleRate is not in range"===t.message)throw n();throw t}if(null===e)throw s();if(!be(t.latencyHint))throw new TypeError(`The provided value '${t.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(void 0!==t.sampleRate&&e.sampleRate!==t.sampleRate)throw n();super(e,2);const{latencyHint:i}=t,{sampleRate:r}=e;if(this._baseLatency="number"==typeof e.baseLatency?e.baseLatency:"balanced"===i?512/r:"interactive"===i||void 0===i?256/r:"playback"===i?1024/r:128*Math.max(2,Math.min(128,Math.round(i*r/128)))/r,this._nativeAudioContext=e,"webkitAudioContext"===c.name?(this._nativeGainNode=e.createGain(),this._nativeOscillatorNode=e.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(e.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,"running"===e.state){this._state="suspended";const t=()=>{"suspended"===this._state&&(this._state=null),e.removeEventListener("statechange",t)};e.addEventListener("statechange",t)}}get baseLatency(){return this._baseLatency}get state(){return null!==this._state?this._state:this._nativeAudioContext.state}close(){return"closed"===this.state?this._nativeAudioContext.close().then((()=>{throw e()})):("suspended"===this._state&&(this._state=null),this._nativeAudioContext.close().then((()=>{null!==this._nativeGainNode&&null!==this._nativeOscillatorNode&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),we(this)})))}createMediaElementSource(t){return new i(this,{mediaElement:t})}createMediaStreamDestination(){return new r(this)}createMediaStreamSource(t){return new o(this,{mediaStream:t})}createMediaStreamTrackSource(t){return new a(this,{mediaStreamTrack:t})}resume(){return"suspended"===this._state?new Promise(((t,e)=>{const n=()=>{this._nativeAudioContext.removeEventListener("statechange",n),"running"===this._nativeAudioContext.state?t():this.resume().then(t,e)};this._nativeAudioContext.addEventListener("statechange",n)})):this._nativeAudioContext.resume().catch((t=>{if(void 0===t||15===t.code)throw e();throw t}))}suspend(){return this._nativeAudioContext.suspend().catch((t=>{if(void 0===t)throw e();throw t}))}})(vr,on,Mn,Nn,jr,Ur,Br,Wr,Ts),Gr=(Hr=zi,t=>{const e=Hr.get(t);if(void 0===e)throw new Error("The context has no set of AudioWorkletNodes.");return e});var Hr;const Kr=(Xr=Gr,(t,e)=>{Xr(t).add(e)});var Xr;const Yr=(t=>(e,n,s=0,i=0)=>{const r=e[s];if(void 0===r)throw t();return Fe(n)?r.connect(n,0,i):r.connect(n,0)})(de),Qr=(t=>(e,n)=>{t(e).delete(n)})(Gr),Zr=(t=>(e,n,s,i=0)=>void 0===n?e.forEach((t=>t.disconnect())):"number"==typeof n?nn(t,e,n).disconnect():Fe(n)?void 0===s?e.forEach((t=>t.disconnect(n))):void 0===i?nn(t,e,s).disconnect(n,0):nn(t,e,s).disconnect(n,0,i):void 0===s?e.forEach((t=>t.disconnect(n))):nn(t,e,s).disconnect(n,0))(de),Jr=new WeakMap,to=(eo=Jr,no=ee,t=>no(eo,t));var eo,no;const so=((t,e,n,s,i,r,o,a,c,h,l,u,d)=>(p,f,m,g)=>{if(0===g.numberOfInputs&&0===g.numberOfOutputs)throw c();const y=Array.isArray(g.outputChannelCount)?g.outputChannelCount:Array.from(g.outputChannelCount);if(y.some((t=>t<1)))throw c();if(y.length!==g.numberOfOutputs)throw e();if("explicit"!==g.channelCountMode)throw c();const _=g.channelCount*g.numberOfInputs,v=y.reduce(((t,e)=>t+e),0),w=void 0===m.parameterDescriptors?0:m.parameterDescriptors.length;if(_+w>6||v>6)throw c();const b=new MessageChannel,T=[],x=[];for(let t=0;t<g.numberOfInputs;t+=1)T.push(o(p,{channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation,gain:1})),x.push(i(p,{channelCount:g.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:g.channelCount}));const A=[];if(void 0!==m.parameterDescriptors)for(const{defaultValue:t,maxValue:e,minValue:n,name:s}of m.parameterDescriptors){const i=r(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:void 0!==g.parameterData[s]?g.parameterData[s]:void 0===t?0:t});Object.defineProperties(i.offset,{defaultValue:{get:()=>void 0===t?0:t},maxValue:{get:()=>void 0===e?34028234663852886e22:e},minValue:{get:()=>void 0===n?-34028234663852886e22:n}}),A.push(i)}const k=s(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,_+w)}),C=vn(f,p.sampleRate),E=a(p,C,_+w,Math.max(1,v)),S=i(p,{channelCount:Math.max(1,v),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,v)}),M=[];for(let t=0;t<g.numberOfOutputs;t+=1)M.push(s(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:y[t]}));for(let t=0;t<g.numberOfInputs;t+=1){T[t].connect(x[t]);for(let e=0;e<g.channelCount;e+=1)x[t].connect(k,e,t*g.channelCount+e)}const I=new ze(void 0===m.parameterDescriptors?[]:m.parameterDescriptors.map((({name:t},e)=>{const n=A[e];return n.connect(k,0,_+e),n.start(0),[t,n.offset]})));k.connect(E);let D=g.channelInterpretation,P=null;const O=0===g.numberOfOutputs?[E]:M,R={get bufferSize(){return C},get channelCount(){return g.channelCount},set channelCount(t){throw n()},get channelCountMode(){return g.channelCountMode},set channelCountMode(t){throw n()},get channelInterpretation(){return D},set channelInterpretation(t){for(const e of T)e.channelInterpretation=t;D=t},get context(){return E.context},get inputs(){return T},get numberOfInputs(){return g.numberOfInputs},get numberOfOutputs(){return g.numberOfOutputs},get onprocessorerror(){return P},set onprocessorerror(t){"function"==typeof P&&R.removeEventListener("processorerror",P),P="function"==typeof t?t:null,"function"==typeof P&&R.addEventListener("processorerror",P)},get parameters(){return I},get port(){return b.port2},addEventListener:(...t)=>E.addEventListener(t[0],t[1],t[2]),connect:t.bind(null,O),disconnect:h.bind(null,O),dispatchEvent:(...t)=>E.dispatchEvent(t[0]),removeEventListener:(...t)=>E.removeEventListener(t[0],t[1],t[2])},N=new Map;var V,L;b.port1.addEventListener=(V=b.port1.addEventListener,(...t)=>{if("message"===t[0]){const e="function"==typeof t[1]?t[1]:"object"==typeof t[1]&&null!==t[1]&&"function"==typeof t[1].handleEvent?t[1].handleEvent:null;if(null!==e){const n=N.get(t[1]);void 0!==n?t[1]=n:(t[1]=t=>{l(p.currentTime,p.sampleRate,(()=>e(t)))},N.set(e,t[1]))}}return V.call(b.port1,t[0],t[1],t[2])}),b.port1.removeEventListener=(L=b.port1.removeEventListener,(...t)=>{if("message"===t[0]){const e=N.get(t[1]);void 0!==e&&(N.delete(t[1]),t[1]=e)}return L.call(b.port1,t[0],t[1],t[2])});let q=null;Object.defineProperty(b.port1,"onmessage",{get:()=>q,set:t=>{"function"==typeof q&&b.port1.removeEventListener("message",q),q="function"==typeof t?t:null,"function"==typeof q&&(b.port1.addEventListener("message",q),b.port1.start())}}),m.prototype.port=b.port1;let F=null;const j=((t,e,n,s)=>{let i=Xt.get(t);void 0===i&&(i=new WeakMap,Xt.set(t,i));const r=wn(n,s);return i.set(e,r),r})(p,R,m,g);j.then((t=>F=t));const U=He(g.numberOfInputs,g.channelCount),B=He(g.numberOfOutputs,y),z=void 0===m.parameterDescriptors?[]:m.parameterDescriptors.reduce(((t,{name:e})=>({...t,[e]:new Float32Array(128)})),{});let W=!0;const $=()=>{g.numberOfOutputs>0&&E.disconnect(S);for(let t=0,e=0;t<g.numberOfOutputs;t+=1){const n=M[t];for(let s=0;s<y[t];s+=1)S.disconnect(n,e+s,s);e+=y[t]}},G=new Map;E.onaudioprocess=({inputBuffer:t,outputBuffer:e})=>{if(null!==F){const n=u(R);for(let s=0;s<C;s+=128){for(let e=0;e<g.numberOfInputs;e+=1)for(let n=0;n<g.channelCount;n+=1)$e(t,U[e],n,n,s);void 0!==m.parameterDescriptors&&m.parameterDescriptors.forEach((({name:e},n)=>{$e(t,z,e,_+n,s)}));for(let t=0;t<g.numberOfInputs;t+=1)for(let e=0;e<y[t];e+=1)0===B[t][e].byteLength&&(B[t][e]=new Float32Array(128));try{const t=U.map(((t,e)=>{if(n[e].size>0)return G.set(e,C/128),t;const s=G.get(e);return void 0===s?[]:(t.every((t=>t.every((t=>0===t))))&&(1===s?G.delete(e):G.set(e,s-1)),t)})),i=l(p.currentTime+s/p.sampleRate,p.sampleRate,(()=>F.process(t,B,z)));W=i;for(let t=0,n=0;t<g.numberOfOutputs;t+=1){for(let i=0;i<y[t];i+=1)Ge(e,B[t],i,n+i,s);n+=y[t]}}catch(t){W=!1,R.dispatchEvent(new ErrorEvent("processorerror",{colno:t.colno,filename:t.filename,lineno:t.lineno,message:t.message}))}if(!W){for(let t=0;t<g.numberOfInputs;t+=1){T[t].disconnect(x[t]);for(let e=0;e<g.channelCount;e+=1)x[s].disconnect(k,e,t*g.channelCount+e)}if(void 0!==m.parameterDescriptors){const t=m.parameterDescriptors.length;for(let e=0;e<t;e+=1){const t=A[e];t.disconnect(k,0,_+e),t.stop()}}k.disconnect(E),E.onaudioprocess=null,H?$():Y();break}}}};let H=!1;const K=o(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),X=()=>E.connect(K).connect(p.destination),Y=()=>{E.disconnect(K),K.disconnect()};return X(),d(R,(()=>{if(W){Y(),g.numberOfOutputs>0&&E.connect(S);for(let t=0,e=0;t<g.numberOfOutputs;t+=1){const n=M[t];for(let s=0;s<y[t];s+=1)S.connect(n,e+s,s);e+=y[t]}}H=!0}),(()=>{W&&(X(),$()),H=!1}))})(Yr,de,on,yi,Tn,xi,kn,Sn,Mn,Zr,dr,to,pi),io=((t,e,n,s,i)=>(r,o,a,c,h,l)=>{if(null!==a)try{const e=new a(r,c,l),s=new Map;let o=null;if(Object.defineProperties(e,{channelCount:{get:()=>l.channelCount,set:()=>{throw t()}},channelCountMode:{get:()=>"explicit",set:()=>{throw t()}},onprocessorerror:{get:()=>o,set:t=>{"function"==typeof o&&e.removeEventListener("processorerror",o),o="function"==typeof t?t:null,"function"==typeof o&&e.addEventListener("processorerror",o)}}}),e.addEventListener=(d=e.addEventListener,(...t)=>{if("processorerror"===t[0]){const e="function"==typeof t[1]?t[1]:"object"==typeof t[1]&&null!==t[1]&&"function"==typeof t[1].handleEvent?t[1].handleEvent:null;if(null!==e){const n=s.get(t[1]);void 0!==n?t[1]=n:(t[1]=n=>{"error"===n.type?(Object.defineProperties(n,{type:{value:"processorerror"}}),e(n)):e(new ErrorEvent(t[0],{...n}))},s.set(e,t[1]))}}return d.call(e,"error",t[1],t[2]),d.call(e,...t)}),e.removeEventListener=(u=e.removeEventListener,(...t)=>{if("processorerror"===t[0]){const e=s.get(t[1]);void 0!==e&&(s.delete(t[1]),t[1]=e)}return u.call(e,"error",t[1],t[2]),u.call(e,t[0],t[1],t[2])}),0!==l.numberOfOutputs){const t=n(r,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});e.connect(t).connect(r.destination);return i(e,(()=>t.disconnect()),(()=>t.connect(r.destination)))}return e}catch(t){if(11===t.code)throw s();throw t}var u,d;if(void 0===h)throw s();return(t=>{const{port1:e}=new MessageChannel;try{e.postMessage(t)}finally{e.close()}})(l),e(r,o,h,l)})(on,so,kn,Mn,pi),ro=((t,e,n,s,i,r,o,a,c,h,l,u,d,p,f,m)=>(g,y,_)=>{const v=new WeakMap;let w=null;return{render(b,T){a(T,b);const x=v.get(T);return void 0!==x?Promise.resolve(x):(async(a,b)=>{let T=l(a),x=null;const A=le(T,b),k=Array.isArray(y.outputChannelCount)?y.outputChannelCount:Array.from(y.outputChannelCount);if(null===u){const t=k.reduce(((t,e)=>t+e),0),n=i(b,{channelCount:Math.max(1,t),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,t)}),r=[];for(let t=0;t<a.numberOfOutputs;t+=1)r.push(s(b,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:k[t]}));const h=o(b,{channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,gain:1});h.connect=e.bind(null,r),h.disconnect=c.bind(null,r),x=[n,r,h]}else A||(T=new u(b,g));if(v.set(b,null===x?T:x[2]),null!==x){if(null===w){if(void 0===_)throw new Error("Missing the processor constructor.");if(null===d)throw new Error("Missing the native OfflineAudioContext constructor.");const t=a.channelCount*a.numberOfInputs,e=void 0===_.parameterDescriptors?0:_.parameterDescriptors.length,n=t+e,c=async()=>{const c=new d(n,128*Math.ceil(a.context.length/128),b.sampleRate),h=[],l=[];for(let t=0;t<y.numberOfInputs;t+=1)h.push(o(c,{channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,gain:1})),l.push(i(c,{channelCount:y.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:y.channelCount}));const u=await Promise.all(Array.from(a.parameters.values()).map((async t=>{const e=r(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:t.value});return await p(c,t,e.offset),e}))),g=s(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,t+e)});for(let t=0;t<y.numberOfInputs;t+=1){h[t].connect(l[t]);for(let e=0;e<y.channelCount;e+=1)l[t].connect(g,e,t*y.channelCount+e)}for(const[e,n]of u.entries())n.connect(g,0,t+e),n.start(0);return g.connect(c.destination),await Promise.all(h.map((t=>f(a,c,t)))),m(c)};w=Ke(a,0===n?null:await c(),b,y,k,_,h)}const t=await w,e=n(b,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[c,l,u]=x;null!==t&&(e.buffer=t,e.start(0)),e.connect(c);for(let t=0,e=0;t<a.numberOfOutputs;t+=1){const n=l[t];for(let s=0;s<k[t];s+=1)c.connect(n,e+s,s);e+=k[t]}return u}if(A)for(const[e,n]of a.parameters.entries())await t(b,n,T.parameters.get(e));else for(const[t,e]of a.parameters.entries())await p(b,e,T.parameters.get(t));return await f(a,b,T),T})(b,T)}}})(Gs,Yr,Ks,yi,Tn,xi,kn,Qr,Zr,dr,Oe,Es,gs,Ys,hs,qi),oo=(ao=pr,t=>ao.get(t));var ao;const co=(t=>(e,n)=>{t.set(e,n)})(Jr),ho=ur?((t,e,n,s,i,r,o,a,c,h,l,u,d,p)=>class extends e{constructor(e,p,f){var m;const g=a(e),y=c(g),_=l({...We,...f});d(_);const v=Kt.get(g),w=null==v?void 0:v.get(p),b=y||"closed"!==g.state?g:null!==(m=o(g))&&void 0!==m?m:g,T=i(b,y?null:e.baseLatency,h,p,w,_);super(e,!0,T,y?s(p,_,w):null);const x=[];T.parameters.forEach(((t,e)=>{const s=n(this,y,t);x.push([e,s])})),this._nativeAudioWorkletNode=T,this._onprocessorerror=null,this._parameters=new ze(x),y&&t(g,this);const{activeInputs:A}=r(this);u(T,A)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(t){const e="function"==typeof t?p(this,t):null;this._nativeAudioWorkletNode.onprocessorerror=e;const n=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=null!==n&&n===e?t:n}get parameters(){return null===this._parameters?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}})(Kr,Ss,Zs,ro,io,ye,oo,fs,ys,Es,(t=>({...t,outputChannelCount:void 0!==t.outputChannelCount?t.outputChannelCount:1===t.numberOfInputs&&1===t.numberOfOutputs?[t.channelCount]:Array.from({length:t.numberOfOutputs},(()=>1))})),co,(t=>{const{port1:e,port2:n}=new MessageChannel;try{e.postMessage(t)}finally{e.close(),n.close()}}),$n):void 0,lo=(((t,e,n,s,i)=>{})(on,Mn,Nn,Wi,Ts),((t,e)=>(n,s,i)=>{if(null===e)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(n,s,i)}catch(e){if("SyntaxError"===e.name)throw t();throw e}})(Mn,gs)),uo=((t,e,n,s,i,r,o,a)=>(c,h)=>n(c).render(c,h).then((()=>Promise.all(Array.from(s(h)).map((t=>n(t).render(t,h)))))).then((()=>i(h))).then((n=>("function"!=typeof n.copyFromChannel?(o(n),pe(n)):e(r,(()=>r(n)))||a(n),t.add(n),n))))(Ds,ts,as,Gr,qi,ue,Ns,Vs),po=(((t,e,n,s,i)=>{})(ts,on,lo,Wi,uo),((t,e,n,s,i)=>class extends t{constructor(t,n,i){let r;if("number"==typeof t&&void 0!==n&&void 0!==i)r={length:n,numberOfChannels:t,sampleRate:i};else{if("object"!=typeof t)throw new Error("The given parameters are not valid.");r=t}const{length:o,numberOfChannels:a,sampleRate:c}={...In,...r},h=s(a,o,c);e(un,(()=>un(h)))||h.addEventListener("statechange",(()=>{let t=0;const e=n=>{"running"===this._state&&(t>0?(h.removeEventListener("statechange",e),n.stopImmediatePropagation(),this._waitForThePromiseToSettle(n)):t+=1)};return e})()),super(h,a),this._length=o,this._nativeOfflineAudioContext=h,this._state=null}get length(){return void 0===this._nativeOfflineAudioContext.length?this._length:this._nativeOfflineAudioContext.length}get state(){return null===this._state?this._nativeOfflineAudioContext.state:this._state}startRendering(){return"running"===this._state?Promise.reject(n()):(this._state="running",i(this.destination,this._nativeOfflineAudioContext).finally((()=>{this._state=null,we(this)})))}_waitForThePromiseToSettle(t){null===this._state?this._nativeOfflineAudioContext.dispatchEvent(t):setTimeout((()=>this._waitForThePromiseToSettle(t)))}})(vr,ts,on,lo,uo)),fo=((t,e)=>n=>{const s=t.get(n);return e(s)||e(n)})($t,xs),mo=(go=Bt,yo=ks,t=>go.has(t)||yo(t));var go,yo;const _o=(vo=Wt,wo=Cs,t=>vo.has(t)||wo(t));var vo,wo;const bo=((t,e)=>n=>{const s=t.get(n);return e(s)||e(n)})($t,ys);function To(t,e){if(!t)throw new Error(e)}function xo(t,e,n=1/0){if(!(e<=t&&t<=n))throw new RangeError(`Value must be within [${e}, ${n}], got: ${t}`)}function Ao(t){t.isOffline||"running"===t.state||Co('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let ko=console;function Co(...t){ko.warn(...t)}function Eo(t){return void 0===t}function So(t){return!Eo(t)}function Mo(t){return"number"==typeof t}function Io(t){return"[object Object]"===Object.prototype.toString.call(t)&&t.constructor===Object}function Do(t){return"boolean"==typeof t}function Po(t){return Array.isArray(t)}function Oo(t){return"string"==typeof t}function Ro(t){return Oo(t)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(t)}const No="object"==typeof self?self:null,Vo=No&&(No.hasOwnProperty("AudioContext")||No.hasOwnProperty("webkitAudioContext"));function Lo(t,e,n,s){var i,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,s);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(o=(r<3?i(o):r>3?i(e,n,o):i(e,n))||o);return r>3&&o&&Object.defineProperty(e,n,o),o}function qo(t,e,n,s){return new(n||(n=Promise))((function(i,r){function o(t){try{c(s.next(t))}catch(t){r(t)}}function a(t){try{c(s.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((s=s.apply(t,e||[])).next())}))}Object.create;Object.create;class Fo{constructor(t,e,n){this._callback=t,this._type=e,this._updateInterval=n,this._createClock()}_createWorker(){const t=new Blob([`\n\t\t\t// the initial timeout time\n\t\t\tlet timeoutTime =  ${(1e3*this._updateInterval).toFixed(1)};\n\t\t\t// onmessage callback\n\t\t\tself.onmessage = function(msg){\n\t\t\t\ttimeoutTime = parseInt(msg.data);\n\t\t\t};\n\t\t\t// the tick function which posts a message\n\t\t\t// and schedules a new tick\n\t\t\tfunction tick(){\n\t\t\t\tsetTimeout(tick, timeoutTime);\n\t\t\t\tself.postMessage('tick');\n\t\t\t}\n\t\t\t// call tick initially\n\t\t\ttick();\n\t\t\t`],{type:"text/javascript"}),e=URL.createObjectURL(t),n=new Worker(e);n.onmessage=this._callback.bind(this),this._worker=n}_createTimeout(){this._timeout=setTimeout((()=>{this._createTimeout(),this._callback()}),1e3*this._updateInterval)}_createClock(){if("worker"===this._type)try{this._createWorker()}catch(t){this._type="timeout",this._createClock()}else"timeout"===this._type&&this._createTimeout()}_disposeClock(){this._timeout&&(clearTimeout(this._timeout),this._timeout=0),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(t){this._updateInterval=Math.max(t,128/44100),"worker"===this._type&&this._worker.postMessage(Math.max(1e3*t,1))}get type(){return this._type}set type(t){this._disposeClock(),this._type=t,this._createClock()}dispose(){this._disposeClock()}}function jo(t){return _o(t)}function Uo(t){return mo(t)}function Bo(t){return bo(t)}function zo(t){return fo(t)}function Wo(t){return t instanceof AudioBuffer}function $o(t,e){return"value"===t||jo(e)||Uo(e)||Wo(e)}function Go(t,...e){if(!e.length)return t;const n=e.shift();if(Io(t)&&Io(n))for(const e in n)$o(e,n[e])?t[e]=n[e]:Io(n[e])?(t[e]||Object.assign(t,{[e]:{}}),Go(t[e],n[e])):Object.assign(t,{[e]:n[e]});return Go(t,...e)}function Ho(t,e,n=[],s){const i={},r=Array.from(e);if(Io(r[0])&&s&&!Reflect.has(r[0],s)){Object.keys(r[0]).some((e=>Reflect.has(t,e)))||(Go(i,{[s]:r[0]}),n.splice(n.indexOf(s),1),r.shift())}if(1===r.length&&Io(r[0]))Go(i,r[0]);else for(let t=0;t<n.length;t++)So(r[t])&&(i[n[t]]=r[t]);return Go(t,i)}function Ko(t,e){return Eo(t)?e:t}function Xo(t,e){return e.forEach((e=>{Reflect.has(t,e)&&delete t[e]})),t}class Yo{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...t){(this.debug||No&&this.toString()===No.TONE_DEBUG_CLASS)&&function(...t){ko.log(...t)}(this,...t)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}Yo.version="14.7.77";function Qo(t,e){return t>e+1e-6}function Zo(t,e){return Qo(t,e)||ta(t,e)}function Jo(t,e){return t+1e-6<e}function ta(t,e){return Math.abs(t-e)<1e-6}function ea(t,e,n){return Math.max(Math.min(t,n),e)}class na extends Yo{constructor(){super(),this.name="Timeline",this._timeline=[];const t=Ho(na.getDefaults(),arguments,["memory"]);this.memory=t.memory,this.increasing=t.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(t){if(To(Reflect.has(t,"time"),"Timeline: events must have a time attribute"),t.time=t.time.valueOf(),this.increasing&&this.length){const e=this._timeline[this.length-1];To(Zo(t.time,e.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(t)}else{const e=this._search(t.time);this._timeline.splice(e+1,0,t)}if(this.length>this.memory){const t=this.length-this.memory;this._timeline.splice(0,t)}return this}remove(t){const e=this._timeline.indexOf(t);return-1!==e&&this._timeline.splice(e,1),this}get(t,e="time"){const n=this._search(t,e);return-1!==n?this._timeline[n]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(t,e="time"){const n=this._search(t,e);return n+1<this._timeline.length?this._timeline[n+1]:null}getBefore(t){const e=this._timeline.length;if(e>0&&this._timeline[e-1].time<t)return this._timeline[e-1];const n=this._search(t);return n-1>=0?this._timeline[n-1]:null}cancel(t){if(this._timeline.length>1){let e=this._search(t);if(e>=0)if(ta(this._timeline[e].time,t)){for(let n=e;n>=0&&ta(this._timeline[n].time,t);n--)e=n;this._timeline=this._timeline.slice(0,e)}else this._timeline=this._timeline.slice(0,e+1);else this._timeline=[]}else 1===this._timeline.length&&Zo(this._timeline[0].time,t)&&(this._timeline=[]);return this}cancelBefore(t){const e=this._search(t);return e>=0&&(this._timeline=this._timeline.slice(e+1)),this}previousEvent(t){const e=this._timeline.indexOf(t);return e>0?this._timeline[e-1]:null}_search(t,e="time"){if(0===this._timeline.length)return-1;let n=0;const s=this._timeline.length;let i=s;if(s>0&&this._timeline[s-1][e]<=t)return s-1;for(;n<i;){let s=Math.floor(n+(i-n)/2);const r=this._timeline[s],o=this._timeline[s+1];if(ta(r[e],t)){for(let n=s;n<this._timeline.length;n++){if(!ta(this._timeline[n][e],t))break;s=n}return s}if(Jo(r[e],t)&&Qo(o[e],t))return s;Qo(r[e],t)?i=s:n=s+1}return-1}_iterate(t,e=0,n=this._timeline.length-1){this._timeline.slice(e,n+1).forEach(t)}forEach(t){return this._iterate(t),this}forEachBefore(t,e){const n=this._search(t);return-1!==n&&this._iterate(e,0,n),this}forEachAfter(t,e){const n=this._search(t);return this._iterate(e,n+1),this}forEachBetween(t,e,n){let s=this._search(t),i=this._search(e);return-1!==s&&-1!==i?(this._timeline[s].time!==t&&(s+=1),this._timeline[i].time===e&&(i-=1),this._iterate(n,s,i)):-1===s&&this._iterate(n,0,i),this}forEachFrom(t,e){let n=this._search(t);for(;n>=0&&this._timeline[n].time>=t;)n--;return this._iterate(e,n+1),this}forEachAtTime(t,e){const n=this._search(t);if(-1!==n&&ta(this._timeline[n].time,t)){let s=n;for(let e=n;e>=0&&ta(this._timeline[e].time,t);e--)s=e;this._iterate((t=>{e(t)}),s,n)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const sa=[];function ia(t){sa.push(t)}const ra=[];function oa(t){ra.push(t)}class aa extends Yo{constructor(){super(...arguments),this.name="Emitter"}on(t,e){return t.split(/\W+/).forEach((t=>{Eo(this._events)&&(this._events={}),this._events.hasOwnProperty(t)||(this._events[t]=[]),this._events[t].push(e)})),this}once(t,e){const n=(...s)=>{e(...s),this.off(t,n)};return this.on(t,n),this}off(t,e){return t.split(/\W+/).forEach((n=>{if(Eo(this._events)&&(this._events={}),this._events.hasOwnProperty(t))if(Eo(e))this._events[t]=[];else{const n=this._events[t];for(let t=n.length-1;t>=0;t--)n[t]===e&&n.splice(t,1)}})),this}emit(t,...e){if(this._events&&this._events.hasOwnProperty(t)){const n=this._events[t].slice(0);for(let t=0,s=n.length;t<s;t++)n[t].apply(this,e)}return this}static mixin(t){["on","once","off","emit"].forEach((e=>{const n=Object.getOwnPropertyDescriptor(aa.prototype,e);Object.defineProperty(t.prototype,e,n)}))}dispose(){return super.dispose(),this._events=void 0,this}}class ca extends aa{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class ha extends ca{constructor(){super(),this.name="Context",this._constants=new Map,this._timeouts=new na,this._timeoutIds=0,this._initialized=!1,this.isOffline=!1,this._workletModules=new Map;const t=Ho(ha.getDefaults(),arguments,["context"]);t.context?this._context=t.context:this._context=function(t){return new $r(t)}({latencyHint:t.latencyHint}),this._ticker=new Fo(this.emit.bind(this,"tick"),t.clockSource,t.updateInterval),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this._setLatencyHint(t.latencyHint),this.lookAhead=t.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){var t;return this._initialized||(t=this,sa.forEach((e=>e(t))),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(t,e,n){return this._context.createBuffer(t,e,n)}createChannelMerger(t){return this._context.createChannelMerger(t)}createChannelSplitter(t){return this._context.createChannelSplitter(t)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(t){return this._context.createDelay(t)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(t,e){return this._context.createIIRFilter(t,e)}createPanner(){return this._context.createPanner()}createPeriodicWave(t,e,n){return this._context.createPeriodicWave(t,e,n)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(t){To(zo(this._context),"Not available if OfflineAudioContext");return this._context.createMediaStreamSource(t)}createMediaElementSource(t){To(zo(this._context),"Not available if OfflineAudioContext");return this._context.createMediaElementSource(t)}createMediaStreamDestination(){To(zo(this._context),"Not available if OfflineAudioContext");return this._context.createMediaStreamDestination()}decodeAudioData(t){return this._context.decodeAudioData(t)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(t){To(!this._initialized,"The listener cannot be set after initialization."),this._listener=t}get transport(){return this.initialize(),this._transport}set transport(t){To(!this._initialized,"The transport cannot be set after initialization."),this._transport=t}get draw(){return this.initialize(),this._draw}set draw(t){To(!this._initialized,"Draw cannot be set after initialization."),this._draw=t}get destination(){return this.initialize(),this._destination}set destination(t){To(!this._initialized,"The destination cannot be set after initialization."),this._destination=t}createAudioWorkletNode(t,e){return function(t,e,n){return To(So(ho),"This node only works in a secure context (https or localhost)"),new ho(t,e,n)}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */(this.rawContext,t,e)}addAudioWorkletModule(t,e){return qo(this,void 0,void 0,(function*(){To(So(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletModules.has(e)||this._workletModules.set(e,this.rawContext.audioWorklet.addModule(t)),yield this._workletModules.get(e)}))}workletsAreReady(){return qo(this,void 0,void 0,(function*(){const t=[];this._workletModules.forEach((e=>t.push(e))),yield Promise.all(t)}))}get updateInterval(){return this._ticker.updateInterval}set updateInterval(t){this._ticker.updateInterval=t}get clockSource(){return this._ticker.type}set clockSource(t){this._ticker.type=t}get latencyHint(){return this._latencyHint}_setLatencyHint(t){let e=0;if(this._latencyHint=t,Oo(t))switch(t){case"interactive":e=.1;break;case"playback":e=.5;break;case"balanced":e=.25}this.lookAhead=e,this.updateInterval=e/2}get rawContext(){return this._context}now(){return this._context.currentTime+this.lookAhead}immediate(){return this._context.currentTime}resume(){return zo(this._context)?this._context.resume():Promise.resolve()}close(){return qo(this,void 0,void 0,(function*(){var t;zo(this._context)&&(yield this._context.close()),this._initialized&&(t=this,ra.forEach((e=>e(t))))}))}getConstant(t){if(this._constants.has(t))return this._constants.get(t);{const e=this._context.createBuffer(1,128,this._context.sampleRate),n=e.getChannelData(0);for(let e=0;e<n.length;e++)n[e]=t;const s=this._context.createBufferSource();return s.channelCount=1,s.channelCountMode="explicit",s.buffer=e,s.loop=!0,s.start(0),this._constants.set(t,s),s}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map((t=>this._constants[t].disconnect())),this}_timeoutLoop(){const t=this.now();let e=this._timeouts.peek();for(;this._timeouts.length&&e&&e.time<=t;)e.callback(),this._timeouts.shift(),e=this._timeouts.peek()}setTimeout(t,e){this._timeoutIds++;const n=this.now();return this._timeouts.add({callback:t,id:this._timeoutIds,time:n+e}),this._timeoutIds}clearTimeout(t){return this._timeouts.forEach((e=>{e.id===t&&this._timeouts.remove(e)})),this}clearInterval(t){return this.clearTimeout(t)}setInterval(t,e){const n=++this._timeoutIds,s=()=>{const i=this.now();this._timeouts.add({callback:()=>{t(),s()},id:n,time:i+e})};return s(),n}}function la(t,e){Po(e)?e.forEach((e=>la(t,e))):Object.defineProperty(t,e,{enumerable:!0,writable:!1})}function ua(t,e){Po(e)?e.forEach((e=>ua(t,e))):Object.defineProperty(t,e,{writable:!0})}const da=()=>{};class pa extends Yo{constructor(){super(),this.name="ToneAudioBuffer",this.onload=da;const t=Ho(pa.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=t.reverse,this.onload=t.onload,t.url&&Wo(t.url)||t.url instanceof pa?this.set(t.url):Oo(t.url)&&this.load(t.url).catch(t.onerror)}static getDefaults(){return{onerror:da,onload:da,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:ya().sampleRate}set(t){return t instanceof pa?t.loaded?this._buffer=t.get():t.onload=()=>{this.set(t),this.onload(this)}:this._buffer=t,this._reversed&&this._reverse(),this}get(){return this._buffer}load(t){return qo(this,void 0,void 0,(function*(){const e=pa.load(t).then((t=>{this.set(t),this.onload(this)}));pa.downloads.push(e);try{yield e}finally{const t=pa.downloads.indexOf(e);pa.downloads.splice(t,1)}return this}))}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(t){const e=Po(t)&&t[0].length>0,n=e?t.length:1,s=e?t[0].length:t.length,i=ya(),r=i.createBuffer(n,s,i.sampleRate),o=e||1!==n?t:[t];for(let t=0;t<n;t++)r.copyToChannel(o[t],t);return this._buffer=r,this}toMono(t){if(Mo(t))this.fromArray(this.toArray(t));else{let t=new Float32Array(this.length);const e=this.numberOfChannels;for(let n=0;n<e;n++){const e=this.toArray(n);for(let n=0;n<e.length;n++)t[n]+=e[n]}t=t.map((t=>t/e)),this.fromArray(t)}return this}toArray(t){if(Mo(t))return this.getChannelData(t);if(1===this.numberOfChannels)return this.toArray(0);{const t=[];for(let e=0;e<this.numberOfChannels;e++)t[e]=this.getChannelData(e);return t}}getChannelData(t){return this._buffer?this._buffer.getChannelData(t):new Float32Array(0)}slice(t,e=this.duration){const n=Math.floor(t*this.sampleRate),s=Math.floor(e*this.sampleRate);To(n<s,"The start time must be less than the end time");const i=s-n,r=ya().createBuffer(this.numberOfChannels,i,this.sampleRate);for(let t=0;t<this.numberOfChannels;t++)r.copyToChannel(this.getChannelData(t).subarray(n,s),t);return new pa(r)}_reverse(){if(this.loaded)for(let t=0;t<this.numberOfChannels;t++)this.getChannelData(t).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(t){this._reversed!==t&&(this._reversed=t,this._reverse())}static fromArray(t){return(new pa).fromArray(t)}static fromUrl(t){return qo(this,void 0,void 0,(function*(){const e=new pa;return yield e.load(t)}))}static load(t){return qo(this,void 0,void 0,(function*(){const e=t.match(/\[([^\]\[]+\|.+)\]$/);if(e){const n=e[1].split("|");let s=n[0];for(const t of n)if(pa.supportsType(t)){s=t;break}t=t.replace(e[0],s)}const n=""===pa.baseUrl||pa.baseUrl.endsWith("/")?pa.baseUrl:pa.baseUrl+"/",s=yield fetch(n+t);if(!s.ok)throw new Error(`could not load url: ${t}`);const i=yield s.arrayBuffer();return yield ya().decodeAudioData(i)}))}static supportsType(t){const e=t.split("."),n=e[e.length-1];return""!==document.createElement("audio").canPlayType("audio/"+n)}static loaded(){return qo(this,void 0,void 0,(function*(){for(yield Promise.resolve();pa.downloads.length;)yield pa.downloads[0]}))}}pa.baseUrl="",pa.downloads=[];class fa extends ha{constructor(){var t,e,n;super({clockSource:"offline",context:Bo(arguments[0])?arguments[0]:(t=arguments[0],e=arguments[1]*arguments[2],n=arguments[2],new po(t,e,n)),lookAhead:0,updateInterval:Bo(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=Bo(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(t){return qo(this,void 0,void 0,(function*(){let e=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,e++;const n=Math.floor(this.sampleRate/128);t&&e%n==0&&(yield new Promise((t=>setTimeout(t,1))))}}))}render(t=!0){return qo(this,void 0,void 0,(function*(){yield this.workletsAreReady(),yield this._renderClock(t);const e=yield this._context.startRendering();return new pa(e)}))}close(){return Promise.resolve()}}const ma=new class extends ca{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(t,e,n){return{}}createChannelMerger(t){return{}}createChannelSplitter(t){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(t){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(t,e){return{}}createPanner(){return{}}createPeriodicWave(t,e,n){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(t){return{}}createMediaElementSource(t){return{}}createMediaStreamDestination(){return{}}decodeAudioData(t){return Promise.resolve({})}createAudioWorkletNode(t,e){return{}}get rawContext(){return{}}addAudioWorkletModule(t,e){return qo(this,void 0,void 0,(function*(){return Promise.resolve()}))}resume(){return Promise.resolve()}setTimeout(t,e){return 0}clearTimeout(t){return this}setInterval(t,e){return 0}clearInterval(t){return this}getConstant(t){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(t){}get destination(){return{}}set destination(t){}now(){return 0}immediate(){return 0}};let ga=ma;function ya(){return ga===ma&&Vo&&_a(new ha),ga}function _a(t){ga=zo(t)?new ha(t):Bo(t)?new fa(t):t}if(No&&!No.TONE_SILENCE_LOGGING){let t="v";0;const e=` * Tone.js ${t}14.7.77 * `;console.log(`%c${e}`,"background: #000; color: #fff")}class va extends Yo{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const t=Ho(va.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=t.baseUrl,Object.keys(t.urls).forEach((e=>{this._loadingCount++;const n=t.urls[e];this.add(e,n,this._bufferLoaded.bind(this,t.onload),t.onerror)}))}static getDefaults(){return{baseUrl:"",onerror:da,onload:da,urls:{}}}has(t){return this._buffers.has(t.toString())}get(t){return To(this.has(t),`ToneAudioBuffers has no buffer named: ${t}`),this._buffers.get(t.toString())}_bufferLoaded(t){this._loadingCount--,0===this._loadingCount&&t&&t()}get loaded(){return Array.from(this._buffers).every((([t,e])=>e.loaded))}add(t,e,n=da,s=da){return Oo(e)?this._buffers.set(t.toString(),new pa(this.baseUrl+e,n,s)):this._buffers.set(t.toString(),new pa(e,n,s)),this}dispose(){return super.dispose(),this._buffers.forEach((t=>t.dispose())),this._buffers.clear(),this}}function wa(t){return Math.pow(10,t/20)}function ba(t){return Math.log(t)/Math.LN10*20}function Ta(t){return Math.pow(2,t/12)}let xa=440;function Aa(t){return Math.round(ka(t))}function ka(t){return 69+12*Math.log2(t/xa)}function Ca(t){return xa*Math.pow(2,(t-69)/12)}class Ea extends Yo{constructor(t,e,n){super(),this.defaultUnits="s",this._val=e,this._units=n,this.context=t,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:t=>this._frequencyToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:t=>this._ticksToUnits(parseInt(t,10)),regexp:/^(\d+)i$/i},m:{method:t=>this._beatsToUnits(parseInt(t,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(t,e)=>{const n=parseInt(t,10),s="."===e?1.5:1;return 1===n?this._beatsToUnits(this._getTimeSignature())*s:this._beatsToUnits(4/n)*s},regexp:/^(\d+)n(\.?)$/i},number:{method:t=>this._expressions[this.defaultUnits].method.call(this,t),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:t=>this._secondsToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:t=>parseInt(t,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:t=>{const e=parseInt(t,10);return this._beatsToUnits(8/(3*Math.floor(e)))},regexp:/^(\d+)t$/i},tr:{method:(t,e,n)=>{let s=0;return t&&"0"!==t&&(s+=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&"0"!==e&&(s+=this._beatsToUnits(parseFloat(e))),n&&"0"!==n&&(s+=this._beatsToUnits(parseFloat(n)/4)),s},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof Ea&&this.fromType(this._val),Eo(this._val))return this._noArg();if(Oo(this._val)&&Eo(this._units)){for(const t in this._expressions)if(this._expressions[t].regexp.test(this._val.trim())){this._units=t;break}}else if(Io(this._val)){let t=0;for(const e in this._val)if(So(this._val[e])){const n=this._val[e];t+=new this.constructor(this.context,e).valueOf()*n}return t}if(So(this._units)){const t=this._expressions[this._units],e=this._val.toString().trim().match(t.regexp);return e?t.method.apply(this,e.slice(1)):t.method.call(this,this._val)}return Oo(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(t){return 1/t}_beatsToUnits(t){return 60/this._getBpm()*t}_secondsToUnits(t){return t}_ticksToUnits(t){return t*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(t){switch(this._units=void 0,this.defaultUnits){case"s":this._val=t.toSeconds();break;case"i":this._val=t.toTicks();break;case"hz":this._val=t.toFrequency();break;case"midi":this._val=t.toMidi()}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return 1e3*this.toSeconds()}}class Sa extends Ea{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:t=>this._now()+new this.constructor(this.context,t).valueOf(),regexp:/^\+(.+)/},quantize:{method:t=>{const e=new Sa(this.context,t).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(e))},regexp:/^@(.+)/}})}quantize(t,e=1){const n=new this.constructor(this.context,t).valueOf(),s=this.valueOf();return s+(Math.round(s/n)*n-s)*e}toNotation(){const t=this.toSeconds(),e=["1m"];for(let t=1;t<9;t++){const n=Math.pow(2,t);e.push(n+"n."),e.push(n+"n"),e.push(n+"t")}e.push("0");let n=e[0],s=new Sa(this.context,e[0]).toSeconds();return e.forEach((e=>{const i=new Sa(this.context,e).toSeconds();Math.abs(i-t)<Math.abs(s-t)&&(n=e,s=i)})),n}toBarsBeatsSixteenths(){const t=this._beatsToUnits(1);let e=this.valueOf()/t;e=parseFloat(e.toFixed(4));const n=Math.floor(e/this._getTimeSignature());let s=e%1*4;e=Math.floor(e)%this._getTimeSignature();const i=s.toString();i.length>3&&(s=parseFloat(parseFloat(i).toFixed(3)));return[n,e,s].join(":")}toTicks(){const t=this._beatsToUnits(1),e=this.valueOf()/t;return Math.round(e*this._getPPQ())}toSeconds(){return this.valueOf()}toMidi(){return Aa(this.toFrequency())}_now(){return this.context.now()}}class Ma extends Sa{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return xa}static set A4(t){!function(t){xa=t}(t)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(t){return"midi"===this.defaultUnits?t:Ma.mtof(t)}},note:{regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method(t,e){const n=Ia[t.toLowerCase()]+12*(parseInt(e,10)+1);return"midi"===this.defaultUnits?n:Ma.mtof(n)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(t,e,n){let s=1;return t&&"0"!==t&&(s*=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&"0"!==e&&(s*=this._beatsToUnits(parseFloat(e))),n&&"0"!==n&&(s*=this._beatsToUnits(parseFloat(n)/4)),s}}})}transpose(t){return new Ma(this.context,this.valueOf()*Ta(t))}harmonize(t){return t.map((t=>this.transpose(t)))}toMidi(){return Aa(this.valueOf())}toNote(){const t=this.toFrequency(),e=Math.log2(t/Ma.A4);let n=Math.round(12*e)+57;const s=Math.floor(n/12);s<0&&(n+=-12*s);return Da[n%12]+s.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const t=this._beatsToUnits(1),e=this.valueOf()/t;return Math.floor(e*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(t){return t}_ticksToUnits(t){return 1/(60*t/(this._getBpm()*this._getPPQ()))}_beatsToUnits(t){return 1/super._beatsToUnits(t)}_secondsToUnits(t){return 1/t}static mtof(t){return Ca(t)}static ftom(t){return Aa(t)}}const Ia={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},Da=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class Pa extends Sa{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class Oa extends Yo{constructor(){super();const t=Ho(Oa.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=t.context}static getDefaults(){return{context:ya()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(t){return new Sa(this.context,t).toSeconds()}toFrequency(t){return new Ma(this.context,t).toFrequency()}toTicks(t){return new Pa(this.context,t).toTicks()}_getPartialProperties(t){const e=this.get();return Object.keys(e).forEach((n=>{Eo(t[n])&&delete e[n]})),e}get(){const t=this.constructor.getDefaults();return Object.keys(t).forEach((e=>{if(Reflect.has(this,e)){const n=this[e];So(n)&&So(n.value)&&So(n.setValueAtTime)?t[e]=n.value:n instanceof Oa?t[e]=n._getPartialProperties(t[e]):Po(n)||Mo(n)||Oo(n)||Do(n)?t[e]=n:delete t[e]}})),t}set(t){return Object.keys(t).forEach((e=>{Reflect.has(this,e)&&So(this[e])&&(this[e]&&So(this[e].value)&&So(this[e].setValueAtTime)?this[e].value!==t[e]&&(this[e].value=t[e]):this[e]instanceof Oa?this[e].set(t[e]):this[e]=t[e])})),this}}class Ra extends Oa{constructor(){super(Ho(Ra.getDefaults(),arguments,["param","units","convert"])),this.name="Param",this.overridden=!1,this._minOutput=1e-7;const t=Ho(Ra.getDefaults(),arguments,["param","units","convert"]);for(To(So(t.param)&&(jo(t.param)||t.param instanceof Ra),"param must be an AudioParam");!jo(t.param);)t.param=t.param._param;this._swappable=!!So(t.swappable)&&t.swappable,this._swappable?(this.input=this.context.createGain(),this._param=t.param,this.input.connect(this._param)):this._param=this.input=t.param,this._events=new na(1e3),this._initialValue=this._param.defaultValue,this.units=t.units,this.convert=t.convert,this._minValue=t.minValue,this._maxValue=t.maxValue,So(t.value)&&t.value!==this._toType(this._initialValue)&&this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(Oa.getDefaults(),{convert:!0,units:"number"})}get value(){const t=this.now();return this.getValueAtTime(t)}set value(t){this.cancelScheduledValues(this.now()),this.setValueAtTime(t,this.now())}get minValue(){return So(this._minValue)?this._minValue:"time"===this.units||"frequency"===this.units||"normalRange"===this.units||"positive"===this.units||"transportTime"===this.units||"ticks"===this.units||"bpm"===this.units||"hertz"===this.units||"samples"===this.units?0:"audioRange"===this.units?-1:"decibels"===this.units?-1/0:this._param.minValue}get maxValue(){return So(this._maxValue)?this._maxValue:"normalRange"===this.units||"audioRange"===this.units?1:this._param.maxValue}_is(t,e){return this.units===e}_assertRange(t){return So(this.maxValue)&&So(this.minValue)&&xo(t,this._fromType(this.minValue),this._fromType(this.maxValue)),t}_fromType(t){return this.convert&&!this.overridden?this._is(t,"time")?this.toSeconds(t):this._is(t,"decibels")?wa(t):this._is(t,"frequency")?this.toFrequency(t):t:this.overridden?0:t}_toType(t){return this.convert&&"decibels"===this.units?ba(t):t}setValueAtTime(t,e){const n=this.toSeconds(e),s=this._fromType(t);return To(isFinite(s)&&isFinite(n),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._assertRange(s),this.log(this.units,"setValueAtTime",t,n),this._events.add({time:n,type:"setValueAtTime",value:s}),this._param.setValueAtTime(s,n),this}getValueAtTime(t){const e=Math.max(this.toSeconds(t),0),n=this._events.getAfter(e),s=this._events.get(e);let i=this._initialValue;if(null===s)i=this._initialValue;else if("setTargetAtTime"!==s.type||null!==n&&"setValueAtTime"!==n.type)if(null===n)i=s.value;else if("linearRampToValueAtTime"===n.type||"exponentialRampToValueAtTime"===n.type){let t=s.value;if("setTargetAtTime"===s.type){const e=this._events.getBefore(s.time);t=null===e?this._initialValue:e.value}i="linearRampToValueAtTime"===n.type?this._linearInterpolate(s.time,t,n.time,n.value,e):this._exponentialInterpolate(s.time,t,n.time,n.value,e)}else i=s.value;else{const t=this._events.getBefore(s.time);let n;n=null===t?this._initialValue:t.value,"setTargetAtTime"===s.type&&(i=this._exponentialApproach(s.time,n,s.value,s.constant,e))}return this._toType(i)}setRampPoint(t){t=this.toSeconds(t);let e=this.getValueAtTime(t);return this.cancelAndHoldAtTime(t),0===this._fromType(e)&&(e=this._toType(this._minOutput)),this.setValueAtTime(e,t),this}linearRampToValueAtTime(t,e){const n=this._fromType(t),s=this.toSeconds(e);return To(isFinite(n)&&isFinite(s),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._assertRange(n),this._events.add({time:s,type:"linearRampToValueAtTime",value:n}),this.log(this.units,"linearRampToValueAtTime",t,s),this._param.linearRampToValueAtTime(n,s),this}exponentialRampToValueAtTime(t,e){let n=this._fromType(t);n=ta(n,0)?this._minOutput:n,this._assertRange(n);const s=this.toSeconds(e);return To(isFinite(n)&&isFinite(s),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({time:s,type:"exponentialRampToValueAtTime",value:n}),this.log(this.units,"exponentialRampToValueAtTime",t,s),this._param.exponentialRampToValueAtTime(n,s),this}exponentialRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialRampToValueAtTime(t,n+this.toSeconds(e)),this}linearRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.linearRampToValueAtTime(t,n+this.toSeconds(e)),this}targetRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialApproachValueAtTime(t,n,e),this}exponentialApproachValueAtTime(t,e,n){e=this.toSeconds(e),n=this.toSeconds(n);const s=Math.log(n+1)/Math.log(200);return this.setTargetAtTime(t,e,s),this.cancelAndHoldAtTime(e+.9*n),this.linearRampToValueAtTime(t,e+n),this}setTargetAtTime(t,e,n){const s=this._fromType(t);To(isFinite(n)&&n>0,"timeConstant must be a number greater than 0");const i=this.toSeconds(e);return this._assertRange(s),To(isFinite(s)&&isFinite(i),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({constant:n,time:i,type:"setTargetAtTime",value:s}),this.log(this.units,"setTargetAtTime",t,i,n),this._param.setTargetAtTime(s,i,n),this}setValueCurveAtTime(t,e,n,s=1){n=this.toSeconds(n),e=this.toSeconds(e);const i=this._fromType(t[0])*s;this.setValueAtTime(this._toType(i),e);const r=n/(t.length-1);for(let n=1;n<t.length;n++){const i=this._fromType(t[n])*s;this.linearRampToValueAtTime(this._toType(i),e+n*r)}return this}cancelScheduledValues(t){const e=this.toSeconds(t);return To(isFinite(e),`Invalid argument to cancelScheduledValues: ${JSON.stringify(t)}`),this._events.cancel(e),this._param.cancelScheduledValues(e),this.log(this.units,"cancelScheduledValues",e),this}cancelAndHoldAtTime(t){const e=this.toSeconds(t),n=this._fromType(this.getValueAtTime(e));To(isFinite(e),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(t)}`),this.log(this.units,"cancelAndHoldAtTime",e,"value="+n);const s=this._events.get(e),i=this._events.getAfter(e);return s&&ta(s.time,e)?i?(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time)):(this._param.cancelAndHoldAtTime(e),this._events.cancel(e+this.sampleTime)):i&&(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time),"linearRampToValueAtTime"===i.type?this.linearRampToValueAtTime(this._toType(n),e):"exponentialRampToValueAtTime"===i.type&&this.exponentialRampToValueAtTime(this._toType(n),e)),this._events.add({time:e,type:"setValueAtTime",value:n}),this._param.setValueAtTime(n,e),this}rampTo(t,e=.1,n){return"frequency"===this.units||"bpm"===this.units||"decibels"===this.units?this.exponentialRampTo(t,e,n):this.linearRampTo(t,e,n),this}apply(t){const e=this.context.currentTime;t.setValueAtTime(this.getValueAtTime(e),e);const n=this._events.get(e);if(n&&"setTargetAtTime"===n.type){const s=this._events.getAfter(n.time),i=s?s.time:e+2,r=(i-e)/10;for(let n=e;n<i;n+=r)t.linearRampToValueAtTime(this.getValueAtTime(n),n)}return this._events.forEachAfter(this.context.currentTime,(e=>{"cancelScheduledValues"===e.type?t.cancelScheduledValues(e.time):"setTargetAtTime"===e.type?t.setTargetAtTime(e.value,e.time,e.constant):t[e.type](e.value,e.time)})),this}setParam(t){To(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const e=this.input;return e.disconnect(this._param),this.apply(t),this._param=t,e.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(t,e,n,s,i){return n+(e-n)*Math.exp(-(i-t)/s)}_linearInterpolate(t,e,n,s,i){return e+(i-t)/(n-t)*(s-e)}_exponentialInterpolate(t,e,n,s,i){return e*Math.pow(s/e,(i-t)/(n-t))}}class Na extends Oa{constructor(){super(...arguments),this.name="ToneAudioNode",this._internalChannels=[]}get numberOfInputs(){return So(this.input)?jo(this.input)||this.input instanceof Ra?1:this.input.numberOfInputs:0}get numberOfOutputs(){return So(this.output)?this.output.numberOfOutputs:0}_isAudioNode(t){return So(t)&&(t instanceof Na||Uo(t))}_getInternalNodes(){const t=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&t.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&t.push(this.output),t}_setChannelProperties(t){this._getInternalNodes().forEach((e=>{e.channelCount=t.channelCount,e.channelCountMode=t.channelCountMode,e.channelInterpretation=t.channelInterpretation}))}_getChannelProperties(){const t=this._getInternalNodes();To(t.length>0,"ToneAudioNode does not have any internal nodes");const e=t[0];return{channelCount:e.channelCount,channelCountMode:e.channelCountMode,channelInterpretation:e.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCount:t}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCountMode:t}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelInterpretation:t}))}connect(t,e=0,n=0){return La(this,t,e,n),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return Co("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(t,e=0,n=0){return qa(this,t,e,n),this}chain(...t){return Va(this,...t),this}fan(...t){return t.forEach((t=>this.connect(t))),this}dispose(){return super.dispose(),So(this.input)&&(this.input instanceof Na?this.input.dispose():Uo(this.input)&&this.input.disconnect()),So(this.output)&&(this.output instanceof Na?this.output.dispose():Uo(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function Va(...t){const e=t.shift();t.reduce(((t,e)=>(t instanceof Na?t.connect(e):Uo(t)&&La(t,e),e)),e)}function La(t,e,n=0,s=0){for(To(So(t),"Cannot connect from undefined node"),To(So(e),"Cannot connect to undefined node"),(e instanceof Na||Uo(e))&&To(e.numberOfInputs>0,"Cannot connect to node with no inputs"),To(t.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof Na||e instanceof Ra;)So(e.input)&&(e=e.input);for(;t instanceof Na;)So(t.output)&&(t=t.output);jo(e)?t.connect(e,n):t.connect(e,n,s)}function qa(t,e,n=0,s=0){if(So(e))for(;e instanceof Na;)e=e.input;for(;!Uo(t);)So(t.output)&&(t=t.output);jo(e)?t.disconnect(e,n):Uo(e)?t.disconnect(e,n,s):t.disconnect()}class Fa extends Na{constructor(){super(Ho(Fa.getDefaults(),arguments,["gain","units"])),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode;const t=Ho(Fa.getDefaults(),arguments,["gain","units"]);this.gain=new Ra({context:this.context,convert:t.convert,param:this._gainNode.gain,units:t.units,value:t.gain,minValue:t.minValue,maxValue:t.maxValue}),la(this,"gain")}static getDefaults(){return Object.assign(Na.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class ja extends Na{constructor(t){super(t),this.onended=da,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new Fa({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(t){const e=this.toSeconds(t);return-1!==this._startTime&&e>=this._startTime&&(-1===this._stopTime||e<=this._stopTime)?"started":"stopped"},this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut,this._curve=t.curve,this.onended=t.onended}static getDefaults(){return Object.assign(Na.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:da})}_startGain(t,e=1){To(-1===this._startTime,"Source cannot be started more than once");const n=this.toSeconds(this._fadeIn);return this._startTime=t+n,this._startTime=Math.max(this._startTime,this.context.currentTime),n>0?(this._gainNode.gain.setValueAtTime(0,t),"linear"===this._curve?this._gainNode.gain.linearRampToValueAtTime(e,t+n):this._gainNode.gain.exponentialApproachValueAtTime(e,t,n)):this._gainNode.gain.setValueAtTime(e,t),this}stop(t){return this.log("stop",t),this._stopGain(this.toSeconds(t)),this}_stopGain(t){To(-1!==this._startTime,"'start' must be called before 'stop'"),this.cancelStop();const e=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(t)+e,this._stopTime=Math.max(this._stopTime,this.context.currentTime),e>0?"linear"===this._curve?this._gainNode.gain.linearRampTo(0,e,t):this._gainNode.gain.targetRampTo(0,e,t):(this._gainNode.gain.cancelAndHoldAtTime(t),this._gainNode.gain.setValueAtTime(0,t)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout((()=>{const t="exponential"===this._curve?2*e:0;this._stopSource(this.now()+t),this._onended()}),this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==da&&(this.onended(this),this.onended=da,!this.context.isOffline)){const t=()=>this.dispose();void 0!==window.requestIdleCallback?window.requestIdleCallback(t):setTimeout(t,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),To(-1!==this._startTime,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.disconnect(),this}}class Ua extends ja{constructor(){super(Ho(Ua.getDefaults(),arguments,["url","onload"])),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;const t=Ho(Ua.getDefaults(),arguments,["url","onload"]);La(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new Ra({context:this.context,param:this._source.playbackRate,units:"positive",value:t.playbackRate}),this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this._buffer=new pa(t.url,t.onload,t.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(ja.getDefaults(),{url:new pa,loop:!1,loopEnd:0,loopStart:0,onload:da,onerror:da,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t}get curve(){return this._curve}set curve(t){this._curve=t}start(t,e,n,s=1){To(this.buffer.loaded,"buffer is either not set or not loaded");const i=this.toSeconds(t);this._startGain(i,s),e=this.loop?Ko(e,this.loopStart):Ko(e,0);let r=Math.max(this.toSeconds(e),0);if(this.loop){const t=this.toSeconds(this.loopEnd)||this.buffer.duration,e=this.toSeconds(this.loopStart),n=t-e;Zo(r,t)&&(r=(r-e)%n+e),ta(r,this.buffer.duration)&&(r=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,Jo(r,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(i,r)),So(n)){let t=this.toSeconds(n);t=Math.max(t,0),this.stop(i+t)}return this}_stopSource(t){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(t)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(t){this._source.loopStart=this.toSeconds(t)}get loopEnd(){return this._source.loopEnd}set loopEnd(t){this._source.loopEnd=this.toSeconds(t)}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._source.loop}set loop(t){this._source.loop=t,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}class Ba extends Oa{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new na,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(t,e){return this._events.add({callback:t,time:this.toSeconds(e)}),1===this._events.length&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(t){return this._events.cancel(this.toSeconds(t)),this}_drawLoop(){const t=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=t;){const e=this._events.shift();e&&t-e.time<=this.expiration&&e.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}ia((t=>{t.draw=new Ba({context:t})})),oa((t=>{t.draw.dispose()}));class za extends na{constructor(t="stopped"){super(),this.name="StateTimeline",this._initial=t,this.setStateAtTime(this._initial,0)}getValueAtTime(t){const e=this.get(t);return null!==e?e.state:this._initial}setStateAtTime(t,e,n){return xo(e,0),this.add(Object.assign({},n,{state:t,time:e})),this}getLastState(t,e){for(let n=this._search(e);n>=0;n--){const e=this._timeline[n];if(e.state===t)return e}}getNextState(t,e){const n=this._search(e);if(-1!==n)for(let e=n;e<this._timeline.length;e++){const n=this._timeline[e];if(n.state===t)return n}}}class Wa extends ja{constructor(){super(Ho(Wa.getDefaults(),arguments,["offset"])),this.name="ToneConstantSource",this._source=this.context.createConstantSource();const t=Ho(Wa.getDefaults(),arguments,["offset"]);La(this._source,this._gainNode),this.offset=new Ra({context:this.context,convert:t.convert,param:this._source.offset,units:t.units,value:t.offset,minValue:t.minValue,maxValue:t.maxValue})}static getDefaults(){return Object.assign(ja.getDefaults(),{convert:!0,offset:1,units:"number"})}start(t){const e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._source.start(e),this}_stopSource(t){this._source.stop(t)}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class $a extends Na{constructor(){super(Ho($a.getDefaults(),arguments,["value","units"])),this.name="Signal",this.override=!0;const t=Ho($a.getDefaults(),arguments,["value","units"]);this.output=this._constantSource=new Wa({context:this.context,convert:t.convert,offset:t.value,units:t.units,minValue:t.minValue,maxValue:t.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(Na.getDefaults(),{convert:!0,units:"number",value:0})}connect(t,e=0,n=0){return Ga(this,t,e,n),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(t,e){return this._param.setValueAtTime(t,e),this}getValueAtTime(t){return this._param.getValueAtTime(t)}setRampPoint(t){return this._param.setRampPoint(t),this}linearRampToValueAtTime(t,e){return this._param.linearRampToValueAtTime(t,e),this}exponentialRampToValueAtTime(t,e){return this._param.exponentialRampToValueAtTime(t,e),this}exponentialRampTo(t,e,n){return this._param.exponentialRampTo(t,e,n),this}linearRampTo(t,e,n){return this._param.linearRampTo(t,e,n),this}targetRampTo(t,e,n){return this._param.targetRampTo(t,e,n),this}exponentialApproachValueAtTime(t,e,n){return this._param.exponentialApproachValueAtTime(t,e,n),this}setTargetAtTime(t,e,n){return this._param.setTargetAtTime(t,e,n),this}setValueCurveAtTime(t,e,n,s){return this._param.setValueCurveAtTime(t,e,n,s),this}cancelScheduledValues(t){return this._param.cancelScheduledValues(t),this}cancelAndHoldAtTime(t){return this._param.cancelAndHoldAtTime(t),this}rampTo(t,e,n){return this._param.rampTo(t,e,n),this}get value(){return this._param.value}set value(t){this._param.value=t}get convert(){return this._param.convert}set convert(t){this._param.convert=t}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(t){this._param.overridden=t}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(t){return this._param.apply(t),this}}function Ga(t,e,n,s){(e instanceof Ra||jo(e)||e instanceof $a&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof $a&&(e.overridden=!0)),La(t,e,n,s)}class Ha extends Ra{constructor(){super(Ho(Ha.getDefaults(),arguments,["value"])),this.name="TickParam",this._events=new na(1/0),this._multiplier=1;const t=Ho(Ha.getDefaults(),arguments,["value"]);this._multiplier=t.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(t.value)}),this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(Ra.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(t,e,n){e=this.toSeconds(e),this.setRampPoint(e);const s=this._fromType(t),i=this._events.get(e),r=Math.round(Math.max(1/n,1));for(let t=0;t<=r;t++){const r=n*t+e,o=this._exponentialApproach(i.time,i.value,s,n,r);this.linearRampToValueAtTime(this._toType(o),r)}return this}setValueAtTime(t,e){const n=this.toSeconds(e);super.setValueAtTime(t,e);const s=this._events.get(n),i=this._events.previousEvent(s),r=this._getTicksUntilEvent(i,n);return s.ticks=Math.max(r,0),this}linearRampToValueAtTime(t,e){const n=this.toSeconds(e);super.linearRampToValueAtTime(t,e);const s=this._events.get(n),i=this._events.previousEvent(s),r=this._getTicksUntilEvent(i,n);return s.ticks=Math.max(r,0),this}exponentialRampToValueAtTime(t,e){e=this.toSeconds(e);const n=this._fromType(t),s=this._events.get(e),i=Math.round(Math.max(10*(e-s.time),1)),r=(e-s.time)/i;for(let t=0;t<=i;t++){const i=r*t+s.time,o=this._exponentialInterpolate(s.time,s.value,e,n,i);this.linearRampToValueAtTime(this._toType(o),i)}return this}_getTicksUntilEvent(t,e){if(null===t)t={ticks:0,time:0,type:"setValueAtTime",value:0};else if(Eo(t.ticks)){const e=this._events.previousEvent(t);t.ticks=this._getTicksUntilEvent(e,t.time)}const n=this._fromType(this.getValueAtTime(t.time));let s=this._fromType(this.getValueAtTime(e));const i=this._events.get(e);return i&&i.time===e&&"setValueAtTime"===i.type&&(s=this._fromType(this.getValueAtTime(e-this.sampleTime))),.5*(e-t.time)*(n+s)+t.ticks}getTicksAtTime(t){const e=this.toSeconds(t),n=this._events.get(e);return Math.max(this._getTicksUntilEvent(n,e),0)}getDurationOfTicks(t,e){const n=this.toSeconds(e),s=this.getTicksAtTime(e);return this.getTimeOfTick(s+t)-n}getTimeOfTick(t){const e=this._events.get(t,"ticks"),n=this._events.getAfter(t,"ticks");if(e&&e.ticks===t)return e.time;if(e&&n&&"linearRampToValueAtTime"===n.type&&e.value!==n.value){const s=this._fromType(this.getValueAtTime(e.time)),i=(this._fromType(this.getValueAtTime(n.time))-s)/(n.time-e.time),r=Math.sqrt(Math.pow(s,2)-2*i*(e.ticks-t)),o=(-s+r)/i,a=(-s-r)/i;return(o>0?o:a)+e.time}return e?0===e.value?1/0:e.time+(t-e.ticks)/e.value:t/this._initialValue}ticksToTime(t,e){return this.getDurationOfTicks(t,e)}timeToTicks(t,e){const n=this.toSeconds(e),s=this.toSeconds(t),i=this.getTicksAtTime(n);return this.getTicksAtTime(n+s)-i}_fromType(t){return"bpm"===this.units&&this.multiplier?1/(60/t/this.multiplier):super._fromType(t)}_toType(t){return"bpm"===this.units&&this.multiplier?t/this.multiplier*60:super._toType(t)}get multiplier(){return this._multiplier}set multiplier(t){const e=this.value;this._multiplier=t,this.cancelScheduledValues(0),this.setValueAtTime(e,0)}}class Ka extends $a{constructor(){super(Ho(Ka.getDefaults(),arguments,["value"])),this.name="TickSignal";const t=Ho(Ka.getDefaults(),arguments,["value"]);this.input=this._param=new Ha({context:this.context,convert:t.convert,multiplier:t.multiplier,param:this._constantSource.offset,units:t.units,value:t.value})}static getDefaults(){return Object.assign($a.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(t,e){return this._param.ticksToTime(t,e)}timeToTicks(t,e){return this._param.timeToTicks(t,e)}getTimeOfTick(t){return this._param.getTimeOfTick(t)}getDurationOfTicks(t,e){return this._param.getDurationOfTicks(t,e)}getTicksAtTime(t){return this._param.getTicksAtTime(t)}get multiplier(){return this._param.multiplier}set multiplier(t){this._param.multiplier=t}dispose(){return super.dispose(),this._param.dispose(),this}}class Xa extends Oa{constructor(){super(Ho(Xa.getDefaults(),arguments,["frequency"])),this.name="TickSource",this._state=new za,this._tickOffset=new na;const t=Ho(Xa.getDefaults(),arguments,["frequency"]);this.frequency=new Ka({context:this.context,units:t.units,value:t.frequency}),la(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},Oa.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(t,e){const n=this.toSeconds(t);return"started"!==this._state.getValueAtTime(n)&&(this._state.setStateAtTime("started",n),So(e)&&this.setTicksAtTime(e,n)),this}stop(t){const e=this.toSeconds(t);if("stopped"===this._state.getValueAtTime(e)){const t=this._state.get(e);t&&t.time>0&&(this._tickOffset.cancel(t.time),this._state.cancel(t.time))}return this._state.cancel(e),this._state.setStateAtTime("stopped",e),this.setTicksAtTime(0,e),this}pause(t){const e=this.toSeconds(t);return"started"===this._state.getValueAtTime(e)&&this._state.setStateAtTime("paused",e),this}cancel(t){return t=this.toSeconds(t),this._state.cancel(t),this._tickOffset.cancel(t),this}getTicksAtTime(t){const e=this.toSeconds(t),n=this._state.getLastState("stopped",e),s={state:"paused",time:e};this._state.add(s);let i=n,r=0;return this._state.forEachBetween(n.time,e+this.sampleTime,(t=>{let e=i.time;const n=this._tickOffset.get(t.time);n&&n.time>=i.time&&(r=n.ticks,e=n.time),"started"===i.state&&"started"!==t.state&&(r+=this.frequency.getTicksAtTime(t.time)-this.frequency.getTicksAtTime(e)),i=t})),this._state.remove(s),r}get ticks(){return this.getTicksAtTime(this.now())}set ticks(t){this.setTicksAtTime(t,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(t){const e=this.now(),n=this.frequency.timeToTicks(t,e);this.setTicksAtTime(n,e)}getSecondsAtTime(t){t=this.toSeconds(t);const e=this._state.getLastState("stopped",t),n={state:"paused",time:t};this._state.add(n);let s=e,i=0;return this._state.forEachBetween(e.time,t+this.sampleTime,(t=>{let e=s.time;const n=this._tickOffset.get(t.time);n&&n.time>=s.time&&(i=n.seconds,e=n.time),"started"===s.state&&"started"!==t.state&&(i+=t.time-e),s=t})),this._state.remove(n),i}setTicksAtTime(t,e){return e=this.toSeconds(e),this._tickOffset.cancel(e),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(t,e),ticks:t,time:e}),this}getStateAtTime(t){return t=this.toSeconds(t),this._state.getValueAtTime(t)}getTimeOfTick(t,e=this.now()){const n=this._tickOffset.get(e),s=this._state.get(e),i=Math.max(n.time,s.time),r=this.frequency.getTicksAtTime(i)+t-n.ticks;return this.frequency.getTimeOfTick(r)}forEachTickBetween(t,e,n){let s=this._state.get(t);this._state.forEachBetween(t,e,(e=>{s&&"started"===s.state&&"started"!==e.state&&this.forEachTickBetween(Math.max(s.time,t),e.time-this.sampleTime,n),s=e}));let i=null;if(s&&"started"===s.state){const r=Math.max(s.time,t),o=this.frequency.getTicksAtTime(r),a=o-this.frequency.getTicksAtTime(s.time);let c=Math.ceil(a)-a;c=ta(c,1)?0:c;let h=this.frequency.getTimeOfTick(o+c);for(;h<e;){try{n(h,Math.round(this.getTicksAtTime(h)))}catch(t){i=t;break}h+=this.frequency.getDurationOfTicks(1,h)}}if(i)throw i;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this.frequency.dispose(),this}}class Ya extends Oa{constructor(){super(Ho(Ya.getDefaults(),arguments,["callback","frequency"])),this.name="Clock",this.callback=da,this._lastUpdate=0,this._state=new za("stopped"),this._boundLoop=this._loop.bind(this);const t=Ho(Ya.getDefaults(),arguments,["callback","frequency"]);this.callback=t.callback,this._tickSource=new Xa({context:this.context,frequency:t.frequency,units:t.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,la(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(Oa.getDefaults(),{callback:da,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(t,e){Ao(this.context);const n=this.toSeconds(t);return this.log("start",n),"started"!==this._state.getValueAtTime(n)&&(this._state.setStateAtTime("started",n),this._tickSource.start(n,e),n<this._lastUpdate&&this.emit("start",n,e)),this}stop(t){const e=this.toSeconds(t);return this.log("stop",e),this._state.cancel(e),this._state.setStateAtTime("stopped",e),this._tickSource.stop(e),e<this._lastUpdate&&this.emit("stop",e),this}pause(t){const e=this.toSeconds(t);return"started"===this._state.getValueAtTime(e)&&(this._state.setStateAtTime("paused",e),this._tickSource.pause(e),e<this._lastUpdate&&this.emit("pause",e)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(t){this._tickSource.ticks=t}get seconds(){return this._tickSource.seconds}set seconds(t){this._tickSource.seconds=t}getSecondsAtTime(t){return this._tickSource.getSecondsAtTime(t)}setTicksAtTime(t,e){return this._tickSource.setTicksAtTime(t,e),this}getTimeOfTick(t,e=this.now()){return this._tickSource.getTimeOfTick(t,e)}getTicksAtTime(t){return this._tickSource.getTicksAtTime(t)}nextTickTime(t,e){const n=this.toSeconds(e),s=this.getTicksAtTime(n);return this._tickSource.getTimeOfTick(s+t,n)}_loop(){const t=this._lastUpdate,e=this.now();this._lastUpdate=e,this.log("loop",t,e),t!==e&&(this._state.forEachBetween(t,e,(t=>{switch(t.state){case"started":const e=this._tickSource.getTicksAtTime(t.time);this.emit("start",t.time,e);break;case"stopped":0!==t.time&&this.emit("stop",t.time);break;case"paused":this.emit("pause",t.time)}})),this._tickSource.forEachTickBetween(t,e,((t,e)=>{this.callback(t,e)})))}getStateAtTime(t){const e=this.toSeconds(t);return this._state.getValueAtTime(e)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}aa.mixin(Ya);class Qa extends Na{constructor(){super(Ho(Qa.getDefaults(),arguments,["delayTime","maxDelay"])),this.name="Delay";const t=Ho(Qa.getDefaults(),arguments,["delayTime","maxDelay"]),e=this.toSeconds(t.maxDelay);this._maxDelay=Math.max(e,this.toSeconds(t.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(e),this.delayTime=new Ra({context:this.context,param:this._delayNode.delayTime,units:"time",value:t.delayTime,minValue:0,maxValue:this.maxDelay}),la(this,"delayTime")}static getDefaults(){return Object.assign(Na.getDefaults(),{delayTime:0,maxDelay:1})}get maxDelay(){return this._maxDelay}dispose(){return super.dispose(),this._delayNode.disconnect(),this.delayTime.dispose(),this}}class Za extends Ma{constructor(){super(...arguments),this.name="MidiClass",this.defaultUnits="midi"}_frequencyToUnits(t){return Aa(super._frequencyToUnits(t))}_ticksToUnits(t){return Aa(super._ticksToUnits(t))}_beatsToUnits(t){return Aa(super._beatsToUnits(t))}_secondsToUnits(t){return Aa(super._secondsToUnits(t))}toMidi(){return this.valueOf()}toFrequency(){return Ca(this.toMidi())}transpose(t){return new Za(this.context,this.toMidi()+t)}}class Ja extends Pa{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(t){return this._getPPQ()*t}_secondsToUnits(t){return Math.floor(t/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(t){return t}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class tc extends Yo{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(t){To(So(t.time),"Events must have a time property"),To(So(t.duration),"Events must have a duration parameter"),t.time=t.time.valueOf();let e=new ec(t.time,t.time+t.duration,t);for(null===this._root?this._root=e:this._root.insert(e),this._length++;null!==e;)e.updateHeight(),e.updateMax(),this._rebalance(e),e=e.parent;return this}remove(t){if(null!==this._root){const e=[];this._root.search(t.time,e);for(const n of e)if(n.event===t){this._removeNode(n),this._length--;break}}return this}get length(){return this._length}cancel(t){return this.forEachFrom(t,(t=>this.remove(t))),this}_setRoot(t){this._root=t,null!==this._root&&(this._root.parent=null)}_replaceNodeInParent(t,e){null!==t.parent?(t.isLeftChild()?t.parent.left=e:t.parent.right=e,this._rebalance(t.parent)):this._setRoot(e)}_removeNode(t){if(null===t.left&&null===t.right)this._replaceNodeInParent(t,null);else if(null===t.right)this._replaceNodeInParent(t,t.left);else if(null===t.left)this._replaceNodeInParent(t,t.right);else{let e,n=null;if(t.getBalance()>0)if(null===t.left.right)e=t.left,e.right=t.right,n=e;else{for(e=t.left.right;null!==e.right;)e=e.right;e.parent&&(e.parent.right=e.left,n=e.parent,e.left=t.left,e.right=t.right)}else if(null===t.right.left)e=t.right,e.left=t.left,n=e;else{for(e=t.right.left;null!==e.left;)e=e.left;e.parent&&(e.parent.left=e.right,n=e.parent,e.left=t.left,e.right=t.right)}null!==t.parent?t.isLeftChild()?t.parent.left=e:t.parent.right=e:this._setRoot(e),n&&this._rebalance(n)}t.dispose()}_rotateLeft(t){const e=t.parent,n=t.isLeftChild(),s=t.right;s&&(t.right=s.left,s.left=t),null!==e?n?e.left=s:e.right=s:this._setRoot(s)}_rotateRight(t){const e=t.parent,n=t.isLeftChild(),s=t.left;s&&(t.left=s.right,s.right=t),null!==e?n?e.left=s:e.right=s:this._setRoot(s)}_rebalance(t){const e=t.getBalance();e>1&&t.left?t.left.getBalance()<0?this._rotateLeft(t.left):this._rotateRight(t):e<-1&&t.right&&(t.right.getBalance()>0?this._rotateRight(t.right):this._rotateLeft(t))}get(t){if(null!==this._root){const e=[];if(this._root.search(t,e),e.length>0){let t=e[0];for(let n=1;n<e.length;n++)e[n].low>t.low&&(t=e[n]);return t.event}}return null}forEach(t){if(null!==this._root){const e=[];this._root.traverse((t=>e.push(t))),e.forEach((e=>{e.event&&t(e.event)}))}return this}forEachAtTime(t,e){if(null!==this._root){const n=[];this._root.search(t,n),n.forEach((t=>{t.event&&e(t.event)}))}return this}forEachFrom(t,e){if(null!==this._root){const n=[];this._root.searchAfter(t,n),n.forEach((t=>{t.event&&e(t.event)}))}return this}dispose(){return super.dispose(),null!==this._root&&this._root.traverse((t=>t.dispose())),this._root=null,this}}class ec{constructor(t,e,n){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=n,this.low=t,this.high=e,this.max=this.high}insert(t){t.low<=this.low?null===this.left?this.left=t:this.left.insert(t):null===this.right?this.right=t:this.right.insert(t)}search(t,e){t>this.max||(null!==this.left&&this.left.search(t,e),this.low<=t&&this.high>t&&e.push(this),this.low>t||null!==this.right&&this.right.search(t,e))}searchAfter(t,e){this.low>=t&&(e.push(this),null!==this.left&&this.left.searchAfter(t,e)),null!==this.right&&this.right.searchAfter(t,e)}traverse(t){t(this),null!==this.left&&this.left.traverse(t),null!==this.right&&this.right.traverse(t)}updateHeight(){null!==this.left&&null!==this.right?this.height=Math.max(this.left.height,this.right.height)+1:null!==this.right?this.height=this.right.height+1:null!==this.left?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,null!==this.left&&(this.max=Math.max(this.max,this.left.max)),null!==this.right&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let t=0;return null!==this.left&&null!==this.right?t=this.left.height-this.right.height:null!==this.left?t=this.left.height+1:null!==this.right&&(t=-(this.right.height+1)),t}isLeftChild(){return null!==this.parent&&this.parent.left===this}get left(){return this._left}set left(t){this._left=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(t){this._right=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class nc extends Na{constructor(){super(Ho(nc.getDefaults(),arguments,["volume"])),this.name="Volume";const t=Ho(nc.getDefaults(),arguments,["volume"]);this.input=this.output=new Fa({context:this.context,gain:t.volume,units:"decibels"}),this.volume=this.output.gain,la(this,"volume"),this._unmutedVolume=t.volume,this.mute=t.mute}static getDefaults(){return Object.assign(Na.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(t){!this.mute&&t?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!t&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class sc extends Na{constructor(){super(Ho(sc.getDefaults(),arguments)),this.name="Destination",this.input=new nc({context:this.context}),this.output=new Fa({context:this.context}),this.volume=this.input.volume;const t=Ho(sc.getDefaults(),arguments);Va(this.input,this.output,this.context.rawContext.destination),this.mute=t.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(Na.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(t){this.input.mute=t}chain(...t){return this.input.disconnect(),t.unshift(this.input),t.push(this.output),Va(...t),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}ia((t=>{t.destination=new sc({context:t})})),oa((t=>{t.destination.dispose()}));class ic extends Yo{constructor(t){super(),this.name="TimelineValue",this._timeline=new na({memory:10}),this._initialValue=t}set(t,e){return this._timeline.add({value:t,time:e}),this}get(t){const e=this._timeline.get(t);return e?e.value:this._initialValue}}class rc{constructor(t,e){this.id=rc._eventId++;const n=Object.assign(rc.getDefaults(),e);this.transport=t,this.callback=n.callback,this._once=n.once,this.time=n.time}static getDefaults(){return{callback:da,once:!1,time:0}}invoke(t){this.callback&&(this.callback(t),this._once&&this.transport.clear(this.id))}dispose(){return this.callback=void 0,this}}rc._eventId=0;class oc extends rc{constructor(t,e){super(t,e),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const n=Object.assign(oc.getDefaults(),e);this.duration=new Ja(t.context,n.duration).valueOf(),this._interval=new Ja(t.context,n.interval).valueOf(),this._nextTick=n.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},rc.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(t){this._createEvents(t),super.invoke(t)}_createEvents(t){const e=this.transport.getTicksAtTime(t);e>=this.time&&e>=this._nextTick&&this._nextTick+this._interval<this.time+this.duration&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new Ja(this.context,this._nextTick).toSeconds()))}_restart(t){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.time;const e=this.transport.getTicksAtTime(t);e>this.time&&(this._nextTick=this.time+Math.ceil((e-this.time)/this._interval)*this._interval),this._currentId=this.transport.scheduleOnce(this.invoke.bind(this),new Ja(this.context,this._nextTick).toSeconds()),this._nextTick+=this._interval,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new Ja(this.context,this._nextTick).toSeconds())}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this}}class ac extends Oa{constructor(){super(Ho(ac.getDefaults(),arguments)),this.name="Transport",this._loop=new ic(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new na,this._repeatedEvents=new tc,this._syncedSignals=[],this._swingAmount=0;const t=Ho(ac.getDefaults(),arguments);this._ppq=t.ppq,this._clock=new Ya({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=t.ppq,this.bpm.setValueAtTime(t.bpm,0),la(this,"bpm"),this._timeSignature=t.timeSignature,this._swingTicks=t.ppq/2}static getDefaults(){return Object.assign(Oa.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(t,e){if(this._loop.get(t)&&e>=this._loopEnd&&(this.emit("loopEnd",t),this._clock.setTicksAtTime(this._loopStart,t),e=this._loopStart,this.emit("loopStart",t,this._clock.getSecondsAtTime(t)),this.emit("loop",t)),this._swingAmount>0&&e%this._ppq!=0&&e%(2*this._swingTicks)!=0){const n=e%(2*this._swingTicks)/(2*this._swingTicks),s=Math.sin(n*Math.PI)*this._swingAmount;t+=new Ja(this.context,2*this._swingTicks/3).toSeconds()*s}this._timeline.forEachAtTime(e,(e=>e.invoke(t)))}schedule(t,e){const n=new rc(this,{callback:t,time:new Pa(this.context,e).toTicks()});return this._addEvent(n,this._timeline)}scheduleRepeat(t,e,n,s=1/0){const i=new oc(this,{callback:t,duration:new Sa(this.context,s).toTicks(),interval:new Sa(this.context,e).toTicks(),time:new Pa(this.context,n).toTicks()});return this._addEvent(i,this._repeatedEvents)}scheduleOnce(t,e){const n=new rc(this,{callback:t,once:!0,time:new Pa(this.context,e).toTicks()});return this._addEvent(n,this._timeline)}clear(t){if(this._scheduledEvents.hasOwnProperty(t)){const e=this._scheduledEvents[t.toString()];e.timeline.remove(e.event),e.event.dispose(),delete this._scheduledEvents[t.toString()]}return this}_addEvent(t,e){return this._scheduledEvents[t.id.toString()]={event:t,timeline:e},e.add(t),t.id}cancel(t=0){const e=this.toTicks(t);return this._timeline.forEachFrom(e,(t=>this.clear(t.id))),this._repeatedEvents.forEachFrom(e,(t=>this.clear(t.id))),this}_bindClockEvents(){this._clock.on("start",((t,e)=>{e=new Ja(this.context,e).toSeconds(),this.emit("start",t,e)})),this._clock.on("stop",(t=>{this.emit("stop",t)})),this._clock.on("pause",(t=>{this.emit("pause",t)}))}get state(){return this._clock.getStateAtTime(this.now())}start(t,e){let n;return So(e)&&(n=this.toTicks(e)),this._clock.start(t,n),this}stop(t){return this._clock.stop(t),this}pause(t){return this._clock.pause(t),this}toggle(t){return t=this.toSeconds(t),"started"!==this._clock.getStateAtTime(t)?this.start(t):this.stop(t),this}get timeSignature(){return this._timeSignature}set timeSignature(t){Po(t)&&(t=t[0]/t[1]*4),this._timeSignature=t}get loopStart(){return new Sa(this.context,this._loopStart,"i").toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t)}get loopEnd(){return new Sa(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t)}get loop(){return this._loop.get(this.now())}set loop(t){this._loop.set(t,this.now())}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get swing(){return this._swingAmount}set swing(t){this._swingAmount=t}get swingSubdivision(){return new Ja(this.context,this._swingTicks).toNotation()}set swingSubdivision(t){this._swingTicks=this.toTicks(t)}get position(){const t=this.now(),e=this._clock.getTicksAtTime(t);return new Ja(this.context,e).toBarsBeatsSixteenths()}set position(t){const e=this.toTicks(t);this.ticks=e}get seconds(){return this._clock.seconds}set seconds(t){const e=this.now(),n=this._clock.frequency.timeToTicks(t,e);this.ticks=n}get progress(){if(this.loop){const t=this.now();return(this._clock.getTicksAtTime(t)-this._loopStart)/(this._loopEnd-this._loopStart)}return 0}get ticks(){return this._clock.ticks}set ticks(t){if(this._clock.ticks!==t){const e=this.now();if("started"===this.state){const n=this._clock.getTicksAtTime(e),s=e+this._clock.frequency.getDurationOfTicks(Math.ceil(n)-n,e);this.emit("stop",s),this._clock.setTicksAtTime(t,s),this.emit("start",s,this._clock.getSecondsAtTime(s))}else this._clock.setTicksAtTime(t,e)}}getTicksAtTime(t){return Math.round(this._clock.getTicksAtTime(t))}getSecondsAtTime(t){return this._clock.getSecondsAtTime(t)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(t){this._clock.frequency.multiplier=t}nextSubdivision(t){if(t=this.toTicks(t),"started"!==this.state)return 0;{const e=this.now(),n=t-this.getTicksAtTime(e)%t;return this._clock.nextTickTime(n,e)}}syncSignal(t,e){if(!e){const n=this.now();if(0!==t.getValueAtTime(n)){const s=1/(60/this.bpm.getValueAtTime(n)/this.PPQ);e=t.getValueAtTime(n)/s}else e=0}const n=new Fa(e);return this.bpm.connect(n),n.connect(t._param),this._syncedSignals.push({initial:t.value,ratio:n,signal:t}),t.value=0,this}unsyncSignal(t){for(let e=this._syncedSignals.length-1;e>=0;e--){const n=this._syncedSignals[e];n.signal===t&&(n.ratio.dispose(),n.signal.value=n.initial,this._syncedSignals.splice(e,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),ua(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}aa.mixin(ac),ia((t=>{t.transport=new ac({context:t})})),oa((t=>{t.transport.dispose()}));class cc extends Na{constructor(t){super(t),this.input=void 0,this._state=new za("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=da,this._syncedStop=da,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new nc({context:this.context,mute:t.mute,volume:t.volume}),this.volume=this._volume.volume,la(this,"volume"),this.onstop=t.onstop}static getDefaults(){return Object.assign(Na.getDefaults(),{mute:!1,onstop:da,volume:0})}get state(){return this._synced?"started"===this.context.transport.state?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}_clampToCurrentTime(t){return this._synced?t:Math.max(t,this.context.currentTime)}start(t,e,n){let s=Eo(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(s=this._clampToCurrentTime(s),this._synced||"started"!==this._state.getValueAtTime(s))if(this.log("start",s),this._state.setStateAtTime("started",s),this._synced){const t=this._state.get(s);t&&(t.offset=this.toSeconds(Ko(e,0)),t.duration=n?this.toSeconds(n):void 0);const i=this.context.transport.schedule((t=>{this._start(t,e,n)}),s);this._scheduled.push(i),"started"===this.context.transport.state&&this.context.transport.getSecondsAtTime(this.immediate())>s&&this._syncedStart(this.now(),this.context.transport.seconds)}else Ao(this.context),this._start(s,e,n);else To(Qo(s,this._state.get(s).time),"Start time must be strictly greater than previous start time"),this._state.cancel(s),this._state.setStateAtTime("started",s),this.log("restart",s),this.restart(s,e,n);return this}stop(t){let e=Eo(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(e=this._clampToCurrentTime(e),"started"===this._state.getValueAtTime(e)||So(this._state.getNextState("started",e))){if(this.log("stop",e),this._synced){const t=this.context.transport.schedule(this._stop.bind(this),e);this._scheduled.push(t)}else this._stop(e);this._state.cancel(e),this._state.setStateAtTime("stopped",e)}return this}restart(t,e,n){return t=this.toSeconds(t),"started"===this._state.getValueAtTime(t)&&(this._state.cancel(t),this._restart(t,e,n)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(t,e)=>{if(e>0){const n=this._state.get(e);if(n&&"started"===n.state&&n.time!==e){const s=e-this.toSeconds(n.time);let i;n.duration&&(i=this.toSeconds(n.duration)-s),this._start(t,this.toSeconds(n.offset)+s,i)}}},this._syncedStop=t=>{const e=this.context.transport.getSecondsAtTime(Math.max(t-this.sampleTime,0));"started"===this._state.getValueAtTime(e)&&this._stop(t)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach((t=>this.context.transport.clear(t))),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=da,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class hc extends cc{constructor(){super(Ho(hc.getDefaults(),arguments,["type"])),this.name="Noise",this._source=null;const t=Ho(hc.getDefaults(),arguments,["type"]);this._playbackRate=t.playbackRate,this.type=t.type,this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut}static getDefaults(){return Object.assign(cc.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(t){if(To(t in uc,"Noise: invalid type: "+t),this._type!==t&&(this._type=t,"started"===this.state)){const t=this.now();this._stop(t),this._start(t)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._source&&(this._source.playbackRate.value=t)}_start(t){const e=uc[this._type];this._source=new Ua({url:e,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(t),Math.random()*(e.duration-.001))}_stop(t){this._source&&(this._source.stop(this.toSeconds(t)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(t){this._stop(t),this._start(t)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}const lc={brown:null,pink:null,white:null},uc={get brown(){if(!lc.brown){const t=[];for(let e=0;e<2;e++){const n=new Float32Array(220500);t[e]=n;let s=0;for(let t=0;t<220500;t++){const e=2*Math.random()-1;n[t]=(s+.02*e)/1.02,s=n[t],n[t]*=3.5}}lc.brown=(new pa).fromArray(t)}return lc.brown},get pink(){if(!lc.pink){const t=[];for(let e=0;e<2;e++){const n=new Float32Array(220500);let s,i,r,o,a,c,h;t[e]=n,s=i=r=o=a=c=h=0;for(let t=0;t<220500;t++){const e=2*Math.random()-1;s=.99886*s+.0555179*e,i=.99332*i+.0750759*e,r=.969*r+.153852*e,o=.8665*o+.3104856*e,a=.55*a+.5329522*e,c=-.7616*c-.016898*e,n[t]=s+i+r+o+a+c+h+.5362*e,n[t]*=.11,h=.115926*e}}lc.pink=(new pa).fromArray(t)}return lc.pink},get white(){if(!lc.white){const t=[];for(let e=0;e<2;e++){const n=new Float32Array(220500);t[e]=n;for(let t=0;t<220500;t++)n[t]=2*Math.random()-1}lc.white=(new pa).fromArray(t)}return lc.white}};function dc(t,e){return qo(this,void 0,void 0,(function*(){const n=e/t.context.sampleRate,s=new fa(1,n,t.context.sampleRate);new t.constructor(Object.assign(t.get(),{frequency:2/n,detune:0,context:s})).toDestination().start(0);return(yield s.render()).getChannelData(0)}))}class pc extends ja{constructor(){super(Ho(pc.getDefaults(),arguments,["frequency","type"])),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];const t=Ho(pc.getDefaults(),arguments,["frequency","type"]);La(this._oscillator,this._gainNode),this.type=t.type,this.frequency=new Ra({context:this.context,param:this._oscillator.frequency,units:"frequency",value:t.frequency}),this.detune=new Ra({context:this.context,param:this._oscillator.detune,units:"cents",value:t.detune}),la(this,["frequency","detune"])}static getDefaults(){return Object.assign(ja.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(t){const e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._oscillator.start(e),this}_stopSource(t){this._oscillator.stop(t)}setPeriodicWave(t){return this._oscillator.setPeriodicWave(t),this}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class fc extends cc{constructor(){super(Ho(fc.getDefaults(),arguments,["frequency","type"])),this.name="Oscillator",this._oscillator=null;const t=Ho(fc.getDefaults(),arguments,["frequency","type"]);this.frequency=new $a({context:this.context,units:"frequency",value:t.frequency}),la(this,"frequency"),this.detune=new $a({context:this.context,units:"cents",value:t.detune}),la(this,"detune"),this._partials=t.partials,this._partialCount=t.partialCount,this._type=t.type,t.partialCount&&"custom"!==t.type&&(this._type=this.baseType+t.partialCount.toString()),this.phase=t.phase}static getDefaults(){return Object.assign(cc.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(t){const e=this.toSeconds(t),n=new pc({context:this.context,onended:()=>this.onstop(this)});this._oscillator=n,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(e)}_stop(t){const e=this.toSeconds(t);this._oscillator&&this._oscillator.stop(e)}_restart(t){const e=this.toSeconds(t);return this.log("restart",e),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(e),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if("custom"===this._type){return fc._periodicWaveCache.find((t=>{return t.phase===this._phase&&(e=t.partials,n=this._partials,e.length===n.length&&e.every(((t,e)=>n[e]===t)));var e,n}))}{const t=fc._periodicWaveCache.find((t=>t.type===this._type&&t.phase===this._phase));return this._partialCount=t?t.partialCount:this._partialCount,t}}get type(){return this._type}set type(t){this._type=t;const e=-1!==["sine","square","sawtooth","triangle"].indexOf(t);if(0===this._phase&&e)this._wave=void 0,this._partialCount=0,null!==this._oscillator&&(this._oscillator.type=t);else{const e=this._getCachedPeriodicWave();if(So(e)){const{partials:t,wave:n}=e;this._wave=n,this._partials=t,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave)}else{const[e,n]=this._getRealImaginary(t,this._phase),s=this.context.createPeriodicWave(e,n);this._wave=s,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave),fc._periodicWaveCache.push({imag:n,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:e,type:this._type,wave:this._wave}),fc._periodicWaveCache.length>100&&fc._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(t){this.partialCount&&"custom"!==this._type&&"custom"!==t?this.type=t+this.partialCount:this.type=t}get partialCount(){return this._partialCount}set partialCount(t){xo(t,0);let e=this._type;const n=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(n&&(e=n[1]),"custom"!==this._type)this.type=0===t?e:e+t.toString();else{const e=new Float32Array(t);this._partials.forEach(((t,n)=>e[n]=t)),this._partials=Array.from(e),this.type=this._type}}_getRealImaginary(t,e){let n=2048;const s=new Float32Array(n),i=new Float32Array(n);let r=1;if("custom"===t){if(r=this._partials.length+1,this._partialCount=this._partials.length,n=r,0===this._partials.length)return[s,i]}else{const e=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(t);e?(r=parseInt(e[2],10)+1,this._partialCount=parseInt(e[2],10),t=e[1],r=Math.max(r,2),n=r):this._partialCount=0,this._partials=[]}for(let o=1;o<n;++o){const n=2/(o*Math.PI);let a;switch(t){case"sine":a=o<=r?1:0,this._partials[o-1]=a;break;case"square":a=1&o?2*n:0,this._partials[o-1]=a;break;case"sawtooth":a=n*(1&o?1:-1),this._partials[o-1]=a;break;case"triangle":a=1&o?n*n*2*(o-1>>1&1?-1:1):0,this._partials[o-1]=a;break;case"custom":a=this._partials[o-1];break;default:throw new TypeError("Oscillator: invalid type: "+t)}0!==a?(s[o]=-a*Math.sin(e*o),i[o]=a*Math.cos(e*o)):(s[o]=0,i[o]=0)}return[s,i]}_inverseFFT(t,e,n){let s=0;const i=t.length;for(let r=0;r<i;r++)s+=t[r]*Math.cos(r*n)+e[r]*Math.sin(r*n);return s}getInitialValue(){const[t,e]=this._getRealImaginary(this._type,0);let n=0;const s=2*Math.PI;for(let i=0;i<32;i++)n=Math.max(this._inverseFFT(t,e,i/32*s),n);return ea(-this._inverseFFT(t,e,this._phase)/n,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(t){this._phase=t*Math.PI/180,this.type=this._type}asArray(t=1024){return qo(this,void 0,void 0,(function*(){return dc(this,t)}))}dispose(){return super.dispose(),null!==this._oscillator&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}fc._periodicWaveCache=[];class mc extends Na{constructor(){super(Object.assign(Ho(mc.getDefaults(),arguments,["context"])))}connect(t,e=0,n=0){return Ga(this,t,e,n),this}}class gc extends mc{constructor(){super(Object.assign(Ho(gc.getDefaults(),arguments,["mapping","length"]))),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper;const t=Ho(gc.getDefaults(),arguments,["mapping","length"]);Po(t.mapping)||t.mapping instanceof Float32Array?this.curve=Float32Array.from(t.mapping):"function"==typeof t.mapping&&this.setMap(t.mapping,t.length)}static getDefaults(){return Object.assign($a.getDefaults(),{length:1024})}setMap(t,e=1024){const n=new Float32Array(e);for(let s=0,i=e;s<i;s++){const e=s/(i-1)*2-1;n[s]=t(e,s)}return this.curve=n,this}get curve(){return this._shaper.curve}set curve(t){this._shaper.curve=t}get oversample(){return this._shaper.oversample}set oversample(t){To(["none","2x","4x"].some((e=>e.includes(t))),"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class yc extends mc{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new gc({context:this.context,mapping:t=>(t+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class _c extends $a{constructor(){super(Object.assign(Ho(_c.getDefaults(),arguments,["value"]))),this.name="Multiply",this.override=!1;const t=Ho(_c.getDefaults(),arguments,["value"]);this._mult=this.input=this.output=new Fa({context:this.context,minValue:t.minValue,maxValue:t.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign($a.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class vc extends cc{constructor(){super(Ho(vc.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="AMOscillator",this._modulationScale=new yc({context:this.context}),this._modulationNode=new Fa({context:this.context});const t=Ho(vc.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new fc({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new fc({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new _c({context:this.context,units:"positive",value:t.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),la(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(fc.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){this._modulator.restart(t),this._carrier.restart(t)}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(t=1024){return qo(this,void 0,void 0,(function*(){return dc(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class wc extends cc{constructor(){super(Ho(wc.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="FMOscillator",this._modulationNode=new Fa({context:this.context,gain:0});const t=Ho(wc.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new fc({context:this.context,detune:t.detune,frequency:0,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.detune=this._carrier.detune,this.frequency=new $a({context:this.context,units:"frequency",value:t.frequency}),this._modulator=new fc({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new _c({context:this.context,units:"positive",value:t.harmonicity}),this.modulationIndex=new _c({context:this.context,units:"positive",value:t.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),la(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(fc.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){return this._modulator.restart(t),this._carrier.restart(t),this}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(t=1024){return qo(this,void 0,void 0,(function*(){return dc(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class bc extends cc{constructor(){super(Ho(bc.getDefaults(),arguments,["frequency","width"])),this.name="PulseOscillator",this._widthGate=new Fa({context:this.context,gain:0}),this._thresh=new gc({context:this.context,mapping:t=>t<=0?-1:1});const t=Ho(bc.getDefaults(),arguments,["frequency","width"]);this.width=new $a({context:this.context,units:"audioRange",value:t.width}),this._triangle=new fc({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),la(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(cc.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(t){t=this.toSeconds(t),this._triangle.start(t),this._widthGate.gain.setValueAtTime(1,t)}_stop(t){t=this.toSeconds(t),this._triangle.stop(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(0,t)}_restart(t){this._triangle.restart(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(1,t)}get phase(){return this._triangle.phase}set phase(t){this._triangle.phase=t}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(t){this._triangle.type=t}asArray(t=1024){return qo(this,void 0,void 0,(function*(){return dc(this,t)}))}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class Tc extends cc{constructor(){super(Ho(Tc.getDefaults(),arguments,["frequency","type","spread"])),this.name="FatOscillator",this._oscillators=[];const t=Ho(Tc.getDefaults(),arguments,["frequency","type","spread"]);this.frequency=new $a({context:this.context,units:"frequency",value:t.frequency}),this.detune=new $a({context:this.context,units:"cents",value:t.detune}),this._spread=t.spread,this._type=t.type,this._phase=t.phase,this._partials=t.partials,this._partialCount=t.partialCount,this.count=t.count,la(this,["frequency","detune"])}static getDefaults(){return Object.assign(fc.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(t){t=this.toSeconds(t),this._forEach((e=>e.start(t)))}_stop(t){t=this.toSeconds(t),this._forEach((e=>e.stop(t)))}_restart(t){this._forEach((e=>e.restart(t)))}_forEach(t){for(let e=0;e<this._oscillators.length;e++)t(this._oscillators[e],e)}get type(){return this._type}set type(t){this._type=t,this._forEach((e=>e.type=t))}get spread(){return this._spread}set spread(t){if(this._spread=t,this._oscillators.length>1){const e=-t/2,n=t/(this._oscillators.length-1);this._forEach(((t,s)=>t.detune.value=e+n*s))}}get count(){return this._oscillators.length}set count(t){if(xo(t,1),this._oscillators.length!==t){this._forEach((t=>t.dispose())),this._oscillators=[];for(let e=0;e<t;e++){const n=new fc({context:this.context,volume:-6-1.1*t,type:this._type,phase:this._phase+e/t*360,partialCount:this._partialCount,onstop:0===e?()=>this.onstop(this):da});"custom"===this.type&&(n.partials=this._partials),this.frequency.connect(n.frequency),this.detune.connect(n.detune),n.detune.overridden=!1,n.connect(this.output),this._oscillators[e]=n}this.spread=this._spread,"started"===this.state&&this._forEach((t=>t.start()))}}get phase(){return this._phase}set phase(t){this._phase=t,this._forEach(((t,e)=>t.phase=this._phase+e/this.count*360))}get baseType(){return this._oscillators[0].baseType}set baseType(t){this._forEach((e=>e.baseType=t)),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this._type="custom",this._forEach((e=>e.partials=t)))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(t){this._partialCount=t,this._forEach((e=>e.partialCount=t)),this._type=this._oscillators[0].type}asArray(t=1024){return qo(this,void 0,void 0,(function*(){return dc(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach((t=>t.dispose())),this}}class xc extends cc{constructor(){super(Ho(xc.getDefaults(),arguments,["frequency","modulationFrequency"])),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new _c({context:this.context,value:2});const t=Ho(xc.getDefaults(),arguments,["frequency","modulationFrequency"]);this._pulse=new bc({context:this.context,frequency:t.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new fc({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),la(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(cc.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(t){t=this.toSeconds(t),this._modulator.start(t),this._pulse.start(t)}_stop(t){t=this.toSeconds(t),this._modulator.stop(t),this._pulse.stop(t)}_restart(t){this._modulator.restart(t),this._pulse.restart(t)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(t){this._modulator.phase=t}asArray(t=1024){return qo(this,void 0,void 0,(function*(){return dc(this,t)}))}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const Ac={am:vc,fat:Tc,fm:wc,oscillator:fc,pulse:bc,pwm:xc};class kc extends cc{constructor(){super(Ho(kc.getDefaults(),arguments,["frequency","type"])),this.name="OmniOscillator";const t=Ho(kc.getDefaults(),arguments,["frequency","type"]);this.frequency=new $a({context:this.context,units:"frequency",value:t.frequency}),this.detune=new $a({context:this.context,units:"cents",value:t.detune}),la(this,["frequency","detune"]),this.set(t)}static getDefaults(){return Object.assign(fc.getDefaults(),wc.getDefaults(),vc.getDefaults(),Tc.getDefaults(),bc.getDefaults(),xc.getDefaults())}_start(t){this._oscillator.start(t)}_stop(t){this._oscillator.stop(t)}_restart(t){return this._oscillator.restart(t),this}get type(){let t="";return["am","fm","fat"].some((t=>this._sourceType===t))&&(t=this._sourceType),t+this._oscillator.type}set type(t){"fm"===t.substr(0,2)?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):"am"===t.substr(0,2)?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):"fat"===t.substr(0,3)?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(3)):"pwm"===t?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):"pulse"===t?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=t)}get partials(){return this._oscillator.partials}set partials(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partials=t)}get partialCount(){return this._oscillator.partialCount}set partialCount(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partialCount=t)}set(t){return Reflect.has(t,"type")&&t.type&&(this.type=t.type),super.set(t),this}_createNewOscillator(t){if(t!==this._sourceType){this._sourceType=t;const e=Ac[t],n=this.now();if(this._oscillator){const t=this._oscillator;t.stop(n),this.context.setTimeout((()=>t.dispose()),this.blockTime)}this._oscillator=new e({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),"started"===this.state&&this._oscillator.start(n)}}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t}get sourceType(){return this._sourceType}set sourceType(t){let e="sine";"pwm"!==this._oscillator.type&&"pulse"!==this._oscillator.type&&(e=this._oscillator.type),"fm"===t?this.type="fm"+e:"am"===t?this.type="am"+e:"fat"===t?this.type="fat"+e:"oscillator"===t?this.type=e:"pulse"===t?this.type="pulse":"pwm"===t&&(this.type="pwm")}_getOscType(t,e){return t instanceof Ac[e]}get baseType(){return this._oscillator.baseType}set baseType(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||"pulse"===t||"pwm"===t||(this._oscillator.baseType=t)}get width(){return this._getOscType(this._oscillator,"pulse")?this._oscillator.width:void 0}get count(){return this._getOscType(this._oscillator,"fat")?this._oscillator.count:void 0}set count(t){this._getOscType(this._oscillator,"fat")&&Mo(t)&&(this._oscillator.count=t)}get spread(){return this._getOscType(this._oscillator,"fat")?this._oscillator.spread:void 0}set spread(t){this._getOscType(this._oscillator,"fat")&&Mo(t)&&(this._oscillator.spread=t)}get modulationType(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.modulationType:void 0}set modulationType(t){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&Oo(t)&&(this._oscillator.modulationType=t)}get modulationIndex(){return this._getOscType(this._oscillator,"fm")?this._oscillator.modulationIndex:void 0}get harmonicity(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.harmonicity:void 0}get modulationFrequency(){return this._getOscType(this._oscillator,"pwm")?this._oscillator.modulationFrequency:void 0}asArray(t=1024){return qo(this,void 0,void 0,(function*(){return dc(this,t)}))}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}class Cc extends $a{constructor(){super(Object.assign(Ho(Cc.getDefaults(),arguments,["value"]))),this.override=!1,this.name="Add",this._sum=new Fa({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,Va(this._constantSource,this._sum)}static getDefaults(){return Object.assign($a.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}class Ec extends mc{constructor(){super(Object.assign(Ho(Ec.getDefaults(),arguments,["min","max"]))),this.name="Scale";const t=Ho(Ec.getDefaults(),arguments,["min","max"]);this._mult=this.input=new _c({context:this.context,value:t.max-t.min}),this._add=this.output=new Cc({context:this.context,value:t.min}),this._min=t.min,this._max=t.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(mc.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(t){this._min=t,this._setRange()}get max(){return this._max}set max(t){this._max=t,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}}class Sc extends mc{constructor(){super(Object.assign(Ho(Sc.getDefaults(),arguments))),this.name="Zero",this._gain=new Fa({context:this.context}),this.output=this._gain,this.input=void 0,La(this.context.getConstant(0),this._gain)}dispose(){return super.dispose(),qa(this.context.getConstant(0),this._gain),this}}class Mc extends Na{constructor(){super(Ho(Mc.getDefaults(),arguments,["frequency","min","max"])),this.name="LFO",this._stoppedValue=0,this._units="number",this.convert=!0,this._fromType=Ra.prototype._fromType,this._toType=Ra.prototype._toType,this._is=Ra.prototype._is,this._clampValue=Ra.prototype._clampValue;const t=Ho(Mc.getDefaults(),arguments,["frequency","min","max"]);this._oscillator=new fc(t),this.frequency=this._oscillator.frequency,this._amplitudeGain=new Fa({context:this.context,gain:t.amplitude,units:"normalRange"}),this.amplitude=this._amplitudeGain.gain,this._stoppedSignal=new $a({context:this.context,units:"audioRange",value:0}),this._zeros=new Sc({context:this.context}),this._a2g=new yc({context:this.context}),this._scaler=this.output=new Ec({context:this.context,max:t.max,min:t.min}),this.units=t.units,this.min=t.min,this.max=t.max,this._oscillator.chain(this._amplitudeGain,this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),la(this,["amplitude","frequency"]),this.phase=t.phase}static getDefaults(){return Object.assign(fc.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,type:"sine",units:"number"})}start(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(0,t),this._oscillator.start(t),this}stop(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(this._stoppedValue,t),this._oscillator.stop(t),this}sync(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}unsync(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}_setStoppedValue(){this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get min(){return this._toType(this._scaler.min)}set min(t){t=this._fromType(t),this._scaler.min=t}get max(){return this._toType(this._scaler.max)}set max(t){t=this._fromType(t),this._scaler.max=t}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t,this._setStoppedValue()}get partials(){return this._oscillator.partials}set partials(t){this._oscillator.partials=t,this._setStoppedValue()}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t,this._setStoppedValue()}get units(){return this._units}set units(t){const e=this.min,n=this.max;this._units=t,this.min=e,this.max=n}get state(){return this._oscillator.state}connect(t,e,n){return(t instanceof Ra||t instanceof $a)&&(this.convert=t.convert,this.units=t.units),Ga(this,t,e,n),this}dispose(){return super.dispose(),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}}function Ic(t,e=1/0){const n=new WeakMap;return function(s,i){Reflect.defineProperty(s,i,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(s){xo(s,t,e),n.set(this,s)}})}}function Dc(t,e=1/0){const n=new WeakMap;return function(s,i){Reflect.defineProperty(s,i,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(s){xo(this.toSeconds(s),t,e),n.set(this,s)}})}}class Pc extends cc{constructor(){super(Ho(Pc.getDefaults(),arguments,["url","onload"])),this.name="Player",this._activeSources=new Set;const t=Ho(Pc.getDefaults(),arguments,["url","onload"]);this._buffer=new pa({onload:this._onload.bind(this,t.onload),onerror:t.onerror,reverse:t.reverse,url:t.url}),this.autostart=t.autostart,this._loop=t.loop,this._loopStart=t.loopStart,this._loopEnd=t.loopEnd,this._playbackRate=t.playbackRate,this.fadeIn=t.fadeIn,this.fadeOut=t.fadeOut}static getDefaults(){return Object.assign(cc.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:da,onerror:da,playbackRate:1,reverse:!1})}load(t){return qo(this,void 0,void 0,(function*(){return yield this._buffer.load(t),this._onload(),this}))}_onload(t=da){t(),this.autostart&&this.start()}_onSourceEnd(t){this.onstop(this),this._activeSources.delete(t),0!==this._activeSources.size||this._synced||"started"!==this._state.getValueAtTime(this.now())||(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(t,e,n){return super.start(t,e,n),this}_start(t,e,n){e=this._loop?Ko(e,this._loopStart):Ko(e,0);const s=this.toSeconds(e),i=n;n=Ko(n,Math.max(this._buffer.duration-s,0));let r=this.toSeconds(n);r/=this._playbackRate,t=this.toSeconds(t);const o=new Ua({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);this._loop||this._synced||(this._state.cancel(t+r),this._state.setStateAtTime("stopped",t+r,{implicitEnd:!0})),this._activeSources.add(o),this._loop&&Eo(i)?o.start(t,s):o.start(t,s,r-this.toSeconds(this.fadeOut))}_stop(t){const e=this.toSeconds(t);this._activeSources.forEach((t=>t.stop(e)))}restart(t,e,n){return super.restart(t,e,n),this}_restart(t,e,n){this._stop(t),this._start(t,e,n)}seek(t,e){const n=this.toSeconds(e);if("started"===this._state.getValueAtTime(n)){const e=this.toSeconds(t);this._stop(n),this._start(n,e)}return this}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get loopStart(){return this._loopStart}set loopStart(t){this._loopStart=t,this.buffer.loaded&&xo(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach((e=>{e.loopStart=t}))}get loopEnd(){return this._loopEnd}set loopEnd(t){this._loopEnd=t,this.buffer.loaded&&xo(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach((e=>{e.loopEnd=t}))}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._loop}set loop(t){if(this._loop!==t&&(this._loop=t,this._activeSources.forEach((e=>{e.loop=t})),t)){const t=this._state.getNextState("stopped",this.now());t&&this._state.cancel(t.time)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t;const e=this.now(),n=this._state.getNextState("stopped",e);n&&n.implicitEnd&&(this._state.cancel(n.time),this._activeSources.forEach((t=>t.cancelStop()))),this._activeSources.forEach((n=>{n.playbackRate.setValueAtTime(t,e)}))}get reverse(){return this._buffer.reverse}set reverse(t){this._buffer.reverse=t}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach((t=>t.dispose())),this._activeSources.clear(),this._buffer.dispose(),this}}Lo([Dc(0)],Pc.prototype,"fadeIn",void 0),Lo([Dc(0)],Pc.prototype,"fadeOut",void 0);class Oc extends mc{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new gc({context:this.context,mapping:t=>2*Math.abs(t)-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Rc extends mc{constructor(){super(Object.assign(Ho(Rc.getDefaults(),arguments,["value"]))),this.name="Pow";const t=Ho(Rc.getDefaults(),arguments,["value"]);this._exponentScaler=this.input=this.output=new gc({context:this.context,mapping:this._expFunc(t.value),length:8192}),this._exponent=t.value}static getDefaults(){return Object.assign(mc.getDefaults(),{value:1})}_expFunc(t){return e=>Math.pow(Math.abs(e),t)}get value(){return this._exponent}set value(t){this._exponent=t,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class Nc extends Na{constructor(){super(Ho(Nc.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="Envelope",this._sig=new $a({context:this.context,value:0}),this.output=this._sig,this.input=void 0;const t=Ho(Nc.getDefaults(),arguments,["attack","decay","sustain","release"]);this.attack=t.attack,this.decay=t.decay,this.sustain=t.sustain,this.release=t.release,this.attackCurve=t.attackCurve,this.releaseCurve=t.releaseCurve,this.decayCurve=t.decayCurve}static getDefaults(){return Object.assign(Na.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(t,e){if(Oo(t))return t;{let n;for(n in Vc)if(Vc[n][e]===t)return n;return t}}_setCurve(t,e,n){if(Oo(n)&&Reflect.has(Vc,n)){const s=Vc[n];Io(s)?"_decayCurve"!==t&&(this[t]=s[e]):this[t]=s}else{if(!Po(n)||"_decayCurve"===t)throw new Error("Envelope: invalid curve: "+n);this[t]=n}}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(t){this._setCurve("_attackCurve","In",t)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(t){this._setCurve("_releaseCurve","Out",t)}get decayCurve(){return this._decayCurve}set decayCurve(t){To(["linear","exponential"].some((e=>e===t)),`Invalid envelope curve: ${t}`),this._decayCurve=t}triggerAttack(t,e=1){this.log("triggerAttack",t,e),t=this.toSeconds(t);let n=this.toSeconds(this.attack);const s=this.toSeconds(this.decay),i=this.getValueAtTime(t);if(i>0){n=(1-i)/(1/n)}if(n<this.sampleTime)this._sig.cancelScheduledValues(t),this._sig.setValueAtTime(e,t);else if("linear"===this._attackCurve)this._sig.linearRampTo(e,n,t);else if("exponential"===this._attackCurve)this._sig.targetRampTo(e,n,t);else{this._sig.cancelAndHoldAtTime(t);let s=this._attackCurve;for(let t=1;t<s.length;t++)if(s[t-1]<=i&&i<=s[t]){s=this._attackCurve.slice(t),s[0]=i;break}this._sig.setValueCurveAtTime(s,t,n,e)}if(s&&this.sustain<1){const i=e*this.sustain,r=t+n;this.log("decay",r),"linear"===this._decayCurve?this._sig.linearRampToValueAtTime(i,s+r):this._sig.exponentialApproachValueAtTime(i,r,s)}return this}triggerRelease(t){this.log("triggerRelease",t),t=this.toSeconds(t);const e=this.getValueAtTime(t);if(e>0){const n=this.toSeconds(this.release);n<this.sampleTime?this._sig.setValueAtTime(0,t):"linear"===this._releaseCurve?this._sig.linearRampTo(0,n,t):"exponential"===this._releaseCurve?this._sig.targetRampTo(0,n,t):(To(Po(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(t),this._sig.setValueCurveAtTime(this._releaseCurve,t,n,e))}return this}getValueAtTime(t){return this._sig.getValueAtTime(t)}triggerAttackRelease(t,e,n=1){return e=this.toSeconds(e),this.triggerAttack(e,n),this.triggerRelease(e+this.toSeconds(t)),this}cancel(t){return this._sig.cancelScheduledValues(this.toSeconds(t)),this}connect(t,e=0,n=0){return Ga(this,t,e,n),this}asArray(t=1024){return qo(this,void 0,void 0,(function*(){const e=t/this.context.sampleRate,n=new fa(1,e,this.context.sampleRate),s=this.toSeconds(this.attack)+this.toSeconds(this.decay),i=s+this.toSeconds(this.release),r=.1*i,o=i+r,a=new this.constructor(Object.assign(this.get(),{attack:e*this.toSeconds(this.attack)/o,decay:e*this.toSeconds(this.decay)/o,release:e*this.toSeconds(this.release)/o,context:n}));a._sig.toDestination(),a.triggerAttackRelease(e*(s+r)/o,0);return(yield n.render()).getChannelData(0)}))}dispose(){return super.dispose(),this._sig.dispose(),this}}Lo([Dc(0)],Nc.prototype,"attack",void 0),Lo([Dc(0)],Nc.prototype,"decay",void 0),Lo([Ic(0,1)],Nc.prototype,"sustain",void 0),Lo([Dc(0)],Nc.prototype,"release",void 0);const Vc=(()=>{const t=128;let e,n;const s=[];for(e=0;e<t;e++)s[e]=Math.sin(e/127*(Math.PI/2));const i=[];for(e=0;e<127;e++){n=e/127;const t=Math.sin(n*(2*Math.PI)*6.4-Math.PI/2)+1;i[e]=t/10+.83*n}i[127]=1;const r=[];for(e=0;e<t;e++)r[e]=Math.ceil(e/127*5)/5;const o=[];for(e=0;e<t;e++)n=e/127,o[e]=.5*(1-Math.cos(Math.PI*n));const a=[];for(e=0;e<t;e++){n=e/127;const t=4*Math.pow(n,3)+.2,s=Math.cos(t*Math.PI*2*n);a[e]=Math.abs(s*(1-n))}function c(t){const e=new Array(t.length);for(let n=0;n<t.length;n++)e[n]=1-t[n];return e}return{bounce:{In:c(a),Out:a},cosine:{In:s,Out:(h=s,h.slice(0).reverse())},exponential:"exponential",linear:"linear",ripple:{In:i,Out:c(i)},sine:{In:o,Out:c(o)},step:{In:r,Out:c(r)}};var h})();class Lc extends Na{constructor(){super(Ho(Lc.getDefaults(),arguments)),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease;const t=Ho(Lc.getDefaults(),arguments);this._volume=this.output=new nc({context:this.context,volume:t.volume}),this.volume=this._volume.volume,la(this,"volume")}static getDefaults(){return Object.assign(Na.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0)),this}_syncState(){let t=!1;return this._synced||(this._synced=!0,t=!0),t}_syncMethod(t,e){const n=this["_original_"+t]=this[t];this[t]=(...t)=>{const s=t[e],i=this.context.transport.schedule((s=>{t[e]=s,n.apply(this,t)}),s);this._scheduledEvents.push(i)}}unsync(){return this._scheduledEvents.forEach((t=>this.context.transport.clear(t))),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease),this}triggerAttackRelease(t,e,n,s){const i=this.toSeconds(n),r=this.toSeconds(e);return this.triggerAttack(t,i,s),this.triggerRelease(i+r),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class qc extends Lc{constructor(){super(Ho(qc.getDefaults(),arguments));const t=Ho(qc.getDefaults(),arguments);this.portamento=t.portamento,this.onsilence=t.onsilence}static getDefaults(){return Object.assign(Lc.getDefaults(),{detune:0,onsilence:da,portamento:0})}triggerAttack(t,e,n=1){this.log("triggerAttack",t,e,n);const s=this.toSeconds(e);return this._triggerEnvelopeAttack(s,n),this.setNote(t,s),this}triggerRelease(t){this.log("triggerRelease",t);const e=this.toSeconds(t);return this._triggerEnvelopeRelease(e),this}setNote(t,e){const n=this.toSeconds(e),s=t instanceof Ma?t.toFrequency():t;if(this.portamento>0&&this.getLevelAtTime(n)>.05){const t=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(s,t,n)}else this.frequency.setValueAtTime(s,n);return this}}Lo([Dc(0)],qc.prototype,"portamento",void 0);class Fc extends Nc{constructor(){super(Ho(Fc.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new Fa({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class jc extends qc{constructor(){super(Ho(jc.getDefaults(),arguments)),this.name="Synth";const t=Ho(jc.getDefaults(),arguments);this.oscillator=new kc(Object.assign({context:this.context,detune:t.detune,onstop:()=>this.onsilence(this)},t.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new Fc(Object.assign({context:this.context},t.envelope)),this.oscillator.chain(this.envelope,this.output),la(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(qc.getDefaults(),{envelope:Object.assign(Xo(Nc.getDefaults(),Object.keys(Na.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(Xo(kc.getDefaults(),[...Object.keys(cc.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(t,e){if(this.envelope.triggerAttack(t,e),this.oscillator.start(t),0===this.envelope.sustain){const e=this.toSeconds(this.envelope.attack),n=this.toSeconds(this.envelope.decay);this.oscillator.stop(t+e+n)}}_triggerEnvelopeRelease(t){this.envelope.triggerRelease(t),this.oscillator.stop(t+this.toSeconds(this.envelope.release))}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class Uc extends Na{constructor(){super(Ho(Uc.getDefaults(),arguments,["frequency","type"])),this.name="BiquadFilter";const t=Ho(Uc.getDefaults(),arguments,["frequency","type"]);this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new Ra({context:this.context,units:"number",value:t.Q,param:this._filter.Q}),this.frequency=new Ra({context:this.context,units:"frequency",value:t.frequency,param:this._filter.frequency}),this.detune=new Ra({context:this.context,units:"cents",value:t.detune,param:this._filter.detune}),this.gain=new Ra({context:this.context,units:"decibels",convert:!1,value:t.gain,param:this._filter.gain}),this.type=t.type}static getDefaults(){return Object.assign(Na.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(t){To(-1!==["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(t),`Invalid filter type: ${t}`),this._filter.type=t}getFrequencyResponse(t=128){const e=new Float32Array(t);for(let n=0;n<t;n++){const s=19980*Math.pow(n/t,2)+20;e[n]=s}const n=new Float32Array(t),s=new Float32Array(t),i=this.context.createBiquadFilter();return i.type=this.type,i.Q.value=this.Q.value,i.frequency.value=this.frequency.value,i.gain.value=this.gain.value,i.getFrequencyResponse(e,n,s),n}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}}class Bc extends Na{constructor(){super(Ho(Bc.getDefaults(),arguments,["frequency","type","rolloff"])),this.name="Filter",this.input=new Fa({context:this.context}),this.output=new Fa({context:this.context}),this._filters=[];const t=Ho(Bc.getDefaults(),arguments,["frequency","type","rolloff"]);this._filters=[],this.Q=new $a({context:this.context,units:"positive",value:t.Q}),this.frequency=new $a({context:this.context,units:"frequency",value:t.frequency}),this.detune=new $a({context:this.context,units:"cents",value:t.detune}),this.gain=new $a({context:this.context,units:"decibels",convert:!1,value:t.gain}),this._type=t.type,this.rolloff=t.rolloff,la(this,["detune","frequency","gain","Q"])}static getDefaults(){return Object.assign(Na.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}get type(){return this._type}set type(t){To(-1!==["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(t),`Invalid filter type: ${t}`),this._type=t,this._filters.forEach((e=>e.type=t))}get rolloff(){return this._rolloff}set rolloff(t){const e=Mo(t)?t:parseInt(t,10),n=[-12,-24,-48,-96];let s=n.indexOf(e);To(-1!==s,`rolloff can only be ${n.join(", ")}`),s+=1,this._rolloff=e,this.input.disconnect(),this._filters.forEach((t=>t.disconnect())),this._filters=new Array(s);for(let t=0;t<s;t++){const e=new Uc({context:this.context});e.type=this._type,this.frequency.connect(e.frequency),this.detune.connect(e.detune),this.Q.connect(e.Q),this.gain.connect(e.gain),this._filters[t]=e}this._internalChannels=this._filters,Va(this.input,...this._internalChannels,this.output)}getFrequencyResponse(t=128){const e=new Uc({frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),n=new Float32Array(t).map((()=>1));return this._filters.forEach((()=>{e.getFrequencyResponse(t).forEach(((t,e)=>n[e]*=t))})),e.dispose(),n}dispose(){return super.dispose(),this._filters.forEach((t=>{t.dispose()})),ua(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}}class zc extends Nc{constructor(){super(Ho(zc.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="FrequencyEnvelope";const t=Ho(zc.getDefaults(),arguments,["attack","decay","sustain","release"]);this._octaves=t.octaves,this._baseFrequency=this.toFrequency(t.baseFrequency),this._exponent=this.input=new Rc({context:this.context,value:t.exponent}),this._scale=this.output=new Ec({context:this.context,min:this._baseFrequency,max:this._baseFrequency*Math.pow(2,this._octaves)}),this._sig.chain(this._exponent,this._scale)}static getDefaults(){return Object.assign(Nc.getDefaults(),{baseFrequency:200,exponent:1,octaves:4})}get baseFrequency(){return this._baseFrequency}set baseFrequency(t){const e=this.toFrequency(t);xo(e,0),this._baseFrequency=e,this._scale.min=this._baseFrequency,this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(t){this._octaves=t,this._scale.max=this._baseFrequency*Math.pow(2,t)}get exponent(){return this._exponent.value}set exponent(t){this._exponent.value=t}dispose(){return super.dispose(),this._exponent.dispose(),this._scale.dispose(),this}}class Wc extends qc{constructor(){super(Ho(Wc.getDefaults(),arguments)),this.name="MonoSynth";const t=Ho(Wc.getDefaults(),arguments);this.oscillator=new kc(Object.assign(t.oscillator,{context:this.context,detune:t.detune,onstop:()=>this.onsilence(this)})),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.filter=new Bc(Object.assign(t.filter,{context:this.context})),this.filterEnvelope=new zc(Object.assign(t.filterEnvelope,{context:this.context})),this.envelope=new Fc(Object.assign(t.envelope,{context:this.context})),this.oscillator.chain(this.filter,this.envelope,this.output),this.filterEnvelope.connect(this.filter.frequency),la(this,["oscillator","frequency","detune","filter","filterEnvelope","envelope"])}static getDefaults(){return Object.assign(qc.getDefaults(),{envelope:Object.assign(Xo(Nc.getDefaults(),Object.keys(Na.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.9}),filter:Object.assign(Xo(Bc.getDefaults(),Object.keys(Na.getDefaults())),{Q:1,rolloff:-12,type:"lowpass"}),filterEnvelope:Object.assign(Xo(zc.getDefaults(),Object.keys(Na.getDefaults())),{attack:.6,baseFrequency:200,decay:.2,exponent:2,octaves:3,release:2,sustain:.5}),oscillator:Object.assign(Xo(kc.getDefaults(),Object.keys(cc.getDefaults())),{type:"sawtooth"})})}_triggerEnvelopeAttack(t,e=1){if(this.envelope.triggerAttack(t,e),this.filterEnvelope.triggerAttack(t),this.oscillator.start(t),0===this.envelope.sustain){const e=this.toSeconds(this.envelope.attack),n=this.toSeconds(this.envelope.decay);this.oscillator.stop(t+e+n)}}_triggerEnvelopeRelease(t){this.envelope.triggerRelease(t),this.filterEnvelope.triggerRelease(t),this.oscillator.stop(t+this.toSeconds(this.envelope.release))}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this.filterEnvelope.dispose(),this.filter.dispose(),this}}class $c extends qc{constructor(){super(Ho($c.getDefaults(),arguments)),this.name="DuoSynth";const t=Ho($c.getDefaults(),arguments);this.voice0=new Wc(Object.assign(t.voice0,{context:this.context,onsilence:()=>this.onsilence(this)})),this.voice1=new Wc(Object.assign(t.voice1,{context:this.context})),this.harmonicity=new _c({context:this.context,units:"positive",value:t.harmonicity}),this._vibrato=new Mc({frequency:t.vibratoRate,context:this.context,min:-50,max:50}),this._vibrato.start(),this.vibratoRate=this._vibrato.frequency,this._vibratoGain=new Fa({context:this.context,units:"normalRange",gain:t.vibratoAmount}),this.vibratoAmount=this._vibratoGain.gain,this.frequency=new $a({context:this.context,units:"frequency",value:440}),this.detune=new $a({context:this.context,units:"cents",value:t.detune}),this.frequency.connect(this.voice0.frequency),this.frequency.chain(this.harmonicity,this.voice1.frequency),this._vibrato.connect(this._vibratoGain),this._vibratoGain.fan(this.voice0.detune,this.voice1.detune),this.detune.fan(this.voice0.detune,this.voice1.detune),this.voice0.connect(this.output),this.voice1.connect(this.output),la(this,["voice0","voice1","frequency","vibratoAmount","vibratoRate"])}getLevelAtTime(t){return t=this.toSeconds(t),this.voice0.envelope.getValueAtTime(t)+this.voice1.envelope.getValueAtTime(t)}static getDefaults(){return Go(qc.getDefaults(),{vibratoAmount:.5,vibratoRate:5,harmonicity:1.5,voice0:Go(Xo(Wc.getDefaults(),Object.keys(qc.getDefaults())),{filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}}),voice1:Go(Xo(Wc.getDefaults(),Object.keys(qc.getDefaults())),{filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}})})}_triggerEnvelopeAttack(t,e){this.voice0._triggerEnvelopeAttack(t,e),this.voice1._triggerEnvelopeAttack(t,e)}_triggerEnvelopeRelease(t){return this.voice0._triggerEnvelopeRelease(t),this.voice1._triggerEnvelopeRelease(t),this}dispose(){return super.dispose(),this.voice0.dispose(),this.voice1.dispose(),this.frequency.dispose(),this.detune.dispose(),this._vibrato.dispose(),this.vibratoRate.dispose(),this._vibratoGain.dispose(),this.harmonicity.dispose(),this}}class Gc extends jc{constructor(){super(Ho(Gc.getDefaults(),arguments)),this.name="MembraneSynth",this.portamento=0;const t=Ho(Gc.getDefaults(),arguments);this.pitchDecay=t.pitchDecay,this.octaves=t.octaves,la(this,["oscillator","envelope"])}static getDefaults(){return Go(qc.getDefaults(),jc.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(t,e){const n=this.toSeconds(e),s=this.toFrequency(t instanceof Ma?t.toFrequency():t),i=s*this.octaves;return this.oscillator.frequency.setValueAtTime(i,n),this.oscillator.frequency.exponentialRampToValueAtTime(s,n+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}Lo([Ic(0)],Gc.prototype,"octaves",void 0),Lo([Dc(0)],Gc.prototype,"pitchDecay",void 0);class Hc extends Lc{constructor(){super(Ho(Hc.getDefaults(),arguments)),this.name="NoiseSynth";const t=Ho(Hc.getDefaults(),arguments);this.noise=new hc(Object.assign({context:this.context},t.noise)),this.envelope=new Fc(Object.assign({context:this.context},t.envelope)),this.noise.chain(this.envelope,this.output)}static getDefaults(){return Object.assign(Lc.getDefaults(),{envelope:Object.assign(Xo(Nc.getDefaults(),Object.keys(Na.getDefaults())),{decay:.1,sustain:0}),noise:Object.assign(Xo(hc.getDefaults(),Object.keys(cc.getDefaults())),{type:"white"})})}triggerAttack(t,e=1){return t=this.toSeconds(t),this.envelope.triggerAttack(t,e),this.noise.start(t),0===this.envelope.sustain&&this.noise.stop(t+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay)),this}triggerRelease(t){return t=this.toSeconds(t),this.envelope.triggerRelease(t),this.noise.stop(t+this.toSeconds(this.envelope.release)),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0)),this}triggerAttackRelease(t,e,n=1){return e=this.toSeconds(e),t=this.toSeconds(t),this.triggerAttack(e,n),this.triggerRelease(e+t),this}dispose(){return super.dispose(),this.noise.dispose(),this.envelope.dispose(),this}}const Kc=new Set;function Xc(t){Kc.add(t)}function Yc(t,e){const n=`registerProcessor("${t}", ${e})`;Kc.add(n)}class Qc extends Na{constructor(t){super(t),this.name="ToneAudioWorklet",this.workletOptions={},this.onprocessorerror=da;const e=URL.createObjectURL(new Blob([Array.from(Kc).join("\n")],{type:"text/javascript"})),n=this._audioWorkletName();this._dummyGain=this.context.createGain(),this._dummyParam=this._dummyGain.gain,this.context.addAudioWorkletModule(e,n).then((()=>{this.disposed||(this._worklet=this.context.createAudioWorkletNode(n,this.workletOptions),this._worklet.onprocessorerror=this.onprocessorerror.bind(this),this.onReady(this._worklet))}))}dispose(){return super.dispose(),this._dummyGain.disconnect(),this._worklet&&(this._worklet.port.postMessage("dispose"),this._worklet.disconnect()),this}}Xc('\n\t/**\n\t * The base AudioWorkletProcessor for use in Tone.js. Works with the [[ToneAudioWorklet]]. \n\t */\n\tclass ToneAudioWorkletProcessor extends AudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\t\n\t\t\tsuper(options);\n\t\t\t/**\n\t\t\t * If the processor was disposed or not. Keep alive until it\'s disposed.\n\t\t\t */\n\t\t\tthis.disposed = false;\n\t\t   \t/** \n\t\t\t * The number of samples in the processing block\n\t\t\t */\n\t\t\tthis.blockSize = 128;\n\t\t\t/**\n\t\t\t * the sample rate\n\t\t\t */\n\t\t\tthis.sampleRate = sampleRate;\n\n\t\t\tthis.port.onmessage = (event) => {\n\t\t\t\t// when it receives a dispose \n\t\t\t\tif (event.data === "dispose") {\n\t\t\t\t\tthis.disposed = true;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n');Xc("\n\t/**\n\t * Abstract class for a single input/output processor. \n\t * has a 'generate' function which processes one sample at a time\n\t */\n\tclass SingleIOProcessor extends ToneAudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(Object.assign(options, {\n\t\t\t\tnumberOfInputs: 1,\n\t\t\t\tnumberOfOutputs: 1\n\t\t\t}));\n\t\t\t/**\n\t\t\t * Holds the name of the parameter and a single value of that\n\t\t\t * parameter at the current sample\n\t\t\t * @type { [name: string]: number }\n\t\t\t */\n\t\t\tthis.params = {}\n\t\t}\n\n\t\t/**\n\t\t * Generate an output sample from the input sample and parameters\n\t\t * @abstract\n\t\t * @param input number\n\t\t * @param channel number\n\t\t * @param parameters { [name: string]: number }\n\t\t * @returns number\n\t\t */\n\t\tgenerate(){}\n\n\t\t/**\n\t\t * Update the private params object with the \n\t\t * values of the parameters at the given index\n\t\t * @param parameters { [name: string]: Float32Array },\n\t\t * @param index number\n\t\t */\n\t\tupdateParams(parameters, index) {\n\t\t\tfor (const paramName in parameters) {\n\t\t\t\tconst param = parameters[paramName];\n\t\t\t\tif (param.length > 1) {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][index];\n\t\t\t\t} else {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][0];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Process a single frame of the audio\n\t\t * @param inputs Float32Array[][]\n\t\t * @param outputs Float32Array[][]\n\t\t */\n\t\tprocess(inputs, outputs, parameters) {\n\t\t\tconst input = inputs[0];\n\t\t\tconst output = outputs[0];\n\t\t\t// get the parameter values\n\t\t\tconst channelCount = Math.max(input && input.length || 0, output.length);\n\t\t\tfor (let sample = 0; sample < this.blockSize; sample++) {\n\t\t\t\tthis.updateParams(parameters, sample);\n\t\t\t\tfor (let channel = 0; channel < channelCount; channel++) {\n\t\t\t\t\tconst inputSample = input && input.length ? input[channel][sample] : 0;\n\t\t\t\t\toutput[channel][sample] = this.generate(inputSample, channel, this.params);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn !this.disposed;\n\t\t}\n\t};\n");Xc("\n\t/**\n\t * A multichannel buffer for use within an AudioWorkletProcessor as a delay line\n\t */\n\tclass DelayLine {\n\t\t\n\t\tconstructor(size, channels) {\n\t\t\tthis.buffer = [];\n\t\t\tthis.writeHead = []\n\t\t\tthis.size = size;\n\n\t\t\t// create the empty channels\n\t\t\tfor (let i = 0; i < channels; i++) {\n\t\t\t\tthis.buffer[i] = new Float32Array(this.size);\n\t\t\t\tthis.writeHead[i] = 0;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Push a value onto the end\n\t\t * @param channel number\n\t\t * @param value number\n\t\t */\n\t\tpush(channel, value) {\n\t\t\tthis.writeHead[channel] += 1;\n\t\t\tif (this.writeHead[channel] > this.size) {\n\t\t\t\tthis.writeHead[channel] = 0;\n\t\t\t}\n\t\t\tthis.buffer[channel][this.writeHead[channel]] = value;\n\t\t}\n\n\t\t/**\n\t\t * Get the recorded value of the channel given the delay\n\t\t * @param channel number\n\t\t * @param delay number delay samples\n\t\t */\n\t\tget(channel, delay) {\n\t\t\tlet readHead = this.writeHead[channel] - Math.floor(delay);\n\t\t\tif (readHead < 0) {\n\t\t\t\treadHead += this.size;\n\t\t\t}\n\t\t\treturn this.buffer[channel][readHead];\n\t\t}\n\t}\n");Yc("feedback-comb-filter",'\n\tclass FeedbackCombFilterWorklet extends SingleIOProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(options);\n\t\t\tthis.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);\n\t\t}\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: "delayTime",\n\t\t\t\tdefaultValue: 0.1,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 1,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}, {\n\t\t\t\tname: "feedback",\n\t\t\t\tdefaultValue: 0.5,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 0.9999,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, channel, parameters) {\n\t\t\tconst delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);\n\t\t\tthis.delayLine.push(channel, input + delayedSample * parameters.feedback);\n\t\t\treturn delayedSample;\n\t\t}\n\t}\n');class Zc extends Qc{constructor(){super(Ho(Zc.getDefaults(),arguments,["delayTime","resonance"])),this.name="FeedbackCombFilter";const t=Ho(Zc.getDefaults(),arguments,["delayTime","resonance"]);this.input=new Fa({context:this.context}),this.output=new Fa({context:this.context}),this.delayTime=new Ra({context:this.context,value:t.delayTime,units:"time",minValue:0,maxValue:1,param:this._dummyParam,swappable:!0}),this.resonance=new Ra({context:this.context,value:t.resonance,units:"normalRange",param:this._dummyParam,swappable:!0}),la(this,["resonance","delayTime"])}_audioWorkletName(){return"feedback-comb-filter"}static getDefaults(){return Object.assign(Na.getDefaults(),{delayTime:.1,resonance:.5})}onReady(t){Va(this.input,t,this.output);const e=t.parameters.get("delayTime");this.delayTime.setParam(e);const n=t.parameters.get("feedback");this.resonance.setParam(n)}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.delayTime.dispose(),this.resonance.dispose(),this}}class Jc extends Na{constructor(){super(Ho(Jc.getDefaults(),arguments,["frequency","type"])),this.name="OnePoleFilter";const t=Ho(Jc.getDefaults(),arguments,["frequency","type"]);this._frequency=t.frequency,this._type=t.type,this.input=new Fa({context:this.context}),this.output=new Fa({context:this.context}),this._createFilter()}static getDefaults(){return Object.assign(Na.getDefaults(),{frequency:880,type:"lowpass"})}_createFilter(){const t=this._filter,e=this.toFrequency(this._frequency),n=1/(2*Math.PI*e);if("lowpass"===this._type){const t=1/(n*this.context.sampleRate),e=t-1;this._filter=this.context.createIIRFilter([t,0],[1,e])}else{const t=1/(n*this.context.sampleRate)-1;this._filter=this.context.createIIRFilter([1,-1],[1,t])}this.input.chain(this._filter,this.output),t&&this.context.setTimeout((()=>{this.disposed||(this.input.disconnect(t),t.disconnect())}),this.blockTime)}get frequency(){return this._frequency}set frequency(t){this._frequency=t,this._createFilter()}get type(){return this._type}set type(t){this._type=t,this._createFilter()}getFrequencyResponse(t=128){const e=new Float32Array(t);for(let n=0;n<t;n++){const s=19980*Math.pow(n/t,2)+20;e[n]=s}const n=new Float32Array(t),s=new Float32Array(t);return this._filter.getFrequencyResponse(e,n,s),n}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this._filter.disconnect(),this}}class th extends Na{constructor(){super(Ho(th.getDefaults(),arguments,["delayTime","resonance","dampening"])),this.name="LowpassCombFilter";const t=Ho(th.getDefaults(),arguments,["delayTime","resonance","dampening"]);this._combFilter=this.output=new Zc({context:this.context,delayTime:t.delayTime,resonance:t.resonance}),this.delayTime=this._combFilter.delayTime,this.resonance=this._combFilter.resonance,this._lowpass=this.input=new Jc({context:this.context,frequency:t.dampening,type:"lowpass"}),this._lowpass.connect(this._combFilter)}static getDefaults(){return Object.assign(Na.getDefaults(),{dampening:3e3,delayTime:.1,resonance:.5})}get dampening(){return this._lowpass.frequency}set dampening(t){this._lowpass.frequency=t}dispose(){return super.dispose(),this._combFilter.dispose(),this._lowpass.dispose(),this}}class eh extends Lc{constructor(){super(Ho(eh.getDefaults(),arguments)),this.name="PluckSynth";const t=Ho(eh.getDefaults(),arguments);this._noise=new hc({context:this.context,type:"pink"}),this.attackNoise=t.attackNoise,this._lfcf=new th({context:this.context,dampening:t.dampening,resonance:t.resonance}),this.resonance=t.resonance,this.release=t.release,this._noise.connect(this._lfcf),this._lfcf.connect(this.output)}static getDefaults(){return Go(Lc.getDefaults(),{attackNoise:1,dampening:4e3,resonance:.7,release:1})}get dampening(){return this._lfcf.dampening}set dampening(t){this._lfcf.dampening=t}triggerAttack(t,e){const n=this.toFrequency(t);e=this.toSeconds(e);const s=1/n;return this._lfcf.delayTime.setValueAtTime(s,e),this._noise.start(e),this._noise.stop(e+s*this.attackNoise),this._lfcf.resonance.cancelScheduledValues(e),this._lfcf.resonance.setValueAtTime(this.resonance,e),this}triggerRelease(t){return this._lfcf.resonance.linearRampTo(0,this.release,t),this}dispose(){return super.dispose(),this._noise.dispose(),this._lfcf.dispose(),this}}class nh extends Lc{constructor(){super(Ho(nh.getDefaults(),arguments,["voice","options"])),this.name="PolySynth",this._availableVoices=[],this._activeVoices=[],this._voices=[],this._gcTimeout=-1,this._averageActiveVoices=0;const t=Ho(nh.getDefaults(),arguments,["voice","options"]);To(!Mo(t.voice),"DEPRECATED: The polyphony count is no longer the first argument.");const e=t.voice.getDefaults();this.options=Object.assign(e,t.options),this.voice=t.voice,this.maxPolyphony=t.maxPolyphony,this._dummyVoice=this._getNextAvailableVoice();const n=this._voices.indexOf(this._dummyVoice);this._voices.splice(n,1),this._gcTimeout=this.context.setInterval(this._collectGarbage.bind(this),1)}static getDefaults(){return Object.assign(Lc.getDefaults(),{maxPolyphony:32,options:{},voice:jc})}get activeVoices(){return this._activeVoices.length}_makeVoiceAvailable(t){this._availableVoices.push(t);const e=this._activeVoices.findIndex((e=>e.voice===t));this._activeVoices.splice(e,1)}_getNextAvailableVoice(){if(this._availableVoices.length)return this._availableVoices.shift();if(this._voices.length<this.maxPolyphony){const t=new this.voice(Object.assign(this.options,{context:this.context,onsilence:this._makeVoiceAvailable.bind(this)}));return t.connect(this.output),this._voices.push(t),t}Co("Max polyphony exceeded. Note dropped.")}_collectGarbage(){if(this._averageActiveVoices=Math.max(.95*this._averageActiveVoices,this.activeVoices),this._availableVoices.length&&this._voices.length>Math.ceil(this._averageActiveVoices+1)){const t=this._availableVoices.shift(),e=this._voices.indexOf(t);this._voices.splice(e,1),this.context.isOffline||t.dispose()}}_triggerAttack(t,e,n){t.forEach((t=>{const s=new Za(this.context,t).toMidi(),i=this._getNextAvailableVoice();i&&(i.triggerAttack(t,e,n),this._activeVoices.push({midi:s,voice:i,released:!1}),this.log("triggerAttack",t,e))}))}_triggerRelease(t,e){t.forEach((t=>{const n=new Za(this.context,t).toMidi(),s=this._activeVoices.find((({midi:t,released:e})=>t===n&&!e));s&&(s.voice.triggerRelease(e),s.released=!0,this.log("triggerRelease",t,e))}))}_scheduleEvent(t,e,n,s){To(!this.disposed,"Synth was already disposed"),n<=this.now()?"attack"===t?this._triggerAttack(e,n,s):this._triggerRelease(e,n):this.context.setTimeout((()=>{this._scheduleEvent(t,e,n,s)}),n-this.now())}triggerAttack(t,e,n){Array.isArray(t)||(t=[t]);const s=this.toSeconds(e);return this._scheduleEvent("attack",t,s,n),this}triggerRelease(t,e){Array.isArray(t)||(t=[t]);const n=this.toSeconds(e);return this._scheduleEvent("release",t,n),this}triggerAttackRelease(t,e,n,s){const i=this.toSeconds(n);if(this.triggerAttack(t,i,s),Po(e)){To(Po(t),"If the duration is an array, the notes must also be an array");for(let n=0;n<t.length;n++){const s=e[Math.min(n,e.length-1)],r=this.toSeconds(s);To(r>0,"The duration must be greater than 0"),this.triggerRelease(t[n],i+r)}}else{const n=this.toSeconds(e);To(n>0,"The duration must be greater than 0"),this.triggerRelease(t,i+n)}return this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}set(t){const e=Xo(t,["onsilence","context"]);return this.options=Go(this.options,e),this._voices.forEach((t=>t.set(e))),this._dummyVoice.set(e),this}get(){return this._dummyVoice.get()}releaseAll(t){const e=this.toSeconds(t);return this._activeVoices.forEach((({voice:t})=>{t.triggerRelease(e)})),this}dispose(){return super.dispose(),this._dummyVoice.dispose(),this._voices.forEach((t=>t.dispose())),this._activeVoices=[],this._availableVoices=[],this.context.clearInterval(this._gcTimeout),this}}class sh extends Lc{constructor(){super(Ho(sh.getDefaults(),arguments,["urls","onload","baseUrl"],"urls")),this.name="Sampler",this._activeSources=new Map;const t=Ho(sh.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),e={};Object.keys(t.urls).forEach((n=>{const s=parseInt(n,10);if(To(Ro(n)||Mo(s)&&isFinite(s),`url key is neither a note or midi pitch: ${n}`),Ro(n)){const s=new Ma(this.context,n).toMidi();e[s]=t.urls[n]}else Mo(s)&&isFinite(s)&&(e[s]=t.urls[s])})),this._buffers=new va({urls:e,onload:t.onload,baseUrl:t.baseUrl,onerror:t.onerror}),this.attack=t.attack,this.release=t.release,this.curve=t.curve,this._buffers.loaded&&Promise.resolve().then(t.onload)}static getDefaults(){return Object.assign(Lc.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:da,onerror:da,release:.1,urls:{}})}_findClosest(t){let e=0;for(;e<96;){if(this._buffers.has(t+e))return-e;if(this._buffers.has(t-e))return e;e++}throw new Error(`No available buffers for note: ${t}`)}triggerAttack(t,e,n=1){return this.log("triggerAttack",t,e,n),Array.isArray(t)||(t=[t]),t.forEach((t=>{const s=ka(new Ma(this.context,t).toFrequency()),i=Math.round(s),r=s-i,o=this._findClosest(i),a=i-o,c=this._buffers.get(a),h=Ta(o+r),l=new Ua({url:c,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:h}).connect(this.output);l.start(e,0,c.duration/h,n),Po(this._activeSources.get(i))||this._activeSources.set(i,[]),this._activeSources.get(i).push(l),l.onended=()=>{if(this._activeSources&&this._activeSources.has(i)){const t=this._activeSources.get(i),e=t.indexOf(l);-1!==e&&t.splice(e,1)}}})),this}triggerRelease(t,e){return this.log("triggerRelease",t,e),Array.isArray(t)||(t=[t]),t.forEach((t=>{const n=new Ma(this.context,t).toMidi();if(this._activeSources.has(n)&&this._activeSources.get(n).length){const t=this._activeSources.get(n);e=this.toSeconds(e),t.forEach((t=>{t.stop(e)})),this._activeSources.set(n,[])}})),this}releaseAll(t){const e=this.toSeconds(t);return this._activeSources.forEach((t=>{for(;t.length;){t.shift().stop(e)}})),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(t,e,n,s=1){const i=this.toSeconds(n);return this.triggerAttack(t,i,s),Po(e)?(To(Po(t),"notes must be an array when duration is array"),t.forEach(((t,n)=>{const s=e[Math.min(n,e.length-1)];this.triggerRelease(t,i+this.toSeconds(s))}))):this.triggerRelease(t,i+this.toSeconds(e)),this}add(t,e,n){if(To(Ro(t)||isFinite(t),`note must be a pitch or midi: ${t}`),Ro(t)){const s=new Ma(this.context,t).toMidi();this._buffers.add(s,e,n)}else this._buffers.add(t,e,n);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach((t=>{t.forEach((t=>t.dispose()))})),this._activeSources.clear(),this}}Lo([Dc(0)],sh.prototype,"attack",void 0),Lo([Dc(0)],sh.prototype,"release",void 0);class ih extends Oa{constructor(){super(Ho(ih.getDefaults(),arguments,["callback","value"])),this.name="ToneEvent",this._state=new za("stopped"),this._startOffset=0;const t=Ho(ih.getDefaults(),arguments,["callback","value"]);this._loop=t.loop,this.callback=t.callback,this.value=t.value,this._loopStart=this.toTicks(t.loopStart),this._loopEnd=this.toTicks(t.loopEnd),this._playbackRate=t.playbackRate,this._probability=t.probability,this._humanize=t.humanize,this.mute=t.mute,this._playbackRate=t.playbackRate,this._state.increasing=!0,this._rescheduleEvents()}static getDefaults(){return Object.assign(Oa.getDefaults(),{callback:da,humanize:!1,loop:!1,loopEnd:"1m",loopStart:0,mute:!1,playbackRate:1,probability:1,value:null})}_rescheduleEvents(t=-1){this._state.forEachFrom(t,(t=>{let e;if("started"===t.state){-1!==t.id&&this.context.transport.clear(t.id);const n=t.time+Math.round(this.startOffset/this._playbackRate);if(!0===this._loop||Mo(this._loop)&&this._loop>1){e=1/0,Mo(this._loop)&&(e=this._loop*this._getLoopDuration());const s=this._state.getAfter(n);null!==s&&(e=Math.min(e,s.time-n)),e!==1/0&&(this._state.setStateAtTime("stopped",n+e+1,{id:-1}),e=new Ja(this.context,e));const i=new Ja(this.context,this._getLoopDuration());t.id=this.context.transport.scheduleRepeat(this._tick.bind(this),i,new Ja(this.context,n),e)}else t.id=this.context.transport.schedule(this._tick.bind(this),new Ja(this.context,n))}}))}get state(){return this._state.getValueAtTime(this.context.transport.ticks)}get startOffset(){return this._startOffset}set startOffset(t){this._startOffset=t}get probability(){return this._probability}set probability(t){this._probability=t}get humanize(){return this._humanize}set humanize(t){this._humanize=t}start(t){const e=this.toTicks(t);return"stopped"===this._state.getValueAtTime(e)&&(this._state.add({id:-1,state:"started",time:e}),this._rescheduleEvents(e)),this}stop(t){this.cancel(t);const e=this.toTicks(t);if("started"===this._state.getValueAtTime(e)){this._state.setStateAtTime("stopped",e,{id:-1});const t=this._state.getBefore(e);let n=e;null!==t&&(n=t.time),this._rescheduleEvents(n)}return this}cancel(t){t=Ko(t,-1/0);const e=this.toTicks(t);return this._state.forEachFrom(e,(t=>{this.context.transport.clear(t.id)})),this._state.cancel(e),this}_tick(t){const e=this.context.transport.getTicksAtTime(t);if(!this.mute&&"started"===this._state.getValueAtTime(e)){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){let e=.02;Do(this.humanize)||(e=this.toSeconds(this.humanize)),t+=(2*Math.random()-1)*e}this.callback(t,this.value)}}_getLoopDuration(){return Math.round((this._loopEnd-this._loopStart)/this._playbackRate)}get loop(){return this._loop}set loop(t){this._loop=t,this._rescheduleEvents()}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._rescheduleEvents()}get loopEnd(){return new Ja(this.context,this._loopEnd).toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t),this._loop&&this._rescheduleEvents()}get loopStart(){return new Ja(this.context,this._loopStart).toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t),this._loop&&this._rescheduleEvents()}get progress(){if(this._loop){const t=this.context.transport.ticks,e=this._state.get(t);if(null!==e&&"started"===e.state){const n=this._getLoopDuration();return(t-e.time)%n/n}return 0}return 0}dispose(){return super.dispose(),this.cancel(),this._state.dispose(),this}}class rh extends Oa{constructor(){super(Ho(rh.getDefaults(),arguments,["callback","interval"])),this.name="Loop";const t=Ho(rh.getDefaults(),arguments,["callback","interval"]);this._event=new ih({context:this.context,callback:this._tick.bind(this),loop:!0,loopEnd:t.interval,playbackRate:t.playbackRate,probability:t.probability}),this.callback=t.callback,this.iterations=t.iterations}static getDefaults(){return Object.assign(Oa.getDefaults(),{interval:"4n",callback:da,playbackRate:1,iterations:1/0,probability:1,mute:!1,humanize:!1})}start(t){return this._event.start(t),this}stop(t){return this._event.stop(t),this}cancel(t){return this._event.cancel(t),this}_tick(t){this.callback(t)}get state(){return this._event.state}get progress(){return this._event.progress}get interval(){return this._event.loopEnd}set interval(t){this._event.loopEnd=t}get playbackRate(){return this._event.playbackRate}set playbackRate(t){this._event.playbackRate=t}get humanize(){return this._event.humanize}set humanize(t){this._event.humanize=t}get probability(){return this._event.probability}set probability(t){this._event.probability=t}get mute(){return this._event.mute}set mute(t){this._event.mute=t}get iterations(){return!0===this._event.loop?1/0:this._event.loop}set iterations(t){this._event.loop=t===1/0||t}dispose(){return super.dispose(),this._event.dispose(),this}}class oh extends ih{constructor(){super(Ho(oh.getDefaults(),arguments,["callback","events"])),this.name="Part",this._state=new za("stopped"),this._events=new Set;const t=Ho(oh.getDefaults(),arguments,["callback","events"]);this._state.increasing=!0,t.events.forEach((t=>{Po(t)?this.add(t[0],t[1]):this.add(t)}))}static getDefaults(){return Object.assign(ih.getDefaults(),{events:[]})}start(t,e){const n=this.toTicks(t);if("started"!==this._state.getValueAtTime(n)){e=Ko(e,this._loop?this._loopStart:0),e=this._loop?Ko(e,this._loopStart):Ko(e,0);const t=this.toTicks(e);this._state.add({id:-1,offset:t,state:"started",time:n}),this._forEach((e=>{this._startNote(e,n,t)}))}return this}_startNote(t,e,n){e-=n,this._loop?t.startOffset>=this._loopStart&&t.startOffset<this._loopEnd?(t.startOffset<n&&(e+=this._getLoopDuration()),t.start(new Ja(this.context,e))):t.startOffset<this._loopStart&&t.startOffset>=n&&(t.loop=!1,t.start(new Ja(this.context,e))):t.startOffset>=n&&t.start(new Ja(this.context,e))}get startOffset(){return this._startOffset}set startOffset(t){this._startOffset=t,this._forEach((t=>{t.startOffset+=this._startOffset}))}stop(t){const e=this.toTicks(t);return this._state.cancel(e),this._state.setStateAtTime("stopped",e),this._forEach((e=>{e.stop(t)})),this}at(t,e){const n=new Pa(this.context,t).toTicks(),s=new Ja(this.context,1).toSeconds(),i=this._events.values();let r=i.next();for(;!r.done;){const t=r.value;if(Math.abs(n-t.startOffset)<s)return So(e)&&(t.value=e),t;r=i.next()}return So(e)?(this.add(t,e),this.at(t)):null}add(t,e){t instanceof Object&&Reflect.has(t,"time")&&(t=(e=t).time);const n=this.toTicks(t);let s;return e instanceof ih?(s=e,s.callback=this._tick.bind(this)):s=new ih({callback:this._tick.bind(this),context:this.context,value:e}),s.startOffset=n,s.set({humanize:this.humanize,loop:this.loop,loopEnd:this.loopEnd,loopStart:this.loopStart,playbackRate:this.playbackRate,probability:this.probability}),this._events.add(s),this._restartEvent(s),this}_restartEvent(t){this._state.forEach((e=>{"started"===e.state?this._startNote(t,e.time,e.offset):t.stop(new Ja(this.context,e.time))}))}remove(t,e){return Io(t)&&t.hasOwnProperty("time")&&(t=(e=t).time),t=this.toTicks(t),this._events.forEach((n=>{n.startOffset===t&&(Eo(e)||So(e)&&n.value===e)&&(this._events.delete(n),n.dispose())})),this}clear(){return this._forEach((t=>t.dispose())),this._events.clear(),this}cancel(t){return this._forEach((e=>e.cancel(t))),this._state.cancel(this.toTicks(t)),this}_forEach(t){return this._events&&this._events.forEach((e=>{e instanceof oh?e._forEach(t):t(e)})),this}_setAll(t,e){this._forEach((n=>{n[t]=e}))}_tick(t,e){this.mute||this.callback(t,e)}_testLoopBoundries(t){this._loop&&(t.startOffset<this._loopStart||t.startOffset>=this._loopEnd)?t.cancel(0):"stopped"===t.state&&this._restartEvent(t)}get probability(){return this._probability}set probability(t){this._probability=t,this._setAll("probability",t)}get humanize(){return this._humanize}set humanize(t){this._humanize=t,this._setAll("humanize",t)}get loop(){return this._loop}set loop(t){this._loop=t,this._forEach((e=>{e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.loop=t,this._testLoopBoundries(e)}))}get loopEnd(){return new Ja(this.context,this._loopEnd).toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t),this._loop&&this._forEach((e=>{e.loopEnd=t,this._testLoopBoundries(e)}))}get loopStart(){return new Ja(this.context,this._loopStart).toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t),this._loop&&this._forEach((t=>{t.loopStart=this.loopStart,this._testLoopBoundries(t)}))}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._setAll("playbackRate",t)}get length(){return this._events.size}dispose(){return super.dispose(),this.clear(),this}}function*ah(t){let e=0;for(;e<t.length;)e=lh(e,t),yield t[e],e++}function*ch(t){let e=t.length-1;for(;e>=0;)e=lh(e,t),yield t[e],e--}function*hh(t,e){for(;;)yield*e(t)}function lh(t,e){return ea(t,0,e.length-1)}function*uh(t,e){let n=e?0:t.length-1;for(;;)n=lh(n,t),yield t[n],e?(n++,n>=t.length-1&&(e=!1)):(n--,n<=0&&(e=!0))}function*dh(t){let e=0,n=0;for(;e<t.length;)e=lh(e,t),yield t[e],n++,e+=n%2?2:-1}function*ph(t){let e=t.length-1,n=0;for(;e>=0;)e=lh(e,t),yield t[e],n++,e+=n%2?-2:1}function*fh(t){const e=[];for(let n=0;n<t.length;n++)e.push(n);for(;e.length>0;){const n=lh(e.splice(Math.floor(e.length*Math.random()),1)[0],t);yield t[n]}}function*mh(t,e="up",n=0){switch(To(t.length>0,"The array must have more than one value in it"),e){case"up":yield*hh(t,ah);case"down":yield*hh(t,ch);case"upDown":yield*uh(t,!0);case"downUp":yield*uh(t,!1);case"alternateUp":yield*hh(t,dh);case"alternateDown":yield*hh(t,ph);case"random":yield*function*(t){for(;;){const e=Math.floor(Math.random()*t.length);yield t[e]}}(t);case"randomOnce":yield*hh(t,fh);case"randomWalk":yield*function*(t){let e=Math.floor(Math.random()*t.length);for(;;)0===e?e++:e===t.length-1||Math.random()<.5?e--:e++,yield t[e]}(t)}}class gh extends rh{constructor(){super(Ho(gh.getDefaults(),arguments,["callback","values","pattern"])),this.name="Pattern";const t=Ho(gh.getDefaults(),arguments,["callback","values","pattern"]);this.callback=t.callback,this._values=t.values,this._pattern=mh(t.values,t.pattern),this._type=t.pattern}static getDefaults(){return Object.assign(rh.getDefaults(),{pattern:"up",values:[],callback:da})}_tick(t){const e=this._pattern.next();this._value=e.value,this.callback(t,this._value)}get values(){return this._values}set values(t){this._values=t,this.pattern=this._type}get value(){return this._value}get pattern(){return this._type}set pattern(t){this._type=t,this._pattern=mh(this._values,this._type)}}class yh extends Na{constructor(){super(Object.assign(Ho(yh.getDefaults(),arguments,["fade"]))),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new Oc({context:this.context}),this.a=new Fa({context:this.context,gain:0}),this.b=new Fa({context:this.context,gain:0}),this.output=new Fa({context:this.context}),this._internalChannels=[this.a,this.b];const t=Ho(yh.getDefaults(),arguments,["fade"]);this.fade=new $a({context:this.context,units:"normalRange",value:t.fade}),la(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",La(this._split,this.a.gain,0),La(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(Na.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}class _h extends Na{constructor(t){super(t),this.name="Effect",this._dryWet=new yh({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new Fa({context:this.context}),this.effectReturn=new Fa({context:this.context}),this.input=new Fa({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(t.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],la(this,"wet")}static getDefaults(){return Object.assign(Na.getDefaults(),{wet:1})}connectEffect(t){return this._internalChannels.push(t),this.effectSend.chain(t,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}}class vh extends Na{constructor(){super(Object.assign(Ho(vh.getDefaults(),arguments,["pan"]))),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner;const t=Ho(vh.getDefaults(),arguments,["pan"]);this.pan=new Ra({context:this.context,param:this._panner.pan,value:t.pan,minValue:-1,maxValue:1}),this._panner.channelCount=t.channelCount,this._panner.channelCountMode="explicit",la(this,"pan")}static getDefaults(){return Object.assign(Na.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}Yc("bit-crusher","\n\tclass BitCrusherWorklet extends SingleIOProcessor {\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: \"bits\",\n\t\t\t\tdefaultValue: 12,\n\t\t\t\tminValue: 1,\n\t\t\t\tmaxValue: 16,\n\t\t\t\tautomationRate: 'k-rate'\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, _channel, parameters) {\n\t\t\tconst step = Math.pow(0.5, parameters.bits - 1);\n\t\t\tconst val = step * Math.floor(input / step + 0.5);\n\t\t\treturn val;\n\t\t}\n\t}\n");class wh extends Na{constructor(){super(Ho(wh.getDefaults(),arguments,["channels"])),this.name="Split";const t=Ho(wh.getDefaults(),arguments,["channels"]);this._splitter=this.input=this.output=this.context.createChannelSplitter(t.channels),this._internalChannels=[this._splitter]}static getDefaults(){return Object.assign(Na.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._splitter.disconnect(),this}}class bh extends Na{constructor(){super(Ho(bh.getDefaults(),arguments,["channels"])),this.name="Merge";const t=Ho(bh.getDefaults(),arguments,["channels"]);this._merger=this.output=this.input=this.context.createChannelMerger(t.channels)}static getDefaults(){return Object.assign(Na.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}}class Th extends Na{constructor(t){super(t),this.name="StereoEffect",this.input=new Fa({context:this.context}),this.input.channelCount=2,this.input.channelCountMode="explicit",this._dryWet=this.output=new yh({context:this.context,fade:t.wet}),this.wet=this._dryWet.fade,this._split=new wh({context:this.context,channels:2}),this._merge=new bh({context:this.context,channels:2}),this.input.connect(this._split),this.input.connect(this._dryWet.a),this._merge.connect(this._dryWet.b),la(this,["wet"])}connectEffectLeft(...t){this._split.connect(t[0],0,0),Va(...t),La(t[t.length-1],this._merge,0,0)}connectEffectRight(...t){this._split.connect(t[0],1,0),Va(...t),La(t[t.length-1],this._merge,0,1)}static getDefaults(){return Object.assign(Na.getDefaults(),{wet:1})}dispose(){return super.dispose(),this._dryWet.dispose(),this._split.dispose(),this._merge.dispose(),this}}class xh extends Th{constructor(t){super(t),this.feedback=new $a({context:this.context,value:t.feedback,units:"normalRange"}),this._feedbackL=new Fa({context:this.context}),this._feedbackR=new Fa({context:this.context}),this._feedbackSplit=new wh({context:this.context,channels:2}),this._feedbackMerge=new bh({context:this.context,channels:2}),this._merge.connect(this._feedbackSplit),this._feedbackMerge.connect(this._split),this._feedbackSplit.connect(this._feedbackL,0,0),this._feedbackL.connect(this._feedbackMerge,0,0),this._feedbackSplit.connect(this._feedbackR,1,0),this._feedbackR.connect(this._feedbackMerge,0,1),this.feedback.fan(this._feedbackL.gain,this._feedbackR.gain),la(this,["feedback"])}static getDefaults(){return Object.assign(Th.getDefaults(),{feedback:.5})}dispose(){return super.dispose(),this.feedback.dispose(),this._feedbackL.dispose(),this._feedbackR.dispose(),this._feedbackSplit.dispose(),this._feedbackMerge.dispose(),this}}class Ah extends xh{constructor(){super(Ho(Ah.getDefaults(),arguments,["frequency","delayTime","depth"])),this.name="Chorus";const t=Ho(Ah.getDefaults(),arguments,["frequency","delayTime","depth"]);this._depth=t.depth,this._delayTime=t.delayTime/1e3,this._lfoL=new Mc({context:this.context,frequency:t.frequency,min:0,max:1}),this._lfoR=new Mc({context:this.context,frequency:t.frequency,min:0,max:1,phase:180}),this._delayNodeL=new Qa({context:this.context}),this._delayNodeR=new Qa({context:this.context}),this.frequency=this._lfoL.frequency,la(this,["frequency"]),this._lfoL.frequency.connect(this._lfoR.frequency),this.connectEffectLeft(this._delayNodeL),this.connectEffectRight(this._delayNodeR),this._lfoL.connect(this._delayNodeL.delayTime),this._lfoR.connect(this._delayNodeR.delayTime),this.depth=this._depth,this.type=t.type,this.spread=t.spread}static getDefaults(){return Object.assign(xh.getDefaults(),{frequency:1.5,delayTime:3.5,depth:.7,type:"sine",spread:180,feedback:0,wet:.5})}get depth(){return this._depth}set depth(t){this._depth=t;const e=this._delayTime*t;this._lfoL.min=Math.max(this._delayTime-e,0),this._lfoL.max=this._delayTime+e,this._lfoR.min=Math.max(this._delayTime-e,0),this._lfoR.max=this._delayTime+e}get delayTime(){return 1e3*this._delayTime}set delayTime(t){this._delayTime=t/1e3,this.depth=this._depth}get type(){return this._lfoL.type}set type(t){this._lfoL.type=t,this._lfoR.type=t}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(t){this._lfoL.phase=90-t/2,this._lfoR.phase=t/2+90}start(t){return this._lfoL.start(t),this._lfoR.start(t),this}stop(t){return this._lfoL.stop(t),this._lfoR.stop(t),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._delayNodeL.dispose(),this._delayNodeR.dispose(),this.frequency.dispose(),this}}class kh extends _h{constructor(){super(Ho(kh.getDefaults(),arguments,["distortion"])),this.name="Distortion";const t=Ho(kh.getDefaults(),arguments,["distortion"]);this._shaper=new gc({context:this.context,length:4096}),this._distortion=t.distortion,this.connectEffect(this._shaper),this.distortion=t.distortion,this.oversample=t.oversample}static getDefaults(){return Object.assign(_h.getDefaults(),{distortion:.4,oversample:"none"})}get distortion(){return this._distortion}set distortion(t){this._distortion=t;const e=100*t,n=Math.PI/180;this._shaper.setMap((t=>Math.abs(t)<.001?0:(3+e)*t*20*n/(Math.PI+e*Math.abs(t))))}get oversample(){return this._shaper.oversample}set oversample(t){this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.dispose(),this}}class Ch extends _h{constructor(t){super(t),this.name="FeedbackEffect",this._feedbackGain=new Fa({context:this.context,gain:t.feedback,units:"normalRange"}),this.feedback=this._feedbackGain.gain,la(this,"feedback"),this.effectReturn.chain(this._feedbackGain,this.effectSend)}static getDefaults(){return Object.assign(_h.getDefaults(),{feedback:.125})}dispose(){return super.dispose(),this._feedbackGain.dispose(),this.feedback.dispose(),this}}class Eh extends Ch{constructor(){super(Ho(Eh.getDefaults(),arguments,["delayTime","feedback"])),this.name="FeedbackDelay";const t=Ho(Eh.getDefaults(),arguments,["delayTime","feedback"]);this._delayNode=new Qa({context:this.context,delayTime:t.delayTime,maxDelay:t.maxDelay}),this.delayTime=this._delayNode.delayTime,this.connectEffect(this._delayNode),la(this,"delayTime")}static getDefaults(){return Object.assign(Ch.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._delayNode.dispose(),this.delayTime.dispose(),this}}class Sh extends xh{constructor(t){super(t),this._feedbackL.disconnect(),this._feedbackL.connect(this._feedbackMerge,0,1),this._feedbackR.disconnect(),this._feedbackR.connect(this._feedbackMerge,0,0),la(this,["feedback"])}}class Mh extends Sh{constructor(){super(Ho(Mh.getDefaults(),arguments,["delayTime","feedback"])),this.name="PingPongDelay";const t=Ho(Mh.getDefaults(),arguments,["delayTime","feedback"]);this._leftDelay=new Qa({context:this.context,maxDelay:t.maxDelay}),this._rightDelay=new Qa({context:this.context,maxDelay:t.maxDelay}),this._rightPreDelay=new Qa({context:this.context,maxDelay:t.maxDelay}),this.delayTime=new $a({context:this.context,units:"time",value:t.delayTime}),this.connectEffectLeft(this._leftDelay),this.connectEffectRight(this._rightPreDelay,this._rightDelay),this.delayTime.fan(this._leftDelay.delayTime,this._rightDelay.delayTime,this._rightPreDelay.delayTime),this._feedbackL.disconnect(),this._feedbackL.connect(this._rightDelay),la(this,["delayTime"])}static getDefaults(){return Object.assign(Sh.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._leftDelay.dispose(),this._rightDelay.dispose(),this._rightPreDelay.dispose(),this.delayTime.dispose(),this}}class Ih extends Th{constructor(){super(Ho(Ih.getDefaults(),arguments,["frequency","octaves","baseFrequency"])),this.name="Phaser";const t=Ho(Ih.getDefaults(),arguments,["frequency","octaves","baseFrequency"]);this._lfoL=new Mc({context:this.context,frequency:t.frequency,min:0,max:1}),this._lfoR=new Mc({context:this.context,frequency:t.frequency,min:0,max:1,phase:180}),this._baseFrequency=this.toFrequency(t.baseFrequency),this._octaves=t.octaves,this.Q=new $a({context:this.context,value:t.Q,units:"positive"}),this._filtersL=this._makeFilters(t.stages,this._lfoL),this._filtersR=this._makeFilters(t.stages,this._lfoR),this.frequency=this._lfoL.frequency,this.frequency.value=t.frequency,this.connectEffectLeft(...this._filtersL),this.connectEffectRight(...this._filtersR),this._lfoL.frequency.connect(this._lfoR.frequency),this.baseFrequency=t.baseFrequency,this.octaves=t.octaves,this._lfoL.start(),this._lfoR.start(),la(this,["frequency","Q"])}static getDefaults(){return Object.assign(Th.getDefaults(),{frequency:.5,octaves:3,stages:10,Q:10,baseFrequency:350})}_makeFilters(t,e){const n=[];for(let s=0;s<t;s++){const t=this.context.createBiquadFilter();t.type="allpass",this.Q.connect(t.Q),e.connect(t.frequency),n.push(t)}return n}get octaves(){return this._octaves}set octaves(t){this._octaves=t;const e=this._baseFrequency*Math.pow(2,t);this._lfoL.max=e,this._lfoR.max=e}get baseFrequency(){return this._baseFrequency}set baseFrequency(t){this._baseFrequency=this.toFrequency(t),this._lfoL.min=this._baseFrequency,this._lfoR.min=this._baseFrequency,this.octaves=this._octaves}dispose(){return super.dispose(),this.Q.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._filtersL.forEach((t=>t.disconnect())),this._filtersR.forEach((t=>t.disconnect())),this.frequency.dispose(),this}}class Dh extends _h{constructor(){super(Ho(Dh.getDefaults(),arguments,["decay"])),this.name="Reverb",this._convolver=this.context.createConvolver(),this.ready=Promise.resolve();const t=Ho(Dh.getDefaults(),arguments,["decay"]);this._decay=t.decay,this._preDelay=t.preDelay,this.generate(),this.connectEffect(this._convolver)}static getDefaults(){return Object.assign(_h.getDefaults(),{decay:1.5,preDelay:.01})}get decay(){return this._decay}set decay(t){xo(t=this.toSeconds(t),.001),this._decay=t,this.generate()}get preDelay(){return this._preDelay}set preDelay(t){xo(t=this.toSeconds(t),0),this._preDelay=t,this.generate()}generate(){return qo(this,void 0,void 0,(function*(){const t=this.ready,e=new fa(2,this._decay+this._preDelay,this.context.sampleRate),n=new hc({context:e}),s=new hc({context:e}),i=new bh({context:e});n.connect(i,0,0),s.connect(i,0,1);const r=new Fa({context:e}).toDestination();i.connect(r),n.start(0),s.start(0),r.gain.setValueAtTime(0,0),r.gain.setValueAtTime(1,this._preDelay),r.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay);const o=e.render();return this.ready=o.then(da),yield t,this._convolver.buffer=(yield o).get(),this}))}dispose(){return super.dispose(),this._convolver.disconnect(),this}}class Ph extends Th{constructor(){super(Ho(Ph.getDefaults(),arguments,["frequency","depth"])),this.name="Tremolo";const t=Ho(Ph.getDefaults(),arguments,["frequency","depth"]);this._lfoL=new Mc({context:this.context,type:t.type,min:1,max:0}),this._lfoR=new Mc({context:this.context,type:t.type,min:1,max:0}),this._amplitudeL=new Fa({context:this.context}),this._amplitudeR=new Fa({context:this.context}),this.frequency=new $a({context:this.context,value:t.frequency,units:"frequency"}),this.depth=new $a({context:this.context,value:t.depth,units:"normalRange"}),la(this,["frequency","depth"]),this.connectEffectLeft(this._amplitudeL),this.connectEffectRight(this._amplitudeR),this._lfoL.connect(this._amplitudeL.gain),this._lfoR.connect(this._amplitudeR.gain),this.frequency.fan(this._lfoL.frequency,this._lfoR.frequency),this.depth.fan(this._lfoR.amplitude,this._lfoL.amplitude),this.spread=t.spread}static getDefaults(){return Object.assign(Th.getDefaults(),{frequency:10,type:"sine",depth:.5,spread:180})}start(t){return this._lfoL.start(t),this._lfoR.start(t),this}stop(t){return this._lfoL.stop(t),this._lfoR.stop(t),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this.context.transport.syncSignal(this.frequency),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this.context.transport.unsyncSignal(this.frequency),this}get type(){return this._lfoL.type}set type(t){this._lfoL.type=t,this._lfoR.type=t}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(t){this._lfoL.phase=90-t/2,this._lfoR.phase=t/2+90}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._amplitudeL.dispose(),this._amplitudeR.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class Oh extends _h{constructor(){super(Ho(Oh.getDefaults(),arguments,["frequency","depth"])),this.name="Vibrato";const t=Ho(Oh.getDefaults(),arguments,["frequency","depth"]);this._delayNode=new Qa({context:this.context,delayTime:0,maxDelay:t.maxDelay}),this._lfo=new Mc({context:this.context,type:t.type,min:0,max:t.maxDelay,frequency:t.frequency,phase:-90}).start().connect(this._delayNode.delayTime),this.frequency=this._lfo.frequency,this.depth=this._lfo.amplitude,this.depth.value=t.depth,la(this,["frequency","depth"]),this.effectSend.chain(this._delayNode,this.effectReturn)}static getDefaults(){return Object.assign(_h.getDefaults(),{maxDelay:.005,frequency:5,depth:.1,type:"sine"})}get type(){return this._lfo.type}set type(t){this._lfo.type=t}dispose(){return super.dispose(),this._delayNode.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class Rh extends Na{constructor(){super(Ho(Rh.getDefaults(),arguments,["solo"])),this.name="Solo";const t=Ho(Rh.getDefaults(),arguments,["solo"]);this.input=this.output=new Fa({context:this.context}),Rh._allSolos.has(this.context)||Rh._allSolos.set(this.context,new Set),Rh._allSolos.get(this.context).add(this),this.solo=t.solo}static getDefaults(){return Object.assign(Na.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(t){t?this._addSolo():this._removeSolo(),Rh._allSolos.get(this.context).forEach((t=>t._updateSolo()))}get muted(){return 0===this.input.gain.value}_addSolo(){Rh._soloed.has(this.context)||Rh._soloed.set(this.context,new Set),Rh._soloed.get(this.context).add(this)}_removeSolo(){Rh._soloed.has(this.context)&&Rh._soloed.get(this.context).delete(this)}_isSoloed(){return Rh._soloed.has(this.context)&&Rh._soloed.get(this.context).has(this)}_noSolos(){return!Rh._soloed.has(this.context)||Rh._soloed.has(this.context)&&0===Rh._soloed.get(this.context).size}_updateSolo(){this._isSoloed()||this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),Rh._allSolos.get(this.context).delete(this),this._removeSolo(),this}}Rh._allSolos=new Map,Rh._soloed=new Map;class Nh extends Na{constructor(){super(Ho(Nh.getDefaults(),arguments,["pan","volume"])),this.name="PanVol";const t=Ho(Nh.getDefaults(),arguments,["pan","volume"]);this._panner=this.input=new vh({context:this.context,pan:t.pan,channelCount:t.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new nc({context:this.context,volume:t.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=t.mute,la(this,["pan","volume"])}static getDefaults(){return Object.assign(Na.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class Vh extends Na{constructor(){super(Ho(Vh.getDefaults(),arguments,["volume","pan"])),this.name="Channel";const t=Ho(Vh.getDefaults(),arguments,["volume","pan"]);this._solo=this.input=new Rh({solo:t.solo,context:this.context}),this._panVol=this.output=new Nh({context:this.context,pan:t.pan,volume:t.volume,mute:t.mute,channelCount:t.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),la(this,["pan","volume"])}static getDefaults(){return Object.assign(Na.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(t){this._solo.solo=t}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(t){this._panVol.mute=t}_getBus(t){return Vh.buses.has(t)||Vh.buses.set(t,new Fa({context:this.context})),Vh.buses.get(t)}send(t,e=0){const n=this._getBus(t),s=new Fa({context:this.context,units:"decibels",gain:e});return this.connect(s),s.connect(n),s}receive(t){return this._getBus(t).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}Vh.buses=new Map;class Lh extends Na{constructor(){super(Ho(Lh.getDefaults(),arguments)),this.name="Mono",this.input=new Fa({context:this.context}),this._merge=this.output=new bh({channels:2,context:this.context}),this.input.connect(this._merge,0,0),this.input.connect(this._merge,0,1)}dispose(){return super.dispose(),this._merge.dispose(),this.input.dispose(),this}}class qh extends Na{constructor(){super(...arguments),this.name="Listener",this.positionX=new Ra({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new Ra({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new Ra({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new Ra({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new Ra({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new Ra({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new Ra({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new Ra({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new Ra({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(Na.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}ia((t=>{t.listener=new qh({context:t})})),oa((t=>{t.listener.dispose()}));class Fh extends Na{constructor(){super(Ho(Fh.getDefaults(),arguments,["threshold","ratio"])),this.name="Compressor",this._compressor=this.context.createDynamicsCompressor(),this.input=this._compressor,this.output=this._compressor;const t=Ho(Fh.getDefaults(),arguments,["threshold","ratio"]);this.threshold=new Ra({minValue:this._compressor.threshold.minValue,maxValue:this._compressor.threshold.maxValue,context:this.context,convert:!1,param:this._compressor.threshold,units:"decibels",value:t.threshold}),this.attack=new Ra({minValue:this._compressor.attack.minValue,maxValue:this._compressor.attack.maxValue,context:this.context,param:this._compressor.attack,units:"time",value:t.attack}),this.release=new Ra({minValue:this._compressor.release.minValue,maxValue:this._compressor.release.maxValue,context:this.context,param:this._compressor.release,units:"time",value:t.release}),this.knee=new Ra({minValue:this._compressor.knee.minValue,maxValue:this._compressor.knee.maxValue,context:this.context,convert:!1,param:this._compressor.knee,units:"decibels",value:t.knee}),this.ratio=new Ra({minValue:this._compressor.ratio.minValue,maxValue:this._compressor.ratio.maxValue,context:this.context,convert:!1,param:this._compressor.ratio,units:"positive",value:t.ratio}),la(this,["knee","release","attack","ratio","threshold"])}static getDefaults(){return Object.assign(Na.getDefaults(),{attack:.003,knee:30,ratio:12,release:.25,threshold:-24})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.disconnect(),this.attack.dispose(),this.release.dispose(),this.threshold.dispose(),this.ratio.dispose(),this.knee.dispose(),this}}const jh=ya().transport;const Uh=ya().destination;ya().destination;ya().listener;ya().draw;const Bh=ya();const zh=pa,Wh=function(t){const e=[];let n=0;for(let s=0;s<t.length;s++){let i=t.charCodeAt(s);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&s+1<t.length&&56320==(64512&t.charCodeAt(s+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++s)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class $h{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Gh(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}class Hh extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,Hh.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Kh.prototype.create)}}class Kh{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},s=`${this.service}/${t}`,i=this.errors[t],r=i?function(t,e){return t.replace(Xh,((t,n)=>{const s=e[n];return null!=s?String(s):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${r} (${s}).`;return new Hh(s,o,n)}}const Xh=/\{\$([^}]+)}/g;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yh(t,e){if(t===e)return!0;const n=Object.keys(t),s=Object.keys(e);for(const i of n){if(!s.includes(i))return!1;const n=t[i],r=e[i];if(Qh(n)&&Qh(r)){if(!Yh(n,r))return!1}else if(n!==r)return!1}for(const t of s)if(!n.includes(t))return!1;return!0}function Qh(t){return null!==t&&"object"==typeof t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Zh(t){return t&&t._delegate?t._delegate:t}class Jh{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class tl{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new $h;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),s=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(s)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(s)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t))try{this.getOrInitializeService({instanceIdentifier:"[DEFAULT]"})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t="[DEFAULT]"){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t="[DEFAULT]"){return this.instances.has(t)}getOptions(t="[DEFAULT]"){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(t)&&e.resolve(s)}return s}onInit(t,e){var n;const s=this.normalizeInstanceIdentifier(e),i=null!==(n=this.onInitCallbacks.get(s))&&void 0!==n?n:new Set;i.add(t),this.onInitCallbacks.set(s,i);const r=this.instances.get(s);return r&&t(r,s),()=>{i.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const s of n)try{s(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(s=t,"[DEFAULT]"===s?void 0:s),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var s;return n||null}normalizeInstanceIdentifier(t="[DEFAULT]"){return this.component?this.component.multipleInstances?t:"[DEFAULT]":t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class nl{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new tl(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sl=[];var il;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(il||(il={}));const rl={debug:il.DEBUG,verbose:il.VERBOSE,info:il.INFO,warn:il.WARN,error:il.ERROR,silent:il.SILENT},ol=il.INFO,al={[il.DEBUG]:"log",[il.VERBOSE]:"log",[il.INFO]:"info",[il.WARN]:"warn",[il.ERROR]:"error"},cl=(t,e,...n)=>{if(e<t.logLevel)return;const s=(new Date).toISOString(),i=al[e];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[i](`[${s}]  ${t.name}:`,...n)};class hl{constructor(t){this.name=t,this._logLevel=ol,this._logHandler=cl,this._userLogHandler=null,sl.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in il))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?rl[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,il.DEBUG,...t),this._logHandler(this,il.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,il.VERBOSE,...t),this._logHandler(this,il.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,il.INFO,...t),this._logHandler(this,il.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,il.WARN,...t),this._logHandler(this,il.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,il.ERROR,...t),this._logHandler(this,il.ERROR,...t)}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class ll{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const ul=new hl("@firebase/app"),dl={"@firebase/app":"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},pl=new Map,fl=new Map;function ml(t,e){try{t.container.addComponent(e)}catch(n){ul.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function gl(t){const e=t.name;if(fl.has(e))return ul.debug(`There were multiple attempts to register component ${e}.`),!1;fl.set(e,t);for(const e of pl.values())ml(e,t);return!0}function yl(t,e){return t.container.getProvider(e)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const _l=new Kh("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function."});
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class vl{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Jh("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw _l.create("app-deleted",{appName:this._name})}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wl(t="[DEFAULT]"){const e=pl.get(t);if(!e)throw _l.create("no-app",{appName:t});return e}function bl(t,e,n){var s;let i=null!==(s=dl[t])&&void 0!==s?s:t;n&&(i+=`-${n}`);const r=i.match(/\s|\//),o=e.match(/\s|\//);if(r||o){const t=[`Unable to register library "${i}" with version "${e}":`];return r&&t.push(`library name "${i}" contains illegal characters (whitespace or "/")`),r&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void ul.warn(t.join(" "))}gl(new Jh(`${i}-version`,(()=>({library:i,version:e})),"VERSION"))}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Tl;Tl="",gl(new Jh("platform-logger",(t=>new ll(t)),"PRIVATE")),bl("@firebase/app","0.7.16",Tl),bl("@firebase/app","0.7.16","esm2017"),bl("fire-js","");
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
bl("firebase","9.6.6","app");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class xl extends Hh{constructor(t,e){super(Al(t),`Firebase Storage: ${e} (${Al(t)})`),this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,xl.prototype)}_codeEquals(t){return Al(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}function Al(t){return"storage/"+t}function kl(){return new xl("unknown","An unknown error occurred, please check the error payload for server response.")}function Cl(){return new xl("canceled","User canceled the upload/download.")}function El(t){return new xl("invalid-argument",t)}function Sl(){return new xl("app-deleted","The Firebase app was deleted.")}function Ml(t){throw new xl("internal-error","Internal error: "+t)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Il{constructor(t,e){this.bucket=t,this.path_=e}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,e){let n;try{n=Il.makeFromUrl(t,e)}catch(e){return new Il(t,"")}if(""===n.path)return n;throw new xl("invalid-default-bucket","Invalid default bucket '"+t+"'.")}static makeFromUrl(t,e){let n=null;const s="([A-Za-z0-9.\\-_]+)";const i=new RegExp("^gs://"+s+"(/(.*))?$","i");function r(t){t.path_=decodeURIComponent(t.path)}const o=e.replace(/[.]/g,"\\."),a=[{regex:i,indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${o}/v[A-Za-z0-9_]+/b/${s}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:r},{regex:new RegExp(`^https?://${"firebasestorage.googleapis.com"===e?"(?:storage.googleapis.com|storage.cloud.google.com)":e}/${s}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:r}];for(let e=0;e<a.length;e++){const s=a[e],i=s.regex.exec(t);if(i){const t=i[s.indices.bucket];let e=i[s.indices.path];e||(e=""),n=new Il(t,e),s.postModify(n);break}}if(null==n)throw function(t){return new xl("invalid-url","Invalid URL '"+t+"'.")}(t);return n}}class Dl{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=!1){}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pl(t){return"string"==typeof t||t instanceof String}function Ol(t,e,n,s){if(s<e)throw El(`Invalid value for '${t}'. Expected ${e} or greater.`);if(s>n)throw El(`Invalid value for '${t}'. Expected ${n} or less.`)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rl(t,e,n){let s=e;return null==n&&(s=`https://${e}`),`${n}://${s}/v0${t}`}function Nl(t){const e=encodeURIComponent;let n="?";for(const s in t)if(t.hasOwnProperty(s)){n=n+(e(s)+"="+e(t[s]))+"&"}return n=n.slice(0,-1),n}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Vl,Ll;(Ll=Vl||(Vl={}))[Ll.NO_ERROR=0]="NO_ERROR",Ll[Ll.NETWORK_ERROR=1]="NETWORK_ERROR",Ll[Ll.ABORT=2]="ABORT";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class ql{constructor(t,e,n,s,i,r,o,a,c,h,l){this.url_=t,this.method_=e,this.headers_=n,this.body_=s,this.successCodes_=i,this.additionalRetryCodes_=r,this.callback_=o,this.errorCallback_=a,this.timeout_=c,this.progressCallback_=h,this.connectionFactory_=l,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise(((t,e)=>{this.resolve_=t,this.reject_=e,this.start_()}))}start_(){const t=(t,e)=>{const n=this.resolve_,s=this.reject_,i=e.connection;if(e.wasSuccessCode)try{const t=this.callback_(i,i.getResponse());void 0!==t?n(t):n()}catch(t){s(t)}else if(null!==i){const t=kl();t.serverResponse=i.getErrorText(),this.errorCallback_?s(this.errorCallback_(i,t)):s(t)}else if(e.canceled){s(this.appDelete_?Sl():Cl())}else{s(new xl("retry-limit-exceeded","Max retry time for operation exceeded, please try again."))}};this.canceled_?t(0,new Fl(!1,null,!0)):this.backoffId_=function(t,e,n){let s=1,i=null,r=null,o=!1,a=0;function c(){return 2===a}let h=!1;function l(...t){h||(h=!0,e.apply(null,t))}function u(e){i=setTimeout((()=>{i=null,t(p,c())}),e)}function d(){r&&clearTimeout(r)}function p(t,...e){if(h)return void d();if(t)return d(),void l.call(null,t,...e);if(c()||o)return d(),void l.call(null,t,...e);let n;s<64&&(s*=2),1===a?(a=2,n=0):n=1e3*(s+Math.random()),u(n)}let f=!1;function m(t){f||(f=!0,d(),h||(null!==i?(t||(a=2),clearTimeout(i),u(0)):t||(a=1)))}return u(0),r=setTimeout((()=>{o=!0,m(!0)}),n),m}(((t,e)=>{if(e)return void t(!1,new Fl(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const s=t=>{const e=t.loaded,n=t.lengthComputable?t.total:-1;null!==this.progressCallback_&&this.progressCallback_(e,n)};null!==this.progressCallback_&&n.addUploadProgressListener(s),n.send(this.url_,this.method_,this.body_,this.headers_).then((()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(s),this.pendingConnection_=null;const e=n.getErrorCode()===Vl.NO_ERROR,i=n.getStatus();if(!e||this.isRetryStatusCode_(i)){const e=n.getErrorCode()===Vl.ABORT;return void t(!1,new Fl(!1,null,e))}const r=-1!==this.successCodes_.indexOf(i);t(!0,new Fl(r,n))}))}),t,this.timeout_)}getPromise(){return this.promise_}cancel(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}isRetryStatusCode_(t){const e=t>=500&&t<600,n=-1!==[408,429].indexOf(t),s=-1!==this.additionalRetryCodes_.indexOf(t);return e||n||s}}class Fl{constructor(t,e,n){this.wasSuccessCode=t,this.connection=e,this.canceled=!!n}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function jl(t){let e;try{e=JSON.parse(t)}catch(t){return null}return"object"!=typeof(n=e)||Array.isArray(n)?null:e;var n}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ul(t){const e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bl(t,e){return e}class zl{constructor(t,e,n,s){this.server=t,this.local=e||t,this.writable=!!n,this.xform=s||Bl}}let Wl=null;function $l(){if(Wl)return Wl;const t=[];t.push(new zl("bucket")),t.push(new zl("generation")),t.push(new zl("metageneration")),t.push(new zl("name","fullPath",!0));const e=new zl("name");e.xform=function(t,e){return function(t){return!Pl(t)||t.length<2?t:Ul(t)}(e)},t.push(e);const n=new zl("size");return n.xform=function(t,e){return void 0!==e?Number(e):e},t.push(n),t.push(new zl("timeCreated")),t.push(new zl("updated")),t.push(new zl("md5Hash",null,!0)),t.push(new zl("cacheControl",null,!0)),t.push(new zl("contentDisposition",null,!0)),t.push(new zl("contentEncoding",null,!0)),t.push(new zl("contentLanguage",null,!0)),t.push(new zl("contentType",null,!0)),t.push(new zl("metadata","customMetadata",!0)),Wl=t,Wl}function Gl(t,e,n){const s={type:"file"},i=n.length;for(let t=0;t<i;t++){const i=n[t];s[i.local]=i.xform(s,e[i.server])}return function(t,e){Object.defineProperty(t,"ref",{get:function(){const n=t.bucket,s=t.fullPath,i=new Il(n,s);return e._makeStorageReference(i)}})}(s,t),s}function Hl(t,e,n){const s=jl(e);if(null===s)return null;return Gl(t,s,n)}class Kl{constructor(t,e,n,s){this.url=t,this.method=e,this.handler=n,this.timeout=s,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xl(t){if(!t)throw kl()}function Yl(t,e){return function(n,s){const i=Hl(t,s,e);return Xl(null!==i),function(t,e,n,s){const i=jl(e);if(null===i)return null;if(!Pl(i.downloadTokens))return null;const r=i.downloadTokens;if(0===r.length)return null;const o=encodeURIComponent;return r.split(",").map((e=>{const i=t.bucket,r=t.fullPath;return Rl("/b/"+o(i)+"/o/"+o(r),n,s)+Nl({alt:"media",token:e})}))[0]}(i,s,t.host,t._protocol)}}function Ql(t){return function(e,n){let s;var i,r;return 401===e.getStatus()?s=e.getErrorText().includes("Firebase App Check token is invalid")?new xl("unauthorized-app","This app does not have permission to access Firebase Storage on this project."):new xl("unauthenticated","User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?(r=t.bucket,s=new xl("quota-exceeded","Quota for bucket '"+r+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===e.getStatus()?(i=t.path,s=new xl("unauthorized","User does not have permission to access '"+i+"'.")):s=n,s.serverResponse=n.serverResponse,s}}function Zl(t){const e=Ql(t);return function(n,s){let i=e(n,s);var r;return 404===n.getStatus()&&(r=t.path,i=new xl("object-not-found","Object '"+r+"' does not exist.")),i.serverResponse=s.serverResponse,i}}class Jl{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Vl.NO_ERROR,this.sendPromise_=new Promise((t=>{this.xhr_.addEventListener("abort",(()=>{this.errorCode_=Vl.ABORT,t()})),this.xhr_.addEventListener("error",(()=>{this.errorCode_=Vl.NETWORK_ERROR,t()})),this.xhr_.addEventListener("load",(()=>{t()}))}))}send(t,e,n,s){if(this.sent_)throw Ml("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(e,t,!0),void 0!==s)for(const t in s)s.hasOwnProperty(t)&&this.xhr_.setRequestHeader(t,s[t].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Ml("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Ml("cannot .getStatus() before sending");try{return this.xhr_.status}catch(t){return-1}}getResponse(){if(!this.sent_)throw Ml("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Ml("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(t){return this.xhr_.getResponseHeader(t)}addUploadProgressListener(t){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",t)}removeUploadProgressListener(t){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",t)}}class tu extends Jl{initXhr(){this.xhr_.responseType="text"}}function eu(){return new tu}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class nu{constructor(t,e){this._service=t,this._location=e instanceof Il?e:Il.makeFromUrl(e,t.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,e){return new nu(t,e)}get root(){const t=new Il(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Ul(this._location.path)}get storage(){return this._service}get parent(){const t=function(t){if(0===t.length)return null;const e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this._location.path);if(null===t)return null;const e=new Il(this._location.bucket,t);return new nu(this._service,e)}_throwIfRoot(t){if(""===this._location.path)throw function(t){return new xl("invalid-root-operation","The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(t)}}function su(t){t._throwIfRoot("getDownloadURL");const e=function(t,e,n){const s=Rl(e.fullServerUrl(),t.host,t._protocol),i=t.maxOperationRetryTime,r=new Kl(s,"GET",Yl(t,n),i);return r.errorHandler=Zl(e),r}(t.storage,t._location,$l());return t.storage.makeRequestWithTokens(e,eu).then((t=>{if(null===t)throw new xl("no-download-url","The given file does not have any download URLs.");return t}))}function iu(t,e){const n=function(t,e){const n=e.split("/").filter((t=>t.length>0)).join("/");return 0===t.length?n:t+"/"+n}(t._location.path,e),s=new Il(t._location.bucket,n);return new nu(t.storage,s)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ru(t,e){if(t instanceof cu){const n=t;if(null==n._bucket)throw new xl("no-default-bucket","No default bucket found. Did you set the 'storageBucket' property when initializing the app?");const s=new nu(n,n._bucket);return null!=e?ru(s,e):s}return void 0!==e?iu(t,e):t}function ou(t,e){if(e&&/^[A-Za-z]+:\/\//.test(e)){if(t instanceof cu)return new nu(t,e);throw El("To use ref(service, url), the first argument must be a Storage instance.")}return ru(t,e)}function au(t,e){const n=null==e?void 0:e.storageBucket;return null==n?null:Il.makeFromBucketSpec(n,t)}class cu{constructor(t,e,n,s,i){this.app=t,this._authProvider=e,this._appCheckProvider=n,this._url=s,this._firebaseVersion=i,this._bucket=null,this._host="firebasestorage.googleapis.com",this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=s?Il.makeFromBucketSpec(s,this._host):au(this._host,this.app.options)}get host(){return this._host}set host(t){this._host=t,null!=this._url?this._bucket=Il.makeFromBucketSpec(this._url,t):this._bucket=au(t,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){Ol("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){Ol("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const t=this._authProvider.getImmediate({optional:!0});if(t){const e=await t.getToken();if(null!==e)return e.accessToken}return null}async _getAppCheckToken(){const t=this._appCheckProvider.getImmediate({optional:!0});if(t){return(await t.getToken()).token}return null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach((t=>t.cancel())),this._requests.clear()),Promise.resolve()}_makeStorageReference(t){return new nu(this,t)}_makeRequest(t,e,n,s){if(this._deleted)return new Dl(Sl());{const i=function(t,e,n,s,i,r){const o=Nl(t.urlParams),a=t.url+o,c=Object.assign({},t.headers);return function(t,e){e&&(t["X-Firebase-GMPID"]=e)}(c,e),function(t,e){null!==e&&e.length>0&&(t.Authorization="Firebase "+e)}(c,n),function(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(null!=e?e:"AppManager")}(c,r),function(t,e){null!==e&&(t["X-Firebase-AppCheck"]=e)}(c,s),new ql(a,t.method,c,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,i)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t,this._appId,n,s,e,this._firebaseVersion);return this._requests.add(i),i.getPromise().then((()=>this._requests.delete(i)),(()=>this._requests.delete(i))),i}}async makeRequestWithTokens(t,e){const[n,s]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,e,n,s).getPromise()}}function hu(t){return su(t=Zh(t))}function lu(t,e){return ou(t=Zh(t),e)}function uu(t,{instanceIdentifier:e}){const n=t.getProvider("app").getImmediate(),s=t.getProvider("auth-internal"),i=t.getProvider("app-check-internal");return new cu(n,s,i,e,"9.6.6")}gl(new Jh("storage",uu,"PUBLIC").setMultipleInstances(!0)),bl("@firebase/storage","0.9.2",""),bl("@firebase/storage","0.9.2","esm2017");var du,pu="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},fu={},mu=mu||{},gu=pu||self;function yu(){}function _u(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function vu(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var wu="closure_uid_"+(1e9*Math.random()>>>0),bu=0;function Tu(t,e,n){return t.call.apply(t.bind,arguments)}function xu(t,e,n){if(!t)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,s),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function Au(t,e,n){return(Au=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Tu:xu).apply(null,arguments)}function ku(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function Cu(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Vb=function(t,n,s){for(var i=Array(arguments.length-2),r=2;r<arguments.length;r++)i[r-2]=arguments[r];return e.prototype[n].apply(t,i)}}function Eu(){this.s=this.s,this.o=this.o}var Su={};Eu.prototype.s=!1,Eu.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var t=function(t){return Object.prototype.hasOwnProperty.call(t,wu)&&t[wu]||(t[wu]=++bu)}(this);delete Su[t]}},Eu.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Mu=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},Iu=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){const s=t.length,i="string"==typeof t?t.split(""):t;for(let r=0;r<s;r++)r in i&&e.call(n,i[r],r,t)};function Du(t){return Array.prototype.concat.apply([],arguments)}function Pu(t){const e=t.length;if(0<e){const n=Array(e);for(let s=0;s<e;s++)n[s]=t[s];return n}return[]}function Ou(t){return/^[\s\xa0]*$/.test(t)}var Ru,Nu=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Vu(t,e){return-1!=t.indexOf(e)}function Lu(t,e){return t<e?-1:t>e?1:0}t:{var qu=gu.navigator;if(qu){var Fu=qu.userAgent;if(Fu){Ru=Fu;break t}}Ru=""}function ju(t,e,n){for(const s in t)e.call(n,t[s],s,t)}function Uu(t){const e={};for(const n in t)e[n]=t[n];return e}var Bu="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function zu(t,e){let n,s;for(let e=1;e<arguments.length;e++){for(n in s=arguments[e],s)t[n]=s[n];for(let e=0;e<Bu.length;e++)n=Bu[e],Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}}function Wu(t){return Wu[" "](t),t}Wu[" "]=yu;var $u,Gu,Hu=Vu(Ru,"Opera"),Ku=Vu(Ru,"Trident")||Vu(Ru,"MSIE"),Xu=Vu(Ru,"Edge"),Yu=Xu||Ku,Qu=Vu(Ru,"Gecko")&&!(Vu(Ru.toLowerCase(),"webkit")&&!Vu(Ru,"Edge"))&&!(Vu(Ru,"Trident")||Vu(Ru,"MSIE"))&&!Vu(Ru,"Edge"),Zu=Vu(Ru.toLowerCase(),"webkit")&&!Vu(Ru,"Edge");function Ju(){var t=gu.document;return t?t.documentMode:void 0}t:{var td="",ed=(Gu=Ru,Qu?/rv:([^\);]+)(\)|;)/.exec(Gu):Xu?/Edge\/([\d\.]+)/.exec(Gu):Ku?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Gu):Zu?/WebKit\/(\S+)/.exec(Gu):Hu?/(?:Version)[ \/]?(\S+)/.exec(Gu):void 0);if(ed&&(td=ed?ed[1]:""),Ku){var nd=Ju();if(null!=nd&&nd>parseFloat(td)){$u=String(nd);break t}}$u=td}var sd,id={};function rd(){return function(t){var e=id;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=t(9)}((function(){let t=0;const e=Nu(String($u)).split("."),n=Nu("9").split("."),s=Math.max(e.length,n.length);for(let o=0;0==t&&o<s;o++){var i=e[o]||"",r=n[o]||"";do{if(i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],r=/(\d*)(\D*)(.*)/.exec(r)||["","","",""],0==i[0].length&&0==r[0].length)break;t=Lu(0==i[1].length?0:parseInt(i[1],10),0==r[1].length?0:parseInt(r[1],10))||Lu(0==i[2].length,0==r[2].length)||Lu(i[2],r[2]),i=i[3],r=r[3]}while(0==t)}return 0<=t}))}if(gu.document&&Ku){var od=Ju();sd=od||(parseInt($u,10)||void 0)}else sd=void 0;var ad=sd,cd=function(){if(!gu.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{gu.addEventListener("test",yu,e),gu.removeEventListener("test",yu,e)}catch(t){}return t}();function hd(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function ld(t,e){if(hd.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,s=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(Qu){t:{try{Wu(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,s?(this.clientX=void 0!==s.clientX?s.clientX:s.pageX,this.clientY=void 0!==s.clientY?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:ud[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&ld.Z.h.call(this)}}hd.prototype.h=function(){this.defaultPrevented=!0},Cu(ld,hd);var ud={2:"touch",3:"pen",4:"mouse"};ld.prototype.h=function(){ld.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var dd="closure_listenable_"+(1e6*Math.random()|0),pd=0;function fd(t,e,n,s,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!s,this.ia=i,this.key=++pd,this.ca=this.fa=!1}function md(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function gd(t){this.src=t,this.g={},this.h=0}function yd(t,e){var n=e.type;if(n in t.g){var s,i=t.g[n],r=Mu(i,e);(s=0<=r)&&Array.prototype.splice.call(i,r,1),s&&(md(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function _d(t,e,n,s){for(var i=0;i<t.length;++i){var r=t[i];if(!r.ca&&r.listener==e&&r.capture==!!n&&r.ia==s)return i}return-1}gd.prototype.add=function(t,e,n,s,i){var r=t.toString();(t=this.g[r])||(t=this.g[r]=[],this.h++);var o=_d(t,e,s,i);return-1<o?(e=t[o],n||(e.fa=!1)):((e=new fd(e,this.src,r,!!s,i)).fa=n,t.push(e)),e};var vd="closure_lm_"+(1e6*Math.random()|0),wd={};function bd(t,e,n,s,i){if(s&&s.once)return xd(t,e,n,s,i);if(Array.isArray(e)){for(var r=0;r<e.length;r++)bd(t,e[r],n,s,i);return null}return n=Id(n),t&&t[dd]?t.N(e,n,vu(s)?!!s.capture:!!s,i):Td(t,e,n,!1,s,i)}function Td(t,e,n,s,i,r){if(!e)throw Error("Invalid event type");var o=vu(i)?!!i.capture:!!i,a=Sd(t);if(a||(t[vd]=a=new gd(t)),(n=a.add(e,n,s,o,r)).proxy)return n;if(s=function(){function t(n){return e.call(t.src,t.listener,n)}var e=Ed;return t}(),n.proxy=s,s.src=t,s.listener=n,t.addEventListener)cd||(i=o),void 0===i&&(i=!1),t.addEventListener(e.toString(),s,i);else if(t.attachEvent)t.attachEvent(Cd(e.toString()),s);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(s)}return n}function xd(t,e,n,s,i){if(Array.isArray(e)){for(var r=0;r<e.length;r++)xd(t,e[r],n,s,i);return null}return n=Id(n),t&&t[dd]?t.O(e,n,vu(s)?!!s.capture:!!s,i):Td(t,e,n,!0,s,i)}function Ad(t,e,n,s,i){if(Array.isArray(e))for(var r=0;r<e.length;r++)Ad(t,e[r],n,s,i);else s=vu(s)?!!s.capture:!!s,n=Id(n),t&&t[dd]?(t=t.i,(e=String(e).toString())in t.g&&(-1<(n=_d(r=t.g[e],n,s,i))&&(md(r[n]),Array.prototype.splice.call(r,n,1),0==r.length&&(delete t.g[e],t.h--)))):t&&(t=Sd(t))&&(e=t.g[e.toString()],t=-1,e&&(t=_d(e,n,s,i)),(n=-1<t?e[t]:null)&&kd(n))}function kd(t){if("number"!=typeof t&&t&&!t.ca){var e=t.src;if(e&&e[dd])yd(e.i,t);else{var n=t.type,s=t.proxy;e.removeEventListener?e.removeEventListener(n,s,t.capture):e.detachEvent?e.detachEvent(Cd(n),s):e.addListener&&e.removeListener&&e.removeListener(s),(n=Sd(e))?(yd(n,t),0==n.h&&(n.src=null,e[vd]=null)):md(t)}}}function Cd(t){return t in wd?wd[t]:wd[t]="on"+t}function Ed(t,e){if(t.ca)t=!0;else{e=new ld(e,this);var n=t.listener,s=t.ia||t.src;t.fa&&kd(t),t=n.call(s,e)}return t}function Sd(t){return(t=t[vd])instanceof gd?t:null}var Md="__closure_events_fn_"+(1e9*Math.random()>>>0);function Id(t){return"function"==typeof t?t:(t[Md]||(t[Md]=function(e){return t.handleEvent(e)}),t[Md])}function Dd(){Eu.call(this),this.i=new gd(this),this.P=this,this.I=null}function Pd(t,e){var n,s=t.I;if(s)for(n=[];s;s=s.I)n.push(s);if(t=t.P,s=e.type||e,"string"==typeof e)e=new hd(e,t);else if(e instanceof hd)e.target=e.target||t;else{var i=e;zu(e=new hd(s,t),i)}if(i=!0,n)for(var r=n.length-1;0<=r;r--){var o=e.g=n[r];i=Od(o,s,!0,e)&&i}if(i=Od(o=e.g=t,s,!0,e)&&i,i=Od(o,s,!1,e)&&i,n)for(r=0;r<n.length;r++)i=Od(o=e.g=n[r],s,!1,e)&&i}function Od(t,e,n,s){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,r=0;r<e.length;++r){var o=e[r];if(o&&!o.ca&&o.capture==n){var a=o.listener,c=o.ia||o.src;o.fa&&yd(t.i,o),i=!1!==a.call(c,s)&&i}}return i&&!s.defaultPrevented}Cu(Dd,Eu),Dd.prototype[dd]=!0,Dd.prototype.removeEventListener=function(t,e,n,s){Ad(this,t,e,n,s)},Dd.prototype.M=function(){if(Dd.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],s=0;s<n.length;s++)md(n[s]);delete e.g[t],e.h--}}this.I=null},Dd.prototype.N=function(t,e,n,s){return this.i.add(String(t),e,!1,n,s)},Dd.prototype.O=function(t,e,n,s){return this.i.add(String(t),e,!0,n,s)};var Rd=gu.JSON.stringify;function Nd(){var t=Bd;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var Vd,Ld=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new qd),(t=>t.reset()));class qd{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function Fd(t){gu.setTimeout((()=>{throw t}),0)}function jd(t,e){Vd||function(){var t=gu.Promise.resolve(void 0);Vd=function(){t.then(zd)}}(),Ud||(Vd(),Ud=!0),Bd.add(t,e)}var Ud=!1,Bd=new class{constructor(){this.h=this.g=null}add(t,e){const n=Ld.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}};function zd(){for(var t;t=Nd();){try{t.h.call(t.g)}catch(t){Fd(t)}var e=Ld;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}Ud=!1}function Wd(t,e){Dd.call(this),this.h=t||1,this.g=e||gu,this.j=Au(this.kb,this),this.l=Date.now()}function $d(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function Gd(t,e,n){if("function"==typeof t)n&&(t=Au(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=Au(t.handleEvent,t)}return 2147483647<Number(e)?-1:gu.setTimeout(t,e||0)}function Hd(t){t.g=Gd((()=>{t.g=null,t.i&&(t.i=!1,Hd(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}Cu(Wd,Dd),(du=Wd.prototype).da=!1,du.S=null,du.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Pd(this,"tick"),this.da&&($d(this),this.start()))}},du.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},du.M=function(){Wd.Z.M.call(this),$d(this),delete this.g};class Kd extends Eu{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:Hd(this)}M(){super.M(),this.g&&(gu.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Xd(t){Eu.call(this),this.h=t,this.g={}}Cu(Xd,Eu);var Yd=[];function Qd(t,e,n,s){Array.isArray(n)||(n&&(Yd[0]=n.toString()),n=Yd);for(var i=0;i<n.length;i++){var r=bd(e,n[i],s||t.handleEvent,!1,t.h||t);if(!r)break;t.g[r.key]=r}}function Zd(t){ju(t.g,(function(t,e){this.g.hasOwnProperty(e)&&kd(t)}),t),t.g={}}function Jd(){this.g=!0}function tp(t,e,n,s){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var s=n[t];if(!(2>s.length)){var i=s[1];if(Array.isArray(i)&&!(1>i.length)){var r=i[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<i.length;o++)i[o]=""}}}return Rd(n)}catch(t){return e}}(t,n)+(s?" "+s:"")}))}Xd.prototype.M=function(){Xd.Z.M.call(this),Zd(this)},Xd.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Jd.prototype.Aa=function(){this.g=!1},Jd.prototype.info=function(){};var ep={},np=null;function sp(){return np=np||new Dd}function ip(t){hd.call(this,ep.Ma,t)}function rp(t){const e=sp();Pd(e,new ip(e,t))}function op(t,e){hd.call(this,ep.STAT_EVENT,t),this.stat=e}function ap(t){const e=sp();Pd(e,new op(e,t))}function cp(t,e){hd.call(this,ep.Na,t),this.size=e}function hp(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return gu.setTimeout((function(){t()}),e)}ep.Ma="serverreachability",Cu(ip,hd),ep.STAT_EVENT="statevent",Cu(op,hd),ep.Na="timingevent",Cu(cp,hd);var lp={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},up={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function dp(){}function pp(t){return t.h||(t.h=t.i())}function fp(){}dp.prototype.h=null;var mp,gp={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function yp(){hd.call(this,"d")}function _p(){hd.call(this,"c")}function vp(){}function wp(t,e,n,s){this.l=t,this.j=e,this.m=n,this.X=s||1,this.V=new Xd(this),this.P=Tp,t=Yu?125:void 0,this.W=new Wd(t),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new bp}function bp(){this.i=null,this.g="",this.h=!1}Cu(yp,hd),Cu(_p,hd),Cu(vp,dp),vp.prototype.g=function(){return new XMLHttpRequest},vp.prototype.i=function(){return{}},mp=new vp;var Tp=45e3,xp={},Ap={};function kp(t,e,n){t.K=1,t.v=Kp(Bp(e)),t.s=n,t.U=!0,Cp(t,null)}function Cp(t,e){t.F=Date.now(),Ip(t),t.A=Bp(t.v);var n=t.A,s=t.X;Array.isArray(s)||(s=[String(s)]),cf(n.h,"t",s),t.C=0,n=t.l.H,t.h=new bp,t.g=cm(t.l,n?e:null,!t.s),0<t.O&&(t.L=new Kd(Au(t.Ia,t,t.g),t.O)),Qd(t.V,t.g,"readystatechange",t.gb),e=t.H?Uu(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),rp(1),function(t,e,n,s,i,r){t.info((function(){if(t.g)if(r)for(var o="",a=r.split("&"),c=0;c<a.length;c++){var h=a[c].split("=");if(1<h.length){var l=h[0];h=h[1];var u=l.split("_");o=2<=u.length&&"type"==u[1]?o+(l+"=")+h+"&":o+(l+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+s+") [attempt "+i+"]: "+e+"\n"+n+"\n"+o}))}(t.j,t.u,t.A,t.m,t.X,t.s)}function Ep(t){return!!t.g&&("GET"==t.u&&2!=t.K&&t.l.Ba)}function Sp(t,e,n){let s,i=!0;for(;!t.I&&t.C<n.length;){if(s=Mp(t,n),s==Ap){4==e&&(t.o=4,ap(14),i=!1),tp(t.j,t.m,null,"[Incomplete Response]");break}if(s==xp){t.o=4,ap(15),tp(t.j,t.m,n,"[Invalid Chunk]"),i=!1;break}tp(t.j,t.m,s,null),Np(t,s)}Ep(t)&&s!=Ap&&s!=xp&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,ap(16),i=!1),t.i=t.i&&i,i?0<n.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),tm(e),e.L=!0,ap(11))):(tp(t.j,t.m,n,"[Invalid Chunked Response]"),Rp(t),Op(t))}function Mp(t,e){var n=t.C,s=e.indexOf("\n",n);return-1==s?Ap:(n=Number(e.substring(n,s)),isNaN(n)?xp:(s+=1)+n>e.length?Ap:(e=e.substr(s,n),t.C=s+n,e))}function Ip(t){t.Y=Date.now()+t.P,Dp(t,t.P)}function Dp(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=hp(Au(t.eb,t),e)}function Pp(t){t.B&&(gu.clearTimeout(t.B),t.B=null)}function Op(t){0==t.l.G||t.I||sm(t.l,t)}function Rp(t){Pp(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,$d(t.W),Zd(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function Np(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||ff(n.i,t)))if(n.I=t.N,!t.J&&ff(n.i,t)&&3==n.G){try{var s=n.Ca.g.parse(e)}catch(t){s=null}if(Array.isArray(s)&&3==s.length){var i=s;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;nm(n),$f(n)}Jf(n),ap(18)}}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=hp(Au(n.ab,n),6e3));if(1>=pf(n.i)&&n.ka){try{n.ka()}catch(t){}n.ka=void 0}}else rm(n,11)}else if((t.J||n.g==t)&&nm(n),!Ou(e))for(i=n.Ca.g.parse(e),e=0;e<i.length;e++){let h=i[e];if(n.U=h[0],h=h[1],2==n.G)if("c"==h[0]){n.J=h[1],n.la=h[2];const e=h[3];null!=e&&(n.ma=e,n.h.info("VER="+n.ma));const i=h[4];null!=i&&(n.za=i,n.h.info("SVER="+n.za));const l=h[5];null!=l&&"number"==typeof l&&0<l&&(s=1.5*l,n.K=s,n.h.info("backChannelRequestTimeoutMs_="+s)),s=n;const u=t.g;if(u){const t=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var r=s.i;!r.g&&(Vu(t,"spdy")||Vu(t,"quic")||Vu(t,"h2"))&&(r.j=r.l,r.g=new Set,r.h&&(mf(r,r.h),r.h=null))}if(s.D){const t=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(s.sa=t,Hp(s.F,s.D,t))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms"));var o=t;if((s=n).oa=am(s,s.H?s.la:null,s.W),o.J){gf(s.i,o);var a=o,c=s.K;c&&a.setTimeout(c),a.B&&(Pp(a),Ip(a)),s.g=o}else Zf(s);0<n.l.length&&Kf(n)}else"stop"!=h[0]&&"close"!=h[0]||rm(n,7);else 3==n.G&&("stop"==h[0]||"close"==h[0]?"stop"==h[0]?rm(n,7):Wf(n):"noop"!=h[0]&&n.j&&n.j.wa(h),n.A=0)}rp(4)}catch(t){}}function Vp(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(_u(t)||"string"==typeof t)Iu(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var n=t.T();else if(t.R&&"function"==typeof t.R)n=void 0;else if(_u(t)||"string"==typeof t){n=[];for(var s=t.length,i=0;i<s;i++)n.push(i)}else for(i in n=[],s=0,t)n[s++]=i;s=function(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(_u(t)){for(var e=[],n=t.length,s=0;s<n;s++)e.push(t[s]);return e}for(s in e=[],n=0,t)e[n++]=t[s];return e}(t),i=s.length;for(var r=0;r<i;r++)e.call(void 0,s[r],n&&n[r],t)}}function Lp(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var s=0;s<n;s+=2)this.set(arguments[s],arguments[s+1])}else if(t)if(t instanceof Lp)for(n=t.T(),s=0;s<n.length;s++)this.set(n[s],t.get(n[s]));else for(s in t)this.set(s,t[s])}function qp(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var s=t.g[e];Fp(t.h,s)&&(t.g[n++]=s),e++}t.g.length=n}if(t.i!=t.g.length){var i={};for(n=e=0;e<t.g.length;)Fp(i,s=t.g[e])||(t.g[n++]=s,i[s]=1),e++;t.g.length=n}}function Fp(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(du=wp.prototype).setTimeout=function(t){this.P=t},du.gb=function(t){t=t.target;const e=this.L;e&&3==Ff(t)?e.l():this.Ia(t)},du.Ia=function(t){try{if(t==this.g)t:{const l=Ff(this.g);var e=this.g.Da();const u=this.g.ba();if(!(3>l)&&(3!=l||Yu||this.g&&(this.h.h||this.g.ga()||jf(this.g)))){this.I||4!=l||7==e||rp(8==e||0>=u?3:2),Pp(this);var n=this.g.ba();this.N=n;e:if(Ep(this)){var s=jf(this.g);t="";var i=s.length,r=4==Ff(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Rp(this),Op(this);var o="";break e}this.h.i=new gu.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,t+=this.h.i.decode(s[e],{stream:r&&e==i-1});s.splice(0,i),this.h.g+=t,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=200==n,function(t,e,n,s,i,r,o){t.info((function(){return"XMLHTTP RESP ("+s+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+r+" "+o}))}(this.j,this.u,this.A,this.m,this.X,l,n),this.i){if(this.$&&!this.J){e:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Ou(a)){var h=a;break e}}h=null}if(!(n=h)){this.i=!1,this.o=3,ap(12),Rp(this),Op(this);break t}tp(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Np(this,n)}this.U?(Sp(this,l,o),Yu&&this.i&&3==l&&(Qd(this.V,this.W,"tick",this.fb),this.W.start())):(tp(this.j,this.m,o,null),Np(this,o)),4==l&&Rp(this),this.i&&!this.I&&(4==l?sm(this.l,this):(this.i=!1,Ip(this)))}else 400==n&&0<o.indexOf("Unknown SID")?(this.o=3,ap(12)):(this.o=0,ap(13)),Rp(this),Op(this)}}}catch(t){}},du.fb=function(){if(this.g){var t=Ff(this.g),e=this.g.ga();this.C<e.length&&(Pp(this),Sp(this,t,e),this.i&&4!=t&&Ip(this))}},du.cancel=function(){this.I=!0,Rp(this)},du.eb=function(){this.B=null;const t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.A),2!=this.K&&(rp(3),ap(17)),Rp(this),this.o=2,Op(this)):Dp(this,this.Y-t)},(du=Lp.prototype).R=function(){qp(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},du.T=function(){return qp(this),this.g.concat()},du.get=function(t,e){return Fp(this.h,t)?this.h[t]:e},du.set=function(t,e){Fp(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},du.forEach=function(t,e){for(var n=this.T(),s=0;s<n.length;s++){var i=n[s],r=this.get(i);t.call(e,r,i,this)}};var jp=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Up(t,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof Up){this.g=void 0!==e?e:t.g,zp(this,t.j),this.s=t.s,Wp(this,t.i),$p(this,t.m),this.l=t.l,e=t.h;var n=new sf;n.i=e.i,e.g&&(n.g=new Lp(e.g),n.h=e.h),Gp(this,n),this.o=t.o}else t&&(n=String(t).match(jp))?(this.g=!!e,zp(this,n[1]||"",!0),this.s=Xp(n[2]||""),Wp(this,n[3]||"",!0),$p(this,n[4]),this.l=Xp(n[5]||"",!0),Gp(this,n[6]||"",!0),this.o=Xp(n[7]||"")):(this.g=!!e,this.h=new sf(null,this.g))}function Bp(t){return new Up(t)}function zp(t,e,n){t.j=n?Xp(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Wp(t,e,n){t.i=n?Xp(e,!0):e}function $p(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Gp(t,e,n){e instanceof sf?(t.h=e,function(t,e){e&&!t.j&&(rf(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(of(this,e),cf(this,n,t))}),t)),t.j=e}(t.h,t.g)):(n||(e=Yp(e,ef)),t.h=new sf(e,t.g))}function Hp(t,e,n){t.h.set(e,n)}function Kp(t){return Hp(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Xp(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Yp(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Qp),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Qp(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Up.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Yp(e,Zp,!0),":");var n=this.i;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(Yp(e,Zp,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&t.push("/"),t.push(Yp(n,"/"==n.charAt(0)?tf:Jp,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",Yp(n,nf)),t.join("")};var Zp=/[#\/\?@]/g,Jp=/[#\?:]/g,tf=/[#\?]/g,ef=/[#\?@]/g,nf=/#/g;function sf(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function rf(t){t.g||(t.g=new Lp,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var s=t[n].indexOf("="),i=null;if(0<=s){var r=t[n].substring(0,s);i=t[n].substring(s+1)}else r=t[n];e(r,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function of(t,e){rf(t),e=hf(t,e),Fp(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,Fp((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&qp(t)))}function af(t,e){return rf(t),e=hf(t,e),Fp(t.g.h,e)}function cf(t,e,n){of(t,e),0<n.length&&(t.i=null,t.g.set(hf(t,e),Pu(n)),t.h+=n.length)}function hf(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(du=sf.prototype).add=function(t,e){rf(this),this.i=null,t=hf(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},du.forEach=function(t,e){rf(this),this.g.forEach((function(n,s){Iu(n,(function(n){t.call(e,n,s,this)}),this)}),this)},du.T=function(){rf(this);for(var t=this.g.R(),e=this.g.T(),n=[],s=0;s<e.length;s++)for(var i=t[s],r=0;r<i.length;r++)n.push(e[s]);return n},du.R=function(t){rf(this);var e=[];if("string"==typeof t)af(this,t)&&(e=Du(e,this.g.get(hf(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=Du(e,t[n])}return e},du.set=function(t,e){return rf(this),this.i=null,af(this,t=hf(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},du.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},du.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++){var s=e[n],i=encodeURIComponent(String(s));s=this.R(s);for(var r=0;r<s.length;r++){var o=i;""!==s[r]&&(o+="="+encodeURIComponent(String(s[r]))),t.push(o)}}return this.i=t.join("&")};function lf(t){this.l=t||uf,gu.PerformanceNavigationTiming?t=0<(t=gu.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(gu.g&&gu.g.Ea&&gu.g.Ea()&&gu.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var uf=10;function df(t){return!!t.h||!!t.g&&t.g.size>=t.j}function pf(t){return t.h?1:t.g?t.g.size:0}function ff(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function mf(t,e){t.g?t.g.add(e):t.h=e}function gf(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function yf(t){if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}return Pu(t.i)}function _f(){}function vf(){this.g=new _f}function wf(t,e,n){const s=n||"";try{Vp(t,(function(t,n){let i=t;vu(t)&&(i=Rd(t)),e.push(s+n+"="+encodeURIComponent(i))}))}catch(t){throw e.push(s+"type="+encodeURIComponent("_badmap")),t}}function bf(t,e,n,s,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(s)}catch(t){}}function Tf(t){this.l=t.$b||null,this.j=t.ib||!1}function xf(t,e){Dd.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=Af,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}lf.prototype.cancel=function(){if(this.i=yf(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}},_f.prototype.stringify=function(t){return gu.JSON.stringify(t,void 0)},_f.prototype.parse=function(t){return gu.JSON.parse(t,void 0)},Cu(Tf,dp),Tf.prototype.g=function(){return new xf(this.l,this.j)},Tf.prototype.i=function(t){return function(){return t}}({}),Cu(xf,Dd);var Af=0;function kf(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function Cf(t){t.readyState=4,t.l=null,t.j=null,t.A=null,Ef(t)}function Ef(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(du=xf.prototype).open=function(t,e){if(this.readyState!=Af)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,Ef(this)},du.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||gu).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},du.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Cf(this)),this.readyState=Af},du.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Ef(this)),this.g&&(this.readyState=3,Ef(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==gu.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;kf(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},du.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?Cf(this):Ef(this),3==this.readyState&&kf(this)}},du.Ua=function(t){this.g&&(this.response=this.responseText=t,Cf(this))},du.Ta=function(t){this.g&&(this.response=t,Cf(this))},du.ha=function(){this.g&&Cf(this)},du.setRequestHeader=function(t,e){this.v.append(t,e)},du.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},du.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(xf.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var Sf=gu.JSON.parse;function Mf(t){Dd.call(this),this.headers=new Lp,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=If,this.K=this.L=!1}Cu(Mf,Dd);var If="",Df=/^https?$/i,Pf=["POST","PUT"];function Of(t){return"content-type"==t.toLowerCase()}function Rf(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Nf(t),Lf(t)}function Nf(t){t.D||(t.D=!0,Pd(t,"complete"),Pd(t,"error"))}function Vf(t){if(t.h&&void 0!==mu&&(!t.C[1]||4!=Ff(t)||2!=t.ba()))if(t.v&&4==Ff(t))Gd(t.Fa,0,t);else if(Pd(t,"readystatechange"),4==Ff(t)){t.h=!1;try{const a=t.ba();t:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var s;if(s=0===a){var i=String(t.H).match(jp)[1]||null;if(!i&&gu.self&&gu.self.location){var r=gu.self.location.protocol;i=r.substr(0,r.length-1)}s=!Df.test(i?i.toLowerCase():"")}n=s}if(n)Pd(t,"complete"),Pd(t,"success");else{t.m=6;try{var o=2<Ff(t)?t.g.statusText:""}catch(t){o=""}t.j=o+" ["+t.ba()+"]",Nf(t)}}finally{Lf(t)}}}function Lf(t,e){if(t.g){qf(t);const n=t.g,s=t.C[0]?yu:null;t.g=null,t.C=null,e||Pd(t,"ready");try{n.onreadystatechange=s}catch(t){}}}function qf(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(gu.clearTimeout(t.A),t.A=null)}function Ff(t){return t.g?t.g.readyState:0}function jf(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case If:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Uf(t,e,n){t:{for(s in n){var s=!1;break t}s=!0}s||(n=function(t){let e="";return ju(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Hp(t,e,n))}function Bf(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function zf(t){this.za=0,this.l=[],this.h=new Jd,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Bf("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Bf("baseRetryDelayMs",5e3,t),this.$a=Bf("retryDelaySeedMs",1e4,t),this.Ya=Bf("forwardChannelMaxRetries",2,t),this.ra=Bf("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new lf(t&&t.concurrentRequestLimit),this.Ca=new vf,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function Wf(t){if(Gf(t),3==t.G){var e=t.V++,n=Bp(t.F);Hp(n,"SID",t.J),Hp(n,"RID",e),Hp(n,"TYPE","terminate"),Yf(t,n),(e=new wp(t,t.h,e,void 0)).K=2,e.v=Kp(Bp(n)),n=!1,gu.navigator&&gu.navigator.sendBeacon&&(n=gu.navigator.sendBeacon(e.v.toString(),"")),!n&&gu.Image&&((new Image).src=e.v,n=!0),n||(e.g=cm(e.l,null),e.g.ea(e.v)),e.F=Date.now(),Ip(e)}om(t)}function $f(t){t.g&&(tm(t),t.g.cancel(),t.g=null)}function Gf(t){$f(t),t.u&&(gu.clearTimeout(t.u),t.u=null),nm(t),t.i.cancel(),t.m&&("number"==typeof t.m&&gu.clearTimeout(t.m),t.m=null)}function Hf(t,e){t.l.push(new class{constructor(t,e){this.h=t,this.g=e}}(t.Za++,e)),3==t.G&&Kf(t)}function Kf(t){df(t.i)||t.m||(t.m=!0,jd(t.Ha,t),t.C=0)}function Xf(t,e){var n;n=e?e.m:t.V++;const s=Bp(t.F);Hp(s,"SID",t.J),Hp(s,"RID",n),Hp(s,"AID",t.U),Yf(t,s),t.o&&t.s&&Uf(s,t.o,t.s),n=new wp(t,t.h,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=Qf(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),mf(t.i,n),kp(n,s,e)}function Yf(t,e){t.j&&Vp({},(function(t,n){Hp(e,n,t)}))}function Qf(t,e,n){n=Math.min(t.l.length,n);var s=t.j?Au(t.j.Oa,t.j,t):null;t:{var i=t.l;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=i[0].h,t.push("ofs="+e)):e=0:t.push("ofs="+e);let r=!0;for(let o=0;o<n;o++){let n=i[o].h;const a=i[o].g;if(n-=e,0>n)e=Math.max(0,i[o].h-100),r=!1;else try{wf(a,t,"req"+n+"_")}catch(t){s&&s(a)}}if(r){s=t.join("&");break t}}}return t=t.l.splice(0,n),e.D=t,s}function Zf(t){t.g||t.u||(t.Y=1,jd(t.Ga,t),t.A=0)}function Jf(t){return!(t.g||t.u||3<=t.A)&&(t.Y++,t.u=hp(Au(t.Ga,t),im(t,t.A)),t.A++,!0)}function tm(t){null!=t.B&&(gu.clearTimeout(t.B),t.B=null)}function em(t){t.g=new wp(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=Bp(t.oa);Hp(e,"RID","rpc"),Hp(e,"SID",t.J),Hp(e,"CI",t.N?"0":"1"),Hp(e,"AID",t.U),Yf(t,e),Hp(e,"TYPE","xmlhttp"),t.o&&t.s&&Uf(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=Kp(Bp(e)),n.s=null,n.U=!0,Cp(n,t)}function nm(t){null!=t.v&&(gu.clearTimeout(t.v),t.v=null)}function sm(t,e){var n=null;if(t.g==e){nm(t),tm(t),t.g=null;var s=2}else{if(!ff(t.i,e))return;n=e.D,gf(t.i,e),s=1}if(t.I=e.N,0!=t.G)if(e.i)if(1==s){n=e.s?e.s.length:0,e=Date.now()-e.F;var i=t.C;Pd(s=sp(),new cp(s,n,e,i)),Kf(t)}else Zf(t);else if(3==(i=e.o)||0==i&&0<t.I||!(1==s&&function(t,e){return!(pf(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.l=e.D.concat(t.l),0):1==t.G||2==t.G||t.C>=(t.Xa?0:t.Ya)||(t.m=hp(Au(t.Ha,t,e),im(t,t.C)),t.C++,0)))}(t,e)||2==s&&Jf(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),i){case 1:rm(t,5);break;case 4:rm(t,10);break;case 3:rm(t,6);break;default:rm(t,2)}}function im(t,e){let n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function rm(t,e){if(t.h.info("Error code "+e),2==e){var n=null;t.j&&(n=null);var s=Au(t.jb,t);n||(n=new Up("//www.google.com/images/cleardot.gif"),gu.location&&"http"==gu.location.protocol||zp(n,"https"),Kp(n)),function(t,e){const n=new Jd;if(gu.Image){const s=new Image;s.onload=ku(bf,n,s,"TestLoadImage: loaded",!0,e),s.onerror=ku(bf,n,s,"TestLoadImage: error",!1,e),s.onabort=ku(bf,n,s,"TestLoadImage: abort",!1,e),s.ontimeout=ku(bf,n,s,"TestLoadImage: timeout",!1,e),gu.setTimeout((function(){s.ontimeout&&s.ontimeout()}),1e4),s.src=t}else e(!1)}(n.toString(),s)}else ap(2);t.G=0,t.j&&t.j.va(e),om(t),Gf(t)}function om(t){t.G=0,t.I=-1,t.j&&(0==yf(t.i).length&&0==t.l.length||(t.i.i.length=0,Pu(t.l),t.l.length=0),t.j.ua())}function am(t,e,n){let s=function(t){return t instanceof Up?Bp(t):new Up(t,void 0)}(n);if(""!=s.i)e&&Wp(s,e+"."+s.i),$p(s,s.m);else{const t=gu.location;s=function(t,e,n,s){var i=new Up(null,void 0);return t&&zp(i,t),e&&Wp(i,e),n&&$p(i,n),s&&(i.l=s),i}(t.protocol,e?e+"."+t.hostname:t.hostname,+t.port,n)}return t.aa&&ju(t.aa,(function(t,e){Hp(s,e,t)})),e=t.D,n=t.sa,e&&n&&Hp(s,e,n),Hp(s,"VER",t.ma),Yf(t,s),s}function cm(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=n&&t.Ba&&!t.qa?new Mf(new Tf({ib:!0})):new Mf(t.qa)).L=t.H,e}function hm(){}function lm(){if(Ku&&!(10<=Number(ad)))throw Error("Environmental error: no available transport.")}function um(t,e){Dd.call(this),this.g=new zf(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!Ou(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Ou(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&(e in(t=this.h)&&delete t[e])),this.j=new fm(this)}function dm(t){yp.call(this);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function pm(){_p.call(this),this.status=1}function fm(t){this.g=t}(du=Mf.prototype).ea=function(t,e,n,s){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():mp.g(),this.C=this.u?pp(this.u):pp(mp),this.g.onreadystatechange=Au(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(t){return void Rf(this,t)}t=n||"";const i=new Lp(this.headers);s&&Vp(s,(function(t,e){i.set(e,t)})),s=function(t){t:{var e=Of;const n=t.length,s="string"==typeof t?t.split(""):t;for(let i=0;i<n;i++)if(i in s&&e.call(void 0,s[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.T()),n=gu.FormData&&t instanceof gu.FormData,!(0<=Mu(Pf,e))||s||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(t,e){this.g.setRequestHeader(e,t)}),this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{qf(this),0<this.B&&((this.K=function(t){return Ku&&rd()&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Au(this.pa,this)):this.A=Gd(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){Rf(this,t)}},du.pa=function(){void 0!==mu&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Pd(this,"timeout"),this.abort(8))},du.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Pd(this,"complete"),Pd(this,"abort"),Lf(this))},du.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Lf(this,!0)),Mf.Z.M.call(this)},du.Fa=function(){this.s||(this.F||this.v||this.l?Vf(this):this.cb())},du.cb=function(){Vf(this)},du.ba=function(){try{return 2<Ff(this)?this.g.status:-1}catch(t){return-1}},du.ga=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},du.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Sf(e)}},du.Da=function(){return this.m},du.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(du=zf.prototype).ma=8,du.G=1,du.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(t){}},du.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;const i=new wp(this,this.h,t,void 0);let r=this.s;if(this.P&&(r?(r=Uu(r),zu(r,this.P)):r=this.P),null===this.o&&(i.H=r),this.ja)t:{for(var e=0,n=0;n<this.l.length;n++){var s=this.l[n];if(void 0===(s="__data__"in s.g&&"string"==typeof(s=s.g.__data__)?s.length:void 0))break;if(4096<(e+=s)){e=n;break t}if(4096===e||n===this.l.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=Qf(this,i,e),Hp(n=Bp(this.F),"RID",t),Hp(n,"CVER",22),this.D&&Hp(n,"X-HTTP-Session-Id",this.D),Yf(this,n),this.o&&r&&Uf(n,this.o,r),mf(this.i,i),this.Ra&&Hp(n,"TYPE","init"),this.ja?(Hp(n,"$req",e),Hp(n,"SID","null"),i.$=!0,kp(i,n,null)):kp(i,n,e),this.G=2}}else 3==this.G&&(t?Xf(this,t):0==this.l.length||df(this.i)||Xf(this))},du.Ga=function(){if(this.u=null,em(this),this.$&&!(this.L||null==this.g||0>=this.O)){var t=2*this.O;this.h.info("BP detection timer enabled: "+t),this.B=hp(Au(this.bb,this),t)}},du.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,ap(10),$f(this),em(this))},du.ab=function(){null!=this.v&&(this.v=null,$f(this),Jf(this),ap(19))},du.jb=function(t){t?(this.h.info("Successfully pinged google.com"),ap(2)):(this.h.info("Failed to ping google.com"),ap(1))},(du=hm.prototype).xa=function(){},du.wa=function(){},du.va=function(){},du.ua=function(){},du.Oa=function(){},lm.prototype.g=function(t,e){return new um(t,e)},Cu(um,Dd),um.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),jd(Au(t.hb,t,e))),ap(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=am(t,null,t.W),Kf(t)},um.prototype.close=function(){Wf(this.g)},um.prototype.u=function(t){if("string"==typeof t){var e={};e.__data__=t,Hf(this.g,e)}else this.v?((e={}).__data__=Rd(t),Hf(this.g,e)):Hf(this.g,t)},um.prototype.M=function(){this.g.j=null,delete this.j,Wf(this.g),delete this.g,um.Z.M.call(this)},Cu(dm,yp),Cu(pm,_p),Cu(fm,hm),fm.prototype.xa=function(){Pd(this.g,"a")},fm.prototype.wa=function(t){Pd(this.g,new dm(t))},fm.prototype.va=function(t){Pd(this.g,new pm(t))},fm.prototype.ua=function(){Pd(this.g,"b")},lm.prototype.createWebChannel=lm.prototype.g,um.prototype.send=um.prototype.u,um.prototype.open=um.prototype.m,um.prototype.close=um.prototype.close,lp.NO_ERROR=0,lp.TIMEOUT=8,lp.HTTP_ERROR=6,up.COMPLETE="complete",fp.EventType=gp,gp.OPEN="a",gp.CLOSE="b",gp.ERROR="c",gp.MESSAGE="d",Dd.prototype.listen=Dd.prototype.N,Mf.prototype.listenOnce=Mf.prototype.O,Mf.prototype.getLastError=Mf.prototype.La,Mf.prototype.getLastErrorCode=Mf.prototype.Da,Mf.prototype.getStatus=Mf.prototype.ba,Mf.prototype.getResponseJson=Mf.prototype.Qa,Mf.prototype.getResponseText=Mf.prototype.ga,Mf.prototype.send=Mf.prototype.ea;var mm,gm,ym=fu.createWebChannelTransport=function(){return new lm},_m=fu.getStatEventTarget=function(){return sp()},vm=fu.ErrorCode=lp,wm=fu.EventType=up,bm=fu.Event=ep,Tm=fu.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},xm=fu.FetchXmlHttpFactory=Tf,Am=fu.WebChannel=fp,km=fu.XhrIo=Mf,Cm={};function Em(){throw new Error("setTimeout has not been defined")}function Sm(){throw new Error("clearTimeout has not been defined")}function Mm(t){if(mm===setTimeout)return setTimeout(t,0);if((mm===Em||!mm)&&setTimeout)return mm=setTimeout,setTimeout(t,0);try{return mm(t,0)}catch(e){try{return mm.call(null,t,0)}catch(e){return mm.call(this,t,0)}}}!function(){try{mm="function"==typeof setTimeout?setTimeout:Em}catch(t){mm=Em}try{gm="function"==typeof clearTimeout?clearTimeout:Sm}catch(t){gm=Sm}}();var Im,Dm=[],Pm=!1,Om=-1;function Rm(){Pm&&Im&&(Pm=!1,Im.length?Dm=Im.concat(Dm):Om=-1,Dm.length&&Nm())}function Nm(){if(!Pm){var t=Mm(Rm);Pm=!0;for(var e=Dm.length;e;){for(Im=Dm,Dm=[];++Om<e;)Im&&Im[Om].run();Om=-1,e=Dm.length}Im=null,Pm=!1,function(t){if(gm===clearTimeout)return clearTimeout(t);if((gm===Sm||!gm)&&clearTimeout)return gm=clearTimeout,clearTimeout(t);try{gm(t)}catch(e){try{return gm.call(null,t)}catch(e){return gm.call(this,t)}}}(t)}}function Vm(t,e){this.fun=t,this.array=e}function Lm(){}Cm.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];Dm.push(new Vm(t,e)),1!==Dm.length||Pm||Mm(Nm)},Vm.prototype.run=function(){this.fun.apply(null,this.array)},Cm.title="browser",Cm.browser=!0,Cm.env={},Cm.argv=[],Cm.version="",Cm.versions={},Cm.on=Lm,Cm.addListener=Lm,Cm.once=Lm,Cm.off=Lm,Cm.removeListener=Lm,Cm.removeAllListeners=Lm,Cm.emit=Lm,Cm.prependListener=Lm,Cm.prependOnceListener=Lm,Cm.listeners=function(t){return[]},Cm.binding=function(t){throw new Error("process.binding is not supported")},Cm.cwd=function(){return"/"},Cm.chdir=function(t){throw new Error("process.chdir is not supported")},Cm.umask=function(){return 0};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class qm{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}qm.UNAUTHENTICATED=new qm(null),qm.GOOGLE_CREDENTIALS=new qm("google-credentials-uid"),qm.FIRST_PARTY=new qm("first-party-uid"),qm.MOCK_USER=new qm("mock-user");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
let Fm="9.6.5";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jm=new hl("@firebase/firestore");function Um(){return jm.logLevel}function Bm(t,...e){if(jm.logLevel<=il.DEBUG){const n=e.map($m);jm.debug(`Firestore (${Fm}): ${t}`,...n)}}function zm(t,...e){if(jm.logLevel<=il.ERROR){const n=e.map($m);jm.error(`Firestore (${Fm}): ${t}`,...n)}}function Wm(t,...e){if(jm.logLevel<=il.WARN){const n=e.map($m);jm.warn(`Firestore (${Fm}): ${t}`,...n)}}function $m(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gm(t="Unexpected state"){const e=`FIRESTORE (${Fm}) INTERNAL ASSERTION FAILED: `+t;throw zm(e),new Error(e)}function Hm(t,e){t||Gm()}function Km(t,e){return t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xm={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ym extends Hh{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qm{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zm{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class Jm{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(qm.UNAUTHENTICATED)))}shutdown(){}}class tg{constructor(t){this.t=t,this.currentUser=qm.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const s=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let i=new Qm;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Qm,t.enqueueRetryable((()=>s(this.currentUser)))};const r=()=>{const e=i;t.enqueueRetryable((async()=>{await e.promise,await s(this.currentUser)}))},o=t=>{Bm("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),r()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(Bm("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Qm)}}),0),r()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(Bm("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(Hm("string"==typeof e.accessToken),new Zm(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return Hm(null===t||"string"==typeof t),new qm(t)}}class eg{constructor(t,e,n){this.type="FirstParty",this.user=qm.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",e);const s=t.auth.getAuthHeaderValueForFirstParty([]);s&&this.headers.set("Authorization",s),n&&this.headers.set("X-Goog-Iam-Authorization-Token",n)}}class ng{constructor(t,e,n){this.h=t,this.l=e,this.m=n}getToken(){return Promise.resolve(new eg(this.h,this.l,this.m))}start(t,e){t.enqueueRetryable((()=>e(qm.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class sg{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ig{constructor(t){this.g=t,this.forceRefresh=!1,this.appCheck=null}start(t,e){this.o=n=>{t.enqueueRetryable((()=>{return null!=(t=n).error&&Bm("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`),e(t.token);var t}))};const n=t=>{Bm("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.g.onInit((t=>n(t))),setTimeout((()=>{if(!this.appCheck){const t=this.g.getImmediate({optional:!0});t?n(t):Bm("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(Hm("string"==typeof t.token),new sg(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class rg{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.p(t),this.T=t=>e.writeSequenceNumber(t))}p(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.T&&this.T(t),t}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function og(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */rg.I=-1;class ag{static A(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const s=og(40);for(let i=0;i<s.length;++i)n.length<20&&s[i]<e&&(n+=t.charAt(s[i]%t.length))}return n}}function cg(t,e){return t<e?-1:t>e?1:0}function hg(t,e,n){return t.length===e.length&&t.every(((t,s)=>n(t,e[s])))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class lg{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Ym(Xm.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Ym(Xm.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Ym(Xm.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Ym(Xm.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return lg.fromMillis(Date.now())}static fromDate(t){return lg.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new lg(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?cg(this.nanoseconds,t.nanoseconds):cg(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ug{constructor(t){this.timestamp=t}static fromTimestamp(t){return new ug(t)}static min(){return new ug(new lg(0,0))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dg(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function pg(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function fg(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mg{constructor(t,e,n){void 0===e?e=0:e>t.length&&Gm(),void 0===n?n=t.length-e:n>t.length-e&&Gm(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===mg.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof mg?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let s=0;s<n;s++){const n=t.get(s),i=e.get(s);if(n<i)return-1;if(n>i)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class gg extends mg{construct(t,e,n){return new gg(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new Ym(Xm.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new gg(e)}static emptyPath(){return new gg([])}}const yg=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class _g extends mg{construct(t,e,n){return new _g(t,e,n)}static isValidIdentifier(t){return yg.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),_g.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new _g(["__name__"])}static fromServerFormat(t){const e=[];let n="",s=0;const i=()=>{if(0===n.length)throw new Ym(Xm.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let r=!1;for(;s<t.length;){const e=t[s];if("\\"===e){if(s+1===t.length)throw new Ym(Xm.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[s+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new Ym(Xm.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,s+=2}else"`"===e?(r=!r,s++):"."!==e||r?(n+=e,s++):(i(),s++)}if(i(),r)throw new Ym(Xm.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new _g(e)}static emptyPath(){return new _g([])}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class vg{constructor(t){this.binaryString=t}static fromBase64String(t){const e=atob(t);return new vg(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new vg(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){var t;return t=this.binaryString,btoa(t)}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return cg(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}vg.EMPTY_BYTE_STRING=new vg("");const wg=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function bg(t){if(Hm(!!t),"string"==typeof t){let e=0;const n=wg.exec(t);if(Hm(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const s=new Date(t);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:Tg(t.seconds),nanos:Tg(t.nanos)}}function Tg(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function xg(t){return"string"==typeof t?vg.fromBase64String(t):vg.fromUint8Array(t)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ag(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function kg(t){const e=t.mapValue.fields.__previous_value__;return Ag(e)?kg(e):e}function Cg(t){const e=bg(t.mapValue.fields.__local_write_time__.timestampValue);return new lg(e.seconds,e.nanos)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eg(t){return null==t}function Sg(t){return 0===t&&1/t==-1/0}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Mg{constructor(t){this.path=t}static fromPath(t){return new Mg(gg.fromString(t))}static fromName(t){return new Mg(gg.fromString(t).popFirst(5))}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}isEqual(t){return null!==t&&0===gg.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return gg.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new Mg(new gg(t.slice()))}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ig(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Ag(t)?4:10:Gm()}function Dg(t,e){if(t===e)return!0;const n=Ig(t);if(n!==Ig(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Cg(t).isEqual(Cg(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=bg(t.timestampValue),s=bg(e.timestampValue);return n.seconds===s.seconds&&n.nanos===s.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return s=e,xg(t.bytesValue).isEqual(xg(s.bytesValue));case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Tg(t.geoPointValue.latitude)===Tg(e.geoPointValue.latitude)&&Tg(t.geoPointValue.longitude)===Tg(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Tg(t.integerValue)===Tg(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=Tg(t.doubleValue),s=Tg(e.doubleValue);return n===s?Sg(n)===Sg(s):isNaN(n)&&isNaN(s)}return!1}(t,e);case 9:return hg(t.arrayValue.values||[],e.arrayValue.values||[],Dg);case 10:return function(t,e){const n=t.mapValue.fields||{},s=e.mapValue.fields||{};if(dg(n)!==dg(s))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===s[t]||!Dg(n[t],s[t])))return!1;return!0}(t,e);default:return Gm()}var s}function Pg(t,e){return void 0!==(t.values||[]).find((t=>Dg(t,e)))}function Og(t,e){if(t===e)return 0;const n=Ig(t),s=Ig(e);if(n!==s)return cg(n,s);switch(n){case 0:return 0;case 1:return cg(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=Tg(t.integerValue||t.doubleValue),s=Tg(e.integerValue||e.doubleValue);return n<s?-1:n>s?1:n===s?0:isNaN(n)?isNaN(s)?0:-1:1}(t,e);case 3:return Rg(t.timestampValue,e.timestampValue);case 4:return Rg(Cg(t),Cg(e));case 5:return cg(t.stringValue,e.stringValue);case 6:return function(t,e){const n=xg(t),s=xg(e);return n.compareTo(s)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),s=e.split("/");for(let t=0;t<n.length&&t<s.length;t++){const e=cg(n[t],s[t]);if(0!==e)return e}return cg(n.length,s.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=cg(Tg(t.latitude),Tg(e.latitude));return 0!==n?n:cg(Tg(t.longitude),Tg(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],s=e.values||[];for(let t=0;t<n.length&&t<s.length;++t){const e=Og(n[t],s[t]);if(e)return e}return cg(n.length,s.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){const n=t.fields||{},s=Object.keys(n),i=e.fields||{},r=Object.keys(i);s.sort(),r.sort();for(let t=0;t<s.length&&t<r.length;++t){const e=cg(s[t],r[t]);if(0!==e)return e;const o=Og(n[s[t]],i[r[t]]);if(0!==o)return o}return cg(s.length,r.length)}(t.mapValue,e.mapValue);default:throw Gm()}}function Rg(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return cg(t,e);const n=bg(t),s=bg(e),i=cg(n.seconds,s.seconds);return 0!==i?i:cg(n.nanos,s.nanos)}function Ng(t){return Vg(t)}function Vg(t){var e,n;return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=bg(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?xg(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,Mg.fromName(n).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(t){let e="[",n=!0;for(const s of t.values||[])n?n=!1:e+=",",e+=Vg(s);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",s=!0;for(const i of e)s?s=!1:n+=",",n+=`${i}:${Vg(t.fields[i])}`;return n+"}"}(t.mapValue):Gm()}function Lg(t){return!!t&&"integerValue"in t}function qg(t){return!!t&&"arrayValue"in t}function Fg(t){return!!t&&"nullValue"in t}function jg(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ug(t){return!!t&&"mapValue"in t}function Bg(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return pg(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=Bg(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Bg(t.arrayValue.values[n]);return e}return Object.assign({},t)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zg{constructor(t){this.value=t}static empty(){return new zg({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Ug(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Bg(e)}setAll(t){let e=_g.emptyPath(),n={},s=[];t.forEach(((t,i)=>{if(!e.isImmediateParentOf(i)){const t=this.getFieldsMap(e);this.applyChanges(t,n,s),n={},s=[],e=i.popLast()}t?n[i.lastSegment()]=Bg(t):s.push(i.lastSegment())}));const i=this.getFieldsMap(e);this.applyChanges(i,n,s)}delete(t){const e=this.field(t.popLast());Ug(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Dg(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let s=e.mapValue.fields[t.get(n)];Ug(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,n){pg(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new zg(Bg(this.value))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Wg{constructor(t,e,n,s,i){this.key=t,this.documentType=e,this.version=n,this.data=s,this.documentState=i}static newInvalidDocument(t){return new Wg(t,0,ug.min(),zg.empty(),0)}static newFoundDocument(t,e,n){return new Wg(t,1,e,n,0)}static newNoDocument(t,e){return new Wg(t,2,e,zg.empty(),0)}static newUnknownDocument(t,e){return new Wg(t,3,e,zg.empty(),2)}convertToFoundDocument(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=zg.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=zg.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof Wg&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Wg(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $g{constructor(t,e=null,n=[],s=[],i=null,r=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=r,this.endAt=o,this.R=null}}function Gg(t,e=null,n=[],s=[],i=null,r=null,o=null){return new $g(t,e,n,s,i,r,o)}function Hg(t){const e=Km(t);if(null===e.R){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>function(t){return t.field.canonicalString()+t.op.toString()+Ng(t.value)}(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>{return(e=t).field.canonicalString()+e.dir;var e})).join(","),Eg(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=oy(e.startAt)),e.endAt&&(t+="|ub:",t+=oy(e.endAt)),e.R=t}return e.R}function Kg(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!cy(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let i=0;i<t.filters.length;i++)if(n=t.filters[i],s=e.filters[i],n.op!==s.op||!n.field.isEqual(s.field)||!Dg(n.value,s.value))return!1;var n,s;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!ly(t.startAt,e.startAt)&&ly(t.endAt,e.endAt)}function Xg(t){return Mg.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Yg extends class{}{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.P(t,e,n):new Qg(t,e,n):"array-contains"===e?new ey(t,n):"in"===e?new ny(t,n):"not-in"===e?new sy(t,n):"array-contains-any"===e?new iy(t,n):new Yg(t,e,n)}static P(t,e,n){return"in"===e?new Zg(t,n):new Jg(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.v(Og(e,this.value)):null!==e&&Ig(this.value)===Ig(e)&&this.v(Og(e,this.value))}v(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Gm()}}V(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class Qg extends Yg{constructor(t,e,n){super(t,e,n),this.key=Mg.fromName(n.referenceValue)}matches(t){const e=Mg.comparator(t.key,this.key);return this.v(e)}}class Zg extends Yg{constructor(t,e){super(t,"in",e),this.keys=ty("in",e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class Jg extends Yg{constructor(t,e){super(t,"not-in",e),this.keys=ty("not-in",e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function ty(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>Mg.fromName(t.referenceValue)))}class ey extends Yg{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return qg(e)&&Pg(e.arrayValue,this.value)}}class ny extends Yg{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Pg(this.value.arrayValue,e)}}class sy extends Yg{constructor(t,e){super(t,"not-in",e)}matches(t){if(Pg(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!Pg(this.value.arrayValue,e)}}class iy extends Yg{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!qg(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>Pg(this.value.arrayValue,t)))}}class ry{constructor(t,e){this.position=t,this.before=e}}function oy(t){return`${t.before?"b":"a"}:${t.position.map((t=>Ng(t))).join(",")}`}class ay{constructor(t,e="asc"){this.field=t,this.dir=e}}function cy(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function hy(t,e,n){let s=0;for(let i=0;i<t.position.length;i++){const r=e[i],o=t.position[i];if(s=r.field.isKeyField()?Mg.comparator(Mg.fromName(o.referenceValue),n.key):Og(o,n.data.field(r.field)),"desc"===r.dir&&(s*=-1),0!==s)break}return t.before?s<=0:s<0}function ly(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Dg(t.position[n],e.position[n]))return!1;return!0}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uy{constructor(t,e=null,n=[],s=[],i=null,r="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=s,this.limit=i,this.limitType=r,this.startAt=o,this.endAt=a,this.S=null,this.D=null,this.startAt,this.endAt}}function dy(t,e,n,s,i,r,o,a){return new uy(t,e,n,s,i,r,o,a)}function py(t){return new uy(t)}function fy(t){return!Eg(t.limit)&&"F"===t.limitType}function my(t){return!Eg(t.limit)&&"L"===t.limitType}function gy(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function yy(t){for(const e of t.filters)if(e.V())return e.field;return null}function _y(t){return null!==t.collectionGroup}function vy(t){const e=Km(t);if(null===e.S){e.S=[];const t=yy(e),n=gy(e);if(null!==t&&null===n)t.isKeyField()||e.S.push(new ay(t)),e.S.push(new ay(_g.keyField(),"asc"));else{let t=!1;for(const n of e.explicitOrderBy)e.S.push(n),n.field.isKeyField()&&(t=!0);if(!t){const t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.S.push(new ay(_g.keyField(),t))}}}return e.S}function wy(t){const e=Km(t);if(!e.D)if("F"===e.limitType)e.D=Gg(e.path,e.collectionGroup,vy(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of vy(e)){const e="desc"===n.dir?"asc":"desc";t.push(new ay(n.field,e))}const n=e.endAt?new ry(e.endAt.position,!e.endAt.before):null,s=e.startAt?new ry(e.startAt.position,!e.startAt.before):null;e.D=Gg(e.path,e.collectionGroup,t,e.filters,e.limit,n,s)}return e.D}function by(t,e,n){return new uy(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Ty(t,e){return Kg(wy(t),wy(e))&&t.limitType===e.limitType}function xy(t){return`${Hg(wy(t))}|lt:${t.limitType}`}function Ay(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>{var e;return`${(e=t).field.canonicalString()} ${e.op} ${Ng(e.value)}`})).join(", ")}]`),Eg(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>{return`${(e=t).field.canonicalString()} (${e.dir})`;var e})).join(", ")}]`),t.startAt&&(e+=", startAt: "+oy(t.startAt)),t.endAt&&(e+=", endAt: "+oy(t.endAt)),`Target(${e})`}(wy(t))}; limitType=${t.limitType})`}function ky(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):Mg.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of t.explicitOrderBy)if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&(s=e,!((n=t).startAt&&!hy(n.startAt,vy(n),s)||n.endAt&&hy(n.endAt,vy(n),s)));var n,s}function Cy(t){return(e,n)=>{let s=!1;for(const i of vy(t)){const t=Ey(i,e,n);if(0!==t)return t;s=s||i.field.isKeyField()}return 0}}function Ey(t,e,n){const s=t.field.isKeyField()?Mg.comparator(e.key,n.key):function(t,e,n){const s=e.data.field(t),i=n.data.field(t);return null!==s&&null!==i?Og(s,i):Gm()}(t.field,e,n);switch(t.dir){case"asc":return s;case"desc":return-1*s;default:return Gm()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sy(t,e){if(t.C){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Sg(e)?"-0":e}}function My(t){return{integerValue:""+t}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iy{constructor(){this._=void 0}}function Dy(t,e,n){return t instanceof Ry?Ny(t,e):t instanceof Vy?Ly(t,e):n}function Py(t,e){var n,s;return t instanceof qy?Lg(n=e)||(s=n)&&"doubleValue"in s?e:{integerValue:0}:null}class Oy extends Iy{}class Ry extends Iy{constructor(t){super(),this.elements=t}}function Ny(t,e){const n=jy(e);for(const e of t.elements)n.some((t=>Dg(t,e)))||n.push(e);return{arrayValue:{values:n}}}class Vy extends Iy{constructor(t){super(),this.elements=t}}function Ly(t,e){let n=jy(e);for(const e of t.elements)n=n.filter((t=>!Dg(t,e)));return{arrayValue:{values:n}}}class qy extends Iy{constructor(t,e){super(),this.k=t,this.N=e}}function Fy(t){return Tg(t.integerValue||t.doubleValue)}function jy(t){return qg(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uy(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class By{}function zy(t,e,n){var s;t instanceof Hy?function(t,e,n){const s=t.value.clone(),i=Yy(t.fieldTransforms,e,n.transformResults);s.setAll(i),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):t instanceof Ky?function(t,e,n){if(!Uy(t.precondition,e))return void e.convertToUnknownDocument(n.version);const s=Yy(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(Xy(t)),i.setAll(s),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):(s=n,e.convertToNoDocument(s.version).setHasCommittedMutations())}function Wy(t,e,n){var s;t instanceof Hy?function(t,e,n){if(!Uy(t.precondition,e))return;const s=t.value.clone(),i=Qy(t.fieldTransforms,n,e);s.setAll(i),e.convertToFoundDocument(Gy(e),s).setHasLocalMutations()}(t,e,n):t instanceof Ky?function(t,e,n){if(!Uy(t.precondition,e))return;const s=Qy(t.fieldTransforms,n,e),i=e.data;i.setAll(Xy(t)),i.setAll(s),e.convertToFoundDocument(Gy(e),i).setHasLocalMutations()}(t,e,n):(s=e,Uy(t.precondition,s)&&s.convertToNoDocument(ug.min()))}function $y(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&(n=t.fieldTransforms,s=e.fieldTransforms,!!(void 0===n&&void 0===s||n&&s&&hg(n,s,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&(n=t.transform,s=e.transform,n instanceof Ry&&s instanceof Ry||n instanceof Vy&&s instanceof Vy?hg(n.elements,s.elements,Dg):n instanceof qy&&s instanceof qy?Dg(n.N,s.N):n instanceof Oy&&s instanceof Oy);var n,s}(t,e)))))&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask));var n,s}function Gy(t){return t.isFoundDocument()?t.version:ug.min()}class Hy extends By{constructor(t,e,n,s=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=s,this.type=0}}class Ky extends By{constructor(t,e,n,s,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=s,this.fieldTransforms=i,this.type=1}}function Xy(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const s=t.data.field(n);e.set(n,s)}})),e}function Yy(t,e,n){const s=new Map;Hm(t.length===n.length);for(let i=0;i<n.length;i++){const r=t[i],o=r.transform,a=e.data.field(r.field);s.set(r.field,Dy(o,a,n[i]))}return s}function Qy(t,e,n){const s=new Map;for(const a of t){const t=a.transform,c=n.data.field(a.field);s.set(a.field,(r=c,o=e,(i=t)instanceof Oy?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(o,r):i instanceof Ry?Ny(i,r):i instanceof Vy?Ly(i,r):function(t,e){const n=Py(t,e),s=Fy(n)+Fy(t.N);return Lg(n)&&Lg(t.N)?My(s):Sy(t.k,s)}(i,r)))}var i,r,o;return s}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Zy{constructor(t){this.count=t}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Jy,t_;function e_(t){if(void 0===t)return zm("GRPC error has no .code"),Xm.UNKNOWN;switch(t){case Jy.OK:return Xm.OK;case Jy.CANCELLED:return Xm.CANCELLED;case Jy.UNKNOWN:return Xm.UNKNOWN;case Jy.DEADLINE_EXCEEDED:return Xm.DEADLINE_EXCEEDED;case Jy.RESOURCE_EXHAUSTED:return Xm.RESOURCE_EXHAUSTED;case Jy.INTERNAL:return Xm.INTERNAL;case Jy.UNAVAILABLE:return Xm.UNAVAILABLE;case Jy.UNAUTHENTICATED:return Xm.UNAUTHENTICATED;case Jy.INVALID_ARGUMENT:return Xm.INVALID_ARGUMENT;case Jy.NOT_FOUND:return Xm.NOT_FOUND;case Jy.ALREADY_EXISTS:return Xm.ALREADY_EXISTS;case Jy.PERMISSION_DENIED:return Xm.PERMISSION_DENIED;case Jy.FAILED_PRECONDITION:return Xm.FAILED_PRECONDITION;case Jy.ABORTED:return Xm.ABORTED;case Jy.OUT_OF_RANGE:return Xm.OUT_OF_RANGE;case Jy.UNIMPLEMENTED:return Xm.UNIMPLEMENTED;case Jy.DATA_LOSS:return Xm.DATA_LOSS;default:return Gm()}}(t_=Jy||(Jy={}))[t_.OK=0]="OK",t_[t_.CANCELLED=1]="CANCELLED",t_[t_.UNKNOWN=2]="UNKNOWN",t_[t_.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",t_[t_.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",t_[t_.NOT_FOUND=5]="NOT_FOUND",t_[t_.ALREADY_EXISTS=6]="ALREADY_EXISTS",t_[t_.PERMISSION_DENIED=7]="PERMISSION_DENIED",t_[t_.UNAUTHENTICATED=16]="UNAUTHENTICATED",t_[t_.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",t_[t_.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",t_[t_.ABORTED=10]="ABORTED",t_[t_.OUT_OF_RANGE=11]="OUT_OF_RANGE",t_[t_.UNIMPLEMENTED=12]="UNIMPLEMENTED",t_[t_.INTERNAL=13]="INTERNAL",t_[t_.UNAVAILABLE=14]="UNAVAILABLE",t_[t_.DATA_LOSS=15]="DATA_LOSS";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class n_{constructor(t,e){this.comparator=t,this.root=e||i_.EMPTY}insert(t,e){return new n_(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,i_.BLACK,null,null))}remove(t){return new n_(this.comparator,this.root.remove(t,this.comparator).copy(null,null,i_.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(t,n.key);if(0===s)return e+n.left.size;s<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new s_(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new s_(this.root,t,this.comparator,!1)}getReverseIterator(){return new s_(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new s_(this.root,t,this.comparator,!0)}}class s_{constructor(t,e,n,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,s&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class i_{constructor(t,e,n,s,i){this.key=t,this.value=e,this.color=null!=n?n:i_.RED,this.left=null!=s?s:i_.EMPTY,this.right=null!=i?i:i_.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,s,i){return new i_(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=s?s:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let s=this;const i=n(t,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(t,e,n),null):0===i?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return i_.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===e(t,s.key)){if(s.right.isEmpty())return i_.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,i_.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,i_.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Gm();if(this.right.isRed())throw Gm();const t=this.left.check();if(t!==this.right.check())throw Gm();return t+(this.isRed()?0:1)}}i_.EMPTY=null,i_.RED=!0,i_.BLACK=!1,i_.EMPTY=new class{constructor(){this.size=0}get key(){throw Gm()}get value(){throw Gm()}get color(){throw Gm()}get left(){throw Gm()}get right(){throw Gm()}copy(t,e,n,s,i){return this}insert(t,e,n){return new i_(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class r_{constructor(t){this.comparator=t,this.data=new n_(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new o_(this.data.getIterator())}getIteratorFrom(t){return new o_(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof r_))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,s=n.getNext().key;if(0!==this.comparator(t,s))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new r_(this.comparator);return e.data=t,e}}class o_{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a_=new n_(Mg.comparator);function c_(){return a_}const h_=new n_(Mg.comparator);function l_(){return h_}new n_(Mg.comparator);const u_=new r_(Mg.comparator);function d_(...t){let e=u_;for(const n of t)e=e.add(n);return e}const p_=new r_(cg);function f_(){return p_}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m_{constructor(t,e,n,s,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e){const n=new Map;return n.set(t,g_.createSynthesizedTargetChangeForCurrentChange(t,e)),new m_(ug.min(),n,f_(),c_(),d_())}}class g_{constructor(t,e,n,s,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e){return new g_(vg.EMPTY_BYTE_STRING,e,d_(),d_(),d_())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y_{constructor(t,e,n,s){this.$=t,this.removedTargetIds=e,this.key=n,this.O=s}}class __{constructor(t,e){this.targetId=t,this.M=e}}class v_{constructor(t,e,n=vg.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=s}}class w_{constructor(){this.F=0,this.L=x_(),this.B=vg.EMPTY_BYTE_STRING,this.U=!1,this.q=!0}get current(){return this.U}get resumeToken(){return this.B}get K(){return 0!==this.F}get j(){return this.q}W(t){t.approximateByteSize()>0&&(this.q=!0,this.B=t)}G(){let t=d_(),e=d_(),n=d_();return this.L.forEach(((s,i)=>{switch(i){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:Gm()}})),new g_(this.B,this.U,t,e,n)}H(){this.q=!1,this.L=x_()}J(t,e){this.q=!0,this.L=this.L.insert(t,e)}Y(t){this.q=!0,this.L=this.L.remove(t)}X(){this.F+=1}Z(){this.F-=1}tt(){this.q=!0,this.U=!0}}class b_{constructor(t){this.et=t,this.nt=new Map,this.st=c_(),this.it=T_(),this.rt=new r_(cg)}ot(t){for(const e of t.$)t.O&&t.O.isFoundDocument()?this.ct(e,t.O):this.at(e,t.key,t.O);for(const e of t.removedTargetIds)this.at(e,t.key,t.O)}ut(t){this.forEachTarget(t,(e=>{const n=this.ht(e);switch(t.state){case 0:this.lt(e)&&n.W(t.resumeToken);break;case 1:n.Z(),n.K||n.H(),n.W(t.resumeToken);break;case 2:n.Z(),n.K||this.removeTarget(e);break;case 3:this.lt(e)&&(n.tt(),n.W(t.resumeToken));break;case 4:this.lt(e)&&(this.ft(e),n.W(t.resumeToken));break;default:Gm()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.nt.forEach(((t,n)=>{this.lt(n)&&e(n)}))}dt(t){const e=t.targetId,n=t.M.count,s=this.wt(e);if(s){const t=s.target;if(Xg(t))if(0===n){const n=new Mg(t.path);this.at(e,n,Wg.newNoDocument(n,ug.min()))}else Hm(1===n);else this._t(e)!==n&&(this.ft(e),this.rt=this.rt.add(e))}}gt(t){const e=new Map;this.nt.forEach(((n,s)=>{const i=this.wt(s);if(i){if(n.current&&Xg(i.target)){const e=new Mg(i.target.path);null!==this.st.get(e)||this.yt(s,e)||this.at(s,e,Wg.newNoDocument(e,t))}n.j&&(e.set(s,n.G()),n.H())}}));let n=d_();this.it.forEach(((t,e)=>{let s=!0;e.forEachWhile((t=>{const e=this.wt(t);return!e||2===e.purpose||(s=!1,!1)})),s&&(n=n.add(t))}));const s=new m_(t,e,this.rt,this.st,n);return this.st=c_(),this.it=T_(),this.rt=new r_(cg),s}ct(t,e){if(!this.lt(t))return;const n=this.yt(t,e.key)?2:0;this.ht(t).J(e.key,n),this.st=this.st.insert(e.key,e),this.it=this.it.insert(e.key,this.Tt(e.key).add(t))}at(t,e,n){if(!this.lt(t))return;const s=this.ht(t);this.yt(t,e)?s.J(e,1):s.Y(e),this.it=this.it.insert(e,this.Tt(e).delete(t)),n&&(this.st=this.st.insert(e,n))}removeTarget(t){this.nt.delete(t)}_t(t){const e=this.ht(t).G();return this.et.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}X(t){this.ht(t).X()}ht(t){let e=this.nt.get(t);return e||(e=new w_,this.nt.set(t,e)),e}Tt(t){let e=this.it.get(t);return e||(e=new r_(cg),this.it=this.it.insert(t,e)),e}lt(t){const e=null!==this.wt(t);return e||Bm("WatchChangeAggregator","Detected inactive target",t),e}wt(t){const e=this.nt.get(t);return e&&e.K?null:this.et.Et(t)}ft(t){this.nt.set(t,new w_),this.et.getRemoteKeysForTarget(t).forEach((e=>{this.at(t,e,null)}))}yt(t,e){return this.et.getRemoteKeysForTarget(t).has(e)}}function T_(){return new n_(Mg.comparator)}function x_(){return new n_(Mg.comparator)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A_={asc:"ASCENDING",desc:"DESCENDING"},k_={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class C_{constructor(t,e){this.databaseId=t,this.C=e}}function E_(t,e){return t.C?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function S_(t,e){return t.C?e.toBase64():e.toUint8Array()}function M_(t){return Hm(!!t),ug.fromTimestamp(function(t){const e=bg(t);return new lg(e.seconds,e.nanos)}(t))}function I_(t,e){return(n=t,new gg(["projects",n.projectId,"databases",n.database])).child("documents").child(e).canonicalString();var n}function D_(t){const e=gg.fromString(t);return Hm(K_(e)),e}function P_(t,e){const n=D_(e);if(n.get(1)!==t.databaseId.projectId)throw new Ym(Xm.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Ym(Xm.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Mg(V_(n))}function O_(t,e){return I_(t.databaseId,e)}function R_(t){const e=D_(t);return 4===e.length?gg.emptyPath():V_(e)}function N_(t){return new gg(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function V_(t){return Hm(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function L_(t,e){return{documents:[O_(t,e.path)]}}function q_(t,e){const n={structuredQuery:{}},s=e.path;null!==e.collectionGroup?(n.parent=O_(t,s),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=O_(t,s.popLast()),n.structuredQuery.from=[{collectionId:s.lastSegment()}]);const i=function(t){if(0===t.length)return;const e=t.map((t=>function(t){if("=="===t.op){if(jg(t.value))return{unaryFilter:{field:$_(t.field),op:"IS_NAN"}};if(Fg(t.value))return{unaryFilter:{field:$_(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(jg(t.value))return{unaryFilter:{field:$_(t.field),op:"IS_NOT_NAN"}};if(Fg(t.value))return{unaryFilter:{field:$_(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:$_(t.field),op:W_(t.op),value:t.value}}}(t)));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}(e.filters);i&&(n.structuredQuery.where=i);const r=function(t){if(0!==t.length)return t.map((t=>{return{field:$_((e=t).field),direction:z_(e.dir)};var e}))}(e.orderBy);r&&(n.structuredQuery.orderBy=r);const o=(a=t,c=e.limit,a.C||Eg(c)?c:{value:c});var a,c;return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt=U_(e.startAt)),e.endAt&&(n.structuredQuery.endAt=U_(e.endAt)),n}function F_(t){let e=R_(t.parent);const n=t.structuredQuery,s=n.from?n.from.length:0;let i=null;if(s>0){Hm(1===s);const t=n.from[0];t.allDescendants?i=t.collectionId:e=e.child(t.collectionId)}let r=[];n.where&&(r=j_(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((t=>{return new ay(G_((e=t).field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction));var e})));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,Eg(e)?null:e}(n.limit));let c=null;n.startAt&&(c=B_(n.startAt));let h=null;return n.endAt&&(h=B_(n.endAt)),dy(e,i,o,r,a,"F",c,h)}function j_(t){return t?void 0!==t.unaryFilter?[H_(t)]:void 0!==t.fieldFilter?[(e=t,Yg.create(G_(e.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Gm()}}(e.fieldFilter.op),e.fieldFilter.value))]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((t=>j_(t))).reduce(((t,e)=>t.concat(e))):Gm():[];var e}function U_(t){return{before:t.before,values:t.position}}function B_(t){const e=!!t.before,n=t.values||[];return new ry(n,e)}function z_(t){return A_[t]}function W_(t){return k_[t]}function $_(t){return{fieldPath:t.canonicalString()}}function G_(t){return _g.fromServerFormat(t.fieldPath)}function H_(t){switch(t.unaryFilter.op){case"IS_NAN":const e=G_(t.unaryFilter.field);return Yg.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=G_(t.unaryFilter.field);return Yg.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=G_(t.unaryFilter.field);return Yg.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=G_(t.unaryFilter.field);return Yg.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Gm()}}function K_(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X_(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=Q_(e)),e=Y_(t.get(n),e);return Q_(e)}function Y_(t,e){let n=e;const s=t.length;for(let e=0;e<s;e++){const s=t.charAt(e);switch(s){case"\0":n+="";break;case"":n+="";break;default:n+=s}}return n}function Q_(t){return t+""}class Z_{constructor(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}}Z_.store="owner",Z_.key="owner";class J_{constructor(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}}J_.store="mutationQueues",J_.keyPath="userId";class tv{constructor(t,e,n,s,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=s,this.mutations=i}}tv.store="mutations",tv.keyPath="batchId",tv.userMutationsIndex="userMutationsIndex",tv.userMutationsKeyPath=["userId","batchId"];class ev{constructor(){}static prefixForUser(t){return[t]}static prefixForPath(t,e){return[t,X_(e)]}static key(t,e,n){return[t,X_(e),n]}}ev.store="documentMutations",ev.PLACEHOLDER=new ev;class nv{constructor(t,e,n,s,i,r){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=s,this.readTime=i,this.parentPath=r}}nv.store="remoteDocuments",nv.readTimeIndex="readTimeIndex",nv.readTimeIndexPath="readTime",nv.collectionReadTimeIndex="collectionReadTimeIndex",nv.collectionReadTimeIndexPath=["parentPath","readTime"];class sv{constructor(t){this.byteSize=t}}sv.store="remoteDocumentGlobal",sv.key="remoteDocumentGlobalKey";class iv{constructor(t,e,n,s,i,r,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=s,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=r,this.query=o}}iv.store="targets",iv.keyPath="targetId",iv.queryTargetsIndexName="queryTargetsIndex",iv.queryTargetsKeyPath=["canonicalId","targetId"];class rv{constructor(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n}}rv.store="targetDocuments",rv.keyPath=["targetId","path"],rv.documentTargetsIndex="documentTargetsIndex",rv.documentTargetsKeyPath=["path","targetId"];class ov{constructor(t,e,n,s){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=s}}ov.key="targetGlobalKey",ov.store="targetGlobal";class av{constructor(t,e){this.collectionId=t,this.parent=e}}av.store="collectionParents",av.keyPath=["collectionId","parent"];class cv{constructor(t,e,n,s){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=s}}cv.store="clientMetadata",cv.keyPath="clientId";class hv{constructor(t,e,n){this.bundleId=t,this.createTime=e,this.version=n}}hv.store="bundles",hv.keyPath="bundleId";class lv{constructor(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n}}lv.store="namedQueries",lv.keyPath="name";J_.store,tv.store,ev.store,nv.store,iv.store,Z_.store,ov.store,rv.store,cv.store,sv.store,av.store,hv.store,lv.store;const uv="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class dv{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pv{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&Gm(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new pv(((n,s)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,s)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,s)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof pv?e:pv.resolve(e)}catch(t){return pv.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):pv.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):pv.reject(e)}static resolve(t){return new pv(((e,n)=>{e(t)}))}static reject(t){return new pv(((e,n)=>{n(t)}))}static waitFor(t){return new pv(((e,n)=>{let s=0,i=0,r=!1;t.forEach((t=>{++s,t.next((()=>{++i,r&&i===s&&e()}),(t=>n(t)))})),r=!0,i===s&&e()}))}static or(t){let e=pv.resolve(!1);for(const n of t)e=e.next((t=>t?pv.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,s)=>{n.push(e.call(this,t,s))})),this.waitFor(n)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fv(t){return"IndexedDbTransactionError"===t.name}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class mv{constructor(t,e,n,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const s=this.mutations[e];s.key.isEqual(t.key)&&zy(s,t,n[e])}}applyToLocalView(t){for(const e of this.baseMutations)e.key.isEqual(t.key)&&Wy(e,t,this.localWriteTime);for(const e of this.mutations)e.key.isEqual(t.key)&&Wy(e,t,this.localWriteTime)}applyToLocalDocumentSet(t){this.mutations.forEach((e=>{const n=t.get(e.key),s=n;this.applyToLocalView(s),n.isValidDocument()||s.convertToNoDocument(ug.min())}))}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),d_())}isEqual(t){return this.batchId===t.batchId&&hg(this.mutations,t.mutations,((t,e)=>$y(t,e)))&&hg(this.baseMutations,t.baseMutations,((t,e)=>$y(t,e)))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class gv{constructor(t,e,n,s,i=ug.min(),r=ug.min(),o=vg.EMPTY_BYTE_STRING){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=r,this.resumeToken=o}withSequenceNumber(t){return new gv(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(t,e){return new gv(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}withLastLimboFreeSnapshotVersion(t){return new gv(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yv{constructor(t){this.Gt=t}}function _v(t){const e=F_({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?by(e,e.limit,"L"):e}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class vv{constructor(){this.zt=new wv}addToCollectionParentIndex(t,e){return this.zt.add(e),pv.resolve()}getCollectionParents(t,e){return pv.resolve(this.zt.getEntries(e))}}class wv{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e]||new r_(gg.comparator),i=!s.has(n);return this.index[e]=s.add(n),i}has(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e];return s&&s.has(n)}getEntries(t){return(this.index[t]||new r_(gg.comparator)).toArray()}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bv{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new bv(t,bv.DEFAULT_COLLECTION_PERCENTILE,bv.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */bv.DEFAULT_COLLECTION_PERCENTILE=10,bv.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,bv.DEFAULT=new bv(41943040,bv.DEFAULT_COLLECTION_PERCENTILE,bv.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),bv.DISABLED=new bv(-1,0,0);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Tv{constructor(t){this.se=t}next(){return this.se+=2,this.se}static ie(){return new Tv(0)}static re(){return new Tv(-1)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function xv(t){if(t.code!==Xm.FAILED_PRECONDITION||t.message!==uv)throw t;Bm("LocalStore","Unexpectedly lost primary lease")}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Av{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,s]of n)if(this.equalsFn(e,t))return s}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),s=this.inner[n];if(void 0!==s){for(let n=0;n<s.length;n++)if(this.equalsFn(s[n][0],t))return void(s[n]=[t,e]);s.push([t,e])}else this.inner[n]=[[t,e]]}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],t))return 1===n.length?delete this.inner[e]:n.splice(s,1),!0;return!1}forEach(t){pg(this.inner,((e,n)=>{for(const[e,s]of n)t(e,s)}))}isEmpty(){return fg(this.inner)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kv{constructor(){this.changes=new Av((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}getReadTime(t){const e=this.changes.get(t);return e?e.readTime:ug.min()}addEntry(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})}removeEntry(t,e=null){this.assertNotApplied(),this.changes.set(t,{document:Wg.newInvalidDocument(t),readTime:e})}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?pv.resolve(n.document):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Cv{constructor(t,e,n){this.Je=t,this.An=e,this.Jt=n}Rn(t,e){return this.An.getAllMutationBatchesAffectingDocumentKey(t,e).next((n=>this.bn(t,e,n)))}bn(t,e,n){return this.Je.getEntry(t,e).next((t=>{for(const e of n)e.applyToLocalView(t);return t}))}Pn(t,e){t.forEach(((t,n)=>{for(const t of e)t.applyToLocalView(n)}))}vn(t,e){return this.Je.getEntries(t,e).next((e=>this.Vn(t,e).next((()=>e))))}Vn(t,e){return this.An.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>this.Pn(e,t)))}getDocumentsMatchingQuery(t,e,n){return s=e,Mg.isDocumentKey(s.path)&&null===s.collectionGroup&&0===s.filters.length?this.Sn(t,e.path):_y(e)?this.Dn(t,e,n):this.Cn(t,e,n);var s}Sn(t,e){return this.Rn(t,new Mg(e)).next((t=>{let e=l_();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}Dn(t,e,n){const s=e.collectionGroup;let i=l_();return this.Jt.getCollectionParents(t,s).next((r=>pv.forEach(r,(r=>{const o=(a=e,c=r.child(s),new uy(c,null,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt));var a,c;return this.Cn(t,o,n).next((t=>{t.forEach(((t,e)=>{i=i.insert(t,e)}))}))})).next((()=>i))))}Cn(t,e,n){let s,i;return this.Je.getDocumentsMatchingQuery(t,e,n).next((n=>(s=n,this.An.getAllMutationBatchesAffectingQuery(t,e)))).next((e=>(i=e,this.Nn(t,i,s).next((t=>{s=t;for(const t of i)for(const e of t.mutations){const n=e.key;let i=s.get(n);null==i&&(i=Wg.newInvalidDocument(n),s=s.insert(n,i)),Wy(e,i,t.localWriteTime),i.isFoundDocument()||(s=s.remove(n))}}))))).next((()=>(s.forEach(((t,n)=>{ky(e,n)||(s=s.remove(t))})),s)))}Nn(t,e,n){let s=d_();for(const t of e)for(const e of t.mutations)e instanceof Ky&&null===n.get(e.key)&&(s=s.add(e.key));let i=n;return this.Je.getEntries(t,s).next((t=>(t.forEach(((t,e)=>{e.isFoundDocument()&&(i=i.insert(t,e))})),i)))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ev{constructor(t,e,n,s){this.targetId=t,this.fromCache=e,this.kn=n,this.xn=s}static $n(t,e){let n=d_(),s=d_();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:s=s.add(t.doc.key)}return new Ev(t,e.fromCache,n,s)}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sv{On(t){this.Mn=t}getDocumentsMatchingQuery(t,e,n,s){return 0===(i=e).filters.length&&null===i.limit&&null==i.startAt&&null==i.endAt&&(0===i.explicitOrderBy.length||1===i.explicitOrderBy.length&&i.explicitOrderBy[0].field.isKeyField())||n.isEqual(ug.min())?this.Fn(t,e):this.Mn.vn(t,s).next((i=>{const r=this.Ln(e,i);return(fy(e)||my(e))&&this.Bn(e.limitType,r,s,n)?this.Fn(t,e):(Um()<=il.DEBUG&&Bm("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Ay(e)),this.Mn.getDocumentsMatchingQuery(t,e,n).next((t=>(r.forEach((e=>{t=t.insert(e.key,e)})),t))))}));var i}Ln(t,e){let n=new r_(Cy(t));return e.forEach(((e,s)=>{ky(t,s)&&(n=n.add(s))})),n}Bn(t,e,n,s){if(n.size!==e.size)return!0;const i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Fn(t,e){return Um()<=il.DEBUG&&Bm("QueryEngine","Using full collection scan to execute query:",Ay(e)),this.Mn.getDocumentsMatchingQuery(t,e,ug.min())}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mv{constructor(t,e,n,s){this.persistence=t,this.Un=e,this.k=s,this.qn=new n_(cg),this.Kn=new Av((t=>Hg(t)),Kg),this.jn=ug.min(),this.An=t.getMutationQueue(n),this.Qn=t.getRemoteDocumentCache(),this.He=t.getTargetCache(),this.Wn=new Cv(this.Qn,this.An,this.persistence.getIndexManager()),this.Ye=t.getBundleCache(),this.Un.On(this.Wn)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.qn)))}}function Iv(t,e,n,s){return new Mv(t,e,n,s)}async function Dv(t,e){const n=Km(t);let s=n.An,i=n.Wn;const r=await n.persistence.runTransaction("Handle user change","readonly",(t=>{let r;return n.An.getAllMutationBatches(t).next((o=>(r=o,s=n.persistence.getMutationQueue(e),i=new Cv(n.Qn,s,n.persistence.getIndexManager()),s.getAllMutationBatches(t)))).next((e=>{const n=[],s=[];let o=d_();for(const t of r){n.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return i.vn(t,o).next((t=>({Gn:t,removedBatchIds:n,addedBatchIds:s})))}))}));return n.An=s,n.Wn=i,n.Un.On(n.Wn),r}function Pv(t){const e=Km(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.He.getLastRemoteSnapshotVersion(t)))}function Ov(t,e,n,s,i){let r=d_();return n.forEach((t=>r=r.add(t))),e.getEntries(t,r).next((t=>{let r=c_();return n.forEach(((n,o)=>{const a=t.get(n),c=(null==i?void 0:i.get(n))||s;o.isNoDocument()&&o.version.isEqual(ug.min())?(e.removeEntry(n,c),r=r.insert(n,o)):!a.isValidDocument()||o.version.compareTo(a.version)>0||0===o.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(o,c),r=r.insert(n,o)):Bm("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",o.version)})),r}))}function Rv(t,e){const n=Km(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let s;return n.He.getTargetData(t,e).next((i=>i?(s=i,pv.resolve(s)):n.He.allocateTargetId(t).next((i=>(s=new gv(e,i,0,t.currentSequenceNumber),n.He.addTargetData(t,s).next((()=>s)))))))})).then((t=>{const s=n.qn.get(t.targetId);return(null===s||t.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.qn=n.qn.insert(t.targetId,t),n.Kn.set(e,t.targetId)),t}))}async function Nv(t,e,n){const s=Km(t),i=s.qn.get(e),r=n?"readwrite":"readwrite-primary";try{n||await s.persistence.runTransaction("Release target",r,(t=>s.persistence.referenceDelegate.removeTarget(t,i)))}catch(t){if(!fv(t))throw t;Bm("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}s.qn=s.qn.remove(e),s.Kn.delete(i.target)}function Vv(t,e,n){const s=Km(t);let i=ug.min(),r=d_();return s.persistence.runTransaction("Execute query","readonly",(t=>function(t,e,n){const s=Km(t),i=s.Kn.get(n);return void 0!==i?pv.resolve(s.qn.get(i)):s.He.getTargetData(e,n)}(s,t,wy(e)).next((e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,s.He.getMatchingKeysForTargetId(t,e.targetId).next((t=>{r=t}))})).next((()=>s.Un.getDocumentsMatchingQuery(t,e,n?i:ug.min(),n?r:d_()))).next((t=>({documents:t,zn:r})))))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Lv{constructor(t){this.k=t,this.Xn=new Map,this.Zn=new Map}getBundleMetadata(t,e){return pv.resolve(this.Xn.get(e))}saveBundleMetadata(t,e){var n;return this.Xn.set(e.id,{id:(n=e).id,version:n.version,createTime:M_(n.createTime)}),pv.resolve()}getNamedQuery(t,e){return pv.resolve(this.Zn.get(e))}saveNamedQuery(t,e){return this.Zn.set(e.name,{name:(n=e).name,query:_v(n.bundledQuery),readTime:M_(n.readTime)}),pv.resolve();var n}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qv{constructor(){this.ts=new r_(Fv.es),this.ns=new r_(Fv.ss)}isEmpty(){return this.ts.isEmpty()}addReference(t,e){const n=new Fv(t,e);this.ts=this.ts.add(n),this.ns=this.ns.add(n)}rs(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.os(new Fv(t,e))}cs(t,e){t.forEach((t=>this.removeReference(t,e)))}us(t){const e=new Mg(new gg([])),n=new Fv(e,t),s=new Fv(e,t+1),i=[];return this.ns.forEachInRange([n,s],(t=>{this.os(t),i.push(t.key)})),i}hs(){this.ts.forEach((t=>this.os(t)))}os(t){this.ts=this.ts.delete(t),this.ns=this.ns.delete(t)}ls(t){const e=new Mg(new gg([])),n=new Fv(e,t),s=new Fv(e,t+1);let i=d_();return this.ns.forEachInRange([n,s],(t=>{i=i.add(t.key)})),i}containsKey(t){const e=new Fv(t,0),n=this.ts.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class Fv{constructor(t,e){this.key=t,this.fs=e}static es(t,e){return Mg.comparator(t.key,e.key)||cg(t.fs,e.fs)}static ss(t,e){return cg(t.fs,e.fs)||Mg.comparator(t.key,e.key)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jv{constructor(t,e){this.Jt=t,this.referenceDelegate=e,this.An=[],this.ds=1,this.ws=new r_(Fv.es)}checkEmpty(t){return pv.resolve(0===this.An.length)}addMutationBatch(t,e,n,s){const i=this.ds;this.ds++,this.An.length>0&&this.An[this.An.length-1];const r=new mv(i,e,n,s);this.An.push(r);for(const e of s)this.ws=this.ws.add(new Fv(e.key,i)),this.Jt.addToCollectionParentIndex(t,e.key.path.popLast());return pv.resolve(r)}lookupMutationBatch(t,e){return pv.resolve(this._s(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,s=this.gs(n),i=s<0?0:s;return pv.resolve(this.An.length>i?this.An[i]:null)}getHighestUnacknowledgedBatchId(){return pv.resolve(0===this.An.length?-1:this.ds-1)}getAllMutationBatches(t){return pv.resolve(this.An.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new Fv(e,0),s=new Fv(e,Number.POSITIVE_INFINITY),i=[];return this.ws.forEachInRange([n,s],(t=>{const e=this._s(t.fs);i.push(e)})),pv.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new r_(cg);return e.forEach((t=>{const e=new Fv(t,0),s=new Fv(t,Number.POSITIVE_INFINITY);this.ws.forEachInRange([e,s],(t=>{n=n.add(t.fs)}))})),pv.resolve(this.ys(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,s=n.length+1;let i=n;Mg.isDocumentKey(i)||(i=i.child(""));const r=new Fv(new Mg(i),0);let o=new r_(cg);return this.ws.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===s&&(o=o.add(t.fs)),!0)}),r),pv.resolve(this.ys(o))}ys(t){const e=[];return t.forEach((t=>{const n=this._s(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){Hm(0===this.ps(e.batchId,"removed")),this.An.shift();let n=this.ws;return pv.forEach(e.mutations,(s=>{const i=new Fv(s.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)})).next((()=>{this.ws=n}))}ee(t){}containsKey(t,e){const n=new Fv(e,0),s=this.ws.firstAfterOrEqual(n);return pv.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.An.length,pv.resolve()}ps(t,e){return this.gs(t)}gs(t){return 0===this.An.length?0:t-this.An[0].batchId}_s(t){const e=this.gs(t);return e<0||e>=this.An.length?null:this.An[e]}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uv{constructor(t,e){this.Jt=t,this.Ts=e,this.docs=new n_(Mg.comparator),this.size=0}addEntry(t,e,n){const s=e.key,i=this.docs.get(s),r=i?i.size:0,o=this.Ts(e);return this.docs=this.docs.insert(s,{document:e.mutableCopy(),size:o,readTime:n}),this.size+=o-r,this.Jt.addToCollectionParentIndex(t,s.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return pv.resolve(n?n.document.mutableCopy():Wg.newInvalidDocument(e))}getEntries(t,e){let n=c_();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():Wg.newInvalidDocument(t))})),pv.resolve(n)}getDocumentsMatchingQuery(t,e,n){let s=c_();const i=new Mg(e.path.child("")),r=this.docs.getIteratorFrom(i);for(;r.hasNext();){const{key:t,value:{document:i,readTime:o}}=r.getNext();if(!e.path.isPrefixOf(t.path))break;o.compareTo(n)<=0||ky(e,i)&&(s=s.insert(i.key,i.mutableCopy()))}return pv.resolve(s)}Es(t,e){return pv.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new Bv(this)}getSize(t){return pv.resolve(this.size)}}class Bv extends kv{constructor(t){super(),this.De=t}applyChanges(t){const e=[];return this.changes.forEach(((n,s)=>{s.document.isValidDocument()?e.push(this.De.addEntry(t,s.document,this.getReadTime(n))):this.De.removeEntry(n)})),pv.waitFor(e)}getFromCache(t,e){return this.De.getEntry(t,e)}getAllFromCache(t,e){return this.De.getEntries(t,e)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zv{constructor(t){this.persistence=t,this.Is=new Av((t=>Hg(t)),Kg),this.lastRemoteSnapshotVersion=ug.min(),this.highestTargetId=0,this.As=0,this.Rs=new qv,this.targetCount=0,this.bs=Tv.ie()}forEachTarget(t,e){return this.Is.forEach(((t,n)=>e(n))),pv.resolve()}getLastRemoteSnapshotVersion(t){return pv.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return pv.resolve(this.As)}allocateTargetId(t){return this.highestTargetId=this.bs.next(),pv.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.As&&(this.As=e),pv.resolve()}ae(t){this.Is.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.bs=new Tv(e),this.highestTargetId=e),t.sequenceNumber>this.As&&(this.As=t.sequenceNumber)}addTargetData(t,e){return this.ae(e),this.targetCount+=1,pv.resolve()}updateTargetData(t,e){return this.ae(e),pv.resolve()}removeTargetData(t,e){return this.Is.delete(e.target),this.Rs.us(e.targetId),this.targetCount-=1,pv.resolve()}removeTargets(t,e,n){let s=0;const i=[];return this.Is.forEach(((r,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Is.delete(r),i.push(this.removeMatchingKeysForTargetId(t,o.targetId)),s++)})),pv.waitFor(i).next((()=>s))}getTargetCount(t){return pv.resolve(this.targetCount)}getTargetData(t,e){const n=this.Is.get(e)||null;return pv.resolve(n)}addMatchingKeys(t,e,n){return this.Rs.rs(e,n),pv.resolve()}removeMatchingKeys(t,e,n){this.Rs.cs(e,n);const s=this.persistence.referenceDelegate,i=[];return s&&e.forEach((e=>{i.push(s.markPotentiallyOrphaned(t,e))})),pv.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this.Rs.us(e),pv.resolve()}getMatchingKeysForTargetId(t,e){const n=this.Rs.ls(e);return pv.resolve(n)}containsKey(t,e){return pv.resolve(this.Rs.containsKey(e))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wv{constructor(t,e){var n,s;this.Ps={},this.Be=new rg(0),this.Ue=!1,this.Ue=!0,this.referenceDelegate=t(this),this.He=new zv(this),this.Jt=new vv,this.Je=(n=this.Jt,s=t=>this.referenceDelegate.vs(t),new Uv(n,s)),this.k=new yv(e),this.Ye=new Lv(this.k)}start(){return Promise.resolve()}shutdown(){return this.Ue=!1,Promise.resolve()}get started(){return this.Ue}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.Jt}getMutationQueue(t){let e=this.Ps[t.toKey()];return e||(e=new jv(this.Jt,this.referenceDelegate),this.Ps[t.toKey()]=e),e}getTargetCache(){return this.He}getRemoteDocumentCache(){return this.Je}getBundleCache(){return this.Ye}runTransaction(t,e,n){Bm("MemoryPersistence","Starting transaction:",t);const s=new $v(this.Be.next());return this.referenceDelegate.Vs(),n(s).next((t=>this.referenceDelegate.Ss(s).next((()=>t)))).toPromise().then((t=>(s.raiseOnCommittedEvent(),t)))}Ds(t,e){return pv.or(Object.values(this.Ps).map((n=>()=>n.containsKey(t,e))))}}class $v extends dv{constructor(t){super(),this.currentSequenceNumber=t}}class Gv{constructor(t){this.persistence=t,this.Cs=new qv,this.Ns=null}static ks(t){return new Gv(t)}get xs(){if(this.Ns)return this.Ns;throw Gm()}addReference(t,e,n){return this.Cs.addReference(n,e),this.xs.delete(n.toString()),pv.resolve()}removeReference(t,e,n){return this.Cs.removeReference(n,e),this.xs.add(n.toString()),pv.resolve()}markPotentiallyOrphaned(t,e){return this.xs.add(e.toString()),pv.resolve()}removeTarget(t,e){this.Cs.us(e.targetId).forEach((t=>this.xs.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.xs.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Vs(){this.Ns=new Set}Ss(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return pv.forEach(this.xs,(n=>{const s=Mg.fromPath(n);return this.$s(t,s).next((t=>{t||e.removeEntry(s)}))})).next((()=>(this.Ns=null,e.apply(t))))}updateLimboDocument(t,e){return this.$s(t,e).next((t=>{t?this.xs.delete(e.toString()):this.xs.add(e.toString())}))}vs(t){return 0}$s(t,e){return pv.or([()=>pv.resolve(this.Cs.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ds(t,e)])}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hv{constructor(){this.activeTargetIds=f_()}Fs(t){this.activeTargetIds=this.activeTargetIds.add(t)}Ls(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Ms(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Kv{constructor(){this.pi=new Hv,this.Ti={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.pi.Fs(t),this.Ti[t]||"not-current"}updateQueryState(t,e,n){this.Ti[t]=e}removeLocalQueryTarget(t){this.pi.Ls(t)}isLocalQueryTarget(t){return this.pi.activeTargetIds.has(t)}clearQueryState(t){delete this.Ti[t]}getAllActiveQueryTargets(){return this.pi.activeTargetIds}isActiveQueryTarget(t){return this.pi.activeTargetIds.has(t)}start(){return this.pi=new Hv,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(){}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xv{Ei(t){}shutdown(){}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yv{constructor(){this.Ii=()=>this.Ai(),this.Ri=()=>this.bi(),this.Pi=[],this.vi()}Ei(t){this.Pi.push(t)}shutdown(){window.removeEventListener("online",this.Ii),window.removeEventListener("offline",this.Ri)}vi(){window.addEventListener("online",this.Ii),window.addEventListener("offline",this.Ri)}Ai(){Bm("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.Pi)t(0)}bi(){Bm("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.Pi)t(1)}static Pt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qv={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zv{constructor(t){this.Vi=t.Vi,this.Si=t.Si}Di(t){this.Ci=t}Ni(t){this.ki=t}onMessage(t){this.xi=t}close(){this.Si()}send(t){this.Vi(t)}$i(){this.Ci()}Oi(t){this.ki(t)}Mi(t){this.xi(t)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jv extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http";this.Fi=e+"://"+t.host,this.Li="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Bi(t,e,n,s,i){const r=this.Ui(t,e);Bm("RestConnection","Sending: ",r,n);const o={};return this.qi(o,s,i),this.Ki(t,r,o,n).then((t=>(Bm("RestConnection","Received: ",t),t)),(e=>{throw Wm("RestConnection",`${t} failed with error: `,e,"url: ",r,"request:",n),e}))}ji(t,e,n,s,i){return this.Bi(t,e,n,s,i)}qi(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+Fm,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}Ui(t,e){const n=Qv[t];return`${this.Fi}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams}Ki(t,e,n,s){return new Promise(((i,r)=>{const o=new km;o.listenOnce(wm.COMPLETE,(()=>{try{switch(o.getLastErrorCode()){case vm.NO_ERROR:const e=o.getResponseJson();Bm("Connection","XHR received:",JSON.stringify(e)),i(e);break;case vm.TIMEOUT:Bm("Connection",'RPC "'+t+'" timed out'),r(new Ym(Xm.DEADLINE_EXCEEDED,"Request time out"));break;case vm.HTTP_ERROR:const n=o.getStatus();if(Bm("Connection",'RPC "'+t+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const t=o.getResponseJson().error;if(t&&t.status&&t.message){const e=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(Xm).indexOf(e)>=0?e:Xm.UNKNOWN}(t.status);r(new Ym(e,t.message))}else r(new Ym(Xm.UNKNOWN,"Server responded with status "+o.getStatus()))}else r(new Ym(Xm.UNAVAILABLE,"Connection failed."));break;default:Gm()}}finally{Bm("Connection",'RPC "'+t+'" completed.')}}));const a=JSON.stringify(s);o.send(e,"POST",a,n,15)}))}Qi(t,e,n){const s=[this.Fi,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=ym(),r=_m(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new xm({})),this.qi(o.initMessageHeaders,e,n),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Gh())||"object"==typeof navigator&&"ReactNative"===navigator.product||Gh().indexOf("Electron/")>=0||function(){const t=Gh();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}()||Gh().indexOf("MSAppHost/")>=0||function(){const t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}()||(o.httpHeadersOverwriteParam="$httpHeaders");const a=s.join("");Bm("Connection","Creating WebChannel: "+a,o);const c=i.createWebChannel(a,o);let h=!1,l=!1;const u=new Zv({Vi:t=>{l?Bm("Connection","Not sending because WebChannel is closed:",t):(h||(Bm("Connection","Opening WebChannel transport."),c.open(),h=!0),Bm("Connection","WebChannel sending:",t),c.send(t))},Si:()=>c.close()}),d=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return d(c,Am.EventType.OPEN,(()=>{l||Bm("Connection","WebChannel transport opened.")})),d(c,Am.EventType.CLOSE,(()=>{l||(l=!0,Bm("Connection","WebChannel transport closed"),u.Oi())})),d(c,Am.EventType.ERROR,(t=>{l||(l=!0,Wm("Connection","WebChannel transport errored:",t),u.Oi(new Ym(Xm.UNAVAILABLE,"The operation could not be completed")))})),d(c,Am.EventType.MESSAGE,(t=>{var e;if(!l){const n=t.data[0];Hm(!!n);const s=n,i=s.error||(null===(e=s[0])||void 0===e?void 0:e.error);if(i){Bm("Connection","WebChannel received error:",i);const t=i.status;let e=function(t){const e=Jy[t];if(void 0!==e)return e_(e)}(t),n=i.message;void 0===e&&(e=Xm.INTERNAL,n="Unknown error status: "+t+" with message "+i.message),l=!0,u.Oi(new Ym(e,n)),c.close()}else Bm("Connection","WebChannel received:",n),u.Mi(n)}})),d(r,bm.STAT_EVENT,(t=>{t.stat===Tm.PROXY?Bm("Connection","Detected buffering proxy"):t.stat===Tm.NOPROXY&&Bm("Connection","Detected no buffering proxy")})),setTimeout((()=>{u.$i()}),0),u}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tw(){return"undefined"!=typeof document?document:null}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ew(t){return new C_(t,!0)}class nw{constructor(t,e,n=1e3,s=1.5,i=6e4){this.Me=t,this.timerId=e,this.Wi=n,this.Gi=s,this.zi=i,this.Hi=0,this.Ji=null,this.Yi=Date.now(),this.reset()}reset(){this.Hi=0}Xi(){this.Hi=this.zi}Zi(t){this.cancel();const e=Math.floor(this.Hi+this.tr()),n=Math.max(0,Date.now()-this.Yi),s=Math.max(0,e-n);s>0&&Bm("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Hi} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Ji=this.Me.enqueueAfterDelay(this.timerId,s,(()=>(this.Yi=Date.now(),t()))),this.Hi*=this.Gi,this.Hi<this.Wi&&(this.Hi=this.Wi),this.Hi>this.zi&&(this.Hi=this.zi)}er(){null!==this.Ji&&(this.Ji.skipDelay(),this.Ji=null)}cancel(){null!==this.Ji&&(this.Ji.cancel(),this.Ji=null)}tr(){return(Math.random()-.5)*this.Hi}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sw{constructor(t,e,n,s,i,r,o,a){this.Me=t,this.nr=n,this.sr=s,this.ir=i,this.authCredentialsProvider=r,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.rr=0,this.cr=null,this.ar=null,this.stream=null,this.ur=new nw(t,e)}hr(){return 1===this.state||5===this.state||this.lr()}lr(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.dr()}async stop(){this.hr()&&await this.close(0)}wr(){this.state=0,this.ur.reset()}_r(){this.lr()&&null===this.cr&&(this.cr=this.Me.enqueueAfterDelay(this.nr,6e4,(()=>this.mr())))}gr(t){this.yr(),this.stream.send(t)}async mr(){if(this.lr())return this.close(0)}yr(){this.cr&&(this.cr.cancel(),this.cr=null)}pr(){this.ar&&(this.ar.cancel(),this.ar=null)}async close(t,e){this.yr(),this.pr(),this.ur.cancel(),this.rr++,4!==t?this.ur.reset():e&&e.code===Xm.RESOURCE_EXHAUSTED?(zm(e.toString()),zm("Using maximum backoff delay to prevent overloading the backend."),this.ur.Xi()):e&&e.code===Xm.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Tr(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Ni(e)}Tr(){}auth(){this.state=1;const t=this.Er(this.rr),e=this.rr;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.rr===e&&this.Ir(t,n)}),(e=>{t((()=>{const t=new Ym(Xm.UNKNOWN,"Fetching auth token failed: "+e.message);return this.Ar(t)}))}))}Ir(t,e){const n=this.Er(this.rr);this.stream=this.Rr(t,e),this.stream.Di((()=>{n((()=>(this.state=2,this.ar=this.Me.enqueueAfterDelay(this.sr,1e4,(()=>(this.lr()&&(this.state=3),Promise.resolve()))),this.listener.Di())))})),this.stream.Ni((t=>{n((()=>this.Ar(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}dr(){this.state=5,this.ur.Zi((async()=>{this.state=0,this.start()}))}Ar(t){return Bm("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}Er(t){return e=>{this.Me.enqueueAndForget((()=>this.rr===t?e():(Bm("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class iw extends sw{constructor(t,e,n,s,i,r){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,s,r),this.k=i}Rr(t,e){return this.ir.Qi("Listen",t,e)}onMessage(t){this.ur.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const i="NO_CHANGE"===(s=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===s?1:"REMOVE"===s?2:"CURRENT"===s?3:"RESET"===s?4:Gm(),r=e.targetChange.targetIds||[],o=function(t,e){return t.C?(Hm(void 0===e||"string"==typeof e),vg.fromBase64String(e||"")):(Hm(void 0===e||e instanceof Uint8Array),vg.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),a=e.targetChange.cause,c=a&&function(t){const e=void 0===t.code?Xm.UNKNOWN:e_(t.code);return new Ym(e,t.message||"")}(a);n=new v_(i,r,o,c||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const i=P_(t,s.document.name),r=M_(s.document.updateTime),o=new zg({mapValue:{fields:s.document.fields}}),a=Wg.newFoundDocument(i,r,o),c=s.targetIds||[],h=s.removedTargetIds||[];n=new y_(c,h,a.key,a)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const i=P_(t,s.document),r=s.readTime?M_(s.readTime):ug.min(),o=Wg.newNoDocument(i,r),a=s.removedTargetIds||[];n=new y_([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const i=P_(t,s.document),r=s.removedTargetIds||[];n=new y_([],r,i,null)}else{if(!("filter"in e))return Gm();{e.filter;const t=e.filter;t.targetId;const s=t.count||0,i=new Zy(s),r=t.targetId;n=new __(r,i)}}var s;return n}(this.k,t),n=function(t){if(!("targetChange"in t))return ug.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?ug.min():e.readTime?M_(e.readTime):ug.min()}(t);return this.listener.br(e,n)}Pr(t){const e={};e.database=N_(this.k),e.addTarget=function(t,e){let n;const s=e.target;return n=Xg(s)?{documents:L_(t,s)}:{query:q_(t,s)},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=S_(t,e.resumeToken):e.snapshotVersion.compareTo(ug.min())>0&&(n.readTime=E_(t,e.snapshotVersion.toTimestamp())),n}(this.k,t);const n=function(t,e){const n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Gm()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.k,t);n&&(e.labels=n),this.gr(e)}vr(t){const e={};e.database=N_(this.k),e.removeTarget=t,this.gr(e)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class rw extends class{}{constructor(t,e,n,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.ir=n,this.k=s,this.$r=!1}Or(){if(this.$r)throw new Ym(Xm.FAILED_PRECONDITION,"The client has already been terminated.")}Bi(t,e,n){return this.Or(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,i])=>this.ir.Bi(t,e,n,s,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Xm.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Ym(Xm.UNKNOWN,t.toString())}))}ji(t,e,n){return this.Or(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,i])=>this.ir.ji(t,e,n,s,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Xm.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Ym(Xm.UNKNOWN,t.toString())}))}terminate(){this.$r=!0}}class ow{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.Mr=0,this.Fr=null,this.Lr=!0}Br(){0===this.Mr&&(this.Ur("Unknown"),this.Fr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.Fr=null,this.qr("Backend didn't respond within 10 seconds."),this.Ur("Offline"),Promise.resolve()))))}Kr(t){"Online"===this.state?this.Ur("Unknown"):(this.Mr++,this.Mr>=1&&(this.jr(),this.qr(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.Ur("Offline")))}set(t){this.jr(),this.Mr=0,"Online"===t&&(this.Lr=!1),this.Ur(t)}Ur(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}qr(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Lr?(zm(e),this.Lr=!1):Bm("OnlineStateTracker",e)}jr(){null!==this.Fr&&(this.Fr.cancel(),this.Fr=null)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aw{constructor(t,e,n,s,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Qr=[],this.Wr=new Map,this.Gr=new Set,this.zr=[],this.Hr=i,this.Hr.Ei((t=>{n.enqueueAndForget((async()=>{gw(this)&&(Bm("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=Km(t);e.Gr.add(4),await hw(e),e.Jr.set("Unknown"),e.Gr.delete(4),await cw(e)}(this))}))})),this.Jr=new ow(n,s)}}async function cw(t){if(gw(t))for(const e of t.zr)await e(!0)}async function hw(t){for(const e of t.zr)await e(!1)}function lw(t,e){const n=Km(t);n.Wr.has(e.targetId)||(n.Wr.set(e.targetId,e),mw(n)?fw(n):Aw(n).lr()&&dw(n,e))}function uw(t,e){const n=Km(t),s=Aw(n);n.Wr.delete(e),s.lr()&&pw(n,e),0===n.Wr.size&&(s.lr()?s._r():gw(n)&&n.Jr.set("Unknown"))}function dw(t,e){t.Yr.X(e.targetId),Aw(t).Pr(e)}function pw(t,e){t.Yr.X(e),Aw(t).vr(e)}function fw(t){t.Yr=new b_({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>t.Wr.get(e)||null}),Aw(t).start(),t.Jr.Br()}function mw(t){return gw(t)&&!Aw(t).hr()&&t.Wr.size>0}function gw(t){return 0===Km(t).Gr.size}function yw(t){t.Yr=void 0}async function _w(t){t.Wr.forEach(((e,n)=>{dw(t,e)}))}async function vw(t,e){yw(t),mw(t)?(t.Jr.Kr(e),fw(t)):t.Jr.set("Unknown")}async function ww(t,e,n){if(t.Jr.set("Online"),e instanceof v_&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const s of e.targetIds)t.Wr.has(s)&&(await t.remoteSyncer.rejectListen(s,n),t.Wr.delete(s),t.Yr.removeTarget(s))}(t,e)}catch(n){Bm("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await bw(t,n)}else if(e instanceof y_?t.Yr.ot(e):e instanceof __?t.Yr.dt(e):t.Yr.ut(e),!n.isEqual(ug.min()))try{const e=await Pv(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.Yr.gt(e);return n.targetChanges.forEach(((n,s)=>{if(n.resumeToken.approximateByteSize()>0){const i=t.Wr.get(s);i&&t.Wr.set(s,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach((e=>{const n=t.Wr.get(e);if(!n)return;t.Wr.set(e,n.withResumeToken(vg.EMPTY_BYTE_STRING,n.snapshotVersion)),pw(t,e);const s=new gv(n.target,e,1,n.sequenceNumber);dw(t,s)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){Bm("RemoteStore","Failed to raise snapshot:",e),await bw(t,e)}}async function bw(t,e,n){if(!fv(e))throw e;t.Gr.add(1),await hw(t),t.Jr.set("Offline"),n||(n=()=>Pv(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Bm("RemoteStore","Retrying IndexedDB access"),await n(),t.Gr.delete(1),await cw(t)}))}async function Tw(t,e){const n=Km(t);n.asyncQueue.verifyOperationInProgress(),Bm("RemoteStore","RemoteStore received new credentials");const s=gw(n);n.Gr.add(3),await hw(n),s&&n.Jr.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Gr.delete(3),await cw(n)}async function xw(t,e){const n=Km(t);e?(n.Gr.delete(2),await cw(n)):e||(n.Gr.add(2),await hw(n),n.Jr.set("Unknown"))}function Aw(t){return t.Xr||(t.Xr=function(t,e,n){const s=Km(t);return s.Or(),new iw(e,s.ir,s.authCredentials,s.appCheckCredentials,s.k,n)}(t.datastore,t.asyncQueue,{Di:_w.bind(null,t),Ni:vw.bind(null,t),br:ww.bind(null,t)}),t.zr.push((async e=>{e?(t.Xr.wr(),mw(t)?fw(t):t.Jr.set("Unknown")):(await t.Xr.stop(),yw(t))}))),t.Xr}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class kw{constructor(t,e,n,s,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=s,this.removalCallback=i,this.deferred=new Qm,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}static createAndSchedule(t,e,n,s,i){const r=Date.now()+n,o=new kw(t,e,r,s,i);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Ym(Xm.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Cw(t,e){if(zm("AsyncQueue",`${e}: ${t}`),fv(t))return new Ym(Xm.UNAVAILABLE,`${e}: ${t}`);throw t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ew{constructor(t){this.comparator=t?(e,n)=>t(e,n)||Mg.comparator(e.key,n.key):(t,e)=>Mg.comparator(t.key,e.key),this.keyedMap=l_(),this.sortedSet=new n_(this.comparator)}static emptySet(t){return new Ew(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof Ew))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,s=n.getNext().key;if(!t.isEqual(s))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new Ew;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sw{constructor(){this.eo=new n_(Mg.comparator)}track(t){const e=t.doc.key,n=this.eo.get(e);n?0!==t.type&&3===n.type?this.eo=this.eo.insert(e,t):3===t.type&&1!==n.type?this.eo=this.eo.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.eo=this.eo.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.eo=this.eo.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.eo=this.eo.remove(e):1===t.type&&2===n.type?this.eo=this.eo.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.eo=this.eo.insert(e,{type:2,doc:t.doc}):Gm():this.eo=this.eo.insert(e,t)}no(){const t=[];return this.eo.inorderTraversal(((e,n)=>{t.push(n)})),t}}class Mw{constructor(t,e,n,s,i,r,o,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=i,this.fromCache=r,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(t,e,n,s){const i=[];return e.forEach((t=>{i.push({type:0,doc:t})})),new Mw(t,e,Ew.emptySet(e),i,n,s,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Ty(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iw{constructor(){this.so=void 0,this.listeners=[]}}class Dw{constructor(){this.queries=new Av((t=>xy(t)),Ty),this.onlineState="Unknown",this.io=new Set}}async function Pw(t,e){const n=Km(t),s=e.query;let i=!1,r=n.queries.get(s);if(r||(i=!0,r=new Iw),i)try{r.so=await n.onListen(s)}catch(t){const n=Cw(t,`Initialization of query '${Ay(e.query)}' failed`);return void e.onError(n)}n.queries.set(s,r),r.listeners.push(e),e.ro(n.onlineState),r.so&&e.oo(r.so)&&Vw(n)}async function Ow(t,e){const n=Km(t),s=e.query;let i=!1;const r=n.queries.get(s);if(r){const t=r.listeners.indexOf(e);t>=0&&(r.listeners.splice(t,1),i=0===r.listeners.length)}if(i)return n.queries.delete(s),n.onUnlisten(s)}function Rw(t,e){const n=Km(t);let s=!1;for(const t of e){const e=t.query,i=n.queries.get(e);if(i){for(const e of i.listeners)e.oo(t)&&(s=!0);i.so=t}}s&&Vw(n)}function Nw(t,e,n){const s=Km(t),i=s.queries.get(e);if(i)for(const t of i.listeners)t.onError(n);s.queries.delete(e)}function Vw(t){t.io.forEach((t=>{t.next()}))}class Lw{constructor(t,e,n){this.query=t,this.co=e,this.ao=!1,this.uo=null,this.onlineState="Unknown",this.options=n||{}}oo(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new Mw(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}let e=!1;return this.ao?this.ho(t)&&(this.co.next(t),e=!0):this.lo(t,this.onlineState)&&(this.fo(t),e=!0),this.uo=t,e}onError(t){this.co.error(t)}ro(t){this.onlineState=t;let e=!1;return this.uo&&!this.ao&&this.lo(this.uo,t)&&(this.fo(this.uo),e=!0),e}lo(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return!(this.options.wo&&n||t.docs.isEmpty()&&"Offline"!==e)}ho(t){if(t.docChanges.length>0)return!0;const e=this.uo&&this.uo.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}fo(t){t=Mw.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.ao=!0,this.co.next(t)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class qw{constructor(t){this.key=t}}class Fw{constructor(t){this.key=t}}class jw{constructor(t,e){this.query=t,this.To=e,this.Eo=null,this.current=!1,this.Io=d_(),this.mutatedKeys=d_(),this.Ao=Cy(t),this.Ro=new Ew(this.Ao)}get bo(){return this.To}Po(t,e){const n=e?e.vo:new Sw,s=e?e.Ro:this.Ro;let i=e?e.mutatedKeys:this.mutatedKeys,r=s,o=!1;const a=fy(this.query)&&s.size===this.query.limit?s.last():null,c=my(this.query)&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal(((t,e)=>{const h=s.get(t),l=ky(this.query,e)?e:null,u=!!h&&this.mutatedKeys.has(h.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let p=!1;h&&l?h.data.isEqual(l.data)?u!==d&&(n.track({type:3,doc:l}),p=!0):this.Vo(h,l)||(n.track({type:2,doc:l}),p=!0,(a&&this.Ao(l,a)>0||c&&this.Ao(l,c)<0)&&(o=!0)):!h&&l?(n.track({type:0,doc:l}),p=!0):h&&!l&&(n.track({type:1,doc:h}),p=!0,(a||c)&&(o=!0)),p&&(l?(r=r.add(l),i=d?i.add(t):i.delete(t)):(r=r.delete(t),i=i.delete(t)))})),fy(this.query)||my(this.query))for(;r.size>this.query.limit;){const t=fy(this.query)?r.last():r.first();r=r.delete(t.key),i=i.delete(t.key),n.track({type:1,doc:t})}return{Ro:r,vo:n,Bn:o,mutatedKeys:i}}Vo(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n){const s=this.Ro;this.Ro=t.Ro,this.mutatedKeys=t.mutatedKeys;const i=t.vo.no();i.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Gm()}};return n(t)-n(e)}(t.type,e.type)||this.Ao(t.doc,e.doc))),this.So(n);const r=e?this.Do():[],o=0===this.Io.size&&this.current?1:0,a=o!==this.Eo;return this.Eo=o,0!==i.length||a?{snapshot:new Mw(this.query,t.Ro,s,i,t.mutatedKeys,0===o,a,!1),Co:r}:{Co:r}}ro(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Ro:this.Ro,vo:new Sw,mutatedKeys:this.mutatedKeys,Bn:!1},!1)):{Co:[]}}No(t){return!this.To.has(t)&&!!this.Ro.has(t)&&!this.Ro.get(t).hasLocalMutations}So(t){t&&(t.addedDocuments.forEach((t=>this.To=this.To.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.To=this.To.delete(t))),this.current=t.current)}Do(){if(!this.current)return[];const t=this.Io;this.Io=d_(),this.Ro.forEach((t=>{this.No(t.key)&&(this.Io=this.Io.add(t.key))}));const e=[];return t.forEach((t=>{this.Io.has(t)||e.push(new Fw(t))})),this.Io.forEach((n=>{t.has(n)||e.push(new qw(n))})),e}ko(t){this.To=t.zn,this.Io=d_();const e=this.Po(t.documents);return this.applyChanges(e,!0)}xo(){return Mw.fromInitialDocuments(this.query,this.Ro,this.mutatedKeys,0===this.Eo)}}class Uw{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class Bw{constructor(t){this.key=t,this.$o=!1}}class zw{constructor(t,e,n,s,i,r){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=r,this.Oo={},this.Mo=new Av((t=>xy(t)),Ty),this.Fo=new Map,this.Lo=new Set,this.Bo=new n_(Mg.comparator),this.Uo=new Map,this.qo=new qv,this.Ko={},this.jo=new Map,this.Qo=Tv.re(),this.onlineState="Unknown",this.Wo=void 0}get isPrimaryClient(){return!0===this.Wo}}async function Ww(t,e){const n=ib(t);let s,i;const r=n.Mo.get(e);if(r)s=r.targetId,n.sharedClientState.addLocalQueryTarget(s),i=r.view.xo();else{const t=await Rv(n.localStore,wy(e)),r=n.sharedClientState.addLocalQueryTarget(t.targetId);s=t.targetId,i=await $w(n,e,s,"current"===r),n.isPrimaryClient&&lw(n.remoteStore,t)}return i}async function $w(t,e,n,s){t.Go=(e,n,s)=>async function(t,e,n,s){let i=e.view.Po(n);i.Bn&&(i=await Vv(t.localStore,e.query,!1).then((({documents:t})=>e.view.Po(t,i))));const r=s&&s.targetChanges.get(e.targetId),o=e.view.applyChanges(i,t.isPrimaryClient,r);return Zw(t,e.targetId,o.Co),o.snapshot}(t,e,n,s);const i=await Vv(t.localStore,e,!0),r=new jw(e,i.zn),o=r.Po(i.documents),a=g_.createSynthesizedTargetChangeForCurrentChange(n,s&&"Offline"!==t.onlineState),c=r.applyChanges(o,t.isPrimaryClient,a);Zw(t,n,c.Co);const h=new Uw(e,n,r);return t.Mo.set(e,h),t.Fo.has(n)?t.Fo.get(n).push(e):t.Fo.set(n,[e]),c.snapshot}async function Gw(t,e){const n=Km(t),s=n.Mo.get(e),i=n.Fo.get(s.targetId);if(i.length>1)return n.Fo.set(s.targetId,i.filter((t=>!Ty(t,e)))),void n.Mo.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||await Nv(n.localStore,s.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(s.targetId),uw(n.remoteStore,s.targetId),Yw(n,s.targetId)})).catch(xv)):(Yw(n,s.targetId),await Nv(n.localStore,s.targetId,!0))}async function Hw(t,e){const n=Km(t);try{const t=await function(t,e){const n=Km(t),s=e.snapshotVersion;let i=n.qn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const r=n.Qn.newChangeBuffer({trackRemovals:!0});i=n.qn;const o=[];e.targetChanges.forEach(((r,a)=>{const c=i.get(a);if(!c)return;o.push(n.He.removeMatchingKeys(t,r.removedDocuments,a).next((()=>n.He.addMatchingKeys(t,r.addedDocuments,a))));let h=c.withSequenceNumber(t.currentSequenceNumber);var l,u,d;e.targetMismatches.has(a)?h=h.withResumeToken(vg.EMPTY_BYTE_STRING,ug.min()).withLastLimboFreeSnapshotVersion(ug.min()):r.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(r.resumeToken,s)),i=i.insert(a,h),u=h,d=r,(0===(l=c).resumeToken.approximateByteSize()||u.snapshotVersion.toMicroseconds()-l.snapshotVersion.toMicroseconds()>=3e8||d.addedDocuments.size+d.modifiedDocuments.size+d.removedDocuments.size>0)&&o.push(n.He.updateTargetData(t,h))}));let a=c_();if(e.documentUpdates.forEach(((s,i)=>{e.resolvedLimboDocuments.has(s)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,s))})),o.push(Ov(t,r,e.documentUpdates,s,void 0).next((t=>{a=t}))),!s.isEqual(ug.min())){const e=n.He.getLastRemoteSnapshotVersion(t).next((e=>n.He.setTargetsMetadata(t,t.currentSequenceNumber,s)));o.push(e)}return pv.waitFor(o).next((()=>r.apply(t))).next((()=>n.Wn.Vn(t,a))).next((()=>a))})).then((t=>(n.qn=i,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const s=n.Uo.get(e);s&&(Hm(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?s.$o=!0:t.modifiedDocuments.size>0?Hm(s.$o):t.removedDocuments.size>0&&(Hm(s.$o),s.$o=!1))})),await eb(n,t,e)}catch(t){await xv(t)}}function Kw(t,e,n){const s=Km(t);if(s.isPrimaryClient&&0===n||!s.isPrimaryClient&&1===n){const t=[];s.Mo.forEach(((n,s)=>{const i=s.view.ro(e);i.snapshot&&t.push(i.snapshot)})),function(t,e){const n=Km(t);n.onlineState=e;let s=!1;n.queries.forEach(((t,n)=>{for(const t of n.listeners)t.ro(e)&&(s=!0)})),s&&Vw(n)}(s.eventManager,e),t.length&&s.Oo.br(t),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function Xw(t,e,n){const s=Km(t);s.sharedClientState.updateQueryState(e,"rejected",n);const i=s.Uo.get(e),r=i&&i.key;if(r){let t=new n_(Mg.comparator);t=t.insert(r,Wg.newNoDocument(r,ug.min()));const n=d_().add(r),i=new m_(ug.min(),new Map,new r_(cg),t,n);await Hw(s,i),s.Bo=s.Bo.remove(r),s.Uo.delete(e),tb(s)}else await Nv(s.localStore,e,!1).then((()=>Yw(s,e,n))).catch(xv)}function Yw(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const s of t.Fo.get(e))t.Mo.delete(s),n&&t.Oo.zo(s,n);t.Fo.delete(e),t.isPrimaryClient&&t.qo.us(e).forEach((e=>{t.qo.containsKey(e)||Qw(t,e)}))}function Qw(t,e){t.Lo.delete(e.path.canonicalString());const n=t.Bo.get(e);null!==n&&(uw(t.remoteStore,n),t.Bo=t.Bo.remove(e),t.Uo.delete(n),tb(t))}function Zw(t,e,n){for(const s of n)s instanceof qw?(t.qo.addReference(s.key,e),Jw(t,s)):s instanceof Fw?(Bm("SyncEngine","Document no longer in limbo: "+s.key),t.qo.removeReference(s.key,e),t.qo.containsKey(s.key)||Qw(t,s.key)):Gm()}function Jw(t,e){const n=e.key,s=n.path.canonicalString();t.Bo.get(n)||t.Lo.has(s)||(Bm("SyncEngine","New document in limbo: "+n),t.Lo.add(s),tb(t))}function tb(t){for(;t.Lo.size>0&&t.Bo.size<t.maxConcurrentLimboResolutions;){const e=t.Lo.values().next().value;t.Lo.delete(e);const n=new Mg(gg.fromString(e)),s=t.Qo.next();t.Uo.set(s,new Bw(n)),t.Bo=t.Bo.insert(n,s),lw(t.remoteStore,new gv(wy(py(n.path)),s,2,rg.I))}}async function eb(t,e,n){const s=Km(t),i=[],r=[],o=[];s.Mo.isEmpty()||(s.Mo.forEach(((t,a)=>{o.push(s.Go(a,e,n).then((t=>{if(t){s.isPrimaryClient&&s.sharedClientState.updateQueryState(a.targetId,t.fromCache?"not-current":"current"),i.push(t);const e=Ev.$n(a.targetId,t);r.push(e)}})))})),await Promise.all(o),s.Oo.br(i),await async function(t,e){const n=Km(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>pv.forEach(e,(e=>pv.forEach(e.kn,(s=>n.persistence.referenceDelegate.addReference(t,e.targetId,s))).next((()=>pv.forEach(e.xn,(s=>n.persistence.referenceDelegate.removeReference(t,e.targetId,s)))))))))}catch(t){if(!fv(t))throw t;Bm("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.qn.get(e),s=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(s);n.qn=n.qn.insert(e,i)}}}(s.localStore,r))}async function nb(t,e){const n=Km(t);if(!n.currentUser.isEqual(e)){Bm("SyncEngine","User change. New user:",e.toKey());const t=await Dv(n.localStore,e);n.currentUser=e,(s=n).jo.forEach((t=>{t.forEach((t=>{t.reject(new Ym(Xm.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),s.jo.clear(),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await eb(n,t.Gn)}var s}function sb(t,e){const n=Km(t),s=n.Uo.get(e);if(s&&s.$o)return d_().add(s.key);{let t=d_();const s=n.Fo.get(e);if(!s)return t;for(const e of s){const s=n.Mo.get(e);t=t.unionWith(s.view.bo)}return t}}function ib(t){const e=Km(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Hw.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=sb.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Xw.bind(null,e),e.Oo.br=Rw.bind(null,e.eventManager),e.Oo.zo=Nw.bind(null,e.eventManager),e}class rb{constructor(){this.synchronizeTabs=!1}async initialize(t){this.k=ew(t.databaseInfo.databaseId),this.sharedClientState=this.Jo(t),this.persistence=this.Yo(t),await this.persistence.start(),this.gcScheduler=this.Xo(t),this.localStore=this.Zo(t)}Xo(t){return null}Zo(t){return Iv(this.persistence,new Sv,t.initialUser,this.k)}Yo(t){return new Wv(Gv.ks,this.k)}Jo(t){return new Kv}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class ob{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>Kw(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=nb.bind(null,this.syncEngine),await xw(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new Dw}createDatastore(t){const e=ew(t.databaseInfo.databaseId),n=(s=t.databaseInfo,new Jv(s));var s,i,r;return i=t.authCredentials,r=t.appCheckCredentials,new rw(i,r,n,e)}createRemoteStore(t){var e,n,s,i,r;return e=this.localStore,n=this.datastore,s=t.asyncQueue,i=t=>Kw(this.syncEngine,t,0),r=Yv.Pt()?new Yv:new Xv,new aw(e,n,s,i,r)}createSyncEngine(t,e){return function(t,e,n,s,i,r,o){const a=new zw(t,e,n,s,i,r);return o&&(a.Wo=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=Km(t);Bm("RemoteStore","RemoteStore shutting down."),e.Gr.add(5),await hw(e),e.Hr.shutdown(),e.Jr.set("Unknown")}(this.remoteStore)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class ab{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.ec(this.observer.next,t)}error(t){this.observer.error?this.ec(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)}nc(){this.muted=!0}ec(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class cb{constructor(t,e,n,s){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=s,this.user=qm.UNAUTHENTICATED,this.clientId=ag.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{Bm("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(Bm("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Ym(Xm.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Qm;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=Cw(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function hb(t,e){t.asyncQueue.verifyOperationInProgress(),Bm("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let s=n.initialUser;t.setCredentialChangeListener((async t=>{s.isEqual(t)||(await Dv(e.localStore,t),s=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t.offlineComponents=e}async function lb(t,e){t.asyncQueue.verifyOperationInProgress();const n=await ub(t);Bm("FirestoreClient","Initializing OnlineComponentProvider");const s=await t.getConfiguration();await e.initialize(n,s),t.setCredentialChangeListener((t=>Tw(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>Tw(e.remoteStore,n))),t.onlineComponents=e}async function ub(t){return t.offlineComponents||(Bm("FirestoreClient","Using default OfflineComponentProvider"),await hb(t,new rb)),t.offlineComponents}async function db(t){return t.onlineComponents||(Bm("FirestoreClient","Using default OnlineComponentProvider"),await lb(t,new ob)),t.onlineComponents}async function pb(t){const e=await db(t),n=e.eventManager;return n.onListen=Ww.bind(null,e.syncEngine),n.onUnlisten=Gw.bind(null,e.syncEngine),n}function fb(t,e,n={}){const s=new Qm;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,s,i){const r=new ab({next:r=>{e.enqueueAndForget((()=>Ow(t,o)));const a=r.docs.has(n);!a&&r.fromCache?i.reject(new Ym(Xm.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&r.fromCache&&s&&"server"===s.source?i.reject(new Ym(Xm.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(r)},error:t=>i.reject(t)}),o=new Lw(py(n.path),r,{includeMetadataChanges:!0,wo:!0});return Pw(t,o)}(await pb(t),t.asyncQueue,e,n,s))),s.promise}function mb(t,e,n={}){const s=new Qm;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,s,i){const r=new ab({next:n=>{e.enqueueAndForget((()=>Ow(t,o))),n.fromCache&&"server"===s.source?i.reject(new Ym(Xm.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:t=>i.reject(t)}),o=new Lw(n,r,{includeMetadataChanges:!0,wo:!0});return Pw(t,o)}(await pb(t),t.asyncQueue,e,n,s))),s.promise}class gb{constructor(t,e,n,s,i,r,o,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=s,this.ssl=i,this.forceLongPolling=r,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class yb{constructor(t,e){this.projectId=t,this.database=e||"(default)"}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof yb&&t.projectId===this.projectId&&t.database===this.database}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _b=new Map;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vb(t,e,n){if(!n)throw new Ym(Xm.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function wb(t){if(!Mg.isDocumentKey(t))throw new Ym(Xm.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function bb(t){if(Mg.isDocumentKey(t))throw new Ym(Xm.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Tb(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const n=(e=t).constructor?e.constructor.name:null;return n?`a custom ${n} object`:"an object"}}var e;return"function"==typeof t?"a function":Gm()}function xb(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Ym(Xm.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Tb(t);throw new Ym(Xm.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Ab{constructor(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Ym(Xm.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Ym(Xm.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,function(t,e,n,s){if(!0===e&&!0===s)throw new Ym(Xm.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kb{constructor(t,e,n){this._authCredentials=e,this._appCheckCredentials=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ab({}),this._settingsFrozen=!1,t instanceof yb?this._databaseId=t:(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Ym(Xm.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new yb(t.options.projectId)}(t))}get app(){if(!this._app)throw new Ym(Xm.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new Ym(Xm.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ab(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new Jm;switch(t.type){case"gapi":const e=t.client;return Hm(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new ng(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new Ym(Xm.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=_b.get(t);e&&(Bm("ComponentProvider","Removing Datastore"),_b.delete(t),e.terminate())}(this),Promise.resolve()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Cb{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Sb(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Cb(this.firestore,t,this._key)}}class Eb{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new Eb(this.firestore,t,this._query)}}class Sb extends Eb{constructor(t,e,n){super(t,e,py(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Cb(this.firestore,null,new Mg(t))}withConverter(t){return new Sb(this.firestore,t,this._path)}}function Mb(t,e,...n){if(t=Zh(t),vb("collection","path",e),t instanceof kb){const s=gg.fromString(e,...n);return bb(s),new Sb(t,null,s)}{if(!(t instanceof Cb||t instanceof Sb))throw new Ym(Xm.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(gg.fromString(e,...n));return bb(s),new Sb(t.firestore,null,s)}}function Ib(t,e,...n){if(t=Zh(t),1===arguments.length&&(e=ag.A()),vb("doc","path",e),t instanceof kb){const s=gg.fromString(e,...n);return wb(s),new Cb(t,null,new Mg(s))}{if(!(t instanceof Cb||t instanceof Sb))throw new Ym(Xm.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(gg.fromString(e,...n));return wb(s),new Cb(t.firestore,t instanceof Sb?t.converter:null,new Mg(s))}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Db{constructor(){this.mc=Promise.resolve(),this.gc=[],this.yc=!1,this.Tc=[],this.Ec=null,this.Ic=!1,this.Ac=!1,this.Rc=[],this.ur=new nw(this,"async_queue_retry"),this.bc=()=>{const t=tw();t&&Bm("AsyncQueue","Visibility state changed to "+t.visibilityState),this.ur.er()};const t=tw();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.bc)}get isShuttingDown(){return this.yc}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Pc(),this.vc(t)}enterRestrictedMode(t){if(!this.yc){this.yc=!0,this.Ac=t||!1;const e=tw();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.bc)}}enqueue(t){if(this.Pc(),this.yc)return new Promise((()=>{}));const e=new Qm;return this.vc((()=>this.yc&&this.Ac?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.gc.push(t),this.Vc())))}async Vc(){if(0!==this.gc.length){try{await this.gc[0](),this.gc.shift(),this.ur.reset()}catch(t){if(!fv(t))throw t;Bm("AsyncQueue","Operation failed with retryable error: "+t)}this.gc.length>0&&this.ur.Zi((()=>this.Vc()))}}vc(t){const e=this.mc.then((()=>(this.Ic=!0,t().catch((t=>{this.Ec=t,this.Ic=!1;throw zm("INTERNAL UNHANDLED ERROR: ",function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t})).then((t=>(this.Ic=!1,t))))));return this.mc=e,e}enqueueAfterDelay(t,e,n){this.Pc(),this.Rc.indexOf(t)>-1&&(e=0);const s=kw.createAndSchedule(this,t,e,n,(t=>this.Sc(t)));return this.Tc.push(s),s}Pc(){this.Ec&&Gm()}verifyOperationInProgress(){}async Dc(){let t;do{t=this.mc,await t}while(t!==this.mc)}Cc(t){for(const e of this.Tc)if(e.timerId===t)return!0;return!1}Nc(t){return this.Dc().then((()=>{this.Tc.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.Tc)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.Dc()}))}kc(t){this.Rc.push(t)}Sc(t){const e=this.Tc.indexOf(t);this.Tc.splice(e,1)}}class Pb extends kb{constructor(t,e,n){super(t,e,n),this.type="firestore",this._queue=new Db,this._persistenceKey="name"in t?t.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||Rb(this),this._firestoreClient.terminate()}}function Ob(t){return t._firestoreClient||Rb(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Rb(t){var e;const n=t._freezeSettings(),s=(i=t._databaseId,r=(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",o=t._persistenceKey,new gb(i,r,o,(a=n).host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,a.useFetchStreams));var i,r,o,a;t._firestoreClient=new cb(t._authCredentials,t._appCheckCredentials,t._queue,s)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Nb{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new Ym(Xm.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new _g(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Vb{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Vb(vg.fromBase64String(t))}catch(t){throw new Ym(Xm.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Vb(vg.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Lb{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new Ym(Xm.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Ym(Xm.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return cg(this._lat,t._lat)||cg(this._long,t._long)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qb=new RegExp("[~\\*/\\[\\]]");function Fb(t,e,n){if(e.search(qb)>=0)throw jb(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Nb(...e.split("."))._internalPath}catch(s){throw jb(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function jb(t,e,n,s,i){const r=s&&!s.isEmpty(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(r||o)&&(c+=" (found",r&&(c+=` in field ${s}`),o&&(c+=` in document ${i}`),c+=")"),new Ym(Xm.INVALID_ARGUMENT,a+t+c)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Ub{constructor(t,e,n,s,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Cb(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new Bb(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(zb("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class Bb extends Ub{data(){return super.data()}}function zb(t,e){return"string"==typeof e?Fb(t,e):e instanceof Nb?e._internalPath:e._delegate._internalPath}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wb{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class $b extends Ub{constructor(t,e,n,s,i,r){super(t,e,n,s,r),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Gb(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(zb("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class Gb extends $b{data(t={}){return super.data(t)}}class Hb{constructor(t,e,n,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new Wb(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new Gb(this._firestore,this._userDataWriter,n.key,n,new Wb(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Ym(Xm.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>({type:"added",doc:new Gb(t._firestore,t._userDataWriter,n.doc.key,n.doc,new Wb(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:e++})))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const s=new Gb(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Wb(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let i=-1,r=-1;return 0!==e.type&&(i=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),r=n.indexOf(e.doc.key)),{type:Kb(e.type),doc:s,oldIndex:i,newIndex:r}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function Kb(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Gm()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Xb(t){if(my(t)&&0===t.explicitOrderBy.length)throw new Ym(Xm.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}function Yb(t,...e){for(const n of e)t=n._apply(t);return t}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Qb{convertValue(t,e="none"){switch(Ig(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Tg(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(xg(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Gm()}}convertObject(t,e){const n={};return pg(t.fields,((t,s)=>{n[t]=this.convertValue(s,e)})),n}convertGeoPoint(t){return new Lb(Tg(t.latitude),Tg(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=kg(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Cg(t));default:return null}}convertTimestamp(t){const e=bg(t);return new lg(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=gg.fromString(t);Hm(K_(n));const s=new yb(n.get(1),n.get(3)),i=new Mg(n.popFirst(5));return s.isEqual(e)||zm(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Zb(t){t=xb(t,Cb);const e=xb(t.firestore,Pb);return fb(Ob(e),t._key).then((n=>eT(e,t,n)))}class Jb extends Qb{constructor(t){super(),this.firestore=t}convertBytes(t){return new Vb(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new Cb(this.firestore,null,e)}}function tT(t){t=xb(t,Eb);const e=xb(t.firestore,Pb),n=Ob(e),s=new Jb(e);return Xb(t._query),mb(n,t._query).then((n=>new Hb(e,s,t,n)))}function eT(t,e,n){const s=n.docs.get(e._key),i=new Jb(t);return new $b(t,i,e._key,s,new Wb(n.hasPendingWrites,n.fromCache),e.converter)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(t,e=!0){Fm="9.6.6",gl(new Jh("firestore",((t,{options:n})=>{const s=t.getProvider("app").getImmediate(),i=new Pb(s,new tg(t.getProvider("auth-internal")),new ig(t.getProvider("app-check-internal")));return n=Object.assign({useFetchStreams:e},n),i._setSettings(n),i}),"PUBLIC")),bl("@firebase/firestore","3.4.4",t),bl("@firebase/firestore","3.4.4","esm2017")}();const nT=function(t,e={}){if("object"!=typeof e){e={name:e}}const n=Object.assign({name:"[DEFAULT]",automaticDataCollectionEnabled:!1},e),s=n.name;if("string"!=typeof s||!s)throw _l.create("bad-app-name",{appName:String(s)});const i=pl.get(s);if(i){if(Yh(t,i.options)&&Yh(n,i.config))return i;throw _l.create("duplicate-app",{appName:s})}const r=new nl(s);for(const t of fl.values())r.addComponent(t);const o=new vl(t,n,r);return pl.set(s,o),o}({apiKey:"AIzaSyCx_9Kyfjn03jNXGM9dj7b8Omfd6CP0awU",authDomain:"actamproject-598ad.firebaseapp.com",projectId:"actamproject-598ad",storageBucket:"actamproject-598ad.appspot.com",messagingSenderId:"868627486863",appId:"1:868627486863:web:ee55ebd557f3abd6d5b8fa"}),sT=function(t=wl()){return yl(t,"firestore").getImmediate()}(),iT=function(t=wl(),e){return yl(t=Zh(t),"storage").getImmediate({identifier:e})}(nT);async function rT(t){let e=lu(iT,"assets/"+t);console.log(e);let n=await hu(e);try{return new URL(n)}catch(t){t.code}}const oT=document.getElementById("canvas-div");var aT=document.getElementById("main-canvas");aT.className="canvases",aT.width=1024,aT.height=512,oT.appendChild(aT);var cT,hT,lT=aT.getContext("2d"),uT=new Date,dT=0,pT=(aT.width,(cT="16m",new Sa(ya(),cT,hT)).toMilliseconds());function fT(){yT.isPlaying&&(Date.now()-yT.now1>1e3/yT.fps?(!function(t){yT.now1=t}(Date.now()),ET(window.requestAnimationFrame(mT))):ET(window.requestAnimationFrame(fT)))}function mT(){const t=3.05,e=3.3,n=6.1;let s=!1;const i=3*Math.PI/2;let r=0,o=0,a=0,c=0,h=0;var l=Date.now(),u=aT.height,d=aT.width;lT.clearRect(0,0,aT.width,aT.height),lT.imageSmoothingEnabled=!1;dT=5/pT;let p=u-4*CT("floor").getNHeight()-100,f=d/2-CT("astrumNight").getNWidth()/2*4;var m=i+dT*(l-uT.getTime());let g=m%(2*Math.PI);g<.5?(r=1,o=0,c=1-2*(g-0),a=0,s=!0,h=1):g<t?(r=1,o=0,c=0,a=0,s=!0):g<e?(r=1,o=4*(g-t),c=0,a=0,s=!0):g<4?(r=0,o=1,c=0,a=1/(4-e)*(g-e),s=!1):g<n?(r=0,o=0,c=0,a=1,s=!1):(r=0,o=0,c=1,a=1-1/(2*Math.PI-n)*(g-n),s=!1,h=1/(2*Math.PI-n)*(g-n));let y=CT("background");y.drawThisImage(0,r,s,aT.height,aT.width,lT,4),y.drawThisImage(1,o,s,aT.height,aT.width,lT,4),y.drawThisImage(2,c,s,aT.height,aT.width,lT,4),y.drawThisImage(3,a,s,aT.height,aT.width,lT,4),lT.save(),lT.translate(Math.round(d/2),Math.round(p-60)),lT.save();let _=CT("astrumNight");lT.translate(Math.round(-f*Math.cos(m)),Math.round(p*Math.sin(-m))),lT.translate(Math.round(-4*_.getNWidth()/2),Math.round(4*_.getNHeight()/2)),_.drawThisImage(0,1,s,0,0,lT,4),lT.restore(),lT.save();let v=CT("astrumDay");lT.translate(Math.round(f*Math.cos(m-.1)),Math.round(p*Math.sin(m-.1))),lT.translate(Math.round(-4*v.getNWidth()/2),Math.round(4*v.getNHeight()/2)),v.drawThisImage(0,1,s,0,0,lT,4),v.drawThisImage(1,h,s,0,0,lT,4),lT.restore(),lT.restore(),lT.save();let w=CT("flyingObject");if(0!=w.length){console.log("num of objs"),console.log(w.length);for(let t of w)lT.save(),lT.translate(-d+(2*t.getProperty().shift*2*d+t.getProperty().velocity*m*d)%(2*d),t.getProperty().shift*(u/2)),t.drawThisImage(0,r,s,aT.height,aT.width,lT,4),t.drawThisImage(1,o,s,aT.height,aT.width,lT,4),t.drawThisImage(2,c,s,aT.height,aT.width,lT,4),t.drawThisImage(3,a,s,aT.height,aT.width,lT,4),lT.restore()}lT.restore(),CT("landscape").drawThisImage(0,1,s,aT.height,aT.width,lT,4),CT("floor").drawThisImage(0,1,s,aT.height,aT.width,lT,4),CT("building").drawThisImage(0,1,s,aT.height,aT.width,lT,4),CT("tree").drawThisImage(0,1,s,aT.height,aT.width,lT,4),ET(window.requestAnimationFrame(fT))}class gT{constructor(t,e,n,s,i){this.imageType=s,this.imageArray=t,this.left=e,this.bottom=n,this.property=i}static async build(t){let e=[];for(let n of t.imageArray){let t=new Image;t.src=await rT(n),e.push(t)}let n={};if(4===t.imageType)n.velocity=t.velocity,n.shift=Math.random();return 4==t.imageType&&(t.bottom=Math.random(),t.left=Math.random()),new gT(e,t.left,t.bottom,t.imageType,n)}clone(){return new gT(this.imageArray,this.left,this.bottom,this.imageType,this.property)}changeRandomParams(){if(4==this.imageType){this.bottom=Math.random(),this.left=Math.random();let t={velocity:this.property.velocity,shift:Math.random()};this.property=t}else console.log("imageType:"),console.log(this.imageType),console.error("wrong imageType for utilizing changeRandomParams")}drawThisImage(t=0,e=1,n,s=0,i=0,r,o){var a=this.imageArray[t].naturalHeight*o,c=this.imageArray[t].naturalWidth*o,h=this.left*i,l=(1-this.bottom)*s;r.globalAlpha=e;let u=0,d=0;switch(this.imageType){case 0:case 3:u=h,d=l-a;break;case 1:t=n?1:0,u=h,d=l-a;break;case 2:h=0,l=0,u=0,d=0;break;case 4:u=0,d=0}r.drawImage(this.imageArray[t],u,d,c,a),r.globalAlpha=1}getNWidth(){return this.imageArray[0].naturalWidth}getNHeight(){return this.imageArray[0].naturalHeight}getNImages(){return this.imageArray.length}getProperty(){return this.property}}const yT={loadingPage:{value:0,limit:0,lastUpdate:void 0},imagesToDraw:{},environments:void 0,elementTypes:void 0,elements:[],queueCounter:0,queueDay:0,now1:0,canvasFactor:8,framereq:void 0,fps:15,instruments:{},stateChanged:!1,readyModel:!1,readyToPlay:!1,isPlaying:!0,key:"c",bpm:60,totalLength:"",navigationPage:0,startingId:0,master:{},playingPart:[],drawing:{idList:{astrumDay:21,astrumNight:20,landscape:0,floor:8,building:12,tree:16,background:1,flyingObject:[]},image:{flyingObject:[]},audio:{chords:"| F6 | Em7 A7 | Dm7 | Cm7 F7 |",melody:"f+4 c+8 a8 e+4 c+8 a8\nd+8 e+8 cb8 d+8 db+8 bb8 g8 ab8\na4 f8 d8 g8 a8 f8 e8\neb8 g16 bb16 d+8 db+8 r8 f8 f16 g8 f16",instruments:{}}}};async function _T(){let t=await async function(){const t=Ib(sT,"menu","menuTypes"),e=await Zb(t);if(e.exists())return e.data();console.log("No such document!")}();console.log("got?"),yT.elementTypes=t.primaryTypes,yT.environments=t.environments;let e=await async function(){const t=Yb(Mb(sT,"elements")),e=await tT(t);return elementsToRet=[],e.forEach((t=>{elementsToRet.push(t.data())})),elementsToRet}();yT.elements=e}function vT(){return yT.elements}function wT(){return yT.master}function bT(){return yT.master.mainVolumeSave}function TT(){return yT.master.mainGain.gain.value}function xT(t){yT.loadingPage.limit=t}function AT(){let t=document.getElementById("loadingId"),e=yT.loadingPage.value,n=yT.loadingPage.limit;Date.now()-yT.loadingPage.lastUpdate>1e3/30?(e<n&&(yT.loadingPage.value=e+1,t.value=yT.loadingPage.value),e>=100&&(document.getElementById("container").hidden=!1,document.getElementById("initialLoadingPanel").style.visibility="hidden"),window.requestAnimationFrame(AT),yT.loadingPage.lastUpdate=Date.now()):window.requestAnimationFrame(AT)}function kT(){let t=[];for(const[e,n]of Object.entries(yT.drawing.idList))switch(e){case"floor":case"background":case"landscape":case"building":case"tree":case"astrumDay":case"astrumNight":t.push(n);break;case"flyingObject":for(let e of n)t.push(e)}return t}function CT(t){return yT.imagesToDraw[t]}function ET(t){yT.framereq=t}function ST(t){yT.isPlaying=t}function MT(t,e){yT.instruments[t]=e}function IT(t){var e;return e=yT.drawing.audio.instruments[t],yT.instruments[e]}document.createElement("button"),document.createElement("button");document.createElement("div").className="menu-panel";document.getElementById("btn-sx"),document.getElementById("btn-ct"),document.getElementById("btn-dx");function DT(){document.querySelectorAll(".token-btn").forEach((t=>{t.addEventListener("click",(()=>{var e=t.id,n=t.classList[3],s=t.classList[2];console.log("elements"),console.log(n),console.log(s),function(t){switch(console.log(t),modifyingValue=yT.elements.find((e=>e.id==t)),console.log("modifying value"),console.log(modifyingValue),modifyingValue.elementType){case"floor":case"background":case"landscape":case"building":case"tree":case"astrumDay":case"astrumNight":yT.drawing.idList[modifyingValue.elementType]=modifyingValue.id;break;case"flyingObject":{const t={};for(const e of yT.drawing.idList[modifyingValue.elementType])t[e]?t[e]+=1:t[e]=1;if(t[modifyingValue.id]>2)for(;-1!=yT.drawing.idList[modifyingValue.elementType].indexOf(modifyingValue.id);){let t=yT.drawing.idList[modifyingValue.elementType].indexOf(modifyingValue.id);yT.drawing.idList[modifyingValue.elementType].splice(t,1)}else yT.drawing.idList[modifyingValue.elementType].push(modifyingValue.id)}}console.log(yT.drawing)}(e),PT()}))}))}function PT(){document.querySelectorAll(".token-btn").forEach((t=>{t.classList.remove("selected-btn")})),document.querySelectorAll(".token-btn").forEach((t=>{for(var e=Object.values(kT()).indexOf(parseInt(t.id)),n=0;e>-1;)n+=1,e=Object.values(kT()).indexOf(parseInt(t.id),e+1);if(t.classList.contains("flyingObject")){var s=document.getElementById("tAdd"+t.id);s.removeChild(s.firstChild),s.append(n)}n>0&&t.classList.add("selected-btn")}))}async function OT(t){switch(function(t){yT.navigationPage=t}(t),console.log("page"),console.log(t),t){case 0:await async function(){PT(),document.getElementById("btn-dx").onclick=()=>{OT(1)},document.getElementById("player-navbar").hidden=!0,document.getElementById("canva-container").hidden=!0,document.getElementById("menu-container").hidden=!1,document.getElementById("menu-navbar").hidden=!1,document.getElementById("upbar").hidden=!1}();break;case 1:await async function(){await async function(){let t=kT();yT.imagesToDraw.flyingObject=[];for(let s of t)switch(modifyingValue=yT.elements.find((t=>t.id==s)),console.log("modifyingValue"),console.log(modifyingValue),modifyingValue.elementType){case"floor":yT.drawing.image[modifyingValue.elementType]=modifyingValue.image,yT.imagesToDraw[modifyingValue.elementType]=await gT.build(yT.drawing.image[modifyingValue.elementType]),console.log("ch"),console.log(yT.drawing.audio.instruments.chords),yT.drawing.audio.instruments.chords=modifyingValue.audio.instrument;break;case"background":case"landscape":case"astrumDay":case"astrumNight":yT.drawing.image[modifyingValue.elementType]=modifyingValue.image,yT.imagesToDraw[modifyingValue.elementType]=await gT.build(yT.drawing.image[modifyingValue.elementType]);break;case"building":yT.drawing.image[modifyingValue.elementType]=modifyingValue.image,yT.imagesToDraw[modifyingValue.elementType]=await gT.build(yT.drawing.image[modifyingValue.elementType]),console.log("mel"),console.log(yT.drawing.audio.instruments.melody),yT.drawing.audio.instruments.melody=modifyingValue.audio.instrument;break;case"tree":yT.drawing.image[modifyingValue.elementType]=modifyingValue.image,yT.imagesToDraw[modifyingValue.elementType]=await gT.build(yT.drawing.image[modifyingValue.elementType]),console.log("bass"),console.log(yT.drawing.audio.instruments.bass),yT.drawing.audio.instruments.bass=modifyingValue.audio.instrument;break;case"flyingObject":{yT.drawing.image[modifyingValue.elementType].push(modifyingValue.image),yT.imagesToDraw[modifyingValue.elementType]=[];let t=0;for(let s of yT.drawing.image[modifyingValue.elementType]){if(console.log("Im here to check images to draw "),console.log(yT.imagesToDraw),console.log(s),yT.drawing.image[modifyingValue.elementType].indexOf(s)<t){var e=yT.imagesToDraw[modifyingValue.elementType][yT.drawing.image[modifyingValue.elementType].indexOf(s)];console.log(e);var n=e.clone();console.log(n),n.changeRandomParams(),console.log(n),yT.imagesToDraw[modifyingValue.elementType].push(n),console.log("pushing a recycled element")}else yT.imagesToDraw[modifyingValue.elementType].push(await gT.build(s)),console.log("pushing a recycled element");t++}}}}(),await async function(){lT.clearRect(0,0,aT.width,aT.height),console.log(CT("astrumDay")),console.log(CT("astrumNight")),console.log("passato"),ET(window.requestAnimationFrame(fT))}(),function(){jh.cancel();let t=qT(yT.drawing.audio.melody),e=zT(yT.drawing.audio.chords);console.log(t),e.barLoop!=t.loopValue&&console.error("loop bars no consistent, melodyLoop: "+t.loopValue+", chordsloop: "+e.barLoop);UT(t.notesArray,IT("melody")),BT(e.chordsList,IT("chords")),jh.loopEnd=t.loopValue,jh.loop=!0}(),ga.resume(),document.getElementById("btn-vol").onclick=VT;let t=document.getElementById("volume-slider");NT(70),t.addEventListener("input",(function(){NT(t.value)}),!1),document.getElementById("btn-dx1").onclick=()=>{var t;t="main-canvas",elem=document.getElementById(t),elem.requestFullscreen?elem.requestFullscreen():elem.webkitRequestFullscreen?elem.webkitRequestFullscreen():elem.msRequestFullscreen&&elem.msRequestFullscreen()},document.getElementById("btn-stop").onclick=()=>{OT(0),jh.stop(),ST(!1)},document.getElementById("player-navbar").hidden=!1,document.getElementById("canva-container").hidden=!1,document.getElementById("menu-container").hidden=!0,document.getElementById("menu-navbar").hidden=!0,document.getElementById("upbar").hidden=!0,jh.bpm.value=60,jh.start("+0.1","0:0:0"),ST(!0)}()}}window.addEventListener("keydown",(function(t){"Escape"==t.key&&(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen())}),!0);var RT=window.pageYOffset;function NT(t){t<=0?(document.getElementById("vol-no").style.display="block",document.getElementById("vol-low").style.display="none",document.getElementById("vol-mid").style.display="none",document.getElementById("vol-high").style.display="none"):t<40?(document.getElementById("vol-no").style.display="none",document.getElementById("vol-low").style.display="block",document.getElementById("vol-mid").style.display="none",document.getElementById("vol-high").style.display="none"):t<75?(document.getElementById("vol-no").style.display="none",document.getElementById("vol-low").style.display="none",document.getElementById("vol-mid").style.display="block",document.getElementById("vol-high").style.display="none"):t<101&&(document.getElementById("vol-no").style.display="none",document.getElementById("vol-low").style.display="none",document.getElementById("vol-mid").style.display="none",document.getElementById("vol-high").style.display="block"),document.getElementById("volume-slider").value=t,function(t){t>0&&(yT.master.mainVolumeSave=t),yT.master.mainGain.gain.value=t}(t/100),console.log(TT())}function VT(){console.log("accazzo");let t=100*TT();console.log(t),t>0?NT(0):(console.log("savedVolume"),console.log(100*bT()),NT(100*bT()))}window.onscroll=function(){var t=window.pageYOffset;document.getElementById("upbar").style.top=RT>t?"0":"-100px",RT=t};var LT;buffer1=new zh,buffer2=new zh,buffer3=new zh,buffer4=new zh;function qT(t){let e=[],n=t.split("\n"),s=(n.length,0),i=0,r=0;for(let t of n){notesArray=t.split(" "),console.log(notesArray);for(let t of notesArray){let n=FT(t),o=s+":"+i+":"+r;switch(n.time=o,"r"!=n.note&&e.push(n),n.duration){case"1m":s+=1;break;case"1m.":s+=1,i+=2;break;case"2n":i+=2;break;case"2n.":i+=3;break;case"4n":i+=1;break;case"4n.":i+=1,r+=2;break;case"8n":r+=2;break;case"8n.":r+=3;break;case"16n":r+=1}if(r>=4){let t=r%4;i+=Math.floor(r/4),r=t}if(i>=4){let t=i%4;s+=Math.floor(i/4),i=t}console.log(n)}}let o=s+":"+i+":"+r;return console.log(n),console.log(e),{notesArray:e,loopValue:o}}function FT(t){let e,n;var s=t.match(/\d/),i=t.indexOf(s);if(e=t.charAt(0),"r"!=e){"b"!=t.charAt(1)&&"#"!=t.charAt(1)||(e+=t.charAt(1)),e+=3+jT(t,"+")-jT(t,"-")}else e="r";let r=jT(t,"."),o=t.substring(i,t.length-r);switch(console.log(o),o){case"1":n="1m";break;case"2":n="2n";break;case"4":n="4n";break;case"8":n="8n";break;case"16":n="16n"}for(let t=0;t<r;t++)n+=".";return noteToRet={note:e,duration:n},console.log(noteToRet),noteToRet}function jT(t,e){return t.split(e).length-1}function UT(t,e){const n=new oh(((t,n)=>{e.triggerAttack(n.note,t,.5)}),t).start(0);return n}function BT(t,e){return chordsPlayed=new oh(((t,n)=>{e.triggerAttackRelease(n.notes,n.duration,t,.5)}),t).start(0),chordsPlayed}function zT(t){chordsToRet=[],barsArray=[],barsArray=t.split("|"),barsArray.shift(),barsArray.pop(),numOfBars=barsArray.length;let e=0,n=0,s=0;for(let t of barsArray){chordsBar=t.split(" "),console.log(chordsBar),chordsBar.shift(),chordsBar.pop(),console.log(chordsBar),n=0,s=0,quarterAdd=4/chordsBar.length,console.log(quarterAdd);for(let t of chordsBar){var i;switch(quarterAdd){case 4:i="1m";break;case 2:i="2n";break;case 1:i="4n"}var r=e+":"+n+":"+s;let o=WT(t);chord={notes:o,time:r,duration:i},n+=quarterAdd,chordsToRet.push(chord)}n>=4&&(n%=4),e++}return console.log(chordsToRet),{chordsList:chordsToRet,barLoop:e+":"+n+":"+s}}function WT(t){var e=at.get(t).notes,n=yt.distance("C",e[e.length-1]);console.log("distance from C: "+n),noteOctave=3;for(var s=e.length-1;s>=0;s--)yt.semitones(yt.distance("C",e[s]))>yt.semitones(n)&&(noteOctave--,n=yt.distance("C",e[s])),e[s]=e[s]+noteOctave;return console.log(e),e}LT={Kick:class{constructor(){var t=new Gc({envelope:{attack:.01,decay:.01,sustain:.3,release:.2},frequency:50}).toDestination();this.kick=t}trigger(t,e){this.kick.triggerAttackRelease("C1","8n",t,e)}},Snare:class{constructor(){var t=new Hc({noise:{type:"pink"},envelope:{attack:.01,decay:.1,sustain:.1,release:.1}}),e=new Bc({frequency:15e3,type:"lowpass"}).toDestination(),n=new Fa({gain:3}),s=new zc({attack:0,decay:.01,sustain:.5,release:.2,baseFrequency:"10000hz",octaves:-2}).connect(e.frequency);t.chain(n,e),this.env=s,this.snare=t}trigger(t,e){this.env.triggerAttackRelease("8n",t,e),this.snare.triggerAttackRelease("8n",t,e)}},HiHatClosed:class{constructor(){var t=new Hc({volume:-5,envelope:{attack:0,decay:0,sustain:.4,release:.1}}),e=new Bc({frequency:5e3,type:"highpass",rolloff:-24}).toDestination();t.connect(e),this.hihat=t}trigger(t,e){this.hihat.triggerAttackRelease(.01,t,e)}},HiHatOpen:class{constructor(){var t=new Hc({volume:-5,envelope:{attack:0,decay:0,sustain:.4,release:.02}}),e=new Bc({frequency:3e3,type:"highpass",rolloff:-24}).toDestination();t.connect(e),this.hihat=t}trigger(t,e){this.hihat.triggerAttackRelease(.1,t,e)}},Bell:class{constructor(){const t=new $c,e=new Eh,n=new Dh,s=new nc;t.set({voice0:{envelope:{attack:0,attackCurve:"linear",decay:1.241,decayCurve:"exponential",sustain:0,release:1.89}},voice1:{envelope:{attack:0,attackCurve:"linear",decay:1.241,decayCurve:"exponential",sustain:0,release:1.89}},harmonicity:2,vibratoAmount:0}),t.voice0.oscillator.type="sine2",t.voice1.oscillator.type="sine3",t.voice1.volume.value=-20,t.volume.value=-6,e.set({delayTime:"4n.",feedback:.3,wet:.08}),n.set({decay:4,wet:.2}),t.chain(e,n,s,Uh),this.synth=t,this.volume=s,this.lastNode=s}triggerAttack(t,e,n){this.synth.triggerAttackRelease(t,"8n",e,n)}setVolume(t){this.volume.volume.value=t}connect(t){this.lastNode.disconnect(Uh),this.lastNode.connect(t)}},Lead:class{constructor(){var t=new nh(jc);t.set({envelope:{attack:"32n",decay:"16n",sustain:"0.1",release:"16n"},oscillator:{type:"sine2"},volume:"-10"});var e=new Bc({frequency:"1500hz",type:"lowpass",rolloff:"-24db"}),n=new Mh("4n",.2);n.wet.value=.4;var s=new Dh({decay:"4"});s.wet.value=.5;var i=new Fa(.8);t.chain(e,n,s,i),this.amp=i,this.instr=t}triggerAttack(t,e,n){this.instr.triggerAttackRelease(t,"8n",e,n)}connect(t){this.amp.connect(t)}setVolume(t){this.instr.volume.value=t}},Sitar:class{constructor(){const t=new eh({attackNoise:5,dampening:1e3,release:1.5,resonance:.98,volume:0}),e=new nh(jc);e.set({volume:-40,envelope:{attack:.05,decay:1,decayCurve:"linear",sustain:0,release:1.5},detune:1220,oscillator:{type:"sine",partialCount:5,partials:[0,.2,1,0,1]}});const n=new Bc({frequency:"700Hz",type:"lowpass",rolloff:-24}),s=new Ah({frequency:.2,delayTime:20,depth:1,wet:1}),i=new bh,r=new Lh,o=new Oh({frequency:"0.6Hz",depth:1,wet:.4}),a=new Mh({delayTime:"8n.",feedback:.1,wet:.1}),c=new Dh({decay:2.5,wet:.2}),h=new nc(5);t.connect(i,0,0),e.connect(n).connect(i,0,1),i.chain(r,o,s,a,c,h,Uh),this.volume=h,this.lastNode=h,this.string=t,this.toneSynth=e}triggerAttack(t,e,n){this.string.triggerAttack(t,e,n),this.toneSynth.triggerAttackRelease(t,"8n",e,n)}setVolume(t){this.volume.volume.value=t}connect(t){this.lastNode.disconnect(Uh),this.lastNode.connect(t)}},Marimba:class{constructor(){const t=new $c,e=new jc,n=new kh(.63),s=new nc(-10),i=new Bc({frequency:"4437Hz",type:"lowpass",rolloff:-24}),r=new Bc({frequency:"170Hz",type:"highpass",rolloff:-48}),o=new Ah({frequency:.2,delayTime:.013,depth:1}),a=new Eh({delayTime:"8n.",feedback:.1,wet:.05}),c=new bh,h=new Lh,l=new nc;t.set({voice1:{envelope:{attack:0,decay:.5,sustain:0,release:.19},oscillator:{type:"sine3",volume:-3.82}},voice0:{envelope:{attack:0,decay:.5,sustain:0,release:.19},oscillator:{type:"triangle",volume:-4.62}},harmonicity:.5,vibratoAmount:.1,vibratoRate:"0.5hz"}),e.set({detune:1200,envelope:{attack:0,decay:.01,sustain:0,release:0},oscillator:{type:"sine2",volume:-10}}),t.chain(n,s,i).connect(c,0,0),e.connect(c,0,1),c.chain(h,r,o,a,l,Uh),this.dly=a,this.synthTone=t,this.synthPulse=e,this.volume=l,this.lastNode=l}triggerAttack(t,e,n){this.synthPulse.triggerAttack(t,e,n),this.synthTone.triggerAttack(t,e,n)}setVolume(t){this.volume.volume.value=t}connect(t){this.lastNode.disconnect(Uh),this.lastNode.connect(t)}},Bass1:class{constructor(){const t=new $c({voice0:{oscillator:{type:"sine"},envelope:{attack:.0012,decay:.136,sustain:.5,release:.557}},voice1:{oscillator:{type:"sine",volume:-6},envelope:{attack:.0012,decay:.136,sustain:.5,release:.557}},harmonicity:2,vibratoAmount:0}),e=new nc;t.chain(e,Uh),this.synth=t,this.volume=e,this.lastNode=e}triggerAttackRelease(t,e,n,s){this.synth.triggerAttackRelease(t,e,n,s)}setVolume(t){this.volume.volume.value=t}connect(t){this.lastNode.disconnect(Uh),this.lastNode.connect(t)}},Bass2:class{constructor(){const t=new $c({voice0:{oscillator:{type:"sine"},envelope:{attack:.003,decay:1,sustain:1,release:.008}},voice1:{oscillator:{type:"sawtooth",volume:-18},envelope:{attack:.003,decay:1,sustain:1,release:.008}},harmonicity:.5,vibratoAmount:0}),e=new Bc({frequency:"2000hz",rolloff:-12,type:"lowpass"}),n=new nc;t.chain(e,n,Uh),this.synth=t,this.volume=n,this.lastNode=n}triggerAttackRelease(t,e,n,s){this.synth.triggerAttackRelease(t,e,n,s)}setVolume(t){this.volume.volume.value=t}connect(t){this.lastNode.disconnect(Uh),this.lastNode.connect(t)}},Bass3:class{constructor(){const t=new $c({voice0:{oscillator:{type:"sine"},envelope:{attack:.003,decay:1,sustain:1,release:.008}},voice1:{oscillator:{type:"square",volume:-18},envelope:{attack:.003,decay:1,sustain:1,release:.008}},harmonicity:1,vibratoAmount:0}),e=new $c({harmonicity:.5,voice0:{oscillator:{type:"sawtooth"},envelope:{attack:.003,decay:1,sustain:1,release:.008}},voice1:{oscillator:{type:"sine"},envelope:{attack:.003,decay:1,sustain:1,release:.008}},volume:-15}),n=new Bc({frequency:"2000hz",rolloff:-12,type:"lowpass"}),s=new Ph({frequency:"16n",depth:1,type:"square"}),i=new bh,r=new Lh,o=new nc;t.connect(i,0,0),e.connect(i,0,1),i.chain(r,s,n,o,Uh),this.synth1=t,this.synth2=e,this.volume=o,this.lastNode=o}triggerAttackRelease(t,e,n,s){this.synth1.triggerAttackRelease(t,e,n,s),this.synth2.triggerAttackRelease(t,e,n,s)}setVolume(t){this.volume.volume.value=t}connect(t){this.lastNode.disconnect(Uh),this.lastNode.connect(t)}},Bass4:class{constructor(){const t=new jc({oscillator:{type:"sine"},envelope:{attack:.003,decay:.5,sustain:.1,release:.65}}),e=new nc;t.chain(e,Uh),this.synth=t,this.volume=e,this.lastNode=e}triggerAttackRelease(t,e,n,s){this.synth.triggerAttackRelease(t,e,n,s)}setVolume(t){this.volume.volume.value=t}connect(t){this.lastNode.disconnect(Uh),this.lastNode.connect(t)}},Synth1:class{constructor(){const t=new nh($c);t.set({voice0:{envelope:{attack:1,decay:1,sustain:.4,release:.5},oscillator:{type:"sine",volume:-10}},voice1:{envelope:{attack:1,decay:1,sustain:.4,release:.5},oscillator:{type:"sine",volume:0}},harmonicity:2,vibratoAmount:.4,vibratoRate:"8n"});const e=new nh(jc);e.set({envelope:{attack:1,decay:1,sustain:.4,release:.5},oscillator:{type:"sawtooth"},volume:-20});const n=new bh,s=new Lh,i=new Ih({frequency:"0.1Hz",octaves:1,baseFrequency:"440Hz",wet:1}),r=new Bc({type:"lowpass",frequency:"350Hz",rolloff:-48}),o=new Mc({min:320,max:380,frequency:"4n"}),a=new Eh({delayTime:"8n",feedback:.1,wet:.2}),c=new Ph({type:"sine",frequency:"8n",depth:.45,wet:1}),h=new nc;t.connect(n,0,0),e.connect(n,0,1),n.chain(s,i,r,a,c,h,Uh),o.connect(r.frequency),this.synth1=t,this.synth2=e,this.volume=h,this.lastNode=h}triggerAttackRelease(t,e,n,s){this.synth1.triggerAttackRelease(t,e,n,s),this.synth2.triggerAttackRelease(t,e,n,s)}setVolume(t){this.volume.volume.value=t}connect(t){this.lastNode.disconnect(Uh),this.lastNode.connect(t)}},Synth2:class{constructor(){const t=new nh($c);t.set({voice0:{envelope:{attack:.003,decay:1,sustain:1,release:.008},oscillator:{type:"sawtooth",volume:-30}},voice1:{envelope:{attack:.003,decay:1,sustain:1,release:.008},oscillator:{type:"triangle",volume:0}},harmonicity:1,vibratoAmount:0});const e=new Eh({delayTime:"16n.",feedback:.2,wet:.06}),n=new Ph({type:"sine",frequency:"16n",depth:1,wet:.5}),s=new nc;t.chain(n,e,s,Uh),this.synth1=t,this.volume=s,this.lastNode=s}triggerAttackRelease(t,e,n,s){var i=(4*Math.pow(2,2)).toString()+"n";const r=new gh(((t,e)=>{this.synth1.triggerAttackRelease(e,i,t,s)}),t,"upDown").start(n);r.playbackRate=3,r.stop(n+e)}culo(t,e,n,s){this.synth1.triggerAttackRelease(t,e,n,s)}setVolume(t){this.volume.volume.value=t}connect(t){this.lastNode.disconnect(Uh),this.lastNode.connect(t)}get(){console.log(this.synth1.get())}},Synth3:class{constructor(){const t=new nh($c);t.set({voice0:{envelope:{attack:1.479,decay:.001,sustain:0,release:0},oscillator:{type:"sine",volume:-0}},voice1:{envelope:{attack:1.479,decay:.001,sustain:0,release:0},oscillator:{type:"fatsquare",volume:-20}},volume:-8,harmonicity:1,vibratoAmount:0});const e=new nh($c);e.set({voice0:{envelope:{attack:0,decay:.099,sustain:0,release:0},oscillator:{type:"sine",volume:0}},voice1:{envelope:{attack:0,decay:.099,sustain:0,release:0},oscillator:{type:"sine",volume:-10}},harmonicity:2,detune:1200,volume:-10});const n=new bh,s=new Lh,i=new zc({attack:1.479,decay:.001,sustain:0,release:0,baseFrequency:"1700hz",octaves:3}),r=new Eh({delayTime:"8n.",feedback:.2,wet:.3}),o=new Ah({frequency:"0.2Hz",delayTime:13.25,depth:1,wet:1}),a=new Bc({type:"lowpass",frequency:"1700Hz",rolloff:-12}),c=new Bc({type:"highpass",frequency:"200Hz",rolloff:-12}),h=new nc;i.connect(a.frequency),t.connect(n,0,0),e.connect(n,0,1),n.chain(s,r,o,a,c,h,Uh),this.synth1=t,this.synth2=e,this.env=i,this.volume=h,this.lastNode=h}triggerAttackRelease(t,e,n,s){this.synth1.triggerAttackRelease(t,e,n,s),this.synth2.triggerAttackRelease(t,e,n,s),this.env.triggerAttackRelease(e,n,s)}setVolume(t){this.volume.volume.value=t}connect(t){this.lastNode.disconnect(Uh),this.lastNode.connect(t)}},Synth4:class{constructor(){const t=new nh;t.set({envelope:{attack:0,decay:.367,sustain:0,release:.008},oscillator:{type:"sine"},volume:-18});const e=new Eh({delayTime:"8n.",feedback:.2,wet:.35}),n=new Ih({frequency:"1n.",baseFrequency:"1100hz",stages:6,octaves:1,wet:.23}),s=new nc;t.chain(e,n,s,Uh),this.synth1=t,this.volume=s,this.lastNode=s}triggerAttackRelease(t,e,n,s){this.synth1.triggerAttackRelease(t,e,n,s)}setVolume(t){this.volume.volume.value=t}connect(t){this.lastNode.disconnect(Uh),this.lastNode.connect(t)}}},async function(){Bh.lookAhead=.5,yT.loadingPage.lastUpdate=Date.now(),yT.master={compressor:new Fh({threshold:-15,ratio:7}),hiddenGain:new Fa(.3),mainGain:new Fa(1),mainVolumeSave:1},console.log("master chain set"),console.log(wT()),Uh.chain(wT().hiddenGain,wT().mainGain),console.log("master chain get"),xT(40),AT(),await _T(),function(){bassChannel=new Vh,harmonyChannel=new Vh,melodyChannel=new Vh,drumChannel=new Vh,console.log("here I am"),harmonyChannel.chain(Uh),bassChannel.chain(Uh),melodyChannel.chain(Uh),drumChannel.chain(Uh);let t=new LT.Bell,e=new LT.Lead,n=new LT.Sitar,s=new LT.Marimba;t.connect(melodyChannel),e.connect(melodyChannel),n.connect(melodyChannel),s.connect(melodyChannel),MT("Bell",t),MT("Lead",e),MT("Sitar",n),MT("Marimba",s);let i=new LT.Bass1,r=new LT.Bass2,o=new LT.Bass3,a=new LT.Bass4;i.connect(bassChannel),r.connect(bassChannel),o.connect(bassChannel),a.connect(bassChannel),MT("Bass1",i),MT("Bass2",r),MT("Bass3",o),MT("Bass4",a);let c=new LT.Synth1,h=new LT.Synth2,l=new LT.Synth3,u=new LT.Synth4;c.connect(harmonyChannel),h.connect(harmonyChannel),l.connect(harmonyChannel),u.connect(harmonyChannel),MT("Synth1",c),MT("Synth2",h),MT("Synth3",l),MT("Synth4",u)}(),xT(90),function(){let t=[],e=yT.elements,n=yT.elementTypes,s=yT.environments;for(let i of n)for(let n of s){el=e.find((t=>t.elementType==i&&t.environment==n));let s=e.indexOf(el);e.splice(s,1),t.push(el)}for(;null!=(el=e.find((t=>"flyingObject"==t.elementType)));){let n=e.indexOf(el);e.splice(n,1),t.push(el)}for(;e.length>0;){let n=e.pop();t.push(n)}yT.elements=t}(),await async function(){console.log("menu Creation");var t=document.getElementById("tokenGrid");t.className="token-btn-container",console.log(vT());for(let o of vT()){console.log("datum: "),console.log(o),console.log(o.image.previewUrl);var e=await rT(o.image.previewUrl),n=document.createElement("img");n.src=e,n.className="token-image";var s=document.createElement("div"),i=document.createElement("button");if(i.id=o.id,i.className="nes-btn",i.classList.add("token-btn"),i.classList.add(o.elementType),i.classList.add(o.environment),i.style.margin="7px",i.style.marginLeft="auto",i.style.marginRight="auto",i.appendChild(n),s.classList.add("token-div"),"flyingObject"==o.elementType){var r=document.createElement("div");r.id="tAdd"+i.id,r.classList.add("token-add"),r.append("0"),s.appendChild(i),s.appendChild(r),t.appendChild(s),console.log("ciao nuvoletta")}else s.appendChild(i),t.appendChild(s)}}(),DT(),OT(0),xT(100),console.log("i nodi")}(),window.addEventListener("keydown",(function(t){"MediaPlayPause"==t.key&&(state.isPlaying?(jh.pause(),state.isPlaying=!1,console.log(state.isPlaying)):(jh.start(),state.isPlaying=!0))}),!0),console.log("melody parsing"),qT("F+4 C+8 a8 e+4 c+8 a8\nd+8 e+8 cb8 d+8 db+8 bb8 g8 ab8\na4 f8 d8 g8 a8 f8 e8\neb16 g16 bb8 d+8 db+8 r8 f8 f16 g8 f16"),console.log("testParsing"),zT("| F6 | Em7 A7 | Dm7 | Cm7 F7 |");
//# sourceMappingURL=index.c0b8b163.js.map
